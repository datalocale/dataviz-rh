var ddCtrl;function getDDCtrl(){if(ddCtrl===undefined||ddCtrl===null){ddCtrl=window;}return ddCtrl;}if(ddCtrl===undefined||ddCtrl===null){ddCtrl=getDDCtrl();}ddCtrl.isDDCtrl=true;ddCtrl.LARGE_ROW_LIMIT=20000;ddCtrl.SMALL_ROW_LIMIT=2000;ddCtrl.MOBILE_ROW_LIMIT=2000;ddCtrl.DIM_MAX_MEMBERS=1000;ddCtrl.LIMITSEARCHBOX=50;ddCtrl.LIMITINDEXATION=500;ddCtrl.LIMIT_RESULT_SEARCHBOX=10;ddCtrl.PREVIEW_ROW_LIMIT=0;ddCtrl.EDITTOOLBARWIDTH=200;ddCtrl.chartBeforeRefreshListeners=new Array();ddCtrl.chartRefreshListeners=new Array();ddCtrl.chartDrawnListeners=new Array();ddCtrl.chartModelReadyListeners=new Array();ddCtrl.dimensionFilterListeners=new Array();ddCtrl.variableChangeListeners=new Array();ddCtrl.filters={};ddCtrl.addChartBeforeRefreshListener=function(listener){ddCtrl.chartBeforeRefreshListeners.push(listener);};ddCtrl.removeChartBeforeRefreshListener=function(listener){for(var i=0;i<ddCtrl.chartBeforeRefreshListeners.length;i++){var curListener=ddCtrl.chartBeforeRefreshListeners[i];if(curListener==listener){ddCtrl.chartBeforeRefreshListeners.splice(i,1);
break;}}};ddCtrl.addChartRefreshListener=function(listener){ddCtrl.chartRefreshListeners.push(listener);};ddCtrl.removeChartRefreshListener=function(listener){for(var i=0;i<ddCtrl.chartRefreshListeners.length;i++){var curListener=ddCtrl.chartRefreshListeners[i];if(curListener==listener){ddCtrl.chartRefreshListeners.splice(i,1);break;}}};ddCtrl.addChartDrawnListener=function(listener){ddCtrl.chartDrawnListeners.push(listener);};ddCtrl.removeChartDrawnListener=function(listener){for(var i=0;i<ddCtrl.chartDrawnListeners.length;i++){var curListener=ddCtrl.chartDrawnListeners[i];if(curListener==listener){ddCtrl.chartDrawnListeners.splice(i,1);break;}}};ddCtrl.addChartModelReadyListener=function(listener){ddCtrl.chartModelReadyListeners.push(listener);};ddCtrl.removeChartModelReadyListener=function(listener){for(var i=0;i<ddCtrl.chartModelReadyListeners.length;i++){var curListener=ddCtrl.chartModelReadyListeners[i];if(curListener==listener){ddCtrl.chartModelReadyListeners.splice(i,1);break;}}};
ddCtrl.addDimensionFilterListener=function(listener){ddCtrl.dimensionFilterListeners.push(listener);};ddCtrl.removeDimensionFilterListener=function(listener){for(var i=0;i<ddCtrl.dimensionFilterListeners.length;i++){var curListener=ddCtrl.dimensionFilterListeners[i];if(curListener==listener){ddCtrl.dimensionFilterListeners.splice(i,1);break;}}};ddCtrl.addVariableChangeListener=function(listener){ddCtrl.variableChangeListeners.push(listener);};ddCtrl.removeVariableChangeListener=function(listener){for(var i=0;i<ddCtrl.variableChangeListeners.length;i++){var curListener=ddCtrl.variableChangeListeners[i];if(curListener==listener){ddCtrl.variableChangeListeners.splice(i,1);break;}}};ddCtrl.fireEvent=function(eventName,doc,dm,dmsel,chart){if(eventName=="chartBeforeRefresh"){for(var i=0;i<ddCtrl.chartBeforeRefreshListeners.length;i++){var listener=ddCtrl.chartBeforeRefreshListeners[i];if(typeof(listener)=="object"&&typeof(listener.onChartBeforeRefresh)=="function"){listener.onChartBeforeRefresh(doc,dm,dmsel,chart);
}else{listener(doc,dm,dmsel,chart);}}}else{if(eventName=="chartRefresh"){for(var i=0;i<ddCtrl.chartRefreshListeners.length;i++){var listener=ddCtrl.chartRefreshListeners[i];if(typeof(listener)=="object"&&typeof(listener.onChartRefresh)=="function"){listener.onChartRefresh(doc,dm,dmsel,chart);}else{listener(doc,dm,dmsel,chart);}}if(typeof(onChartRefresh)=="function"){onChartRefresh(doc,dm,dmsel,chart);}}else{if(eventName=="chartDrawn"){for(var i=0;i<ddCtrl.chartDrawnListeners.length;i++){var listener=ddCtrl.chartDrawnListeners[i];if(typeof(listener)=="object"&&typeof(listener.onChartDrawn)=="function"){listener.onChartDrawn(doc,dm,dmsel,chart);}else{listener(doc,dm,dmsel,chart);}}if(typeof(onChartDrawn)=="function"){onChartDrawn(doc,dm,dmsel,chart);}if(typeof(chartDrawn)=="function"){chartDrawn(doc,dm,dmsel,chart);}}else{if(eventName=="chartModelReady"){for(var i=0;i<ddCtrl.chartModelReadyListeners.length;i++){var listener=ddCtrl.chartModelReadyListeners[i];if(typeof(listener)=="object"&&typeof(listener.onChartModelReady)=="function"){listener.onChartModelReady(doc,dm,dmsel,chart);
}else{listener(doc,dm,dmsel,chart);}}}}}}};ddCtrl.fireDimensionFilterEvent=function(dimId,hierarchyId,levelId,members,membersFormated,bExcludeFilter){var bHasChanged=false;var filterOperand=new FilterOperand(dimId,members,hierarchyId,levelId);filterOperand.bExcludeFilter=bExcludeFilter;if(!ddCtrl.filters[dimId]||!ddCtrl.filters[dimId].equals(filterOperand)){bHasChanged=true;}ddCtrl.filters[dimId]=filterOperand;for(var i=0;i<ddCtrl.dimensionFilterListeners.length;i++){var listener=ddCtrl.dimensionFilterListeners[i];if(typeof(listener)=="object"&&typeof(listener.onDimensionFilter)=="function"){listener.onDimensionFilter(dimId,hierarchyId,levelId,members,membersFormated,bExcludeFilter,bHasChanged);}else{listener(dimId,hierarchyId,levelId,members,membersFormated,bExcludeFilter,bHasChanged);}}};ddCtrl.fireVariableChangeListener=function(varName,varValue){for(var i=0;i<ddCtrl.variableChangeListeners.length;i++){var listener=ddCtrl.variableChangeListeners[i];if(typeof(listener)=="object"&&typeof(listener.onVariableChange)=="function"){listener.onVariableChange(varName,varValue);
}else{listener(varName,varValue);}}};function chartBeforeRefresh(doc,dm,dmsel,chart){if(dm.onServer){displayChartLoading(doc);}}ddCtrl.addChartBeforeRefreshListener(chartBeforeRefresh);function chartRefresh(doc,dm,dmsel,chart){hideChartLoading(doc);}ddCtrl.addChartRefreshListener(chartRefresh);ddCtrl.chartError=function(doc,dm,dmsel,chart,errObj){displayChartError(doc,errObj);if(ddCtrl.checkSession&&(errObj.errorCode==401||errObj.errorCode==403)){ddCtrl.checkSession();}};function displayChartLoading(doc){var id=doc.frameId+"_wait";var waitDiv=document.getElementById(id);if(waitDiv){waitDiv.style.display="block";}if(doc.frameId){var frame=document.getElementById(doc.frameId);if(frame){frame.style.opacity=0.4;}}}function hideChartLoading(doc){hideChartError(doc);var id=doc.frameId+"_wait";var waitDiv=document.getElementById(id);if(waitDiv){waitDiv.style.display="none";}if(doc.frameId){var frame=document.getElementById(doc.frameId);if(frame){frame.style.opacity=1;}}}function displayChartError(doc,errObj){hideChartLoading(doc);
var sText="Error";var sCode=0;if(typeof(errObj)=="string"){sText=errObj;}else{if(typeof(errObj.errorMsg)=="string"){sText=errObj.errorMsg;sCode=errObj.errorCode;}else{if(typeof(errObj.message)=="string"){sText=errObj.message;}}}var id=doc.frameId+"_error";var errorDiv=document.getElementById(id);if(!errorDiv){var waitDiv=document.getElementById(doc.frameId+"_wait");if(waitDiv){errorDiv=waitDiv.cloneNode(false);errorDiv.id=id;errorDiv.innerHTML="<table class='error'><tr><td class='errorImg'></td><td><span class='errorTxt'>"+sText+"</span></td></tr></table>";errorDiv.style.display="";waitDiv.parentNode.insertBefore(errorDiv,waitDiv);}if(!errorDiv){alert(sText);}}else{errorDiv.innerHTML="<table class='error'><tr><td class='errorImg'></td><td><span class='errorTxt'>"+sText+"</span></td></tr></table>";errorDiv.style.display="";}var frame=document.getElementById(doc.frameId);if(frame){frame.style.opacity=0.4;}}function hideChartError(doc){var errorId=doc.frameId+"_error";var errorDiv=document.getElementById(errorId);
if(errorDiv){errorDiv.style.display="none";}}ddCtrl.loadFormatRepo=function(callBackFunc){if((typeof(this.formatRepo)=="undefined"||!this.formatRepo)&&typeof(this.ddAPI)!="undefined"){var thisDDCtrl=this;var cbFunc=function(retObj){var dummyDM={formatList:{}};if(thisDDCtrl.ddAPI.isError(retObj)||!retObj){return null;}else{if(typeof(retObj)=="function"){retObj(dummyDM);thisDDCtrl.formatRepo=dummyDM.formatList;}}return thisDDCtrl.formatRepo;};if(callBackFunc!=null&&typeof(callBackFunc)=="function"){return this.ddAPI.loadRepo("formatrepository",getLocale(),function(retObj){callBackFunc(cbFunc(retObj));});}else{var retObj=this.ddAPI.loadRepo("formatrepository",getLocale());return cbFunc(retObj);}}return this.formatRepo;};ddCtrl.loadVizRepo=function(){if(!this.vizRepo){include_js("./staticwebcontent/charts/template/scripts/vizrepo.js",true);}return this.vizRepo;};ddCtrl.loadTransfoRepo=function(callBackFunc){if((typeof(this.transfoRepo)=="undefined"||!this.transfoRepo)&&typeof(this.ddAPI)!="undefined"){var thisDDCtrl=this;
var cbFunc=function(retObj){if(this.ddAPI.isError(retObj)||!retObj){return null;}else{var jsFuncs=retObj;for(var a=0;a<jsFuncs.length;a++){if(jsFuncs[a].type=="TRANS"){if(jsFuncs[a].displayName){jsFuncs[a].displayName=jsFuncs[a].displayName[getLocale()]||a;}if(jsFuncs[a].description){jsFuncs[a].description=jsFuncs[a].description[getLocale()]||"";}if(typeof(ddCtrl.transfoRepo)=="undefined"){thisDDCtrl.transfoRepo={};}thisDDCtrl.transfoRepo[jsFuncs[a].id]=jsFuncs[a];}}}return thisDDCtrl.transfoRepo;};if(callBackFunc!=null&&typeof(callBackFunc)=="function"){return ddCtrl.ddAPI.loadRepo("jsfunctionrepository",getLocale(),function(retObj){callBackFunc(cbFunc(retObj));});}else{var retObj=ddCtrl.ddAPI.loadRepo("jsfunctionrepository",getLocale());return cbFunc(retObj);}}return this.transfoRepo;};ddCtrl.loadPredictRepo=function(callBackFunc){if(!this.predictRepo){include_js("./staticwebcontent/charts/template/scripts/predictrepo.js",true);}return this.predictRepo;};ddCtrl.loadCSSRepo=function(callBackFunc){return this.loadGenericRepo(callBackFunc,"cssrepository","cssRepo","key");
};ddCtrl.loadColorsRepo=function(callBackFunc){return this.loadGenericRepo(callBackFunc,"colortablerepository","colorsRepo","id");};ddCtrl.loadGenericRepo=function(callBackFunc,reponame,repoID,elemIdAttr){if(typeof(repoID)=="undefined"||!repoID){repoID=reponame;}if((typeof(this[repoID])=="undefined"||!this[repoID])&&typeof(this.ddAPI)!="undefined"){var thisDDCtrl=this;var cbFunc=function(retObj){if(thisDDCtrl.ddAPI.isError(retObj)||!retObj){return null;}else{for(var i=0;i<retObj.length;i++){if(typeof(ddCtrl[repoID])=="undefined"){thisDDCtrl[repoID]={};}thisDDCtrl[repoID][retObj[i][elemIdAttr]]=retObj[i];}}return thisDDCtrl[repoID];};if(callBackFunc!=null&&typeof(callBackFunc)=="function"){return this.ddAPI.loadRepo(reponame,getLocale(),function(retObj){callBackFunc(cbFunc(retObj));});}else{var retObj=this.ddAPI.loadRepo(reponame,getLocale());return cbFunc(retObj);}}return this[repoID];};ddCtrl.fireRefreshEvent=function(eventId){var url=ddCtrl.servletAPIPath+"?method=fireEvent&eventid="+eventId;
var xmlRequest=null;if(window.XMLHttpRequest){xmlRequest=new XMLHttpRequest();try{xmlRequest.overrideMimeType("text/plain");}catch(e){}}else{if(window.ActiveXObject){xmlRequest=new ActvieXObject("Microsoft.XMLHTTP");}}xmlRequest.open("GET",url,false);xmlRequest.send(null);var res=xmlRequest.responseText;if(res==true||res=="true"){alert(Properties[getLocale()]["RefreshEventSuccess"]);}else{alert(Properties[getLocale()]["RefreshEventFailure"]);}};ddCtrl.getUserAttribute=function(attribute,onload_CB){if(typeof(this.ddAPI)!="undefined"){var retObj=this.ddAPI.getUserAttribute(attribute);if(this.ddAPI.isError(retObj)){alert("Failed to get session attribute "+attribute);}return retObj;}return"";};ddCtrl.getSessionAttribute=function(attribute){if(typeof(this.ddAPI)!="undefined"){var retObj=this.ddAPI.getSessionAttribute(attribute);if(this.ddAPI.isError(retObj)){alert("Failed to get session attribute "+attribute);}return retObj;}return"";};ddCtrl.setSessionAttribute=function(attribute,value){if(typeof(this.ddAPI)!="undefined"){var retObj=this.ddAPI.setSessionAttribute(attribute,value);
if(this.ddAPI.isError(retObj)){alert("Failed to set session attribute "+attribute);}}};ddCtrl.chartIsEditable=function(chartFrameId){if((isIE()&&!isIE9()&&!isIE11()&&!isIE10())||isTouchDevice()){return false;}var chart=null;if(typeof(ddCtrl.getChart)!="undefined"){chart=ddCtrl.getChart(chartFrameId);}if(!chart||typeof(chart.setAxisEditor)=="undefined"){return false;}return true;};ddCtrl.editChart=function(chartFrameId){if((isIE()&&!isIE9()&&!isIE11()&&!isIE10())||isTouchDevice()){return null;}var chart=null;if(typeof(ddCtrl.getChart)!="undefined"){chart=ddCtrl.getChart(chartFrameId);}if(!chart||typeof(chart.setAxisEditor)=="undefined"){return null;}if(ddCtrl.overrideListenersForSSBI){ddCtrl.overrideListenersForSSBI();}var ae=new AxisEditor(chart,document.getElementById(charts[chartFrameId].id).contentWindow);chart.setAxisEditor(ae);var drawToolbar=ae.isDrawToolbar;var drawDropZones=ae.isDrawDropZones;if(drawToolbar){ae.drawEditToolbar(document.getElementById(charts[chartFrameId].id+"_editToolbar"));
document.getElementById(charts[chartFrameId].id+"_editToolbar").style.display="block";var frameElt=document.getElementById(chartFrameId);if(frameElt){frameElt.style.left=ddCtrl.EDITTOOLBARWIDTH+"px";var breadCrumbElt=document.getElementById(chartFrameId+"_breadcrumb");breadCrumbElt.style.left=ddCtrl.EDITTOOLBARWIDTH+"px";}}if(drawDropZones){ae.drawDropZones(document.getElementById(ddCtrl.charts[chartFrameId].id+"_dropZones"));document.getElementById(ddCtrl.charts[chartFrameId].id+"_dropZones").style.display="block";}return ae;};ddCtrl.stopEditChart=function(flowId){if(ddCtrl&&ddCtrl.dashboardStopEditChart){ddCtrl.dashboardStopEditChart(flowId);}};ddCtrl.executeInContext=function(jscode){eval(jscode);};var hex_digits=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F"],htmlIconDir="../image/icons/",fileServletRPath="../../../../file",exportAsXMode=null,__cssstyles=[],__styleSheet=null,applySafariBackground=true,BATIK=0,FF1=1,FF2=2,FF3=3,UNKNOWN=4,__navigator,_regExpChars=[],F_NUMBER=0,F_DATE=1,F_ICON=2,F_MONTH=3,F_PERCENT=4,F_TIME=5,F_ALERTER=6,__enableAddRule,BrowserDetect={init:function(){if(typeof(navigator)==="undefined"||navigator===undefined||navigator===null){this.browser="batik";
this.version=-1;this.OS="";this.mobile=false;}else{this.initData();this.browser=this.searchString(this.dataBrowser)||"";this.version=this.searchVersion(navigator.userAgent)||this.searchVersion(navigator.appVersion)||-1;this.mobile=this.searchMobile(navigator.userAgent)||this.searchMobile(navigator.appVersion)||false;this.OS=this.searchString(this.dataOS)||"";var ieVersion=ie_ver();if(ieVersion==11){this.browser="ie11";this.version=ieVersion;}}},searchString:function(data){var i,dataString,dataProp;for(i=0;i<data.length;i++){dataString=data[i].string;dataProp=data[i].prop;this.versionSearchString=data[i].versionSearch||data[i].identity;this.mobileSearchString=data[i].mobileSearch||"Mobile";if(dataString){if(dataString.indexOf(data[i].subString)!==-1){return data[i].identity;}}else{if(dataProp){return data[i].identity;}}}},searchVersion:function(dataString){var index=dataString.indexOf(this.versionSearchString);if(index===-1){return;}return parseFloat(dataString.substring(index+this.versionSearchString.length+1));
},searchMobile:function(dataString){var index=dataString.indexOf(this.mobileSearchString);return(index>-1);},initData:function(){this.dataBrowser=[{string:navigator.userAgent,subString:"Edge/",versionSearch:"Edge/",identity:"edge"},{string:navigator.userAgent,subString:"OPR/",versionSearch:"OPR/",identity:"opera"},{string:navigator.userAgent,subString:"Chrome",identity:"chrome"},{string:navigator.userAgent,subString:"chromeframe",identity:"chrome"},{string:navigator.userAgent,subString:"OmniWeb",versionSearch:"OmniWeb/",identity:"omniweb"},{string:navigator.vendor,subString:"Apple",identity:"safari",versionSearch:"Version"},{prop:window.opera,identity:"opera",versionSearch:"Version"},{string:navigator.vendor,subString:"icab",identity:"icab"},{string:navigator.vendor,subString:"KDE",identity:"konqueror"},{string:navigator.userAgent,subString:"Firefox",identity:"firefox"},{string:navigator.vendor,subString:"Camino",identity:"camino"},{string:navigator.userAgent,subString:"Netscape",identity:"netscape"},{string:navigator.userAgent,subString:"MSIE",identity:"ie",versionSearch:"MSIE"},{string:navigator.userAgent,subString:"Gecko",identity:"mozilla",versionSearch:"rv"},{string:navigator.userAgent,subString:"Mozilla",identity:"netscape",versionSearch:"Mozilla"},{string:navigator.userAgent,subString:"BlackBerry",identity:"blackberry",versionSearch:"BlackBerry"}];
this.dataOS=[{string:navigator.platform,subString:"Win",identity:"windows"},{string:navigator.platform,subString:"Mac",identity:"mac"},{string:navigator.userAgent,subString:"iPhone",identity:"iphone"},{string:navigator.userAgent,subString:"iPod",identity:"ipod"},{string:navigator.userAgent,subString:"iPad",identity:"ipad"},{string:navigator.userAgent,subString:"Android",identity:"android"},{string:navigator.platform,subString:"Linux",identity:"linux"},{string:navigator.platform,subString:"BlackBerry",identity:"blackberry"}];}};function ie_ver(){var iev=0;var ieold=(/MSIE (\d+\.\d+);/.test(navigator.userAgent));var trident=!!navigator.userAgent.match(/Trident\/7.0/);var rv=navigator.userAgent.indexOf("rv:11.0");if(ieold){iev=new Number(RegExp.$1);}if(navigator.appVersion.indexOf("MSIE 10")!=-1){iev=10;}if(trident&&rv!=-1){iev=11;}return iev;}BrowserDetect.init();function isIE(){return BrowserDetect.browser==="ie";}function isIE6(){return isIE()&&Math.floor(BrowserDetect.version)===6;}function isIE7(){return isIE()&&Math.floor(BrowserDetect.version)===7;
}function isIE8(){return isIE()&&Math.floor(BrowserDetect.version)===8;}function isIE9(){return isIE()&&Math.floor(BrowserDetect.version)===9;}function isIE10(){return isIE()&&Math.floor(BrowserDetect.version)===10;}function isIE11(){return BrowserDetect.browser==="ie11";}function isEdge(){return BrowserDetect.browser==="edge";}function isSafari(){return BrowserDetect.browser==="safari";}function isSafariMobile(){return isSafari()&&BrowserDetect.mobile;}function isChrome(){return BrowserDetect.browser==="chrome";}function isChromeMobile(){return isChrome()&&BrowserDetect.mobile;}function isFirefox(){return BrowserDetect.browser==="firefox";}function isOpera(){return BrowserDetect.browser==="opera";}function isIPad(){return BrowserDetect.OS==="ipad";}function isIPod(){return BrowserDetect.OS==="ipod";}function isIPhone(){return BrowserDetect.OS==="iphone";}function isAndroid(){return BrowserDetect.OS==="android";}function isBlackBerry(){return BrowserDetect.OS==="blackberry";}function isBatik(){return BrowserDetect.OS==="batik";
}function isAndroidTablet(){return isAndroid()&&(!BrowserDetect.mobile||BrowserDetect.version>=3);}function isTouchDevice(){return isIPad()||isIPhone()||isAndroid()||isBlackBerry();}function isPhoneDevice(){return isIPhone()||(isAndroid()&&!isAndroidTablet());}function isSVG(){return isFirefox()||(isIE()&&Math.floor(BrowserDetect.version)>=9)||isOpera()||isChrome()||isSafari()||isBlackBerry();}function isVML(){return(isIE()&&Math.floor(BrowserDetect.version)<9);}function isCanvas(){return isAndroid();}function isMobile(){return BrowserDetect.mobile;}function preCalcRegExp(){var arrCharRX_C=["\\",".","$","[","]","(",")","{","}","^","?","*","+","-"],arrCharRX_CS=["\\\\","\\.","\\$","\\[","\\]","\\(","\\)","\\{","\\}","\\^","\\?","\\*","\\+","\\-"],i;for(i=0;i<arrCharRX_C.length;i++){_regExpChars[arrCharRX_C[i]]=arrCharRX_CS[i];}}preCalcRegExp();function charToHex(decimal){return hex_digits[decimal];}function toHexa(decimal,len){var runningTotal="",quotient=decimal,savedQuotient,remainder;
while(quotient>=16){savedQuotient=Math.floor(quotient/16);remainder=quotient-(savedQuotient*16);runningTotal=charToHex(remainder)+runningTotal;quotient=savedQuotient;}runningTotal=charToHex(quotient)+runningTotal;while(runningTotal.length<len){runningTotal="0"+runningTotal;}return runningTotal;}function MIN(){var min=0,i;if(arguments.length>0){min=arguments[0];}for(i=0;i<arguments.length;i++){if(arguments[i]<min){min=arguments[i];}}return min;}function MAX(){var max=0,i;if(arguments.length>0){max=arguments[0];}for(i=0;i<arguments.length;i++){if(arguments[i]>max){max=arguments[i];}}return max;}function HSL(){}function RGB(){}function convRGBtoHSL(R,G,B){R/=255;G/=255;B/=255;var max,min,diff,r_dist,g_dist,b_dist,hsl=new HSL();max=MAX(R,G,B);min=MIN(R,G,B);diff=max-min;hsl.l=(max+min)/2;if(diff===0){hsl.h=0;hsl.s=0;}else{if(hsl.l<0.5){hsl.s=diff/(max+min);}else{hsl.s=diff/(2-max-min);}r_dist=(max-R)/diff;g_dist=(max-G)/diff;b_dist=(max-B)/diff;if(R===max){hsl.h=b_dist-g_dist;}else{if(G===max){hsl.h=2+r_dist-b_dist;
}else{if(B===max){hsl.h=4+g_dist-r_dist;}}}hsl.h*=60;if(hsl.h<0){hsl.h+=360;}if(hsl.h>=360){hsl.h-=360;}}return hsl;}function calc_rgb(q1,q2,hue){if(hue>360){hue=hue-360;}if(hue<0){hue=hue+360;}var retVal;if(hue<60){retVal=q1+(q2-q1)*hue/60;}else{if(hue<180){retVal=q2;}else{if(hue<240){retVal=q1+(q2-q1)*(240-hue)/60;}else{retVal=q1;}}}return retVal;}function convHSLtoRGB(H,S,L){var p1,p2,rgb=new RGB();if(L<=0.5){p2=L*(1+S);}else{p2=L+S-(L*S);}p1=2*L-p2;if(S===0){rgb.r=L;rgb.g=L;rgb.b=L;}else{rgb.r=calc_rgb(p1,p2,H+120);rgb.g=calc_rgb(p1,p2,H);rgb.b=calc_rgb(p1,p2,H-120);}rgb.r=Math.floor(rgb.r*255);rgb.g=Math.floor(rgb.g*255);rgb.b=Math.floor(rgb.b*255);return rgb;}function adjustColorLightRGB(col,add,mul){hsl=convRGBtoHSL(col.r,col.g,col.b);hsl.l+=add;hsl.l*=mul;if(hsl.l>1){hsl.l=1;}return convHSLtoRGB(hsl.h,hsl.s,hsl.l);}function adjustColorLight(color,add,mul){var r=parseInt(color.substr(1,2),16),g=parseInt(color.substr(3,2),16),b=parseInt(color.substr(5,2),16),hsl=convRGBtoHSL(r,g,b),rgb;
hsl.l+=add;hsl.l*=mul;if(hsl.l>1){hsl.l=1;}rgb=convHSLtoRGB(hsl.h,hsl.s,hsl.l);return"#"+toHexa(rgb.r,2)+toHexa(rgb.g,2)+toHexa(rgb.b,2);}function lightenColor(color){return adjustColorLight(color,0.3,1);}function txtColorToColor(color){var r=parseInt(color.substr(1,2),16),g=parseInt(color.substr(3,2),16),b=parseInt(color.substr(5,2),16);return r*65536+g*256+b;}mapColorsNameHex={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",honeydew:"#f0fff0",hotpink:"#ff69b4","indianred ":"#cd5c5c","indigo ":"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgreen:"#90ee90",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370db",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#db7093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",rebeccapurple:"#663399",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"};
function colorNameToColorHexa(colorName){colorName=colorName.toLowerCase();if(mapColorsNameHex[colorName]){return mapColorsNameHex[colorName];}return colorName;}function getdivisor(val){var iVal=Math.abs(val),ret;if(iVal>1000000000){ret=1000000000;}else{if(iVal>1000000){ret=1000000;}else{if(iVal>1000){ret=1000;}else{ret=1;}}}return ret;}function DurationDivisor(name,label,divisor,mandatory,twodigit){this.name=name;this.label=label;this.divisor=divisor;this.mandatory=mandatory;this.twodigit=twodigit;}function getAbbreviationNumber(val,format){format.aUnit="";if((format.kU===undefined)||(format.kU===null)||(format.kU==="")){return val;}var iVal=Math.abs(val);if(iVal>=1000000000){val=val/1000000000;format.aUnit=format.gU;}else{if(iVal>=1000000){val=val/1000000;format.aUnit=format.mU;}else{if(iVal>=1000){val=val/1000;format.aUnit=format.kU;}}}return val;}function reverse(str){var res="";var i=str.length;while(i--){res+=str.charAt(i);}return res;}function addThousandSeparator(val,separator){var s=reverse(val);
s=s.replace(/(\d{3})/g,"$1"+separator);s=reverse(s);if(s.indexOf(separator)===0){s=s.substr(separator.length,s.length);}return s;}function formatNumber(format,val){if(format.multiplier&&format.multiplier!==1){val*=format.multiplier;}var __zeros="0000000000000000000",integerpart="0",decimalpart="0",valAbbr=getAbbreviationNumber(Math.abs(val),format),isExponent=false,valFinal=null,valFixed,diff;if(format.decimal>0){valFixed=valAbbr.toFixed(format.decimal).toString();isExponent=valFixed.indexOf("E")>=0;var valFxedSplit=valFixed.split(".");integerpart=valFxedSplit[0];decimalpart=valFxedSplit[1];valFinal=valFixed;}else{integerpart=Math.round(valAbbr).toString();isExponent=integerpart.indexOf("E")>=0;valFinal=integerpart;}if(!isExponent){diff=format.leadingZero-integerpart.length;if(diff>0){integerpart=__zeros.substr(0,diff)+integerpart;}if(!format.forceDecimal){if(decimalpart){var i=decimalpart.length-1;while(i>=0&&decimalpart.charAt(i)=="0"){i--;}decimalpart=decimalpart.substring(0,i+1);if(decimalpart===""){decimalpart="0";
}}}else{try{diff=format.decimal-decimalpart.length;if(diff>0){decimalpart+=__zeros.substr(0,diff);}}catch(e){}}if(format.thousandSeparator!==undefined&&format.thousandSeparator!==null&&format.thousandSeparator!==""){integerpart=addThousandSeparator(integerpart,format.thousandSeparator);}if((decimalpart!=="0")||(format.forceDecimal&&format.decimal>0)){if(format.decimalSeparator===undefined||format.decimalSeparator===null||format.decimalSeparator===""){format.decimalSeparator=".";}valFinal=integerpart+format.decimalSeparator+decimalpart;}else{valFinal=integerpart;}}valFinal+=format.aUnit;if(format.unit!==undefined&&format.unit!==null&&format.unit!=""){if(format.unitBackPosition){valFinal+=format.unit;}else{valFinal=format.unit+valFinal;}}if(val<0){if((typeof(format.negativeDeco)=="boolean"&&format.negativeDeco==true)||(typeof(format.negativeDeco)=="number"&&format.negativeDeco==1)){valFinal="("+valFinal+")";}else{if((typeof(format.negativeDeco)=="boolean"&&format.negativeDeco==false)||(typeof(format.negativeDeco)=="number"&&format.negativeDeco==0)){valFinal="-"+valFinal;
}}}else{if(val>0){if(format.prefixingPositive){valFinal="+"+valFinal;}}}return valFinal;}function formatNum(val,format,usedFormat){var al,newVal,icnNm,date,tDur,iDr,valCmp,valCmpStr;var t="";if((format!==undefined)&&(format!==null)&&(format.type===F_ALERTER)&&format.getAlerter){al=format.getAlerter(val);newVal=val;if(al.value!==null){if(typeof al.value==="object"){if(!usedFormat){usedFormat={};}usedFormat[format.id]=true;if(!usedFormat[al.value.id]){newVal=formatNum(val,al.value,usedFormat);}else{newVal=format.id;}}else{newVal=al.value;}}return newVal;}if(val===undefined||val===null){return"";}if(typeof val==="number"&&!isFinite(val)){val=NaN;}if(format===undefined||format===null||format===""){return String(val);}if(isNaN(val)){if(format.nanReplacement!==null&&format.nanReplacement!==""){return String(format.nanReplacement);}return String(val);}if(format.type===F_NUMBER){return formatNumber(format,val);}if(format.type===F_ICON){icnNm=null;if(val>0){icnNm=format.positiveIcon;}else{if(val===0){icnNm=format.zeroIcon;
}else{if(val<0){icnNm=format.negativeIcon;}}}if(icnNm){return icnNm;}return"unk1";}if(format.type===F_DATE){date=new DDDate();val=val*1000;date.setTime(val);return date.DDFormat(format.value,getLocale());}if(format.type===F_MONTH){val=DDDate.DDMonthNames[getLocale()][val-1];}else{if(format.type===F_PERCENT){val*=100;val=formatNumber(format,val);val=val+"%";}else{if(format.type===F_TIME){if(val<0){val=-val;t="-";}if(format.value=="HH"){var hour=Math.floor(val/3600);var minutesLeft=val-(hour*3600);var minutes=Math.floor(minutesLeft/60);var secondesLeft=minutesLeft-(minutes*60);t+=hour.toString()+":"+minutes.toString()+":"+secondesLeft;return t;}else{tDur=[new DurationDivisor("year",Properties[getLocale()].y+" ",365*24*3600),new DurationDivisor("month","m ",30*24*3600),new DurationDivisor("day",Properties[getLocale()].d+" ",24*3600),new DurationDivisor("hour",":",3600,true,true),new DurationDivisor("minute",":",60,true,true),new DurationDivisor("second","",1,true,true)];iDr=0;while(iDr<tDur.length){valCmp=Math.floor(val/tDur[iDr].divisor);
if(tDur[iDr].mandatory||(valCmp>0)){if(valCmp!==0){val-=valCmp*tDur[iDr].divisor;}valCmpStr=String(valCmp);if(tDur[iDr].twodigit&&(valCmpStr.length===1)){valCmp="0"+valCmp;}t+=valCmp+tDur[iDr].label;}++iDr;}val=t;}}}}return String(val);}function formatNumHtml(val,format,ignoreColor,retStyle){var realValString="",al,newVal,alVal,color;if(exportAsXMode&&format){realValString='v="'+val+'"'+(format?' f="'+format.id+'"':"");}ignoreColor=(ignoreColor===undefined||ignoreColor===null)?false:ignoreColor;if((format!==undefined)&&(format!==null)&&(format.type===F_ALERTER)&&format.getAlerter){al=format.getAlerter(val);newVal=val;if(al.value!==null){if(typeof al.value==="object"){var usedFormat={};usedFormat[format.id]=true;if(!usedFormat[al.value.id]){newVal=formatNum(val,al.value,usedFormat);}else{newVal=format.id;}}else{newVal=al.value;}}alVal=newVal;if(al.isIcon){alVal="";var formatPourcentage=new Format(4,"",2,true,0,"","","","","","",false,0,false,"","","","","","","",1);if(format.id.indexOf("Pourcentage+")>-1||format.id.indexOf("Percent+")>-1){alVal+=" "+formatNumHtml(val,formatPourcentage,ignoreColor,null);
}if(newVal.indexOf("config/")==-1){alVal+="<img "+realValString+' align="top" src="'+htmlIconDir+"16-"+newVal+'.png"/>';}else{alVal+="<img "+realValString+' align="top" src="'+fileServletRPath+"/"+newVal+'"/>';}if(format.id.indexOf("+Pourcentage")>-1||format.id.indexOf("+Percent")>-1){alVal+=" "+formatNumHtml(val,formatPourcentage,ignoreColor,null);}}else{if(al.color||al.fillColor){if(!ignoreColor){var style="";if(al.color){style+="color:"+al.color+";";}if(al.fillColor){style+="background-color:"+al.fillColor;}alVal="<span "+realValString+" style='"+style+"'>"+newVal+"</span>";}if(retStyle){if(al.color){retStyle.color=al.color;}if(al.fillColor){retStyle.fillColor=al.fillColor;retStyle.backgroundColor=al.fillColor;}retStyle.formatted=newVal;}}else{alVal=newVal;}}return alVal;}newVal=formatNum(val,format);if((format!==undefined)&&(format!==null)){if(format.type===F_ICON){if(val===undefined||val===null||isNaN(val)){newVal="<img "+realValString+' align="top" src="'+htmlIconDir+'16-unk1.png"/>';
}else{if(newVal.indexOf("config/")==-1){newVal="<img "+realValString+' align="top" src="'+htmlIconDir+"16-"+newVal+'.png"/>';}else{newVal="<img "+realValString+' align="top" src="'+fileServletRPath+"/"+newVal+'"/>';}}}else{if(format.type===F_NUMBER||format.type===F_PERCENT){color=null;if(val>0){color=format.positiveColor;}else{if(val<0){color=format.negativeColor;}else{color=format.zeroColor;}}if(color){if(!ignoreColor){newVal="<span "+realValString+' style="color: '+color+'">'+newVal+"</span>";}if(retStyle){retStyle.color=color;retStyle.formatted=newVal;newVal="<span "+realValString+">"+newVal+"</span>";}}else{newVal="<span "+realValString+">"+newVal+"</span>";}}}}return newVal;}function getFormatColor(val,format){if(format===undefined||format===null){return null;}if(format.type===F_NUMBER){if(val>0){return format.positiveColor;}if(val<0){return format.negativeColor;}return format.zeroColor;}else{if(format.type===F_ALERTER&&format.getAlerter){var al=format.getAlerter(val);if(al){return al.color;
}}}return null;}function getAlerterFillColor(val,format){if((format!==undefined)&&(format!==null)&&(format.type===F_ALERTER)&&format.getAlerter){var al=format.getAlerter(val);if(al){return al.fillColor;}}return null;}function formatNumGO(val,format,parent,id,fclass,size){var obj=null,fval="",isIcn=false,icnSize=15,color=null,alVal,al,newVal;if(size){icnSize=size;}if((format!==undefined)&&(format!==null)&&(format.type===F_ALERTER)&&format.getAlerter){alVal="";al=format.getAlerter(val);newVal=val;if(al.value!==null){if((typeof al.value==="object")&&(al.value.type!==F_ALERTER)){newVal=formatNum(val,al.value);}else{newVal=al.value;}}if(al.isIcon){isIcn=true;}else{if(al.color){color=al.color;}}fval=newVal;}else{fval=formatNum(val,format);if((format!==undefined)&&(format!==null)&&(format.type===F_ICON)){isIcn=true;}else{color=getFormatColor(val,format);}}if(isIcn){if(typeof(GetElementByID)=="function"&&GetElementByID(fval)){obj=new LibObject(parent,fval,id,0,0,icnSize,icnSize);}else{obj=CreateTextObject(parent,id,fclass,val);
}}else{obj=CreateTextObject(parent,id,fclass,fval);if(color!==null&&color.length>0){obj.setFillColor(color);}}return obj;}function formatNumTO(val,format){var valF=formatNum(val,format);if((format!==undefined)&&(format!==null)){if(format.type==F_NUMBER){if(format.positiveColor&&format.positiveColor.length>0&&val>0){return"${color:"+format.positiveColor+":"+valF+"}";}if(format.negativeColor&&format.negativeColor.length>0&&val<0){return"${color:"+format.negativeColor+":"+valF+"}";}if(format.zeroColor&&format.zeroColor.length>0&&val==0){return"${color:"+format.zeroColor+":"+valF+"}";}}else{if(format.type==F_ICON){if(format.positiveIcon&&format.positiveIcon.length>0&&val>0){return"${icon:"+format.positiveIcon+":"+val+"}";}if(format.negativeIcon&&format.negativeIcon.length>0&&val<0){return"${icon:"+format.negativeIcon+":"+val+"}";}if(format.zeroIcon&&format.zeroIcon.length>0&&val==0){return"${icon:"+format.zeroIcon+":"+val+"}";}}else{if(format.type==F_ALERTER&&format.getAlerter){var al=format.getAlerter(val);
if(al){if(al.color){return"${color:"+al.color+":"+valF+"}";}else{if(al.isIcon){return"${icon:"+al.value+":"+val+"}";}}}}}}}return valF;}function log10(x){return Math.log(x)/Math.log(10);}function setStyle(elem,style){if(elem===undefined||elem===null){return;}if(isIE()){elem.style.setAttribute("cssText",style);}elem.setAttribute("style",style);}function addClass(elt,className){if(elt.className.indexOf(className)==-1){elt.className+=" "+className;}}function removeClass(elt,className){elt.className=elt.className.replace(className,"");}function include_js(file,bXMLHTTPRequest,onload_CB){var html_doc,js,xmlRequest,jsText;if(!bXMLHTTPRequest){html_doc=document.getElementsByTagName("head")[0];js=document.createElement("script");js.setAttribute("type","text/javascript");js.setAttribute("src",file);html_doc.appendChild(js);if(onload_CB){js.onreadystatechange=function(){if(js.readyState==="complete"){onload_CB();}};js.onload=function(){onload_CB();};}}else{xmlRequest=null;if(window.XMLHttpRequest){xmlRequest=new XMLHttpRequest();
try{xmlRequest.overrideMimeType("text/ecmascript");}catch(e){}}else{if(window.ActiveXObject){xmlRequest=new ActiveXObject("Microsoft.XMLHTTP");}}xmlRequest.open("GET",file,onload_CB?true:false);xmlRequest.onreadystatechange=function(){if(xmlRequest.readyState===4){if((xmlRequest.status===0)||(xmlRequest.status>=200&&xmlRequest.status<=206)){xmlRequest.onreadystatechange=new Function();jsText=xmlRequest.responseText;eval(jsText);if(onload_CB){onload_CB();}xmlRequest=null;}}};xmlRequest.send(null);}}function evalJSON(url,params,onload_CB){var xmlRequest=null,jsText,errObj;if(window.XMLHttpRequest){xmlRequest=new XMLHttpRequest();try{xmlRequest.overrideMimeType("text/ecmascript");}catch(e){}}else{if(window.ActiveXObject){xmlRequest=new ActiveXObject("Microsoft.XMLHTTP");}}xmlRequest.open("POST",url,onload_CB?true:false);xmlRequest.setRequestHeader("Content-type","application/x-www-form-urlencoded; charset=UTF-8");if(onload_CB){xmlRequest.onreadystatechange=function(){if(xmlRequest.readyState===4){jsText=xmlRequest.responseText;
xmlRequest.onreadystatechange=new Function();errObj=null;if(xmlRequest.status===403){errObj={};errObj.errorCode=xmlRequest.status;errObj.errorMsg="Error: Session expired: you must reconnect.";if(Properties){errObj.errorMsg=Properties[getLocale()].ErrorSessionExpired;}}else{if(xmlRequest.status===401){errObj={};errObj.errorCode=xmlRequest.status;errObj.errorMsg="Error: Unauthorized.";if(Properties){errObj.errorMsg=Properties[getLocale()].ErrorUnauthorized;}}else{if(xmlRequest.status===500){errObj={};errObj.errorCode=xmlRequest.status;errObj.errorMsg=xmlRequest.statusText;if(!errObj.errorMsg){errObj.errorMsg="Error: Server.";if(Properties){errObj.errorMsg=Properties[getLocale()].ErrorServer;}}}}}xmlRequest=null;onload_CB(jsText,errObj);}};}xmlRequest.send(params);if(!onload_CB){if(xmlRequest.status===403){errObj={};errObj.errorCode=xmlRequest.status;errObj.errorMsg="Error: Session expired: you must reconnect.";if(Properties){errObj.errorMsg=Properties[getLocale()].ErrorSessionExpired;}throw errObj;
}else{if(xmlRequest.status===401){errObj={};errObj.errorCode=xmlRequest.status;errObj.errorMsg="Error: Unauthorized.";if(Properties){errObj.errorMsg=Properties[getLocale()].ErrorUnauthorized;}throw errObj;}else{if(xmlRequest.status===500){errObj={};errObj.errorCode=xmlRequest.status;errObj.errorMsg=xmlRequest.statusText;if(!errObj.errorMsg){errObj.errorMsg="Error: Server.";if(Properties){errObj.errorMsg=Properties[getLocale()].ErrorServer;}}throw errObj;}else{return xmlRequest.responseText;}}}}return null;}function isWhiteChar(ch){if((ch===" ")||(ch==="\t")){return true;}return false;}function isSeparator(ch){if((ch>=97)&&(ch<=122)){return false;}if((ch>=65)&&(ch<=90)){return false;}if((ch>=48)&&(ch<=57)){return false;}if((ch>=192)&&(ch<=687)){return false;}return true;}function hideHourGlass(){var hg=AttachGraphicObject("hourglass");if(hg){hg.Hide();}}function applyCSS(cssName){if(!ddCtrl||!ddCtrl.loadCSSRepo){return;}ddCtrl.loadCSSRepo();if(cssName=="${client.digdashCSS}"){if(ddCtrl.urlParams&&ddCtrl.urlParams.theme){cssName=ddCtrl.urlParams.theme;
}else{if(typeof ddCtrl._digdashCSS=="undefined"){ddCtrl._digdashCSS=ddCtrl.getUserAttribute("digdashCSS");}cssName=ddCtrl._digdashCSS;}}if(ddCtrl.cssRepo&&ddCtrl.cssRepo[cssName]){var cssObj=ddCtrl.cssRepo[cssName];var cssStyle=cssObj.css;if(cssStyle.indexOf("/*")>-1){cssStyle=cssStyle.replace(/\/\*(?:(?!\*\/)[\s\S])*\*\/|[\r\n\t]+/g,"");}cssStyle=cssStyle.replace(/(\r\n|\n|\r)/gm,"");var parseMode=0;var lastSelector=null;var words=cssStyle.split(/({|})+/);for(var i=0;i<words.length;i++){var word=words[i];if(parseMode==0&&word=="{"){parseMode=1;}else{if(word=="}"&&parseMode==1){parseMode=0;}else{if(parseMode==0){lastSelector=trim(word);if(lastSelector.length==0){lastSelector=null;}}else{if(parseMode==1&&lastSelector!=null){var sRule=trim(word);if(sRule.length>0){lastSelector=lastSelector.replace("spanTotal1D","spanTotal1d");addCSSRule(lastSelector,sRule);}lastSelector=null;}}}}}}}function addCSSRule(selector,rule){if(rule==null){return;}__cssstyles[selector]=rule;if(document&&(__styleSheet===undefined||__styleSheet===null)){if(getNavigator()!=BATIK){if(isIE()||document.styleSheets.length<2){__styleSheet=document.styleSheets[0];
}else{try{__styleSheet=document.styleSheets[1];}catch(e){__enableAddRule=false;}}}else{__enableAddRule=false;}}if(__styleSheet){if(__styleSheet.insertRule){try{__styleSheet.insertRule(selector+"{"+rule+"}",__styleSheet.cssRules.length);}catch(e){}}else{if(__styleSheet.addRule){var selectors=selector.split(",");for(var iRule=0;iRule<selectors.length;iRule++){try{__styleSheet.addRule(selectors[iRule],rule,-1);}catch(e){}}}}}if(typeof addCSSRuleInternal==="function"){try{addCSSRuleInternal(selector,rule);}catch(e){}}}function isNumeric(a){return typeof a==="number"&&isFinite(a);}function needFormatAxisLabel(axisLabel){return(axisLabel.textLabel&&axisLabel.textLabel.match("{AbsoluteValue}|{PercentValue}|Member|Measure"));}function needCalculateAxisLabel(axisLabel){return(axisLabel.textLabel&&axisLabel.textLabel.match("{AbsoluteValue}|{PercentValue}"));}function replaceAll(targetStr,toReplace,replacement){var toReplaceEnc="",i,cs,r;for(i=0;i<toReplace.length;i++){cs=_regExpChars[toReplace.charAt(i)];
toReplaceEnc+=cs?cs:toReplace.charAt(i);}r=new RegExp(toReplaceEnc,"g");return targetStr.replace(r,replacement);}function formatAxisLabel(textModel,member,val,percent){if(textModel===undefined||textModel===null||typeof textModel!=="string"||textModel===""){return null;}var resp=textModel;if(val!==null){resp=replaceAll(resp,"${AbsoluteValue}",val);}if(percent!==null){resp=replaceAll(resp,"${PercentValue}",percent);}if(member!==null){resp=replaceAll(resp,"${Member}",member);}return resp;}function applyTransparencyToPNG(objId){var obj=document.getElementById(objId),mode,bg,src;if(isIE6()&&obj){if(obj.currentStyle.backgroundImage.match(/\.png/i)!==null){mode="scale";bg=obj.currentStyle.backgroundImage;src=bg.substring(5,bg.length-2);if(obj.currentStyle.backgroundRepeat==="no-repeat"){mode="crop";}obj.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+src+"', sizingMethod='"+mode+"')";obj.style.backgroundImage="url("+shim+")";}if(obj.tagName==="IMG"&&obj.src.match(/\.png$/i)!==null){src=obj.src;
obj.style.width=obj.width+"px";obj.style.height=obj.height+"px";obj.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+src+"', sizingMethod='scale')";obj.src="x.gif";}}}function safariBackgroundFix(parent,doc){if(!applySafariBackground||!isSafari()){return;}var frameId=doc.frameId,portletId=frameId.substr(6,frameId.length),portlet=parent.document.getElementById(portletId),obj=portlet,compStyle;if(obj===undefined||obj===null){obj=parent.document.getElementById(frameId);}while(obj!==null){compStyle=parent.document.defaultView.getComputedStyle(obj,null);if(compStyle!==null&&compStyle.backgroundColor!==""&&compStyle.backgroundColor!=="rgba(0, 0, 0, 0)"){if(doc.rootElement){doc.rootElement.style.backgroundColor=compStyle.backgroundColor;}else{if(doc.documentElement){doc.documentElement.style.backgroundColor=compStyle.backgroundColor;}}break;}obj=obj.parentNode;}}function trim(myString){if(myString.trim){return myString.trim();}return myString.replace(/^\s+/g,"").replace(/\s+$/g,"");
}var _RegExpsPre={"&":new RegExp("&","g"),"<":new RegExp("<","g"),">":new RegExp(">","g"),isHTML:new RegExp("<img|<span|<br|<a|<div|<input|<select|<table|<frame|<html|<ul")};function xmlEncode(str){str=String(str);str=str.replace(_RegExpsPre["&"],"&amp;");str=str.replace(_RegExpsPre["<"],"&lt;");str=str.replace(_RegExpsPre[">"],"&gt;");str=str.replace(/\'/g,"&apos;");str=str.replace(/\"/g,"&quot;");return str;}function htmlEncode(str){if(typeof str==="string"){if(str.indexOf("&")!=-1){str=str.replace(_RegExpsPre["&"],"&amp;");}if(str.indexOf("<")!=-1){str=str.replace(_RegExpsPre["<"],"&lt;");}if(str.indexOf(">")!=-1){str=str.replace(_RegExpsPre[">"],"&gt;");}}return str;}function isHTML(str){if(typeof str!=="string"){return false;}return _RegExpsPre.isHTML.test(str);}function cloneFilter(filter){if(filter!==undefined&&filter!==null){return filter.clone();}return null;}function getWindowSize(){var myWidth=0,myHeight=0,resizeOld,retObj;if(typeof window.innerWidth==="number"){myWidth=window.innerWidth;
myHeight=window.innerHeight;}else{resizeOld=window.onresize;window.onresize=null;if(document.documentElement&&(document.documentElement.clientWidth||document.documentElement.clientHeight)){myWidth=document.documentElement.clientWidth;myHeight=document.documentElement.clientHeight;}else{if(document.body&&(document.body.clientWidth||document.body.clientHeight)){myWidth=document.body.clientWidth;myHeight=document.body.clientHeight;}}window.onresize=resizeOld;}retObj={};retObj.width=myWidth;retObj.height=myHeight;return retObj;}function addSlashes(ch){ch=ch.replace(/\\/g,"\\\\");ch=ch.replace(/\'/g,"\\'");ch=ch.replace(/\"/g,'\\"');return ch;}function ColorObj(){}ColorObj.prototype.toString=function(){var str;if(this.fillColor){str=this.fillColor;}if(this.strokeColor){str+=":"+this.strokeColor;}if(this.pattern){str+="!"+this.pattern;}return str;};function contrastColor(color){var cT=color.split(":");var fColor=null;if(cT[0].charAt(0)==="!"){var tPat=cT[0].split("#");if(tPat.length>1){fColor=tPat[1];
}else{fColor=tPat[0];}}else{fColor=cT[0];}if(fColor.indexOf("#")>-1){fColor=fColor.substring(fColor.indexOf("#")+1,fColor.length);}var red=parseInt(fColor.substring(0,2),16);var green=parseInt(fColor.substring(2,4),16);var blue=parseInt(fColor.substring(4,6),16);var d=0;var a=1-(0.299*red+0.587*green+0.114*blue)/255;if(a<0.5){d=0;}else{d=255;}var valHex=d.toString(16);if(valHex.length==1){valHex+="0";}var newColor="#"+valHex+valHex+valHex;return newColor;}function getColorObj(color){var cobj=new ColorObj(),tPat,cT=color.split(":");var fColor=null;if(cT[0].charAt(0)==="!"){tPat=cT[0].split("#");if(tPat.length>1){cobj.pattern=tPat[0];fColor=tPat[1];}else{fColor=tPat[0];}}else{fColor=cT[0];}if(fColor&&fColor.indexOf("#")==-1){fColor="#"+fColor;}cobj.fillColor=fColor;if(cT.length>1){var sColor=cT[1];if(sColor&&sColor.indexOf("#")==-1){sColor="#"+sColor;}cobj.strokeColor=sColor;}else{cobj.strokeColor="#000000";cobj.strokeUndef=true;}return cobj;}function makeObject(){if(window.XMLHttpRequest){return new XMLHttpRequest();
}if(window.ActiveXObject){return new ActiveXObject("Microsoft.XMLHTTP");}alert("XMLHTTPRequest unsupported...");return null;}function closeXHR(xhr_object){xhr_object.onreadystatechange=new Function();}function IE6PNGTransparency(filters){if(navigator.appVersion.indexOf("MSIE 6")>-1){supersleight.run(filters);}}function hasSpecialCharacter(str){if(str.indexOf("\\")>-1||str.indexOf("/")>-1||str.indexOf("(")>-1||str.indexOf(")")>-1||str.indexOf(":")>-1||str.indexOf("<")>-1||str.indexOf(">")>-1||str.indexOf("|")>-1||str.indexOf('"')>-1||str.indexOf("*")>-1||str.indexOf("$")>-1||str.indexOf(".")>-1||str.indexOf("{")>-1||str.indexOf("}")>-1){return true;}return false;}function escapeXml(attribute){return xmlEncode(attribute);}function cleanNameForId(str){var dirtyChars=' .#,*/\\"><:';var ret="";for(var i=0;i<str.length;i++){var c=str.charAt(i);ret+=dirtyChars.indexOf(c)<0?c:"_";}return ret;}function setColorToInterval(value,colorIntervalDown,colorIntervalTop,min,max){var strTempItDown=colorIntervalDown.split("#");
var pattern=strTempItDown[0];if(value<=min){return pattern+"#"+strTempItDown[1].split(":")[0];}var strTempItTop=colorIntervalTop.split("#");if(value>=max){return strTempItDown[0]+"#"+strTempItTop[1].split(":")[0];}var strTempItDown2=strTempItDown[1].split("");var strRedItDown=strTempItDown2[0]+strTempItDown2[1];var strGreenItDown=strTempItDown2[2]+strTempItDown2[3];var strBlueItDown=strTempItDown2[4]+strTempItDown2[5];dRedItDown=parseInt(strRedItDown,16);dGreenItDown=parseInt(strGreenItDown,16);dBlueItDown=parseInt(strBlueItDown,16);var strTempItTop2=strTempItTop[1].split("");var strRedItTop=strTempItTop2[0]+strTempItTop2[1];var strGreenItTop=strTempItTop2[2]+strTempItTop2[3];var strBlueItTop=strTempItTop2[4]+strTempItTop2[5];dRedItTop=parseInt(strRedItTop,16);dGreenItTop=parseInt(strGreenItTop,16);dBlueItTop=parseInt(strBlueItTop,16);var medianne=((value-min)*100)/(max-min);var pourcentageTop=medianne;var pourcentageDown=100-medianne;dRed=Math.floor(((dRedItDown*pourcentageDown)/100)+((dRedItTop*pourcentageTop)/100));
dGreen=Math.floor(((dGreenItDown*pourcentageDown)/100)+((dGreenItTop*pourcentageTop)/100));dBlue=Math.floor(((dBlueItDown*pourcentageDown)/100)+((dBlueItTop*pourcentageTop)/100));hRed=dRed.toString(16);hGreen=dGreen.toString(16);hBlue=dBlue.toString(16);if(hRed.length!=2){hRed="0"+hRed;}if(hGreen.length!=2){hGreen="0"+hGreen;}if(hBlue.length!=2){hBlue="0"+hBlue;}color=pattern+"#"+hRed+hGreen+hBlue;return color;}function clearOptionsFast(selectObj){var selectParentNode=selectObj.parentNode,newSelectObj=selectObj.cloneNode(false);selectParentNode.replaceChild(newSelectObj,selectObj);return newSelectObj;}function computeCSSRecurse(elem){if(elem instanceof HTMLElement){if(elem.tagName=="SCRIPT"){return;}if(elem.tagName=="META"){return;}if(elem.tagName=="STYLE"){return;}if(elem.tagName=="HEAD"){return;}if(elem.hasChildNodes()){var nodes=elem.childNodes;for(var i=0;i<nodes.length;i++){computeCSSRecurse(nodes[i]);}}var txtStyle=trim(getStyleAsString(getComputedStyle(elem)));elem.setAttribute("style",txtStyle);
}}function computeCSS_uberslow(){computeCSSRecurse(document.documentElement);}function computeCSS(){for(k=0;k<document.styleSheets.length;k++){var cssStyleSheet=document.styleSheets[k],cssRules=cssStyleSheet.cssRules,i,cssRule,cssText,startT,endT,selectorText,elems,elem,currentStyle,j;if(cssRules!=null){for(i=cssRules.length-1;i>=0;i--){cssRule=cssRules[i];if(!cssRule||!cssRule.cssText){continue;}cssText=cssRule.cssText;startT=cssText.indexOf("{");endT=cssText.lastIndexOf("}");selectorText=cssRule.selectorText;if(selectorText){elems=document.querySelectorAll(selectorText);if(elems!==null){cssText=cssText.substring(startT+1,endT);var oStyle=parseStyle(cssText);for(j=0;j<elems.length;j++){elem=elems[j];currentStyle=elem.getAttribute("style");if(currentStyle===null||currentStyle.length===0){currentStyle=cssText;}else{var oCurrentStyle=mergeStyles(oStyle,parseStyle(currentStyle));currentStyle=getStyleAsString(oCurrentStyle);}elem.setAttribute("style",trim(currentStyle));}}}}}}}function getStyleAsString(oStyle){var style="";
for(var attr in oStyle){style+=attr+":"+oStyle[attr]+";";}return style;}function mergeStyles(oStyle,oCurrentStyle){var oNewStyle=JSON.parse(JSON.stringify(oStyle));for(var attr in oCurrentStyle){if(typeof(oNewStyle[attr])=="undefined"||oNewStyle[attr].lastIndexOf("!important")==-1){oNewStyle[attr]=oCurrentStyle[attr];}}return oNewStyle;}function parseStyle(style){var oStyle={};var tStyles=style.split(";");var len=tStyles.length;for(var i=0;i<len;i++){var css=tStyles[i];var tCSS=css.split(":");if(tCSS.length==2){var cssName=trim(tCSS[0]);if(typeof(oStyle[cssName])=="undefined"){oStyle[cssName]=trim(tCSS[1]);}}}return oStyle;}function appendURLParam(url,pName,pValue){if(url!==null){if(url.indexOf("?")>=0){return url+"&"+encodeURIComponent(pName)+"="+encodeURIComponent(pValue);}return url+"?"+encodeURIComponent(pName)+"="+encodeURIComponent(pValue);}return null;}function getNavigator(){var ffversion;if(__navigator<0){__navigator=UNKNOWN;if(navigator===undefined||navigator===null){__navigator=BATIK;
}else{if(/Firefox[\/\s](\d+\.\d+)/.test(navigator.userAgent)){ffversion=Number(RegExp.$1);__navigator=BATIK+Math.floor(ffversion);}}}return __navigator;}function isOffline(){var offlineMode=window.offlineMode;if(offlineMode==="offline"){return true;}return false;}function removeAllChilds(element){var i=0;var nodes=element.childNodes;while(i<nodes.length){element.removeChild(nodes[i]);}}function initPDFFormat(event){if(typeof(serverPDF)=="undefined"||!serverPDF){if(!ddCtrl&&event){if(event.isDDCtrl){ddCtrl=event;}else{return;}}getJSConstants();if(ddCtrl&&ddCtrl.__chart&&ddCtrl.__chart.pageFormat){var sPageFormat=ddCtrl.__chart.pageFormat;if(sPageFormat!=null&&sPageFormat.indexOf("x")>0){var sTokens=sPageFormat.split("x");try{var pWidth=parseFloat(sTokens[0]);var pHeight=parseFloat(sTokens[1]);var inPPP=sTokens.length>2?parseInt(sTokens[2]):72;__clientW=Math.floor(pWidth*(1/2.54*inPPP));__clientH=Math.floor(pHeight*(1/2.54*inPPP));return;}catch(e2){}}}if(ddCtrl&&ddCtrl.pageFormatWidth>0&&ddCtrl.pageFormatHeight>0){var pWidth=ddCtrl.pageFormatWidth;
var pHeight=ddCtrl.pageFormatHeight;__clientW=Math.floor(pWidth*(1/2.54*72));__clientH=Math.floor(pHeight*(1/2.54*72));}else{var pWidth=21;var pHeight=29.7;__clientW=Math.floor(pWidth*(1/2.54*72));__clientH=Math.floor(pHeight*(1/2.54*72));}}}function normalizeName(str){var strf=str.toLowerCase();strf=strf.replace(/[\u00e0\u00e1\u00e2\u00e3\u00e4\u00e5\u00c0\u00c1\u00c2\u00c3\u00c4\u00c5]/g,"a");strf=strf.replace(/[\u00e6\u00c6]/g,"ae");strf=strf.replace(/[\u00e7\u00c7]/g,"c");strf=strf.replace(/[\u00e8\u00e9\u00ea\u00eb\u00c8\u00c9\u00ca\u00cb]/g,"e");strf=strf.replace(/[\u00ec\u00ed\u00ee\u00ef\u00cc\u00cd\u00ce\u00cf]/g,"i");strf=strf.replace(/[\u00f1\u00d1]/g,"n");strf=strf.replace(/[\u00f2\u00f3\u00f4\u00f5\u00f6\u00d2\u00d3\u00d4\u00d5\u00d6]/g,"o");strf=strf.replace(/[\u00f9\u00fa\u00fb\u00fc\u00d9\u00da\u00db\u00dc]/g,"u");strf=strf.replace(/[\u00fd\u00ff\u00dd]/g,"y");strf=strf.replace(/ /g,"-");return strf;}var globalEval=function globalEval(src){if(window.execScript){window.execScript(src);
return;}var fn=function(){window.eval.call(window,src);};fn();};function getFileNameFromPath(fullPath){if(fullPath==null){return null;}var i=fullPath.length-1;while(i>0){if((fullPath.charAt(i)=="\\")||(fullPath.charAt(i)=="/")){++i;break;}--i;}return fullPath.substr(i);}function hashCode(str){var hash=0,i,chr,len;if(str.length==0){return hash;}for(i=0,len=str.length;i<len;i++){chr=str.charCodeAt(i);hash=((hash<<5)-hash)+chr;hash|=0;}return hash;}function arrayInsertItem(array,insertAt,insertItem){if(typeof(array.length)!="undefined"){if(insertAt==array.length){array.push(insertItem);}else{if(insertAt>array.length){array[insertAt]=insertItem;}else{array.splice(insertAt,0,insertItem);}}}}function arrayMoveItem(array,moveFrom,moveTo){if(moveFrom>=array.length){return;}moveTo=Math.min(moveTo,array.length-1);var item=array[moveFrom];array.splice(moveFrom,1);arrayInsertItem(array,moveTo,item);}function arrayRemoveItem(array,index){if(index>=array.length){return;}array.splice(index,1);}if(typeof(window)!="undefined"){window.alertError=function(msg,funcOnClose){if(!window.isDDCtrl&&typeof(ddCtrl)!="undefined"&&ddCtrl){return ddCtrl.alertError(msg,funcOnClose);
}var popupAlertError=document.getElementById("popupAlertError");if(!popupAlertError){if(window.useCustomDialogs){popupAlertError=(new DOMWrapper(document.body).add("div","popupAlertError","popupDivBg",{style:"display:none;"}).add("div",null,"popupDiv").add("form",null,null,{onsubmit:"return false"}).add("div","popupAlertErrorMsg").parent.add("div",null,"popupButtons").add("button","popupAlertErrorClose").text(getLocMessage("Close")).parent.parent.parent.parent.domElt);}else{window._nativeAlert(msg);if(funcOnClose){funcOnClose();}return;}}document.getElementById("popupAlertErrorMsg").innerHTML=genHTMLForPopup(msg);document.getElementById("popupAlertErrorClose").onclick=function(){hidePopup(popupAlertError);if(funcOnClose){funcOnClose();}return false;};showPopup(popupAlertError);document.getElementById("popupAlertErrorClose").focus();};}if(typeof(window)!="undefined"&&typeof(window._nativeAlert)=="undefined"){window._nativeAlert=window.alert;window.alert=function(msg,funcOnClose){if(!window.isDDCtrl&&typeof(ddCtrl)!="undefined"&&ddCtrl&&ddCtrl.alert!=arguments.callee){return ddCtrl.alert(msg,funcOnClose);
}var popupAlert=document.getElementById("popupAlert");if(!popupAlert){if(window.useCustomDialogs){popupAlert=(new DOMWrapper(document.body).add("div","popupAlert","popupDivBg",{style:"display:none;"}).add("div",null,"popupDiv").add("form",null,null,{onsubmit:"return false"}).add("div","popupAlertMsg").parent.add("div",null,"popupButtons").add("button","popupAlertClose").text(getLocMessage("Close")).parent.parent.parent.parent.domElt);}else{window._nativeAlert(msg);if(funcOnClose){funcOnClose();}return;}}document.getElementById("popupAlertMsg").innerHTML=genHTMLForPopup(msg);document.getElementById("popupAlertClose").onclick=function(){hidePopup(popupAlert);if(funcOnClose){funcOnClose();}return false;};showPopup(popupAlert);document.getElementById("popupAlertClose").focus();};}if(typeof(window)!="undefined"&&typeof(window._nativePrompt)=="undefined"){window._nativePrompt=window.prompt;window.prompt=function(msg,text,funcOnOK,funcOnClose){if(!window.isDDCtrl&&typeof(ddCtrl)!="undefined"&&ddCtrl){return ddCtrl.prompt(msg,text,funcOnOK,funcOnClose);
}var popupPrompt=document.getElementById("popupPrompt");if(!popupPrompt){if(window.useCustomDialogs){popupPrompt=(new DOMWrapper(document.body).add("div","popupPrompt","popupDivBg",{style:"display:none;"}).add("div",null,"popupDiv").add("form",null,null,{onsubmit:"return false"}).add("div","popupPromptLabel").parent.add("input","popupPromptInput",null,{type:"text"}).parent.add("div",null,"popupButtons").add("button","popupPromptOK").text(getLocMessage("Ok")).parent.add("button","popupPromptCancel",null,{onclick:"hidePopup(this.parentNode.parentNode.parentNode.parentNode)"}).text(getLocMessage("Cancel")).parent.parent.parent.parent.domElt);}else{var sRet=window._nativePrompt(msg,text);if(sRet!=null&&funcOnOK){funcOnOK(sRet);}if(funcOnClose){funcOnClose();}return sRet;}}document.getElementById("popupPromptLabel").innerHTML=genHTMLForPopup(msg);document.getElementById("popupPromptInput").value=text;document.getElementById("popupPromptOK").onclick=function(){var sRet=document.getElementById("popupPromptInput").value;
hidePopup(popupPrompt);if(funcOnOK){funcOnOK(sRet);}if(funcOnClose){funcOnClose();}return false;};if(funcOnClose){document.getElementById("popupPromptCancel").onclick=function(){hidePopup(popupPrompt);funcOnClose();return false;};}showPopup(popupPrompt);document.getElementById("popupPromptInput").focus();};}if(typeof(window)!="undefined"){window.promptColor=function(msg,text,funcOnOK,funcOnClose){if(!window.isDDCtrl&&typeof(ddCtrl)!="undefined"&&ddCtrl){return ddCtrl.promptColor(msg,text,funcOnOK,funcOnClose);}var popupPrompt=document.getElementById("popupPromptColor");if(!popupPrompt){if(window.useCustomDialogs){popupPrompt=(new DOMWrapper(document.body).add("div","popupPromptColor","popupDivBg",{style:"display:none;"}).add("div",null,"popupDiv").add("form",null,null,{onsubmit:"return false"}).add("div","popupPromptColorLabel").parent.add("input","popupPromptColorInput",null,{type:"text"}).parent.add("div",null,"popupButtons").add("button","popupPromptColorOK").text(getLocMessage("Ok")).parent.add("button","popupPromptColorCancel",null,{onclick:"hidePopup(this.parentNode.parentNode.parentNode.parentNode)"}).text(getLocMessage("Cancel")).parent.parent.parent.parent.domElt);
if(typeof($)!="undefined"){if(typeof(getLocMessage)!="undefined"){var strings=getLocMessage("Style.Menu.ColPick.ThemeColors")+","+getLocMessage("Style.Menu.ColPick.BaseColors")+","+getLocMessage("Style.Menu.ColPick.MoreColors")+","+getLocMessage("Style.Menu.ColPick.LessColors")+","+getLocMessage("Style.Menu.ColPick.Palette")+","+getLocMessage("Style.Menu.ColPick.History")+","+getLocMessage("Style.Menu.ColPick.NoHistory");$("#popupPromptColorInput").colorpicker({strings:strings});}else{$("#popupPromptColorInput").colorpicker();}}}else{return prompt(msg,text,funcOnOK,funcOnClose);}}document.getElementById("popupPromptColorLabel").innerHTML=genHTMLForPopup(msg);document.getElementById("popupPromptColorInput").value=text;if(typeof($)!="undefined"){$("#popupPromptColorInput").colorpicker("val",text);}document.getElementById("popupPromptColorOK").onclick=function(){var sRet=document.getElementById("popupPromptColorInput").value;hidePopup(popupPrompt);if(funcOnOK){funcOnOK(sRet);}if(funcOnClose){funcOnClose();
}return false;};if(funcOnClose){document.getElementById("popupPromptColorCancel").onclick=function(){hidePopup(popupPrompt);funcOnClose();return false;};}showPopup(popupPrompt);};}if(typeof(window)!="undefined"&&typeof(window._nativeConfirm)=="undefined"){window._nativeConfirm=window.confirm;window.confirm=function(msg,funcOnOK,funcOnClose){if(!window.isDDCtrl&&typeof(ddCtrl)!="undefined"&&ddCtrl){return ddCtrl.confirm(msg,funcOnOK,funcOnClose);}var popupConfirm=document.getElementById("popupConfirm");if(!popupConfirm){if(window.useCustomDialogs){popupConfirm=(new DOMWrapper(document.body).add("div","popupConfirm","popupDivBg",{style:"display:none;"}).add("div",null,"popupDiv").add("form",null,null,{onsubmit:"return false"}).add("div","popupConfirmMsg").parent.add("div",null,"popupButtons").add("button","popupConfirmOK").text(getLocMessage("Ok")).parent.add("button","popupConfirmCancel",null,{onclick:"hidePopup(this.parentNode.parentNode.parentNode.parentNode)"}).text(getLocMessage("Cancel")).parent.parent.parent.parent.domElt);
}else{if(window._nativeConfirm(msg)){if(funcOnOK){funcOnOK();}if(funcOnClose){funcOnClose();}return true;}else{if(funcOnClose){funcOnClose();}return false;}}}document.getElementById("popupConfirmMsg").innerHTML=genHTMLForPopup(msg);document.getElementById("popupConfirmOK").onclick=function(){hidePopup(popupConfirm);if(funcOnOK){funcOnOK();}if(funcOnClose){funcOnClose();}return false;};if(funcOnClose){document.getElementById("popupConfirmCancel").onclick=function(){hidePopup(popupConfirm);funcOnClose();return false;};}showPopup(popupConfirm);document.getElementById("popupConfirmCancel").focus();};}if(typeof(window)!="undefined"&&typeof(window._nativePromptMultiline)=="undefined"){window._nativePromptMultiline=window.promptMultiline;window.promptMultiline=function(msg,text,funcOnOK,funcOnClose){if(!window.isDDCtrl&&typeof(ddCtrl)!="undefined"&&ddCtrl){return ddCtrl.promptMultiline(msg,text,funcOnOK,funcOnClose);}var popupPromptMultiline=document.getElementById("popupPromptMultiline");if(!popupPromptMultiline){if(window.useCustomDialogs){popupPromptMultiline=(new DOMWrapper(document.body).add("div","popupPromptMultiline","popupDivBg",{style:"display:none;"}).add("div",null,"popupDiv").add("form",null,null,{onsubmit:"return false"}).add("div","popupPromptMultilineLabel").parent.add("textarea","popupPromptMultilineInput",null,{cols:"45"}).parent.add("div",null,"popupButtons").add("button","popupPromptMultilineOK").text(getLocMessage("Ok")).parent.add("button","popupPromptMultilineCancel",null,{onclick:"hidePopup(this.parentNode.parentNode.parentNode.parentNode)"}).text(getLocMessage("Cancel")).parent.parent.parent.parent.domElt);
}else{var sRet=window._nativePromptMultiline(msg,text);if(sRet!=null&&funcOnOK){funcOnOK(sRet);}if(funcOnClose){funcOnClose();}return sRet;}}document.getElementById("popupPromptMultilineLabel").innerHTML=genHTMLForPopup(msg);document.getElementById("popupPromptMultilineInput").value=text;document.getElementById("popupPromptMultilineOK").onclick=function(){var sRet=document.getElementById("popupPromptMultilineInput").value;hidePopup(popupPromptMultiline);if(funcOnOK){funcOnOK(sRet);}if(funcOnClose){funcOnClose();}return false;};if(funcOnClose){document.getElementById("popupPromptMultilineCancel").onclick=function(){hidePopup(popupPromptMultiline);funcOnClose();return false;};}showPopup(popupPromptMultiline);document.getElementById("popupPromptMultilineInput").focus();};}function promptInt(label,curValue,min,max,inc,allowEmpty,funcOnOK){var cbPrompt=function(str){var str2=trim(str);var v=parseInt(str2);if(!isNaN(v)&&v>=min&&v<=max){funcOnOK(v);}else{if(allowEmpty&&str2==""){funcOnOK(str2);
}else{alertError(getLocMessage("ValueNotIntOrNotInRange",[min,max]));promptInt(label,curValue,min,max,inc,allowEmpty,funcOnOK);}}};return prompt(label,curValue,cbPrompt);}function promptIntOrPercent(label,curValue,min,max,inc,minp,maxp,incp,allowEmpty,funcOnOK){var cbPrompt=function(str){var str2=trim(str);var v=parseInt(str2);var vp=parseFloat(str2);if(!isNaN(v)&&str2.indexOf("%")<0&&v>=min&&v<=max){funcOnOK(v);}else{if(!isNaN(vp)&&str2.indexOf("%")>0&&vp>=minp&&vp<=maxp){funcOnOK(str2);}else{if(allowEmpty&&str2==""){funcOnOK(str2);}else{alertError(getLocMessage("ValueNotIntOrPercentOrNotInRange",[min,max],[minp,maxp]));promptIntOrPercent(label,curValue,min,max,inc,minp,maxp,incp,allowEmpty,funcOnOK);}}}};return prompt(label,curValue,cbPrompt);}function promptSelect(label,curValue,choices,choicesTexts,funcOnOK,funcOnClose){if(!window.isDDCtrl&&typeof(ddCtrl)!="undefined"&&ddCtrl){return ddCtrl.promptSelect(label,curValue,choices,choicesTexts,funcOnOK,funcOnClose);}var popupPromptSelect=document.getElementById("popupPromptSelect");
if(!popupPromptSelect){popupPromptSelect=(new DOMWrapper(document.body).add("div","popupPromptSelect","popupDivBg",{style:"display:none;"}).add("div",null,"popupDiv").add("form",null,null,{onsubmit:"return false"}).add("div","popupPromptSelectLabel").parent.add("select","popupPromptSelectSelect",null).parent.add("div",null,"popupButtons").add("button","popupPromptSelectOK").text(getLocMessage("Ok")).parent.add("button","popupPromptSelectCancel",null,{onclick:"hidePopup(this.parentNode.parentNode.parentNode.parentNode)"}).text(getLocMessage("Cancel")).parent.parent.parent.parent.domElt);}document.getElementById("popupPromptSelectLabel").innerHTML=genHTMLForPopup(label);var selObj=document.getElementById("popupPromptSelectSelect");while(selObj.options.length>0){selObj.removeChild(selObj.options[0]);}for(var i=0;i<choices.length;i++){var opt=document.createElement("option");opt.value=choices[i];opt.innerHTML=(choicesTexts&&choicesTexts[i])?choicesTexts[i]:choices[i];selObj.appendChild(opt);
}selectInCombo(selObj,curValue,0);document.getElementById("popupPromptSelectOK").onclick=function(){var sRet=document.getElementById("popupPromptSelectSelect").value;hidePopup(popupPromptSelect);if(funcOnOK){funcOnOK(sRet);}if(funcOnClose){funcOnClose();}return false;};if(funcOnClose){document.getElementById("popupPromptSelectCancel").onclick=function(){hidePopup(popupPrompt);funcOnClose();return false;};}showPopup(popupPromptSelect);document.getElementById("popupPromptSelectSelect").focus();}function genHTMLForPopup(str){str=""+str;if(!isHTML(str)){var str2=str;str2=replaceAll(str2,"\\\\n","<br>");str2=replaceAll(str2,"\\n","<br>");str2=replaceAll(str2,"\n","<br>");return str2;}return str;}function showPopup(popupObj){popupObj.style.display="block";}function hidePopup(popupObj){popupObj.style.display="none";}function cloneMap(map){if(map==null){return null;}var map2={};for(var m in map){map2[m]=map[m];}return map2;}function cloneArray(array){if(array==null){return null;}return array.slice();
}function DOMWrapper(elt,parent){this.domElt=elt;this.parent=parent;}DOMWrapper.prototype.add=function(tag,id,className,attributes){var elt=document.createElement(tag);if(id){elt.setAttribute("id",id);}if(className){elt.setAttribute("class",className);}if(attributes){for(var a in attributes){if(attributes[a]){elt.setAttribute(a,attributes[a]);}}}this.domElt.appendChild(elt);return new DOMWrapper(elt,this);};DOMWrapper.prototype.input=function(type,id,className,value,attributes,disabled,onclick){var elt=document.createElement("input");if(type){elt.setAttribute("type",type);}if(id){elt.setAttribute("id",id);elt.setAttribute("name",id);}if(className){elt.setAttribute("class",className);}if(value!=null){elt.setAttribute("value",value);}if(attributes){for(var a in attributes){if(attributes[a]){elt.setAttribute(a,attributes[a]);}}}if(disabled){elt.disabled=true;}if(onclick){elt.onclick=onclick;}this.domElt.appendChild(elt);return new DOMWrapper(elt,this);};DOMWrapper.prototype.text=function(text){var elt=document.createTextNode(text);
this.domElt.appendChild(elt);return this;};function selectInCombo(selObj,selValue,defaultIndex,bAddOption){if(selObj){if(defaultIndex>=0){selObj.selectedIndex=defaultIndex;}for(var i=0;i<selObj.options.length;i++){if(selObj.options[i].value==selValue){selObj.selectedIndex=i;return true;}}if(bAddOption){var optElt=document.createElement("option");optElt.setAttribute("value",selValue);optElt.appendChild(document.createTextNode(selValue));selObj.appendChild(optElt);selObj.selectedIndex=selObj.options.length-1;return true;}}return false;}function sortAlphabetic(a,b){if(a==null||a==""){if(b==null||b==""){return 0;}return 1;}if(b==null||b==""){return -1;}if(a==b){return 0;}return a>b?1:-1;}function sortAlphabeticR(a,b){if(a==null||a==""){if(b==null||b==""){return 0;}return 1;}if(b==null||b==""){return -1;}if(a==b){return 0;}return a>b?-1:1;}function sortNumeric(a,b){if(a==null||a==null||isNaN(a)){if(b==null||isNaN(b)){return 0;}return 1;}if(b==null||isNaN(b)){return -1;}return a-b;}function sortNumericR(a,b){if(b==null||isNaN(b)){if(a==null||isNaN(a)){return 0;
}return -1;}if(a==null||isNaN(a)){return 1;}return b-a;}var latchTimer=null;function latchExecute(func,delay){if(latchTimer!=null){clearTimeout(latchTimer);latchTimer=null;}latchTimer=window.setTimeout(func,delay);}function Latcher(func,delay){this.func=func;this.delay=delay;this.timer=null;var self=this;this.start=function(){self.cancel();self.timer=window.setTimeout(self.func,self.delay);};this.cancel=function(){if(self.timer!=null){clearTimeout(self.timer);self.timer=null;}};}TK_TXT=0;TK_EXPR=1;tokObj=function(type,val){this.type=type;var multiParam=false;if(type==TK_EXPR){if(val.indexOf("/")>=0){this.params=val.split("/");multiParam=true;}else{this.params=val.split(":");}this.value=this.params.shift();if(this.params.length==0){this.checkImpliciteNumber(val);}else{if(multiParam){var num=this.params[0]-0;if(!isNaN(num)){this.checkImpliciteNumber(this.value);this.params.push(num);}}}}else{this.value=val;}};tokObj.prototype=new Object();tokObj.prototype.checkImpliciteNumber=function(val){var i=val.length-1;
var isParam=false;var lastCode=val.charCodeAt(i);var lastVal=val.length;for(var p=0;p<2;++p){while(i>1&&lastCode>=48&&lastCode<=57){--i;lastCode=val.charCodeAt(i);isParam=true;}if(isParam){if(lastCode==43||lastCode==45){this.value=val.substring(0,i);var num=val.substring(i,lastVal)-0;this.rparams=[];this.rparams.push(num);lastVal=i;--i;lastCode=val.charCodeAt(i);}else{this.value=val.substring(0,i+1);var num=val.substring(i+1,lastVal)-0;lastVal=i;this.params=[];this.params.push(num);}isParam=false;}}};tokObj.prototype.genTxt=function(funcSet,params){if(this.type==TK_TXT){return this.value;}else{var func=funcSet[this.value];if(func){return func(params,this);}else{return"${"+this.value+"}";}}};tokForm=function(){this.tokArray=[];};tokForm.prototype=new Object();tokForm.prototype.add=function(tk){this.tokArray.push(tk);};tokForm.prototype.genTxt=function(funcSet,params){var txt="";var i=0;while(i<this.tokArray.length){txt+=this.tokArray[i].genTxt(funcSet,params);++i;}return txt;};tokForm.prototype.genArr=function(funcSet,params){var arr=[];
var i=0;while(i<this.tokArray.length){arr.push(this.tokArray[i].genTxt(funcSet,params));++i;}return arr;};function tokenize(txt,pos){var i=pos;var txtBuf="";var tokF=new tokForm();var tk=null;while(i<txt.length){if((txt.charAt(i)=="$")&&(i+1<txt.length)&&(txt.charAt(i+1)=="{")){var j=i+2;var tokBuf="";while(j<txt.length){if(txt.charAt(j)=="}"){if(txtBuf.length>0){tk=new tokObj(TK_TXT,txtBuf);tokF.add(tk);}tk=new tokObj(TK_EXPR,tokBuf);tokF.add(tk);txtBuf="";i=j;break;}tokBuf+=txt.charAt(j);++j;}}else{txtBuf+=txt.charAt(i);}++i;}if(txtBuf.length>0){tk=new tokObj(TK_TXT,txtBuf);tokF.add(tk);}return tokF;}function ddimport(libjs){}function ddinclude(scriptjs){}function log(txt){try{eval("console").log(txt);}catch(e){}}function DDAPI(apiURL){this.apiURL=apiURL;this.usePOST=true;}DDAPI.PHASE_OUTPUT=65536;DDAPI.prototype.openConnection=function(){return makeObject();};DDAPI.prototype.closeConnection=function(xhrObj){if(xhrObj!=null){closeXHR(xhrObj);}};DDAPI.prototype.evalJSONResponse=function(xhrObj){var jsonTxt=xhrObj.responseText;
var retObj=null;if(jsonTxt.length>0){try{eval("retObj = "+jsonTxt);}catch(e){alert(e);}}return retObj;};DDAPI.prototype.isError=function(retObj){return retObj&&retObj.errorMessage;};DDAPI.prototype.getErrorMessage=function(retObj){if(retObj&&retObj.errorMessage){return retObj.errorMessage;}return null;};DDAPI.prototype.callRest=function(method,paramsMap,canBeNull,useJSON,callbackFunc){var conn=this.openConnection();var thisAPI=this;var url=thisAPI.apiURL;var data=(thisAPI.usePOST?"":"?")+"method="+encodeURIComponent(useJSON?method+"JSON":method);for(var i in paramsMap){data+="&"+encodeURIComponent(i)+"="+encodeURIComponent(paramsMap[i]);}var asyncMode=callbackFunc!=null&&typeof(callbackFunc)=="function";conn.open(thisAPI.usePOST?"POST":"GET",url,asyncMode);conn.setRequestHeader("Content-type","application/x-www-form-urlencoded; charset=UTF-8");var retObj=null;if(asyncMode){conn.onreadystatechange=function(){if(conn.readyState==4){if(useJSON){retObj=thisAPI.evalJSONResponse(conn);}else{retObj=conn.responseText;
}thisAPI.closeConnection(conn);if(retObj&&typeof(retObj)=="object"&&retObj.cause){retObj.errorMessage=retObj.cause;}callbackFunc(retObj);}};}conn.send(data);if(!asyncMode){if(useJSON){retObj=thisAPI.evalJSONResponse(conn);}else{retObj=conn.responseText;}thisAPI.closeConnection(conn);if(retObj&&typeof(retObj)=="object"&&retObj.cause){retObj.errorMessage=retObj.cause;}}return retObj;};DDAPI.prototype.getStatus=function(itemIdentifier,deviceId,flowView,callbackFunc){return this.callRest("getStatus",{itemIdentifier:itemIdentifier,deviceId:deviceId,flowView:flowView},true,true,callbackFunc);};DDAPI.prototype.getItem=function(itemIdentifier,deviceId,callbackFunc){return this.callRest("getItem",{itemIdentifier:itemIdentifier,sDevice:deviceId},true,true,callbackFunc);};DDAPI.prototype.saveFlowParameter=function(flowId,paramName,paramValue,callbackFunc){return this.callRest("saveFlowParameter",{flowId:flowId,paramName:paramName,paramValue:paramValue},false,true,callbackFunc);};DDAPI.prototype.loadRepo=function(repoName,lang,callbackFunc){if(repoName&&repoName.indexOf(".xml")!=repoName.length-4){repoName+=".xml";
}var repoPathXML='<repopath foldertype="0" name="'+repoName+'" onServer="true" searchvariant="false" user="false" variantfound="false"/>';return this.callRest("loadRepo",{repoPath:repoPathXML,lang:lang},true,true,callbackFunc);};DDAPI.prototype.getUserAttribute=function(attribute,callbackFunc){return this.callRest("getUserAttribute",{attribute:attribute},false,false,callbackFunc);};DDAPI.prototype.getSessionAttribute=function(attribute,callbackFunc){return this.callRest("getSessionAttribute",{attribute:attribute},false,false,callbackFunc);};DDAPI.prototype.setSessionAttribute=function(attribute,value,callbackFunc){return this.callRest("setSessionAttribute",{attribute:attribute,value:value},false,false,callbackFunc);};DDAPI.prototype.fireEvent=function(eventId,callbackFunc){return this.callRest("fireEvent",{eventid:eventId},false,true,callbackFunc);};DDAPI.prototype.getFlowSnapshots=function(flowId,callbackFunc){return this.callRest("getFlowSnapshots",{flowId:flowId},false,true,callbackFunc);
};DDAPI.prototype.saveFlowSnapshot=function(flowId,snapName,snapJSONValue,callbackFunc){return this.callRest("saveFlowSnapshot",{flowId:flowId,snapName:snapName,snapJSONValue:snapJSONValue},false,true,callbackFunc);};ColorManager=function(useColorManager){this.palettes=new Object();this.colorById=new Object();this.colorIndexByPalette=new Object();this.colorByMember=new Object();this.roleId=null;this.useColorManager=true;if(typeof(useColorManager)!="undefined"){this.useColorManager=useColorManager;}if(!this.useColorManager&&ddCtrl&&ddCtrl.addChartBeforeRefreshListener){ddCtrl.addChartBeforeRefreshListener(this);}this.legendManager=null;if(!ddCtrl&&typeof LegendManager=="function"){this.legendManager=new LegendManager();}};ColorManager.prototype.onChartBeforeRefresh=function(doc,dm,dmsel,chart){if(chart.colorManager==this){this.palettes=new Object();this.colorById=new Object();this.colorIndexByPalette=new Object();this.colorByMember=new Object();}};ColorManager.prototype.getColor=function(chart,palette,id,mbr){var mbrId=id+"."+mbr;
var color=null;var colorsByRole=null;if(ddCtrl&&ddCtrl.pageList&&chart.frameId&&ddCtrl.charts[chart.frameId]){var pageId=ddCtrl.charts[chart.frameId].pageId;if(ddCtrl.pageList[pageId]){var page=ddCtrl.pageList[pageId];if(this.colorByMember[page.roleId]){colorsByRole=this.colorByMember[page.roleId];}else{colorsByRole=this.colorByMember[""];}}}else{if(this.roleId!=null){colorsByRole=this.colorByMember[this.roleId];}}if(colorsByRole){color=colorsByRole[mbr];}if(!color){color=this.colorById[mbrId];if(!color){var paletteId="";for(var i=0;i<palette.length;i++){paletteId+=palette[i];}paletteId+=id;if(typeof(this.palettes[paletteId])=="undefined"){this.palettes[paletteId]=palette;this.colorById[mbrId]=palette[0];if(this.palettes[paletteId].length>1){this.colorIndexByPalette[paletteId]=1;}else{this.colorIndexByPalette[paletteId]=0;}color=palette[0];}else{var colorIndex=this.colorIndexByPalette[paletteId];color=palette[colorIndex];this.colorById[mbrId]=color;colorIndex++;if(colorIndex==this.palettes[paletteId].length){colorIndex=0;
}this.colorIndexByPalette[paletteId]=colorIndex;}}}if(ddCtrl&&ddCtrl.legendManager){ddCtrl.legendManager.addColor(pageId,chart.frameId,ddCtrl.charts[chart.frameId].flowId,id,mbr,color);}else{if(this.legendManager){this.legendManager.addColor(chart.slideId,chart.frameId,chart.flowId,id,mbr,color);}}return color;};ColorManager.prototype.getColorForSubmap=function(chart,palette,id,mbr){var mbrId=id+"."+mbr;var color=null;var colorsByRole=null;if(ddCtrl&&ddCtrl.pageList&&chart.frameId&&ddCtrl.charts[chart.frameId]){var pageId=ddCtrl.charts[chart.frameId].pageId;if(ddCtrl.pageList[pageId]){var page=ddCtrl.pageList[pageId];if(this.colorByMember[page.roleId]){colorsByRole=this.colorByMember[page.roleId];}else{colorsByRole=this.colorByMember[""];}}}else{if(this.roleId!=null){colorsByRole=this.colorByMember[this.roleId];}}if(colorsByRole){color=colorsByRole[mbr];}if(ddCtrl&&ddCtrl.legendManager){ddCtrl.legendManager.addColor(pageId,chart.frameId,ddCtrl.charts[chart.frameId].flowId,id,mbr,color);
}else{if(this.legendManager){this.legendManager.addColor(chart.slideId,chart.frameId,chart.flowId,id,mbr,color);}}return color;};ColorManager.prototype.setColors=function(roleId,members,colors){this.colorByMember[roleId]=new Object();for(var i=0;i<members.length;i++){var mbr=members[i];var color=colors[i];this.colorByMember[roleId][mbr]=color;}};LegendManager=function(){this.legendsFlow={};this.legendsUI={};this.document=document;if(ddCtrl&&ddCtrl.addChartBeforeRefreshListener){ddCtrl.addChartBeforeRefreshListener(this);}};LegendManager.prototype.toJSON=function(){var legendsByFlow={};for(var frameId in this.legendsFlow){var legendFlow=this.legendsFlow[frameId];var flowId=legendFlow.flowId;if(!legendsByFlow[flowId]){legendsByFlow[flowId]={};}var legendColors=legendFlow.getLegendColors();for(var i=0;i<legendColors.length;i++){var legendColor=legendColors[i];if(!legendsByFlow[flowId][legendColor.axisName]){legendsByFlow[flowId][legendColor.axisName]={};}legendsByFlow[flowId][legendColor.axisName][legendColor.axisMbr]=legendColor.color;
}}return{legendsByFlow:legendsByFlow};};LegendManager.prototype.onChartBeforeRefresh=function(doc,dm,dmsel,chart){this.unregisterChartLegend(doc.frameId);};LegendManager.prototype.addColor=function(pageId,frameId,flowId,axisName,axisMbr,color){if(frameId==null){frameId=flowId;}var portletId=frameId.replace("frame_","");if(!this.legendsFlow){this.legendsFlow={};}if(!this.legendsFlow[frameId]){this.legendsFlow[frameId]=new LegendFlow(pageId,portletId,frameId,flowId);}this.legendsFlow[frameId].addColor(axisName,axisMbr,color);if(ddCtrl){var bHidden=false;if(widgetLegendIsHidden(portletId)){bHidden=true;}if(!bHidden){for(var legendId in this.legendsUI){var legendUI=this.legendsUI[legendId];if(legendUI.pageId==pageId||legendUI.flowId==flowId){legendUI.drawColor(axisName,axisMbr,color);}}}}};LegendManager.prototype.addLegendUI=function(id,pageId,flowId,displayAxisName,layout){var legendUI=new LegendUI(id,pageId,flowId,displayAxisName,layout,this.document);this.legendsUI[legendUI.id]=legendUI;
};LegendManager.prototype.updateChartLegend=function(frameId){if(this.legendsFlow[frameId]&&ddCtrl.charts[frameId]){var pageId=ddCtrl.charts[frameId].pageId;var flowId=ddCtrl.charts[frameId].flowId;for(var legendId in this.legendsUI){var legendUI=this.legendsUI[legendId];if(legendUI.pageId==pageId||legendUI.flowId==flowId){legendUI.draw();}}}};LegendManager.prototype.unregisterChartLegend=function(frameId){if(this.legendsFlow[frameId]&&ddCtrl.charts[frameId]){var pageId=ddCtrl.charts[frameId].pageId;var flowId=ddCtrl.charts[frameId].flowId;delete this.legendsFlow[frameId];for(var legendId in this.legendsUI){var legendUI=this.legendsUI[legendId];if(legendUI.pageId==pageId||legendUI.flowId==flowId){legendUI.draw();}}}};LegendManager.prototype.clearAll=function(){this.legendsFlow={};this.legendsUI={};};LegendManager.prototype.getLegendMembers=function(){var mbrTemp=new Object();var mbrArray=new Array();var bAllMbrs=false;if(ddCtrl.pageList&&ddCtrl.pageList[ddCtrl.pageID]){var page=ddCtrl.pageList[ddCtrl.pageID];
if(page.role==ddCtrl.username){bAllMbrs=true;}}if(bAllMbrs){for(var frameId in this.legendsFlow){var legendFlow=this.legendsFlow[frameId];var legendColors=legendFlow.getLegendColors();for(var i=0;i<legendColors.length;i++){var legendColor=legendColors[i];var axisMbr=legendColor.axisMbr;if(!mbrTemp[axisMbr]){mbrArray.push(axisMbr);mbrTemp[axisMbr]=true;}}}}else{for(var frameId in this.legendsFlow){var legendFlow=this.legendsFlow[frameId];if(legendFlow.pageId==ddCtrl.pageID){var legendColors=legendFlow.getLegendColors();for(var i=0;i<legendColors.length;i++){var legendColor=legendColors[i];var axisMbr=legendColor.axisMbr;if(!mbrTemp[axisMbr]){mbrArray.push(axisMbr);mbrTemp[axisMbr]=true;}}}}}return mbrArray.sort();};LegendManager.prototype.drawLegend=function(legendId){var legendUI=this.legendsUI[legendId];legendUI.draw();};LegendManager.prototype.drawChartLegend=function(legendId){var legendUI=this.legendsUI[legendId];legendUI.draw();};LegendManager.prototype.drawPageLegend=function(legendId){var legendUI=this.legendsUI[legendId];
legendUI.draw();};LegendFlow=function(pageId,portletId,frameId,flowId){this.pageId=pageId;this.portletId=portletId;this.frameId=frameId;this.flowId=flowId;this.legendColors={};this.legendColorsOrder=[];};LegendFlow.prototype.addColor=function(axisName,axisMbr,color){var key=axisName+"_"+axisMbr;if(!this.legendColors[key]){this.legendColors[key]=new LegendColor(axisName,axisMbr,color);this.legendColorsOrder.push(key);}};LegendFlow.prototype.getLegendColors=function(){var legendColors=[];for(var i=0;i<this.legendColorsOrder.length;i++){var key=this.legendColorsOrder[i];legendColors.push(this.legendColors[key]);}return legendColors;};LegendColor=function(axisName,axisMbr,color){this.axisName=axisName;this.axisMbr=axisMbr;this.color=color;};LegendUI=function(id,pageId,flowId,displayAxisName,layout,document){this.id=id;this.pageId=pageId;this.flowId=flowId;this.displayAxisName=displayAxisName;this.layout=layout;this.document=document;this.legendElt=this.document.getElementById(this.id);};LegendUI.prototype.draw=function(){if(this.legendElt){var i=0;
var nodes=this.legendElt.childNodes;while(i<nodes.length){this.legendElt.removeChild(nodes[i]);}for(var frameId in ddCtrl.legendManager.legendsFlow){var legendFlow=ddCtrl.legendManager.legendsFlow[frameId];if(legendFlow.pageId==this.pageId||legendFlow.flowId==this.flowId){var portletId=frameId.replace("frame_","");if(!widgetLegendIsHidden(portletId)){var legendColors=legendFlow.getLegendColors();for(var i=0;i<legendColors.length;i++){var legendColor=legendColors[i];this.drawColor(legendColor.axisName,legendColor.axisMbr,legendColor.color);}}}}}};LegendUI.prototype.drawColor=function(axisName,axisMbr,color){if(this.legendElt){var axisId=this.id+"_"+axisName;var mbrId=axisId+"_"+axisMbr;var displayAxisName=this.displayAxisName;var layout=this.layout;var axisElt=this.document.getElementById(axisId);var mbrElt=this.document.getElementById(mbrId);if(axisElt==null){axisElt=this.document.createElement("div");axisElt.className="label";setStyle(axisElt,"width:100%; float:left");axisElt.id=axisId;
axisElt.membersize=0;var spanAxisName=this.document.createElement("span");spanAxisName.axisname=axisName;axisElt.appendChild(spanAxisName);if(displayAxisName){spanAxisName.innerHTML=axisName;axisElt.appendChild(document.createElement("br"));}this.legendElt.appendChild(axisElt);}if(mbrElt==null){axisElt.membersize++;var cobj=getColorObj(color);var fillColor=cobj.fillColor;if(fillColor.indexOf("#")==-1){fillColor="#"+fillColor;}var stroke=cobj.strokeColor;if(stroke==null||stroke=="none"){stroke="transparent";}test=true;if(layout==null||typeof(layout)=="undefined"||layout=="vertical"){mbrElt=this.document.createElement("div");mbrElt.id=mbrId;mbrElt.axis=axisId;mbrElt.className="legendItem";var html='<table border="0" cellspacing="0" cellpadding="0"><tr><td><table class="colorCell" border="0" width="10" height="10" cellspacing="0" cellpadding="0" style="background-color:'+fillColor+";border-color:"+stroke+'"><tr><td></td></tr></table><td><span class="label">'+axisMbr+"</span></td></tr></table>";
mbrElt.innerHTML=html;axisElt.appendChild(mbrElt);}else{if(layout=="horizontal"){mbrElt=this.document.createElement("span");setStyle(mbrElt,"float:left;");mbrElt.id=mbrId;mbrElt.axis=axisId;var spanMbr=this.document.createElement("span");spanMbr.className="label";setStyle(spanMbr,"white-space: nowrap;");spanMbr.innerHTML=axisMbr;var img=this.document.createElement("img");setStyle(img,"margin-right: 5px; margin-left: 10px; height:10px; width:10px; background-color:"+fillColor+"; border-color:"+stroke);img.src=imgFolder+"trans_pixel.png";mbrElt.appendChild(img);mbrElt.appendChild(spanMbr);axisElt.appendChild(mbrElt);}}}}};function widgetLegendIsHidden(portletId){if(ddCtrl&&typeof(ddCtrl.getWidget)!="undefined"){var widget=ddCtrl.getWidget(portletId);if(widget&&(ddCtrl.widgetIsHidden(portletId)||widget.hiddenLegend)){return true;}}return false;}var dmByURL=new Array();var dmLoaderLockByURL=new Array();var onloadCBsByURL=new Array();function loadDM(dmURL,onloadCB){var dmObj=dmByURL[dmURL];if(dmObj){onloadCB(dmObj);
}else{if(dmLoaderLockByURL[dmURL]){onloadCBsByURL[dmURL].push(onloadCB);}else{dmLoaderLockByURL[dmURL]=new Date();onloadCBsByURL[dmURL]=new Array();onloadCBsByURL[dmURL].push(onloadCB);asyncDMLoad(appendURLParam(dmURL,"l",getLocale()),"cubeDataSet",function(cubeDataSet,errorObj){if(cubeDataSet!=null&&typeof cubeDataSet==typeof loadDM){var dm=new DataModel();cubeDataSet(dm);if(!loadDMDataIfNeeded(dm,dmURL)){dmLoaded(dm,dmURL);}}else{var msg="Error while loading cube at:\n"+dmURL+"\nDetails: "+errorObj;if(Properties){msg=Properties[getLocale()]["ErrorLoadingCube"]+dmURL+"\nDetails: "+errorObj;}if(typeof(errorObj)=="number"){if(errorObj==403){var msg="Error: Session expired: you must reconnect.";if(Properties){msg=Properties[getLocale()]["ErrorSessionExpired"];}}else{if(errorObj==401){var msg="Error: Unauthorized.";if(Properties){msg=Properties[getLocale()]["ErrorUnauthorized"];}}}}dmLoaded(null,dmURL,msg);}});}}}function dmLoaded(dm,dmURL,errObj){for(var i=0;i<onloadCBsByURL[dmURL].length;
i++){onloadCBsByURL[dmURL][i](dm,errObj);}dmByURL[dmURL]=dm;dmLoaderLockByURL[dmURL]=null;}function loadDMDataIfNeeded(dm,dmURL){if(typeof(dm.onServer)=="undefined"){var limitRow=getLimitRowByUserAgent(false);if(dm.lineCount>limitRow){dm.onServer=true;}}if(dm.onServer){return false;}else{loadDMData(dm,dmURL);return true;}}function loadDMData(dm,dmURL){var ind=dmURL.lastIndexOf("cube_dm_");var dmDataURL=dmURL.substring(0,ind)+"cube_data_"+dmURL.substring(ind+"cube_dm_".length);asyncDMLoad(dmDataURL,"loadData",function(loadData,errorObj){if(loadData!=null&&typeof loadData==typeof loadDM){loadData(dm);dm.onServer=false;}else{if(typeof(dm.columns)=="undefined"||dm.columns.length==0){dm.onServer=true;}}dmLoaded(dm,dmURL);});}function asyncDMLoad(file,funcNameToCall,onload_CB){var xmlRequest=null;if(window.XMLHttpRequest){xmlRequest=new XMLHttpRequest();try{xmlRequest.overrideMimeType("text/ecmascript");}catch(e){}}else{if(window.ActiveXObject){xmlRequest=new ActiveXObject("Microsoft.XMLHTTP");
}}xmlRequest.open("GET",file,true);xmlRequest.onreadystatechange=function(){if(xmlRequest.readyState==4){if((xmlRequest.status==0)||(xmlRequest.status>=200&&xmlRequest.status<=206)){xmlRequest.onreadystatechange=new Function;try{var jsText=xmlRequest.responseText;eval(jsText);if(onload_CB){if(funcNameToCall=="cubeDataSet"){onload_CB(cubeDataSet);cubeDataSet=null;}else{if(funcNameToCall=="loadData"){onload_CB(loadData);loadData=null;}}}}catch(e){if(onload_CB){onload_CB(null,e);}}}else{if(onload_CB){onload_CB(null,xmlRequest.status);}}xmlRequest=null;}};xmlRequest.send(null);}function getLimitRowByUserAgent(){var ua=navigator.userAgent.toLowerCase();if(isOffline()){return ddCtrl.LARGE_ROW_LIMIT;}else{if(isFirefox()){return ddCtrl.LARGE_ROW_LIMIT;}else{if(isIE()){return ddCtrl.SMALL_ROW_LIMIT;}else{if(isOpera()){return ddCtrl.LARGE_ROW_LIMIT;}else{if(isIPhone()||isIPod()||isIPad()){return ddCtrl.MOBILE_ROW_LIMIT;}else{if(isAndroid()&&ua.indexOf("webkit")>-1){return ddCtrl.MOBILE_ROW_LIMIT;
}else{if(isChrome()){return ddCtrl.LARGE_ROW_LIMIT;}else{if(isSafari()){return ddCtrl.LARGE_ROW_LIMIT;}else{if(ua.indexOf("gecko")>-1){return ddCtrl.LARGE_ROW_LIMIT;}else{return ddCtrl.SMALL_ROW_LIMIT;}}}}}}}}}}function getMaxLimitRow(){return ddCtrl.LARGE_ROW_LIMIT;}ddCtrl.getPreviewRowLimit=function(){if(ddCtrl.usePreviewRowLimit){return ddCtrl.PREVIEW_ROW_LIMIT;}else{return 0;}};ChartHandle=function(id,svgURL,dmURL,dmViewURL,dmServerURL,pageId,frameObj,containerId){this.id=id;this.frameObj=frameObj;this.svgURL=svgURL;this.dmURL=dmURL;this.dmViewURL=dmViewURL;this.dmServerURL=dmServerURL;if(typeof(pageId)!="undefined"){this.pageId=pageId;}else{this.pageId=ddCtrl.pageID;}this.portletId=this.id.replace("frame_","");this.containerId=containerId;this.registerChart();};ChartHandle.prototype.registerChart=function(){var cubeURL=this.dmURL;var beginIndex=cubeURL.indexOf("cube_dm_")+"cube_dm_".length;var cubeId=cubeURL.substr(beginIndex,cubeURL.length);beginIndex=cubeId.indexOf(".js");if(beginIndex>0){cubeId=cubeId.substr(0,beginIndex);
}if(typeof(dmByPage)!="undefined"&&dmByPage){var dmsList=dmByPage[this.pageId];if(dmsList==null){dmsList=new Array();dmByPage[this.pageId]=dmsList;}dmsList[cubeId]=true;dmByPage[this.id]=new Array();dmByPage[this.id][cubeId]=true;if(this.containerId){if(!dmByPage[this.containerId]){dmByPage[this.containerId]=new Array();}dmByPage[this.containerId][cubeId]=true;}}if(typeof(this.flowId)!="undefined"){var dmsList=new Array();dmsList[cubeId]=true;}};ChartHandle.prototype.getContentDocument=function(){try{var fObj=null;if(this.frameObj){fObj=this.frameObj;}else{fObj=document.getElementById(this.id);}if(fObj){var doc=fObj.contentDocument;if(doc){doc.pageId=this.pageId;doc.portletId=this.portletId;doc.frameId=this.id;return doc;}doc=fObj.contentWindow.document;doc.pageId=this.pageId;doc.portletId=this.portletId;doc.frameId=this.id;return doc;}return null;}catch(e){return null;}};function chartLoaded(documentLoaded){for(i in charts){if(charts[i]!=null&&typeof(charts[i])!="function"&&documentLoaded==charts[i].getContentDocument()){var dmViewURL=charts[i].dmViewURL;
var dmServerURL=charts[i].dmServerURL;loadDM(charts[i].dmURL,function(dm,errObj){if(documentLoaded.setDataCube&&dm!=null){dm.serverURL=dmServerURL;documentLoaded.setDataCube(dm,dmViewURL);}else{if(errObj){if(ddCtrl.chartError){ddCtrl.chartError(documentLoaded,null,null,charts[i],errObj);}else{alert(errObj);}}}});return;}}}if(typeof(ddCtrl.charts)=="undefined"){ddCtrl.charts={};}var charts=ddCtrl.charts;Filter=function(id,pageId,options,hiddenDimensions,bFillNow){this.id=id;this.pageId=pageId;this.hiddenDimensions=hiddenDimensions;for(optId in options){var option=options[optId];this[optId]=option;}if(bFillNow&&ddCtrl.isPageVisible(this.pageId)){this.createFilterUI();for(var panelId in ddCtrl.dimPanelList){var dimSelPanel=ddCtrl.dimPanelList[panelId];if(dimSelPanel.dimsByPageId[this.pageId]){this.onChange(dimSelPanel);}}}ddCtrl.addCurrentPageLoadListener(this);ddCtrl.addDimensionFilterListener(this);};Filter.prototype.currentPageLoaded=function(currentPage,bFirstTime){if(ddCtrl.isPageVisible(this.pageId)){this.createFilterUI();
}};Filter.prototype.onDimensionFilter=function(dimId,hierarchyId,levelId,members,membersFormated){var dimSelPanel=ddCtrl.dimPanelList[dimId+"true"];if(!dimSelPanel){dimSelPanel=ddCtrl.dimPanelList[dimId+"false"];}if(dimSelPanel){var pageId=null;if(ddCtrl.isPageVisible(this.pageId)){pageId=this.pageId;}else{if(ddCtrl.charts[ddCtrl.pageID]){pageId=ddCtrl.charts[ddCtrl.pageID].pageId;}}if(pageId!=null&&dimSelPanel.dimsByPageId[pageId]){var members=dimSelPanel.getSelectedElements();var membersFormated=dimSelPanel.getSelectedFormatedElements();var hierarchyName=dimSelPanel.getSelectedHierarchyName();var levelName=dimSelPanel.getSelectedLevelName();for(var i=0;i<dimSelPanel.dimsByPageId[pageId].length;i++){var dim=dimSelPanel.dimsByPageId[pageId][i];if(dim.id==dimSelPanel.id){if(!this.isDimensionHidden(dim.id)){if(members!=null&&(members.length==0||members[0]=="All")){this.removeAllFilters(dim.id);}else{var bRemove=true;if(((getComboAttribute(dimSelPanel.id,"hideall",false)&&members.length==1)||(!ddCtrl.userACLs[ACLChartNavigation]))&&typeof(offlineMode)=="undefined"){bRemove=false;
}this.displayFilter(dim,hierarchyName,levelName,members,membersFormated,bRemove,dimSelPanel.reverseFilter);}}break;}}}}};Filter.prototype.isDimensionHidden=function(dimId){if(this.hiddenDimensions&&this.hiddenDimensions[dimId]==true){return true;}return false;};Filter.prototype.displayFilter=function(dim,hierarchyName,levelName,members,membersFormated,bRemove,bExclude){this.drawFilter(dim,hierarchyName,levelName,members,membersFormated,bRemove,bExclude);};Filter.prototype.createFilterUI=function(){var filterPortlet=document.getElementById(this.id);var contentId=this.id+"_content";var divContent=document.getElementById(contentId);if(filterPortlet&&!divContent){var divHeader=document.createElement("div");divHeader.className="divHeader";filterPortlet.appendChild(divHeader);var table=document.createElement("table");setStyle(table,"width: 100%");table.className="slicerTable";divHeader.appendChild(table);var tbody=document.createElement("tbody");tbody.className="slicerTable";table.appendChild(tbody);
var trHeader=document.createElement("tr");trHeader.className="trHeaderFilter";tbody.appendChild(trHeader);var tdFieldsHeader=document.createElement("td");tdFieldsHeader.className="tdHeaderFilter";tdFieldsHeader.innerHTML=Properties[getLocale()]["Fields"];trHeader.appendChild(tdFieldsHeader);var tdValuesHeader=document.createElement("td");tdValuesHeader.className="tdHeaderFilter";tdValuesHeader.colSpan=2;tdValuesHeader.innerHTML=Properties[getLocale()]["Values"];trHeader.appendChild(tdValuesHeader);var divContent=document.createElement("div");divContent.id=contentId;divContent.className="divContent";var filterPortletHeight=filterPortlet.offsetHeight-divHeader.offsetHeight;setStyle(divContent,"height:"+filterPortletHeight+"px");filterPortlet.appendChild(divContent);var table=document.createElement("table");setStyle(table,"width: 100%");table.className="slicerTable";divContent.appendChild(table);var tbody=document.createElement("tbody");tbody.id=this.id+"_tbody";table.appendChild(tbody);}};
Filter.prototype.drawFilter=function(dim,hierarchyName,levelName,members,membersFormated,bRemove,bExclude){var dimId=dim.id;var dimName=dim.name;var filterPortlet=document.getElementById(this.id);if(filterPortlet){var filterTable=document.getElementById(this.id+"_tbody");if(!filterTable){this.createFilterUI();filterTable=document.getElementById(this.id+"_tbody");}if(filterTable){var filterContentDiv=document.getElementById(this.id+"_content");if(filterContentDiv){var filterPortletHeight=filterPortlet.offsetHeight;if(filterPortlet.firstChild&&filterPortlet.firstChild.className=="divHeader"){filterPortletHeight=filterPortletHeight-filterPortlet.firstChild.offsetHeight;}else{filterPortletHeight=filterPortletHeight-20;}setStyle(filterContentDiv,"height:"+filterPortletHeight+"px");}var filterPortletWidth=filterPortlet.offsetWidth;var tdWidth=(filterPortletWidth-20)/2;var id=this.id+"_tr_"+dimId+0;var tr=document.getElementById(id);if(tr!=null){var iTr=0;var trId=this.id+"_tr_"+dimId+iTr;var elt=document.getElementById(trId);
while(elt!=null){filterTable.removeChild(elt);iTr++;trId=this.id+"_tr_"+dimId+iTr;elt=document.getElementById(trId);}}tr=document.createElement("tr");tr.id=id;tr.className="trFilter";filterTable.appendChild(tr);var tdDimName=document.createElement("td");tdDimName.className="tdFilter";if(bExclude){tdDimName.className+=" tdFilterExclude";}setStyle(tdDimName,"width: "+tdWidth+"px; max-width: "+tdWidth+"px");var html=null;var tooltip=null;if(typeof(this.showDimension)!="undefined"){if(this.showDimension){html=dimName;}if(hierarchyName!=null&&levelName!=null&&levelName!=Properties[getLocale()]["Root"]){if(this.showHierarchy){if(html!=null){html+=" / "+hierarchyName;}else{html=hierarchyName;}}if(this.showLevel){if(html!=null){html+=" / "+levelName;}else{html=levelName;}}}if(html==null){html=dimName;}}else{html=dimName;if(hierarchyName!=null&&levelName!=null&&levelName!=Properties[getLocale()]["Root"]){html=levelName;}}tooltip=html;tdDimName.innerHTML=html;tdDimName.title=tooltip;if(membersFormated.length>1){tdDimName.rowSpan=membersFormated.length;
}tr.appendChild(tdDimName);var i=0;while(i<membersFormated.length){var trId=this.id+"_tr_"+dimId+i;tr=document.getElementById(trId);if(i!=0&&tr==null){tr=document.createElement("tr");tr.id=this.id+"_tr_"+dimId+i;tr.className="trFilter";filterTable.appendChild(tr);}var tdMember=document.createElement("td");tdMember.className="tdFilter";if(bExclude){tdMember.className+=" tdFilterExclude";}setStyle(tdMember,"width: "+tdWidth+"px; max-width: "+tdWidth+"px");tdMember.innerHTML=membersFormated[i];tdMember.title=membersFormated[i];tr.appendChild(tdMember);this.addDeleteImage(tr,dimId,dim.continuous,members[i],membersFormated[i],i,bRemove);i++;}}}};function removeFilter(elt){var dimId=elt.dimId;var dimContinuous=elt.dimContinuous;var dimPanel=dimPanelList[dimId+dimContinuous];dimPanel.removeFilterDMSels(elt.member);}Filter.prototype.removeAllFilters=function(dimId){var iTr=0;var trId=this.id+"_tr_"+dimId+iTr;var elt=document.getElementById(trId);while(elt!=null){var i=0;var nodes=elt.childNodes;
while(i<nodes.length){elt.removeChild(nodes[i]);}iTr++;elt.style.display="none";trId=this.id+"_tr_"+dimId+iTr;elt=document.getElementById(trId);}};Filter.prototype.addDeleteImage=function(elem,dimId,dimContinuous,member,memberFormated,pos,bDisplay){var tdImage=document.createElement("td");tdImage.id=this.id+"_"+dimId+dimContinuous+"_"+memberFormated;tdImage.dimId=dimId;tdImage.dimContinuous=dimContinuous;tdImage.member=member;tdImage.memberFormated=memberFormated;tdImage.pos=pos;if(bDisplay){tdImage.className="tdFilterImage";tdImage.onclick=function(){removeFilter(this);};}else{tdImage.className="tdFilterImageHidden";}elem.appendChild(tdImage);};FilterOptions=function(showDimension,showHierarchy,showLevel){this.showDimension=showDimension;this.showHierarchy=showHierarchy;this.showLevel=showLevel;};var DATE="Date";var MONTH_YEAR="Month Year";var MOIS_ANNEE="Mois Ann\u00E9e";var YEAR="Year";var ANNEE="Ann\u00E9e";var MONTH="Month";var MOIS="Mois";var DAY="Day";var JOUR="Jour";Slicer=function(id,dimSelPanel,dimId,dimName,continuous,dm,hierarchy,level,pageId,options){if(typeof(id)=="undefined"){return;
}this.id=id;this.frameId=id;this.divSlicer=document.getElementById(this.frameId);this.viz="Slicer";this.classNameActive="tdMemberActive";this.classNameSelected="tdMemberSelected";this.classNameInactive="tdMemberInactive";this.panel=dimSelPanel;this.initialized=this.panel==null?false:true;this.dimId=dimId;this.dimName=dimName;this.continuous=continuous;this.members=[];this.membersIndex={};this.membersSelected=[];this.mapMembersSelected={};this.membersActivate=[];this.mapMembersActivate={};this.mapMembersCaption={};if(typeof(dm)=="string"){this.dmId=dm;}else{this.dm=dm;}this.hierarchy=hierarchy;this.level=level;this.hierarchyId=null;this.levelId=null;if(this.hierarchy==null||this.hierarchy==""){this.hierarchy=-1;}else{if(!isNaN(this.hierarchy-0)){this.hierarchy=this.hierarchy-0;}}if(this.level==null||this.level==""||this.level=="Root"){this.level=-1;}else{if(!isNaN(level-0)){this.level=this.level-0;}}this.pageId=pageId;if(options){for(optId in options){var option=options[optId];this[optId]=option;
}}this.isReverseFilter=false;if(typeof(this.multiSelect)=="undefined"){this.multiSelect=true;}this.monthYearHierarchyId=null;this.slicerYear=null;this.slicerMonth=null;this.slicerDay=null;this.isSlicerDateLink=false;if(this.initialized&&this.dm){this.init(this.panel,this.dm);}if(this.viz=="Slicer"||this.viz=="SlicerHorizontal"){if(this.divSlicer){this.divSlicer.onselectstart=function(){return false;};}}};Slicer.prototype.init=function(panel,dm){this.initialized=true;this.panel=panel;this.dm=dm;this.dim=this.dm.getDimensionById(this.dimId);this.dimName=this.dim.name;this.members=[];this.membersIndex={};this.membersSelected=[];this.mapMembersSelected={};this.membersActivate=[];this.mapMembersActivate={};this.mapMembersCaption={};if(isNaN(this.hierarchy)){for(var iH=0;iH<this.dim.hierarchies.length;iH++){if(this.dim.hierarchies[iH].id==this.hierarchy){this.hierarchy=iH;break;}}}if(isNaN(this.level)){if(this.dim.hierarchies[this.hierarchy]){for(var iL=0;iL<this.dim.hierarchies[this.hierarchy].levels.length;
iL++){if(this.dim.hierarchies[this.hierarchy].levels[iL].id==this.level){this.level=iL;break;}}}}if(this.hierarchy>-1){this.hierarchyId=this.dim.hierarchies[this.hierarchy].id;if(this.level>-1){this.levelId=this.dim.hierarchies[this.hierarchy].levels[this.level].id;if(this.dimLabel){this.dimName=this.dimLabel;this.dimName=this.dimName.replace("${dimension}",this.dim.name);this.dimName=this.dimName.replace("${hierarchy}",this.dim.hierarchies[this.hierarchy].name);this.dimName=this.dimName.replace("${level}",this.dim.hierarchies[this.hierarchy].levels[this.level].name);}}}this.createDMSel();};Slicer.prototype.doFilterMember=function(member,bUpdate){this.panel.setReverseFilter(this.isReverseFilter);var memberFormated=this.getMemberFormated(member);if(this.hierarchyId&&this.levelId){this.panel.selectMember(this.hierarchyId,this.levelId,member,bUpdate,memberFormated);}else{this.panel.selectMember(this.hierarchy,this.level,member,bUpdate,memberFormated);}};Slicer.prototype.doFilterMembers=function(members,bForce){var membersFormated=new Array();
for(var i=0;i<members.length;i++){var member=members[i];var fMember=this.getMemberFormated(member);membersFormated.push(fMember);}if(members.length==0){members[0]="All";membersFormated[0]="All";}if(this.hierarchyId&&this.levelId){this.panel.selectMembers(this.hierarchyId,this.levelId,members,membersFormated,bForce,this.isReverseFilter);}else{this.panel.selectMembers(this.hierarchy,this.level,members,membersFormated,bForce,this.isReverseFilter);}};Slicer.prototype.createDMSel=function(){if(typeof(DataModelSelection)!="undefined"&&typeof(this.dm)!="undefined"){this.dmSel=new DataModelSelection();this.dmSel.previewRowLimit=ddCtrl.DIM_MAX_MEMBERS;this.dmSel.pivot=0;this.dmSel.attachedDM(this.dm);this.dmSel.pageId=this.pageId;this.dmSel.frameId=this.frameId;this.dmSel.addBrowse(1,this.dim,this.hierarchy,this.level);if(this.viz=="SlicerSlider"){if(this.hideEmpty&&this.range){var axisSort=new AxisSort(1,S_NUMERIC,false,-1,null,false);this.dmSel.addAxisSort(axisSort);}}else{if(typeof(this.sortType)!="undefined"&&this.sortType>-1&&typeof(this.sortReverse)!="undefined"){var axisSort=new AxisSort(1,this.sortType,this.sortReverse,-1,null,false);
this.dmSel.addAxisSort(axisSort);}else{if(!this.dim.order&&this.dim.sort){var axisSort=new AxisSort(1,this.dim.sortType,this.dim.sortReverse,-1,null,this.dim.sortOnCaption);this.dmSel.addAxisSort(axisSort);}}}for(var i=0;i<this.dm.dimensions.length;i++){var dim=this.dm.dimensions[i];var panel=dimPanelList[dim.id+dim.continuous];if(panel){panel.updateDMSel(this.dm,this.dmSel);}}ddCtrl.unregisterChart(this.frameId);ddCtrl.svgdocList.push(this);ddCtrl.dmList.push(this.dm);ddCtrl.dmSelList.push(this.dmSel);ddCtrl.chartList.push(this);this.lastSel=null;}};Slicer.prototype.refreshDM=function(){if(ddCtrl.isPageVisible(this.pageId)){if(this.reverseFilterSel){this.reverseFilterSel.checked=this.panel.reverseFilter;}if(this.needToUpdate()){this.prevMembersActivate=cloneArray(this.membersActivate);var slicer=this;this.updateMembersAvailable(function(values){if(values!=null){slicer.updateSlicer();if(slicer.firstUpdateMembersAvailable&&slicer.dim.membersOnServer){var mbrToFilter=null;if(slicer.forbidEmptySelection||slicer.filter=="first"){if(slicer.membersActivate.length>0){mbrToFilter=slicer.membersActivate[0];
}else{if(typeof(slicer.dim.min)=="number"&&!isNaN(slicer.dim.min)){if(slicer.level==-1){mbrToFilter=slicer.dim.min;}else{mbrToFilter=slicer.getGroupMbr(slicer.dim.min);}}}}else{if(slicer.filter=="last"){if(slicer.membersActivate.length>0){mbrToFilter=slicer.membersActivate[slicer.membersActivate.length-1];}else{if(typeof(slicer.dim.max)=="number"&&!isNaN(slicer.dim.max)){if(slicer.level==-1){mbrToFilter=slicer.dim.max;}else{mbrToFilter=slicer.getGroupMbr(slicer.dim.max);}}}}}if(mbrToFilter!=null){var bSelectDateMembers=slicer.selectDateMembers([mbrToFilter]);if(!bSelectDateMembers&&!slicer.panel.hasFilter()){slicer.doFilterMember(mbrToFilter);}}}}if(slicer.hasChanged()){slicer.doSelectMembers();}});}else{if(this.hasChanged()){this.doSelectMembers();}}}};Slicer.prototype.doSelectMembers=function(){var h=this.hierarchy;var l=this.level;var hId=null;var lId=null;if(this.panel.hasHierarchy){h=this.panel.getSelectedHierarchyIndex();l=this.panel.getSelectedLevelIndex();hId=this.panel.getSelectedHierarchyId();
lId=this.panel.getSelectedLevelId();}var membersFormated=this.panel.getSelectedFormatedElements();var members=this.panel.getSelectedElements();var min=NaN;var max=NaN;if(this.panel.isRangeFilter){min=this.panel.getMin();max=this.panel.getMax();}if(this.isSlicerDateLink&&(hId==MONTH_YEAR||hId==MOIS_ANNEE)&&(lId==MONTH||lId==MOIS||lId==DAY||lId==JOUR)&&members.length>0&&members[0]!="All"){if(this.levelId==YEAR||this.levelId==ANNEE){var selYearMbrs=this.getYearsFromSel();this.selectMembers(selYearMbrs,selYearMbrs,this.level);}else{if(this.levelId==MONTH||this.levelId==MOIS){var selMonthMbrs=this.getMonthsFromSel();var mbrsFormated=[];for(var i=0;i<selMonthMbrs.length;i++){mbrsFormated.push(this.getMemberFormated(selMonthMbrs[i]));}this.selectMembers(selMonthMbrs,mbrsFormated,this.level);}else{if(this.levelId==DAY||this.levelId==JOUR){if(hId==MONTH_YEAR&&lId==DAY){var selDayMbrs=this.getDaysFromSel();var mbrsFormated=[];for(var i=0;i<selDayMbrs.length;i++){mbrsFormated.push(this.getMemberFormated(selDayMbrs[i]));
}this.selectMembers(selDayMbrs,mbrsFormated,this.level);}else{this.selectMembers(["All"],Properties[getLocale()]["All"],l);}}}}}else{if(this.isSameHierarchyLevel()||this.range){this.selectMembers(members,membersFormated,l,h,min,max);}else{this.selectMembers(["All"],Properties[getLocale()]["All"],l);}}};Slicer.prototype.getYearsFromSel=function(){var mbrsSel=this.panel.getSelectedElements();var hId=null;var lId=null;if(this.panel.hasHierarchy){hId=this.panel.getSelectedHierarchyId();lId=this.panel.getSelectedLevelId();}if(mbrsSel.length>0&&mbrsSel[0]!="All"&&(hId==MONTH_YEAR||hId==MOIS_ANNEE||hId==DATE)){var mbrs=new Array();var tmpMbrs={};for(var i=0;i<mbrsSel.length;i++){var mbrSel=mbrsSel[i];var year;if(mbrSel>1900&&mbrSel<2100){year=mbrSel;}else{var d=new Date(mbrsSel[i]*1000);year=d.getFullYear();}if(!tmpMbrs[year]){mbrs.push(year);tmpMbrs[year]=true;}}return mbrs;}return null;};Slicer.prototype.getMonthsFromSel=function(){var mbrsSel=this.panel.getSelectedElements();var hId=null;var lId=null;
if(this.panel.hasHierarchy){hId=this.panel.getSelectedHierarchyId();lId=this.panel.getSelectedLevelId();}if(mbrsSel.length>0&&mbrsSel[0]!="All"&&(hId==MONTH_YEAR||hId==MOIS_ANNEE||hId==DATE)&&(lId!=YEAR&&lId!=ANNEE)){var mbrs=new Array();var tmpMbrs={};for(var i=0;i<mbrsSel.length;i++){var month=null;if(hId==DATE&&lId==MONTH){month=mbrsSel[i];}else{var d=new Date(mbrsSel[i]*1000);month=d.getMonth()+1;}if(!tmpMbrs[month]){mbrs.push(month);tmpMbrs[month]=true;}}return mbrs;}return null;};Slicer.prototype.getDaysFromSel=function(){var mbrsSel=this.panel.getSelectedElements();var hId=null;var lId=null;if(this.panel.hasHierarchy){hId=this.panel.getSelectedHierarchyId();lId=this.panel.getSelectedLevelId();}if(mbrsSel.length>0&&mbrsSel[0]!="All"&&(hId==MONTH_YEAR||hId==MOIS_ANNEE||hId==DATE)&&(lId==DAY||lId==JOUR)){var mbrs=new Array();var tmpMbrs={};for(var i=0;i<mbrsSel.length;i++){var day=null;if(hId==DATE){day=mbrsSel[i];}else{var d=new Date(mbrsSel[i]*1000);day=d.getDate();}if(!tmpMbrs[day]){mbrs.push(day);
tmpMbrs[day]=true;}}return mbrs;}return null;};function isRootLevel(h,l){if(h==-1||l==-1){return true;}return false;}Slicer.prototype.isSameHierarchyLevel=function(){var h=-1;var l=-1;var hId=null;var lId=null;if(this.panel.hasHierarchy){h=this.panel.getSelectedHierarchyIndex();l=this.panel.getSelectedLevelIndex();hId=this.panel.getSelectedHierarchyId();lId=this.panel.getSelectedLevelId();if(hId=="Range"){hId=null;h=-1;lId=null;l=-1;}if(lId==null||lId=="root"){hId=null;lId=null;}}if(isRootLevel(this.hierarchy,this.level)&&isRootLevel(h,l)){return true;}if((this.hierarchyId==hId||this.hierarchy==h)&&(this.levelId==lId||this.level==l)){return true;}return false;};Slicer.prototype.findSlicersDate=function(){for(var i=0;i<this.dim.hierarchies.length;i++){var hierarchy=this.dim.hierarchies[i];if(hierarchy.id==MONTH_YEAR||hierarchy.id==MOIS_ANNEE){this.monthYearHierarchyId=hierarchy.id;break;}}if(this.dim.time&&this.hierarchyId==DATE&&this.monthYearHierarchyId!=null&&(this.levelId==YEAR||this.levelId==ANNEE||this.levelId==MONTH||this.levelId==MOIS||this.levelId==DAY||this.levelId==JOUR)){for(var slicerId in ddCtrl.slicers){var slicer=ddCtrl.slicers[slicerId];
if(slicer.dimId==this.dimId&&slicer.dmId==this.dmId&&slicer.hierarchyId==DATE&&(slicer.levelId==YEAR||slicer.levelId==ANNEE)&&slicer.pageId==this.pageId){this.slicerYear=slicer;break;}}for(var slicerId in ddCtrl.slicers){var slicer=ddCtrl.slicers[slicerId];if(slicer.dimId==this.dimId&&slicer.dmId==this.dmId&&slicer.hierarchyId==DATE&&(slicer.levelId==MONTH||slicer.levelId==MOIS)&&slicer.pageId==this.pageId){this.slicerMonth=slicer;break;}}for(var slicerId in ddCtrl.slicers){var slicer=ddCtrl.slicers[slicerId];if(slicer.dimId==this.dimId&&slicer.dmId==this.dmId&&slicer.hierarchyId==DATE&&(slicer.levelId==DAY||slicer.levelId==JOUR)&&slicer.pageId==this.pageId){this.slicerDay=slicer;break;}}if(this.slicerYear&&this.slicerYear.id==this.id&&this.slicerMonth){this.isSlicerDateLink=true;}if(this.slicerMonth&&this.slicerMonth.id==this.id&&this.slicerYear){this.isSlicerDateLink=true;}if(this.slicerDay&&this.slicerDay.id==this.id&&this.slicerYear&&this.slicerMonth){this.isSlicerDateLink=true;}}};
Slicer.prototype.selectDateMembers=function(members){if(this.isSlicerDateLink){if(this.levelId==MONTH||this.levelId==MOIS){if(this.slicerYear!=null){var selMonthMbrs=new Array();var selYearMbrs=new Array();var tmpYearSelMbrs=this.slicerYear.getSelectedMembers();for(var i=0;i<tmpYearSelMbrs.length;i++){var mbr=tmpYearSelMbrs[i];if(mbr!="All"&&typeof(mbr)!="undefined"){selYearMbrs.push(mbr);}}if(selYearMbrs.length>0){for(var i=0;i<members.length;i++){var mbr=members[i];if(mbr!="All"&&typeof(mbr)!="undefined"){selMonthMbrs.push(mbr);}}if(selMonthMbrs!=null&&selMonthMbrs.length>0){var selDayMbrs=new Array();if(this.slicerDay!=null){var tmpDaySelMbrs=this.slicerDay.getSelectedMembers();for(var i=0;i<tmpDaySelMbrs.length;i++){var mbr=tmpDaySelMbrs[i];if(mbr!="All"&&typeof(mbr)!="undefined"){selDayMbrs.push(mbr);}}}var members=new Array();if(selDayMbrs.length>0){for(var iY=0;iY<selYearMbrs.length;iY++){for(var iM=0;iM<selMonthMbrs.length;iM++){for(var iD=0;iD<selDayMbrs.length;iD++){var d=new Date(selYearMbrs[iY],selMonthMbrs[iM]-1,selDayMbrs[iD]);
members.push(d.getTime()/1000);}}}this.panel.selectMembers(this.monthYearHierarchyId,this.slicerDay.levelId,members,null,true,this.isReverseFilter);}else{for(var iY=0;iY<selYearMbrs.length;iY++){for(var iM=0;iM<selMonthMbrs.length;iM++){var d=new Date(selYearMbrs[iY],selMonthMbrs[iM]-1,1);members.push(d.getTime()/1000);}}this.panel.selectMembers(this.monthYearHierarchyId,this.slicerMonth.levelId,members,null,true,this.isReverseFilter);}}else{this.panel.selectMembers(DATE,this.slicerYear.levelId,selYearMbrs,null,true,this.isReverseFilter);}return true;}}}else{if(this.levelId==YEAR||this.levelId==ANNEE){if(this.slicerMonth!=null){var selYearMbrs=new Array();var selMonthMbrs=new Array();var tmpMonthSelMbrs=this.slicerMonth.getSelectedMembers();for(var i=0;i<tmpMonthSelMbrs.length;i++){var mbr=tmpMonthSelMbrs[i];if(mbr!="All"&&typeof(mbr)!="undefined"){selMonthMbrs.push(mbr);}}if(selMonthMbrs.length>0){for(var i=0;i<members.length;i++){var mbr=members[i];if(mbr!="All"&&typeof(mbr)!="undefined"){selYearMbrs.push(mbr);
}}if(selYearMbrs!=null&&selYearMbrs.length>0){var selDayMbrs=new Array();if(this.slicerDay!=null){var tmpDaySelMbrs=this.slicerDay.getSelectedMembers();for(var i=0;i<tmpDaySelMbrs.length;i++){var mbr=tmpDaySelMbrs[i];if(mbr!="All"&&typeof(mbr)!="undefined"){selDayMbrs.push(mbr);}}}var members=new Array();if(selDayMbrs.length>0){for(var iY=0;iY<selYearMbrs.length;iY++){for(var iM=0;iM<selMonthMbrs.length;iM++){for(var iD=0;iD<selDayMbrs.length;iD++){var d=new Date(selYearMbrs[iY],selMonthMbrs[iM]-1,selDayMbrs[iD]);members.push(d.getTime()/1000);}}}this.panel.selectMembers(this.monthYearHierarchyId,this.slicerDay.levelId,members,null,true,this.isReverseFilter);}else{for(var iY=0;iY<selYearMbrs.length;iY++){for(var iM=0;iM<selMonthMbrs.length;iM++){var d=new Date(selYearMbrs[iY],selMonthMbrs[iM]-1,1);members.push(d.getTime()/1000);}}this.panel.selectMembers(this.monthYearHierarchyId,this.slicerMonth.levelId,members,null,true,this.isReverseFilter);}}else{this.panel.selectMembers(DATE,this.slicerMonth.levelId,selMonthMbrs,null,true,this.isReverseFilter);
}return true;}}}else{if(this.levelId==DAY||this.levelId==JOUR){if(this.slicerYear!=null&&this.slicerMonth!=null){var selYearMbrs=new Array();var selMonthMbrs=new Array();var selDayMbrs=new Array();var tmpMonthSelMbrs=this.slicerMonth.getSelectedMembers();for(var i=0;i<tmpMonthSelMbrs.length;i++){var mbr=tmpMonthSelMbrs[i];if(mbr!="All"&&typeof(mbr)!="undefined"){selMonthMbrs.push(mbr);}}var tmpYearSelMbrs=this.slicerYear.getSelectedMembers();for(var i=0;i<tmpYearSelMbrs.length;i++){var mbr=tmpYearSelMbrs[i];if(mbr!="All"&&typeof(mbr)!="undefined"){selYearMbrs.push(mbr);}}if(selMonthMbrs.length>0&&selYearMbrs.length>0){for(var i=0;i<members.length;i++){var mbr=members[i];if(mbr!="All"&&typeof(mbr)!="undefined"){selDayMbrs.push(mbr);}}if(selDayMbrs!=null&&selDayMbrs.length>0){var members=new Array();for(var iY=0;iY<selYearMbrs.length;iY++){for(var iM=0;iM<selMonthMbrs.length;iM++){for(var iD=0;iD<selDayMbrs.length;iD++){var d=new Date(selYearMbrs[iY],selMonthMbrs[iM]-1,selDayMbrs[iD]);members.push(d.getTime()/1000);
}}}this.panel.selectMembers(this.monthYearHierarchyId,this.slicerDay.levelId,members,null,true,this.isReverseFilter);}else{var members=new Array();for(var iY=0;iY<selYearMbrs.length;iY++){for(var iM=0;iM<selMonthMbrs.length;iM++){var d=new Date(selYearMbrs[iY],selMonthMbrs[iM]-1,1);members.push(d.getTime()/1000);}}this.panel.selectMembers(this.monthYearHierarchyId,this.slicerMonth.levelId,members,null,true,this.isReverseFilter);}return true;}}}}}}return false;};Slicer.prototype.getSlicerDateLink=function(){var bHasMonthYearHierarchy=false;for(var i=0;i<this.dim.hierarchies.length;i++){var hierarchy=this.dim.hierarchies[i];if(hierarchy.id==MONTH_YEAR||hierarchy.id==MOIS_ANNEE){bHasMonthYearHierarchy=true;break;}}if(this.dim.time&&this.hierarchyId==DATE&&bHasMonthYearHierarchy){if(this.levelId==MONTH||this.levelId==MOIS){for(var slicerId in ddCtrl.slicers){var slicer=ddCtrl.slicers[slicerId];if(slicer.id!=this.id&&slicer.dimId==this.dimId&&slicer.dmId==this.dmId&&slicer.hierarchyId==DATE&&(slicer.levelId==YEAR||slicer.levelId==ANNEE)&&slicer.pageId==this.pageId){return slicer;
}}}else{if(this.levelId==YEAR||this.levelId==ANNEE){for(var slicerId in ddCtrl.slicers){var slicer=ddCtrl.slicers[slicerId];if(slicer.id!=this.id&&slicer.dimId==this.dimId&&slicer.dmId==this.dmId&&slicer.hierarchyId==DATE&&(slicer.levelId==MONTH||slicer.levelId==MOIS)&&slicer.pageId==this.pageId){return slicer;}}}else{if(this.levelId==DAY||this.levelId==JOUR){for(var slicerId in ddCtrl.slicers){var slicer=ddCtrl.slicers[slicerId];if(slicer.id!=this.id&&slicer.dimId==this.dimId&&slicer.dmId==this.dmId&&slicer.hierarchyId==DATE&&(slicer.levelId==MONTH||slicer.levelId==MOIS)&&slicer.pageId==this.pageId){return slicer;}}}}}}return null;};Slicer.prototype.hasChanged=function(){var newH=this.panel.getSelectedHierarchyIndex();var newL=this.panel.getSelectedLevelIndex();var newMembers=this.panel.getSelectedElements();var currentMembers=this.getSelectedMembers();var bSameHierarchyLevel=false;if((newH==this.hierarchy&&newL==this.level)||(newL==-1&&this.level==-1)){bSameHierarchyLevel=true;}if(bSameHierarchyLevel&&newMembers.length==currentMembers.length){for(var i=0;
i<newMembers.length;i++){if(currentMembers[i]!=newMembers[i]){return true;}}}else{return true;}return false;};Slicer.prototype.needToUpdate=function(){return this.hideEmpty;};Slicer.prototype.updateSlicer=function(){if(this.displayEmptyValuesAtEnd==true||this.dim.membersOnServer){this.redrawMembers();}else{if(this.prevMembersActivate){for(var i=0;i<this.prevMembersActivate.length;i++){var id=this.frameId+"_mbr_"+this.prevMembersActivate[i];var elt=this.divSlicer.ownerDocument.getElementById(id);if(elt){elt.className=this.classNameInactive;}}}var bAddMembers=this.members.length==0;if(bAddMembers){this.members=[];this.membersIndex={};}for(var i=0;i<this.membersActivate.length;i++){if(bAddMembers){this.members.push(this.membersActivate[i]);this.membersIndex[this.membersActivate[i]]=i;}var id=this.frameId+"_mbr_"+this.membersActivate[i];var elt=this.divSlicer.ownerDocument.getElementById(id);if(elt){elt.className=this.classNameActive;}}if(bAddMembers){this.drawMembers();}for(var i=0;i<this.membersSelected.length;
i++){var id=this.frameId+"_mbr_"+this.membersSelected[i];var elt=this.divSlicer.ownerDocument.getElementById(id);if(elt){if(this.mapMembersActivate[this.membersSelected[i]]){elt.className=this.classNameSelected;}else{elt.className=this.classNameInactive;}}}}};Slicer.prototype.getSelectedMembers=function(){return this.membersSelected;};Slicer.prototype.getMembers=function(){this.members=[];this.membersIndex={};var members=[];var membersTest={};var bSortCaption=this.dim.sortOnCaption;var level=this.getLevel();if(level==null){if(!this.dim.membersOnServer){var iMbr=0;while(iMbr<this.dim.members.length){var member=this.dim.members[iMbr];if(this.isNullValue(member)){iMbr++;continue;}if(membersTest[member]==null){membersTest[member]=true;if(bSortCaption){var fMember=member;var mbrPos=this.dim.getMemberPosById(member);if(this.dim.captions&&this.dim.captions[mbrPos]){fMember=this.dim.captions[mbrPos];}members.push(new Member(member,fMember));}else{this.members.push(member);}}iMbr++;}if(this.sortType!==undefined&&this.sortType>-1&&this.sortReverse!==undefined){switch(this.sortType){case S_ALPHA:if(this.sortReverse){this.members.sort(sortAlphabeticR);
}else{this.members.sort(sortAlphabetic);}break;case S_NUMERIC:if(this.sortReverse){this.members.sort(sortNumericR);}else{this.members.sort(sortNumeric);}break;}}else{if(!this.dim.order){if(this.dim.sort){if(bSortCaption){if(this.dim.sortReverse){members.sort(sortCaptionR);}else{members.sort(sortCaption);}}else{this.members.sort(this.dim.sort);}}else{this.members.sort();}}}if(typeof(this.dim.nullValue)!="undefined"){this.members.splice(0,0,this.dim.nullValue);}}}else{var iGrp=0;if(level.groups.length==0){level.prepare(this.dim);}var sNullValue=undefined;while(iGrp<level.groups.length){var group=level.groups[iGrp];var grpName=group.name;if(this.isNullValue(grpName)){iGrp++;sNullValue=grpName;continue;}var grpCaption=group.caption;if(typeof(grpCaption)=="undefined"){grpCaption=grpName;}if(membersTest[grpName]==null){membersTest[grpName]=true;if(bSortCaption){members.push(new Member(grpName,grpCaption));}else{this.members.push(grpName);}}iGrp++;}if(this.sortType!==undefined&&this.sortType>-1&&this.sortReverse!==undefined){switch(this.sortType){case S_ALPHA:if(this.sortReverse){this.members.sort(sortAlphabeticR);
}else{this.members.sort(sortAlphabetic);}break;case S_NUMERIC:if(this.sortReverse){this.members.sort(sortNumericR);}else{this.members.sort(sortNumeric);}break;}}else{if(this.dim.sort){if(bSortCaption){if(this.dim.sortReverse){members.sort(sortCaptionR);}else{members.sort(sortCaption);}}else{this.members.sort(this.dim.sort);}}else{this.members.sort();}}if(typeof(this.level.nullValue)!="undefined"){this.members.splice(0,0,this.level.nullValue);}else{if(typeof(sNullValue)!="undefined"){this.members.splice(0,0,sNullValue);}}}if(bSortCaption){for(var im=0;im<members.length;++im){this.membersIndex[members[im].member]=im;this.members.push(members[im].member);}}else{for(var im=0;im<this.members.length;++im){this.membersIndex[this.members[im]]=im;}}};Member=function(member,memberFormated){this.member=member;this.memberFormated=memberFormated;};function sortCaption(a,b){return ssortAlpha(a.memberFormated,b.memberFormated);}function sortCaptionR(a,b){return ssortAlphaR(a.memberFormated,b.memberFormated);
}Slicer.prototype.getMemberFormated=function(member){if(member=="All"){return Properties[getLocale()]["All"];}if(this.mapMembersCaption[member]){return this.mapMembersCaption[member];}var level=this.getLevel();var fMember=member;if(level!=null){if(this.isNullValue(member)){return getLocMessage("EmptyMember");}else{if(level.format){fMember=formatNum(member,level.format);}else{var gPos=level.getMemberPosByName(member);if(gPos>=0&&level.groups[gPos]&&typeof(level.groups[gPos].caption)!="undefined"){fMember=level.groups[gPos].caption;}}}}else{var mbrPos=this.dim.getMemberPosById(member);if(this.isNullValue(member)){return getLocMessage("EmptyMember");}else{if(this.dim.captionDim&&this.dim.captions[mbrPos]){fMember=this.dim.captions[mbrPos];}else{if(this.dim.format){fMember=formatNum(member,this.dim.format);}}}}return fMember;};Slicer.prototype.getLevel=function(){if(this.hierarchy==-1){if(this.dim.hierarchies&&this.dim.hierarchies.length>0){this.hierarchy=0;}return null;}else{var h=this.dim.hierarchies[this.hierarchy];
if(this.level==-1){return null;}else{var l=h.levels[this.level];return l;}}};Slicer.prototype.getGroupMbr=function(mbr){var level=this.dim.hierarchies[this.hierarchy].levels[this.level];if(this.dim.time&&level.groupformula){if(mbr>1900&&mbr<2100){return mbr;}else{if(!this.groupFunc){var fEval;if(level.groupformula.indexOf("return")>-1){fEval="__c = function() {}; __c.prototype.run = function(t) { "+level.groupformula+"; }; new __c()";}else{fEval="__c = function() {}; __c.prototype.run = function(t) { return "+level.groupformula+"; }; new __c()";}this.groupFunc=eval(fEval);}try{var grp=this.groupFunc.run(mbr);return grp;}catch(e){return null;}}}else{for(var i=0;i<level.groups.length;i++){var grp=level.groups[i];if(grp.isValueIn(mbr)){return grp.name;}}}};Slicer.prototype.getNullValue=function(value){var level=this.getLevel(this.dim);if(level==null){if(typeof(this.dim.nullValue)!="undefined"&&(this.dim.nullValue==value||value=="null")){return this.dim.nullValue;}}else{if(typeof(this.level.nullValue)!="undefined"&&(this.level.nullValue==value||value=="null")){return this.level.nullValue;
}if(this.dim.continuous&&!isNumeric(value)){return value;}}return undefined;};Slicer.prototype.isNullValue=function(value){var level=this.getLevel(this.dim);if(level==null){if(typeof(this.dim.nullValue)!="undefined"&&(this.dim.nullValue==value||value=="null")){return true;}}else{if(typeof(this.level.nullValue)!="undefined"&&(this.level.nullValue==value||value=="null")){return true;}}return false;};Slicer.prototype.updateMembersAvailable=function(callbackFunc){var bParseInt=false;if(this.dim.continuous){if(this.hierarchy!=-1&&this.level!=-1){var level=this.dim.hierarchies[this.hierarchy].levels[this.level];if(level.groupformula){bParseInt=true;}}else{bParseInt=true;}}var filter=this.dmSel.getFilterByDimension(this.dim);if(filter){if((filter.level==-1&&this.level==-1)||(filter.hierarchy==this.hierarchy&&filter.level==this.level)||this.viz=="SlicerSlider"){this.dmSel.removeFilterByDimension(this.dim);}else{if(this.isSlicerDateLink){var selYearMbrs=this.getYearsFromSel();var selMonthMbrs=this.getMonthsFromSel();
var selDayMbrs=this.getDaysFromSel();if(this.slicerMonth!=null&&this.slicerMonth.id==this.id){if(this.slicerYear!=null&&selYearMbrs!=null){var filter=new FilterSelection(this.dim,this.slicerYear.hierarchyId,this.slicerYear.levelId,[],selYearMbrs);this.dmSel.setFilter(filter);}}else{if(this.slicerYear!=null&&this.slicerYear.id==this.id){if(this.slicerMonth!=null&&selMonthMbrs!=null){var filter=new FilterSelection(this.dim,this.slicerMonth.hierarchyId,this.slicerMonth.levelId,[],selMonthMbrs);this.dmSel.setFilter(filter);}}else{if(this.slicerDay!=null&&this.slicerDay.id==this.id){if(this.slicerYear!=null&&selYearMbrs!=null){var filter=new FilterSelection(this.dim,this.slicerYear.hierarchyId,this.slicerYear.levelId,[],selYearMbrs);this.dmSel.setFilter(filter);if(this.slicerMonth!=null&&selMonthMbrs!=null){var filter=new FilterSelection(this.dim,this.slicerMonth.hierarchyId,this.slicerMonth.levelId,[],selMonthMbrs);this.dmSel.addFilter(filter);}}else{if(this.slicerMonth!=null&&selMonthMbrs!=null){var filter=new FilterSelection(this.dim,this.slicerMonth.hierarchyId,this.slicerMonth.levelId,[],selMonthMbrs);
this.dmSel.addFilter(filter);}}}}}}}}var prevSel=this.lastSel;var curSel=JSON.stringify(this.dmSel);curSel=encodeURIComponent(curSel);if(curSel==prevSel){if(callbackFunc!=null){callbackFunc(null);}}else{var slicer=this;this.dm.getDataFromSelectionAsync(this.dmSel,this,function(values,errObj){if(errObj){if(typeof(errObj)=="string"||typeof(errObj.message)=="string"){log(errObj);}else{if(typeof(errObj.errorCode)!="undefined"){if((errObj.errorCode==401||errObj.errorCode==403)&&ddCtrl.checkSession){checkSession();}else{if(typeof(errObj.errorMsg)!="undefined"){log(errObj.errorMsg);}}}else{if(typeof(errObj.errorMsg)!="undefined"){log(errObj.errorMsg);}}}}else{var sNullValue=undefined;if(values!=null){if(typeof(slicer.firstUpdateMembersAvailable)=="undefined"){slicer.firstUpdateMembersAvailable=true;}else{slicer.firstUpdateMembersAvailable=false;}slicer.membersActivate=new Array();slicer.mapMembersActivate={};slicer.mapMembersCaption={};slicer.mapMembersActivate.All=true;for(var i=0;i<values.lines.length;
i++){var idx=values.lines[i][1];var id=values.axis[1][idx].id;if(bParseInt){if(isNumeric(parseInt(id))){id=parseInt(id);}}if(slicer.isNullValue(id)){sNullValue=slicer.getNullValue(id);continue;}slicer.membersActivate.push(id);slicer.mapMembersActivate[id]=true;slicer.mapMembersCaption[id]=values.axis[1][idx].formated;}if(typeof(sNullValue)!="undefined"&&slicer.viz!="SlicerSlider"&&slicer.viz!="SlicerDatePicker"){slicer.membersActivate.splice(0,0,sNullValue);slicer.mapMembersActivate[sNullValue]=true;slicer.mapMembersCaption[sNullValue]=getLocMessage("EmptyMember");}}if(callbackFunc!=null){callbackFunc(values);}}});}};Slicer.prototype.disableMembers=function(){for(var i=0;i<this.membersActivate.length;i++){var id=this.frameId+"_mbr_"+this.membersActivate[i];var elt=this.divSlicer.ownerDocument.getElementById(id);if(elt){elt.className=this.classNameInactive;}}this.updateMembersAvailable();if(this.members.length==0){for(var i=0;i<this.membersActivate.length;i++){this.members.push(this.membersActivate[i]);
}this.drawMembers();}};Slicer.prototype.reselectMembers=function(){for(var i=0;i<this.membersSelected.length;i++){var id=this.frameId+"_mbr_"+this.membersSelected[i];var elt=this.divSlicer.ownerDocument.getElementById(id);if(elt){if(this.mapMembersActivate[this.membersSelected[i]]){elt.className=this.classNameSelected;}else{elt.className=this.classNameInactive;}}}};Slicer.prototype.drawMembers=function(){if(this.divSlicer){this.divSlicer.dimId=this.dimId;var i=0;var nodes=this.divSlicer.childNodes;while(i<nodes.length){this.divSlicer.removeChild(nodes[i]);}var headerHeight=0;if(!this.hideHeader){this.divHeader=document.createElement("div");this.divHeader.className="divHeader";var tableHeader=document.createElement("table");tableHeader.className="slicerTable";tableHeader.setAttribute("width","100%");var tbodyHeader=document.createElement("tbody");tbodyHeader.className="slicerTable";var trHeader=document.createElement("tr");trHeader.className="trHeaderFilter";var tdHeader=document.createElement("td");
tdHeader.innerHTML=this.dimName;tdHeader.className="tdHeaderFilter";trHeader.appendChild(tdHeader);tbodyHeader.appendChild(trHeader);tableHeader.appendChild(tbodyHeader);this.divHeader.appendChild(tableHeader);this.divSlicer.appendChild(this.divHeader);headerHeight+=this.divHeader.offsetHeight;}if(this.members.length==0){this.getMembers();}if(this.showSearch){this.drawSearchMembers(tbodyContent);headerHeight+=this.searchTable.offsetHeight;}if(this.authorizeReverseFilter){this.drawReverseFilter();headerHeight+=this.reverseFilterTable.offsetHeight;}this.addSelectBehavior();this.divContent=document.createElement("div");this.divContent.id=this.id.replace("slicer_","slicercontent_");this.divContent.className="divContent";if(ddCtrl.isNewDashboard){var portletContentElt=document.getElementById(this.id.replace("slicer_","content_"));if(portletContentElt){var divSlicerHeight=portletContentElt.clientHeight;var divContentHeight=divSlicerHeight-headerHeight;setStyle(this.divContent,"height:"+divContentHeight+"px");
}}else{var divSlicerHeight=this.divSlicer.offsetHeight;var divContentHeight=divSlicerHeight-headerHeight;setStyle(this.divContent,"height:"+divContentHeight+"px");}var tableContent=document.createElement("table");tableContent.className="slicerTable";tableContent.setAttribute("width","100%");var tbodyContent=document.createElement("tbody");tableContent.appendChild(tbodyContent);this.divContent.appendChild(tableContent);if(!this.hideAll){var member="All";var fMember=Properties[getLocale()]["All"];this.drawMember(tbodyContent,member,fMember,this.classNameSelected);this.membersSelected.push(member);this.mapMembersSelected[member]=true;this.mapMembersActivate[member]=true;}for(var i=0;i<this.members.length;i++){var member=this.members[i];var fMember=this.getMemberFormated(member);this.membersActivate.push(member);this.mapMembersActivate[member]=true;this.drawMember(tbodyContent,member,fMember,this.classNameActive);if(this.showSearch&&this.members.length<=ddCtrl.LIMITINDEXATION){this.searchbox.add(fMember,new SearchComboValName(member,fMember,0));
}}this.divSlicer.appendChild(this.divContent);var mbrToFilter=null;if(this.forbidEmptySelection||this.filter=="first"){if(this.members.length>0){mbrToFilter=this.members[0];}else{if(typeof(this.dim.min)=="number"&&!isNaN(this.dim.min)){if(this.level==-1){mbrToFilter=this.dim.min;}else{mbrToFilter=this.getGroupMbr(this.dim.min);}}}}else{if(this.filter=="last"){if(this.members.length>0){mbrToFilter=this.members[this.members.length-1];}else{if(typeof(this.dim.max)=="number"&&!isNaN(this.dim.max)){if(this.level==-1){mbrToFilter=this.dim.max;}else{mbrToFilter=this.getGroupMbr(this.dim.max);}}}}}if(mbrToFilter!=null){var bSelectDateMembers=this.selectDateMembers([mbrToFilter]);if(!bSelectDateMembers&&!this.panel.hasFilter()){this.doFilterMember(mbrToFilter);}}}};Slicer.prototype.resize=function(){if(!this.divContent){return;}var headerHeight=0;if(!this.hideHeader&&this.divHeader){headerHeight+=this.divHeader.offsetHeight;}if(this.showSearch&&this.searchTable){headerHeight+=this.searchTable.offsetHeight;
}if(this.authorizeReverseFilter&&this.reverseFilterTable){headerHeight+=this.reverseFilterTable.offsetHeight;}if(ddCtrl.isNewDashboard){var portletContentElt=document.getElementById(this.id.replace("slicer_","content_"));if(portletContentElt){var divSlicerHeight=portletContentElt.clientHeight;var divContentHeight=divSlicerHeight-headerHeight;setStyle(this.divContent,"height:"+divContentHeight+"px");}}else{var divSlicerHeight=this.divSlicer.offsetHeight;var divContentHeight=divSlicerHeight-headerHeight;setStyle(this.divContent,"height:"+divContentHeight+"px");}};Slicer.prototype.addSelectBehavior=function(){var obj=this;var func=function(e){obj.onKeyUp(e);};document.addEventListener("keyup",func,false);this.divSlicer.onmousedown=function(event){var event=event||window.event;var elt=event.target;if(event.ctrlKey&&elt.member){var allElt=document.getElementById(obj.frameId+"_mbr_All");if(allElt){allElt.className=obj.classNameActive;}obj.startMbrIdx=obj.membersIndex[elt.member];delete obj.lastStart;
delete obj.lastEnd;obj.isMouseDown=true;}};this.divSlicer.onmouseup=function(event){var event=event||window.event;if(event.ctrlKey&&obj.isMouseDown){if(!obj.membersToSelect){obj.membersToSelect=[];for(var i=0;i<obj.membersSelected.length;i++){if(obj.membersSelected[i]!="All"){obj.membersToSelect.push(obj.membersSelected[i]);}}}if(obj.membersToSelectPart&&obj.membersToSelectPart.length>0){for(var i=0;i<obj.membersToSelectPart.length;i++){obj.membersToSelect.push(obj.membersToSelectPart[i]);}delete obj.membersToSelectPart;}obj.isMouseDown=false;}};this.divSlicer.onmouseover=function(event){var event=event||window.event;var elt=event.target;if(obj.isMouseDown&&event.ctrlKey&&elt.member){var curMbrIdx=obj.membersIndex[elt.member];var start=Math.min(obj.startMbrIdx,curMbrIdx);var end=Math.max(obj.startMbrIdx,curMbrIdx);var min=start;var max=end;if(typeof(obj.lastStart)!="undefined"){min=Math.min(start,obj.lastStart);}if(typeof(obj.lastEnd)!="undefined"){max=Math.max(end,obj.lastEnd);}obj.membersToSelectPart=[];
for(var i=min;i<=max;i++){var mbr=obj.members[i];var mbrElt=document.getElementById(obj.frameId+"_mbr_"+mbr);if(mbrElt.className!=obj.classNameInactive){if(i>=start&&i<=end){obj.membersToSelectPart.push(mbr);mbrElt.className=obj.classNameSelected;}else{mbrElt.className=obj.classNameActive;}}}obj.lastStart=start;obj.lastEnd=end;}};};Slicer.prototype.onKeyUp=function(event){var event=event||window.event;if((event.key=="Control"||event.key=="Shift")&&this.membersToSelect){var bSelectDateMembers=this.selectDateMembers(this.membersToSelect);if(!bSelectDateMembers){this.doFilterMembers(this.membersToSelect,true);}delete this.membersToSelect;}};Slicer.prototype.drawMember=function(tBody,member,fMember,className){var tr=document.createElement("tr");var td=document.createElement("td");td.className=className;td.id=this.frameId+"_mbr_"+member;td.member=member;td.fMember=fMember;if(isHTML(fMember)){td.innerHTML=fMember;}else{td.innerHTML=htmlEncode(fMember);}if(fMember==""){td.height="16px";}var obj=this;
td.onclick=function(e){obj.selectMemberByClick(e,this);};tr.appendChild(td);tBody.appendChild(tr);};Slicer.prototype.redrawMembers=function(){var i=0;var nodes=this.divContent.childNodes;while(i<nodes.length){this.divContent.removeChild(nodes[i]);}var tableContent=document.createElement("table");tableContent.className="slicerTable";tableContent.setAttribute("width","100%");var tbodyContent=document.createElement("tbody");tableContent.appendChild(tbodyContent);this.divContent.appendChild(tableContent);if(this.showSearch){this.resMembers=null;}if(!this.hideAll){var member="All";var fMember=Properties[getLocale()]["All"];var className=this.classNameActive;if(this.mapMembersSelected[member]){className=this.classNameSelected;}this.drawMember(tbodyContent,member,fMember,className);}this.membersIndex={};var iMbr=0;for(var i=0;i<this.membersActivate.length;i++){var member=this.membersActivate[i];var fMember=this.getMemberFormated(member);this.membersIndex[member]=iMbr;var className=this.classNameActive;
if(this.mapMembersSelected[member]){className=this.classNameSelected;}this.drawMember(tbodyContent,member,fMember,className);if(this.showSearch){var mbrElt=document.getElementById(this.frameId+"_mbr_"+member);if(this.resMembers&&!this.resMembers[member]){mbrElt.style.display="none";}else{mbrElt.style.display="";}}++iMbr;}for(var i=0;i<this.members.length;i++){var member=this.members[i];var fMember=this.getMemberFormated(member);if(!this.mapMembersActivate[member]){this.membersIndex[member]=iMbr;this.drawMember(tbodyContent,member,fMember,this.classNameInactive);if(this.showSearch){var mbrElt=document.getElementById(this.frameId+"_mbr_"+member);if(this.resMembers&&!this.resMembers[member]){mbrElt.style.display="none";}else{mbrElt.style.display="";}}}++iMbr;}this.divSlicer.appendChild(this.divContent);if(this.showSearch){this.searchbox.analyzeText();}};Slicer.prototype.selectMembers=function(members,membersFormated,l){if(this.level==l||members[0]=="All"){var prepMbrs=[];for(var i=0;i<members.length;
++i){prepMbrs[members[i]]=true;}for(var i=0;i<this.membersSelected.length;i++){if(!prepMbrs[this.membersSelected[i]]){var id=this.frameId+"_mbr_"+this.membersSelected[i];var elt=this.divSlicer.ownerDocument.getElementById(id);if(elt){if(this.mapMembersActivate[this.membersSelected[i]]){elt.className=this.classNameActive;}else{elt.className=this.classNameInactive;}}}}this.membersSelected=new Array();this.mapMembersSelected=new Array();for(var i=0;i<members.length;i++){var id=this.frameId+"_mbr_"+members[i];this.membersSelected.push(members[i]);this.mapMembersSelected[members[i]]=true;var elt=this.divSlicer.ownerDocument.getElementById(id);if(elt){if(this.mapMembersActivate[members[i]]){elt.className=this.classNameSelected;}else{elt.className=this.classNameInactive;}}}}};Slicer.prototype.drawSearchMembers=function(){this.searchTable=document.createElement("table");setStyle(this.searchTable,"width: 99%");var tr=document.createElement("tr");var td=document.createElement("td");td.className="slicerSearchImg";
tr.appendChild(td);td=document.createElement("td");var search=document.createElement("input");setStyle(search,"width: 99%");search.setAttribute("id","s_"+this.frameId);td.appendChild(search);tr.appendChild(td);this.searchTable.appendChild(tr);this.divSlicer.appendChild(this.searchTable);var obj=this;this.searchbox=new SearchBox(search.id);this.searchbox.setResultListener(function(){obj.drawResult();});if(this.members.length>ddCtrl.LIMITINDEXATION||this.dim.membersOnServer){var hierarchyName=null;var levelName=null;if(this.dim.hierarchies[this.hierarchy]){var hierarchy=this.dim.hierarchies[this.hierarchy];if(hierarchy.levels[this.level]){hierarchyName=hierarchy.id;levelName=hierarchy.levels[this.level].id;}}var limit=ddCtrl.LIMIT_RESULT_SEARCHBOX;if(this.hideEmpty){limit=this.dim.nbMembers;}this.searchbox.setAnalyzerHandler(new AnalyzerHandler([this.dm.cubeId],[this.dimId],hierarchyName,levelName,limit));}};Slicer.prototype.drawReverseFilter=function(){var slicer=this;this.reverseFilterTable=document.createElement("table");
setStyle(this.reverseFilterTable,"width: 99%");var tr=document.createElement("tr");var td=document.createElement("td");var span=document.createElement("span");span.className="selHierCombo";setStyle(span,"display: inline-block; text-align: right; width: 99%");this.reverseFilterSel=document.createElement("input");this.reverseFilterSel.type="checkbox";this.reverseFilterSel.checked=this.panel.reverseFilter;this.reverseFilterSel.onclick=function(){slicer.isReverseFilter=this.checked;slicer.panel.doReverseFilter(this.checked,true);};setStyle(this.reverseFilterSel,"margin: 0px 2px 0px 0px; vertical-align: middle;");span.appendChild(this.reverseFilterSel);span.appendChild(document.createTextNode(getLocMessage("Exclude")));td.appendChild(span);tr.appendChild(td);this.reverseFilterTable.appendChild(tr);this.divSlicer.appendChild(this.reverseFilterTable);};Slicer.prototype.drawResult=function(){this.resMembers=null;if(this.searchbox.result&&this.searchbox.result.length>0){this.resMembers=new Object();
var iRes=0;while(iRes<this.searchbox.result.length){var resSet=this.searchbox.result[iRes];var lRes=0;while(lRes<resSet.length){var resObj=resSet[lRes];var txt=resObj.txt;var id=resObj.id;this.resMembers[id]=true;++lRes;}++iRes;}var mbrs=this.members;if(this.dim.membersOnServer){mbrs=this.membersActivate;}for(var i=0;i<mbrs.length;i++){var mbr=mbrs[i];var mbrId=this.frameId+"_mbr_"+mbr;var mbrElt=document.getElementById(mbrId);if(!this.resMembers[mbr]){mbrElt.style.display="none";}else{mbrElt.style.display="";}}}else{var mbrs=this.members;if(this.dim.membersOnServer){mbrs=this.membersActivate;}for(var i=0;i<mbrs.length;i++){var mbr=mbrs[i];var mbrId=this.frameId+"_mbr_"+mbr;var mbrElt=document.getElementById(mbrId);mbrElt.style.display="";}}};Slicer.prototype.selectMemberByClick=function(event,elt){if(elt.className==this.classNameInactive){return;}var event=event||window.event;var member=elt.member;var bAll=this.membersSelected.length==0||this.membersSelected[0]=="All";var bIsSelected=elt.className==this.classNameSelected;
var members=[];if(member=="All"){members.push("All");}else{if(event.shiftKey){if(bAll){var allElt=document.getElementById(this.frameId+"_mbr_All");if(allElt){allElt.className=this.classNameActive;}}if(bIsSelected){this.membersToSelect=[];var lastMbrIdx=-1;for(var i=0;i<this.members.length;i++){if(this.members[i]==this.lastSelMbrNonShift){lastMbrIdx=i;break;}}var curMbrIdx=this.membersIndex[member];var start=Math.min(lastMbrIdx,curMbrIdx);var end=Math.max(lastMbrIdx,curMbrIdx);for(var i=0;i<this.members.length;i++){var mbr=this.members[i];var elt=document.getElementById(this.frameId+"_mbr_"+mbr);if(i>=start&&i<=end){elt.className=this.classNameSelected;this.membersToSelect.push(mbr);}else{elt.className=this.classNameActive;}}}else{elt.className=this.classNameSelected;if(typeof(this.lastSelMbrNonShift)=="undefined"){this.lastSelMbrNonShift=member;this.membersToSelect=[member];}else{this.membersToSelect=[];var lastMbrIdx=-1;if(this.membersIndex[this.lastSelMbrNonShift]!==undefined){lastMbrIdx=this.membersIndex[this.lastSelMbrNonShift];
}else{if(this.members.length>0){for(var i=0;i<this.members.length;i++){if(this.members[i]==this.lastSelMbrNonShift){lastMbrIdx=i;break;}}}else{for(var i=0;i<this.membersActivate.length;i++){if(this.membersActivate[i]==this.lastSelMbrNonShift){lastMbrIdx=i;break;}}}}var curMbrIdx=this.membersIndex[member];var start=Math.min(lastMbrIdx,curMbrIdx);var end=Math.max(lastMbrIdx,curMbrIdx);if(this.membersActivate.length>0){for(var i=0;i<this.membersActivate.length;i++){var mbr=this.membersActivate[i];var elt=document.getElementById(this.frameId+"_mbr_"+mbr);if(i>=start&&i<=end){elt.className=this.classNameSelected;this.membersToSelect.push(mbr);}else{elt.className=this.classNameActive;}}}else{for(var i=0;i<this.members.length;i++){var mbr=this.members[i];var elt=document.getElementById(this.frameId+"_mbr_"+mbr);if(i>=start&&i<=end){elt.className=this.classNameSelected;this.membersToSelect.push(mbr);}else{elt.className=this.classNameActive;}}}}}}else{if(event.ctrlKey){if(bAll){var allElt=document.getElementById(this.frameId+"_mbr_All");
if(allElt){allElt.className=this.classNameActive;}}if(bIsSelected){elt.className=this.classNameActive;if(!this.membersToSelect){this.membersToSelect=[];for(var i=0;i<this.membersSelected.length;i++){if(this.membersSelected[i]!=member){this.membersToSelect.push(this.membersSelected[i]);}}}else{for(var i=0;i<this.membersToSelect.length;i++){if(this.membersToSelect[i]==member){this.membersToSelect.splice(i,1);break;}}}}else{this.lastSelMbrNonShift=member;elt.className=this.classNameSelected;if(!this.membersToSelect){this.membersToSelect=new Array();for(var i=0;i<this.membersSelected.length;i++){if(this.membersSelected[i]!="All"){this.membersToSelect.push(this.membersSelected[i]);}}}this.membersToSelect.push(member);}}else{if(this.multiSelect){if(bAll){this.lastSelMbrNonShift=member;members.push(member);}else{if(bIsSelected){for(var i=0;i<this.membersSelected.length;i++){if(this.membersSelected[i]!=member){members.push(this.membersSelected[i]);}}}else{this.lastSelMbrNonShift=member;for(var i=0;
i<this.membersSelected.length;i++){members.push(this.membersSelected[i]);}members.push(member);}}}else{if(bIsSelected){for(var i=0;i<this.membersSelected.length;i++){if(this.membersSelected[i]!=member){members.push(this.membersSelected[i]);}}}else{this.lastSelMbrNonShift=member;members.push(member);}}}}}if(this.membersToSelect){}else{if(this.forbidEmptySelection&&members.length==0){}else{var bSelectDateMembers=this.selectDateMembers(members);if(!bSelectDateMembers){this.doFilterMembers(members,true);}}}};SlicerOneByOne=function(id,dimSelPanel,dimId,dimName,continuous,dm,hierarchy,level,pageId,options){Slicer.call(this,id,dimSelPanel,dimId,dimName,continuous,dm,hierarchy,level,pageId,options);this.viz="SlicerOneByOne";};SlicerOneByOne.prototype=new Slicer();SlicerOneByOne.prototype.drawMembers=function(){if(this.divSlicer){var i=0;var nodes=this.divSlicer.childNodes;while(i<nodes.length){this.divSlicer.removeChild(nodes[i]);}if(this.authorizeReverseFilter){this.drawReverseFilter();}var table=document.createElement("table");
setStyle(table,"width:100%");var tbody=document.createElement("tbody");table.appendChild(tbody);this.divSlicer.appendChild(table);if(!this.hideHeader){var trHeader=document.createElement("tr");trHeader.className="trHeaderFilter";var tdHeader=document.createElement("td");tdHeader.colSpan=3;tdHeader.innerHTML=this.dimName;tdHeader.className="tdHeaderFilter";trHeader.appendChild(tdHeader);tbody.appendChild(trHeader);}this.getMembers();var tr=document.createElement("tr");var tdPrev=document.createElement("td");tdPrev.setAttribute("width","10%");tdPrev.setAttribute("align","center");var imgPrev;if(navigator.appVersion.indexOf("MSIE 6")>-1){imgPrev=document.createElement("div");imgPrev.id=this.frameId+"_previous";imgPrev.style.setAttribute("cssText","cursor:pointer; visibility:hidden; position:relative; height:16px; width:16px; filter:progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+imgFolder+"16-next.png');");}else{imgPrev=document.createElement("img");imgPrev.setAttribute("id",this.frameId+"_previous");
imgPrev.setAttribute("width","16px");imgPrev.setAttribute("height","16px");imgPrev.setAttribute("src",imgFolder+"16-previous.png");}var obj=this;imgPrev.onclick=function(){obj.selectPreviousMember(this);};tdPrev.appendChild(imgPrev);tr.appendChild(tdPrev);var tdMember=document.createElement("td");tdMember.id=this.frameId+"_member";tdMember.setAttribute("align","center");tdMember.setAttribute("width","80%");tr.appendChild(tdMember);var tdNext=document.createElement("td");tdNext.setAttribute("width","10%");tdNext.setAttribute("align","center");var imgNext;if(navigator.appVersion.indexOf("MSIE 6")>-1){imgNext=document.createElement("div");imgNext.id=this.frameId+"_next";imgNext.style.setAttribute("cssText","cursor:pointer;align:center; position:relative; height:16px; width:16px; filter:progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+imgFolder+"16-next.png');");}else{imgNext=document.createElement("img");imgNext.setAttribute("id",this.frameId+"_next");imgNext.setAttribute("width","16px");
imgNext.setAttribute("height","16px");imgNext.setAttribute("src",imgFolder+"16-next.png");}var obj=this;imgNext.onclick=function(){obj.selectNextMember(this);};tdNext.appendChild(imgNext);tr.appendChild(tdNext);tbody.appendChild(tr);var mbrName="All";var mbrNameFormated=Properties[getLocale()]["All"];this.updateMember(mbrName,mbrNameFormated);var mbrToFilter=null;if(this.forbidEmptySelection||this.filter=="first"){if(this.members.length>0){mbrToFilter=this.members[0];}else{if(typeof(this.dim.min)=="number"&&!isNaN(this.dim.min)){if(this.level==-1){mbrToFilter=this.dim.min;}else{mbrToFilter=this.getGroupMbr(this.dim.min);}}}}else{if(this.filter=="last"){if(this.members.length>0){mbrToFilter=this.members[this.members.length-1];}else{if(typeof(this.dim.max)=="number"&&!isNaN(this.dim.max)){if(this.level==-1){mbrToFilter=this.dim.max;}else{mbrToFilter=this.getGroupMbr(this.dim.max);}}}}}if(mbrToFilter!=null){var bSelectDateMembers=this.selectDateMembers([mbrToFilter]);if(!bSelectDateMembers&&!this.panel.hasFilter()){this.doFilterMember(mbrToFilter);
}}}};SlicerOneByOne.prototype.resize=function(){};SlicerOneByOne.prototype.getSelectedMembers=function(){var member=this.getCurrentMember();return[member];};SlicerOneByOne.prototype.needToUpdate=function(){return this.hideEmpty;};SlicerOneByOne.prototype.updateSlicer=function(){var mbrName=this.getCurrentMember();var iM=0;this.members=[];this.membersIndex={};while(iM<this.membersActivate.length){this.members.push(this.membersActivate[iM]);this.membersIndex[this.membersActivate[iM]]=iM;++iM;}if(this.membersIndex[mbrName]==null&&mbrName!="All"){mbrName=this.members[0];this.doFilterMember(mbrName);}};SlicerOneByOne.prototype.selectMembers=function(members,membersFormated,l){if(this.level==l||members[0]=="All"){if(members[0]=="All"){this.updateMember(members[0],this.getMemberFormated(members[0]));}else{if(members.length>0){this.updateMember(members[0],this.getMemberFormated(members[0]));}}}};SlicerOneByOne.prototype.getCurrentMember=function(){var id=this.frameId+"_member";var tdMember=this.divSlicer.ownerDocument.getElementById(id);
var index=tdMember.index;if(index==-1){return"All";}return this.members[index];};SlicerOneByOne.prototype.updateMember=function(member,fMember){var tdMember=this.divSlicer.ownerDocument.getElementById(this.frameId+"_member");if(isHTML(fMember)){tdMember.innerHTML=fMember;}else{tdMember.innerHTML=htmlEncode(fMember);}var index=this.membersIndex[member];if(member=="All"){index=-1;}var memberElt=this.divSlicer.ownerDocument.getElementById(this.frameId+"_member");memberElt.index=index;var prevElt=this.divSlicer.ownerDocument.getElementById(this.frameId+"_previous");var nextElt=this.divSlicer.ownerDocument.getElementById(this.frameId+"_next");var min=-1;if(this.hideAll){min=0;}if(memberElt.index<=min){setStyle(prevElt,"cursor:pointer; visibility:hidden");}else{if(navigator.appVersion.indexOf("MSIE 6")>-1){prevElt.style.setAttribute("cssText","cursor:pointer; visibility:inherit; position:relative; height:16px; width:16px; filter:progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+imgFolder+"16-previous.png');");
}else{setStyle(prevElt,"cursor:pointer; visibility:inherit");}}if(memberElt.index>=(this.members.length-1)){setStyle(nextElt,"cursor:pointer; visibility:hidden");}else{if(navigator.appVersion.indexOf("MSIE 6")>-1){nextElt.style.setAttribute("cssText","cursor:pointer; visibility:inherit; position:relative; height:16px; width:16px; filter:progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+imgFolder+"16-next.png');");}else{setStyle(nextElt,"cursor:pointer; visibility:inherit");}}};SlicerOneByOne.prototype.selectNextMember=function(elt){var memberElt=this.divSlicer.ownerDocument.getElementById(this.frameId+"_member");var member=this.members[memberElt.index+1];var bSelectDateMembers=this.selectDateMembers([member]);if(!bSelectDateMembers){this.doFilterMember(member);}};SlicerOneByOne.prototype.selectPreviousMember=function(elt){var memberElt=this.divSlicer.ownerDocument.getElementById(this.frameId+"_member");var member=null;if(this.hideAll){if(memberElt.index>0){member=this.members[memberElt.index-1];
}}else{if((memberElt.index-1)==-1){member="All";}else{member=this.members[memberElt.index-1];}}if(member!=null){var bSelectDateMembers=this.selectDateMembers([member]);if(!bSelectDateMembers){this.doFilterMember(member);}}};SlicerHorizontal=function(id,dimSelPanel,dimId,dimName,continuous,dm,hierarchy,level,pageId,options){Slicer.call(this,id,dimSelPanel,dimId,dimName,continuous,dm,hierarchy,level,pageId,options);this.viz="SlicerHorizontal";this.classNameActive="spanMemberActive";this.classNameSelected="spanMemberSelected";this.classNameInactive="spanMemberInactive";};SlicerHorizontal.prototype=new Slicer();SlicerHorizontal.prototype.drawMembers=function(){if(this.divSlicer){var i=0;var childs=this.divSlicer.childNodes;while(i<childs.length){this.divSlicer.removeChild(childs[i]);}if(!this.hideHeader){var table=document.createElement("table");table.className="slicerTable";setStyle(table,"width:100%");var tbody=document.createElement("tbody");var trHeader=document.createElement("tr");trHeader.className="trHeaderFilter";
var tdHeader=document.createElement("td");if(this.members.length>0){tdHeader.colSpan=this.members.length;}tdHeader.innerHTML=this.dimName;tdHeader.className="tdHeaderFilter";trHeader.appendChild(tdHeader);tbody.appendChild(trHeader);table.appendChild(tbody);this.divSlicer.appendChild(table);}if(this.members.length==0){this.getMembers();}if(this.showSearch){this.drawSearchMembers();}if(this.authorizeReverseFilter){this.drawReverseFilter();}this.addSelectBehavior();this.divContent=document.createElement("div");this.divContent.className="divSlicerHorizontal";this.divSlicer.appendChild(this.divContent);this.drawMember("","",this.classNameActive);if(!this.hideAll){var member="All";var fMember=Properties[getLocale()]["All"];this.drawMember(member,fMember,this.classNameSelected);this.membersSelected.push(member);this.mapMembersSelected[member]=true;this.mapMembersActivate[member]=true;}for(var i=0;i<this.members.length;i++){var member=this.members[i];var fMember=this.getMemberFormated(member);
this.membersActivate.push(member);this.mapMembersActivate[member]=true;this.drawMember(member,fMember,this.classNameActive);if(this.showSearch&&this.members.length<=ddCtrl.LIMITINDEXATION){this.searchbox.add(fMember,new SearchComboValName(member,fMember,0));}}var mbrToFilter=null;if(this.forbidEmptySelection||this.filter=="first"){if(this.members.length>0){mbrToFilter=this.members[0];}else{if(typeof(this.dim.min)=="number"&&!isNaN(this.dim.min)){if(this.level==-1){mbrToFilter=this.dim.min;}else{mbrToFilter=this.getGroupMbr(this.dim.min);}}}}else{if(this.filter=="last"){if(this.members.length>0){mbrToFilter=this.members[this.members.length-1];}else{if(typeof(this.dim.max)=="number"&&!isNaN(this.dim.max)){if(this.level==-1){mbrToFilter=this.dim.max;}else{mbrToFilter=this.getGroupMbr(this.dim.max);}}}}}if(mbrToFilter!=null){var bSelectDateMembers=this.selectDateMembers([mbrToFilter]);if(!bSelectDateMembers&&!this.panel.hasFilter()){this.doFilterMember(mbrToFilter);}}}};SlicerHorizontal.prototype.resize=function(){};
SlicerHorizontal.prototype.drawMember=function(member,fMember,className){var obj=this;var span=document.createElement("span");span.className=className;span.id=this.frameId+"_mbr_"+member;span.member=member;span.fMember=fMember;if(isHTML(fMember)){span.innerHTML=fMember;}else{span.innerHTML=htmlEncode(fMember);}span.onclick=function(e){obj.selectMemberByClick(e,this);};var spanSep=document.createElement("span");spanSep.className="separatorMember";span.appendChild(spanSep);if(member==""){setStyle(span,"padding-left: 0px");setStyle(spanSep,"padding-right: 0px");}this.divContent.appendChild(span);};SlicerHorizontal.prototype.redrawMembers=function(){var i=0;var nodes=this.divContent.childNodes;while(i<nodes.length){this.divContent.removeChild(nodes[i]);}if(this.showSearch){this.resMembers=null;}this.drawMember("","",this.classNameActive);if(!this.hideAll){var member="All";var fMember=Properties[getLocale()]["All"];var className=this.classNameActive;if(this.mapMembersSelected[member]){var className=this.classNameSelected;
}this.drawMember(member,fMember,className);}this.membersIndex={};var iMbr=0;for(var i=0;i<this.membersActivate.length;i++){var member=this.membersActivate[i];var fMember=this.getMemberFormated(member);this.membersIndex[member]=iMbr;var className=this.classNameActive;if(this.mapMembersSelected[member]){className=this.classNameSelected;}this.drawMember(member,fMember,className);if(this.showSearch){var mbrElt=document.getElementById(this.frameId+"_mbr_"+member);if(this.resMembers&&!this.resMembers[member]){mbrElt.style.display="none";}else{mbrElt.style.display="";}}iMbr++;}for(var i=0;i<this.members.length;i++){var member=this.members[i];var fMember=this.getMemberFormated(member);if(!this.mapMembersActivate[member]){this.membersIndex[member]=iMbr;this.drawMember(member,fMember,this.classNameInactive);if(this.showSearch){var mbrElt=document.getElementById(this.frameId+"_mbr_"+member);if(this.resMembers&&!this.resMembers[member]){mbrElt.style.display="none";}else{mbrElt.style.display="";}}}iMbr++;
}if(this.showSearch){this.searchbox.analyzeText();}};SlicerSearch=function(id,dimSelPanel,dimId,dimName,continuous,dm,hierarchy,level,pageId,options){Slicer.call(this,id,dimSelPanel,dimId,dimName,continuous,dm,hierarchy,level,pageId,options);this.viz="SlicerSearch";};SlicerSearch.prototype=new Slicer();SlicerSearch.prototype.drawMembers=function(){if(this.divSlicer){var i=0;var childs=this.divSlicer.childNodes;while(i<childs.length){this.divSlicer.removeChild(childs[i]);}var obj=this;var contentHeight=this.divSlicer.offsetHeight;var contentWidth=this.divSlicer.offsetWidth;if(isChrome()||isIE()){contentWidth-=4;contentWidth+="px";}else{contentWidth-=1;contentWidth+="px";}if(!this.hideHeader){var table=document.createElement("table");table.className="slicerTable";setStyle(table,"width:100%");var tbody=document.createElement("tbody");var trHeader=document.createElement("tr");trHeader.className="trHeaderFilter";var tdHeader=document.createElement("td");tdHeader.innerHTML=this.dimName;tdHeader.className="tdHeaderFilter";
trHeader.appendChild(tdHeader);tbody.appendChild(trHeader);table.appendChild(tbody);this.divSlicer.appendChild(table);contentHeight-=table.offsetHeight;}var searchTable=document.createElement("table");setStyle(searchTable,"width: 99%");var tr=document.createElement("tr");var td=document.createElement("td");td.className="slicerSearchImg";tr.appendChild(td);td=document.createElement("td");var search=document.createElement("input");setStyle(search,"width: 99%");search.setAttribute("id","s_"+this.frameId);search.autocomplete="off";search.value="";td.appendChild(search);tr.appendChild(td);searchTable.appendChild(tr);this.divSlicer.appendChild(searchTable);contentHeight-=search.offsetHeight;var elem=document.createElement("div");elem.setAttribute("id","selector_"+this.frameId);elem.className="res";this.divSlicer.appendChild(elem);var sel=document.createElement("div");sel.setAttribute("id","selected_"+this.frameId);sel.className="selSearchSlicer";this.divSlicer.appendChild(sel);var maxDisp=0;var selectorHeight=contentHeight;
var selectedHeight=contentHeight;var selectorStyle=null;var selectedStyle=null;var verticalSplit=false;if(verticalSplit){selectorHeight=Math.floor(contentHeight/2);selectedHeight=Math.floor(contentHeight/2);var maxDisp=Math.floor(selectorHeight/16)-1;selectorStyle="cursor:auto; height:"+selectorHeight+"px; width:100%";selectedStyle="cursor:auto; height:"+selectedHeight+"px; width:100%";}else{var outside=true;if(outside){selectorHeight=contentHeight;selectedHeight=contentHeight;maxDisp=Math.floor(selectorHeight/16)-1;var selectorTop=search.offsetTop+search.offsetHeight;var selectorLeft=this.divSlicer.offsetLeft+this.divSlicer.offsetWidth-20;selectorStyle="cursor:pointer; height:"+selectorHeight+"px; width:200px; position:absolute;top:"+selectorTop+"px; left:"+selectorLeft+"px; display:none";selectedStyle="cursor:auto; height:"+selectedHeight+"px; width:100%; z-index:2000";this.divSlicer.style.overflow="visible";this.divSlicer.parentNode.style.overflow="visible";this.divSlicer.parentNode.parentNode.style.overflow="visible";
}}setStyle(elem,selectorStyle);setStyle(sel,selectedStyle);this.searchCombo=new SearchCombo(search.id,elem.id,sel.id);this.searchCombo.maxDisp=maxDisp;this.searchCombo.addSelectionListener(function(){obj.selectMembersBySearch();});this.searchCombo.setResultListener(function(){obj.drawResult();});search.searchCombo=this.searchCombo;if(search.addEventListener){search.addEventListener("keyup",searchInputChanged,false);}else{if(search.attachEvent){search.attachEvent("onkeyup",searchInputChanged);}}this.getMembers();if(this.members.length>ddCtrl.LIMITINDEXATION||this.dim.membersOnServer){var hierarchyName=null;var levelName=null;if(this.dim.hierarchies[this.hierarchy]){var hierarchy=this.dim.hierarchies[this.hierarchy];if(hierarchy.levels[this.level]){hierarchyName=hierarchy.id;levelName=hierarchy.levels[this.level].id;}}var limit=ddCtrl.LIMIT_RESULT_SEARCHBOX;if(this.hideEmpty){limit=this.dim.nbMembers;}this.searchCombo.setAnalyzerHandler(new AnalyzerHandler([this.dm.cubeId],[this.dimId],hierarchyName,levelName,limit));
}else{for(var i=0;i<this.members.length;i++){var member=this.members[i];var fMember=this.getMemberFormated(member);this.searchCombo.add(fMember,new SearchComboValName(member,fMember,i));}}}};SlicerSearch.prototype.resize=function(){};SlicerSearch.prototype.getSelectedMembers=function(){var selected=new Array();var sel=this.searchCombo.selected;for(var i=0;i<sel.length;i++){selected.push(sel[i].id);}return selected;};SlicerSearch.prototype.selectMembersBySearch=function(){var selected=new Array();var sel=this.searchCombo.selected;if(sel.length>0){for(var i=0;i<sel.length;i++){selected.push(sel[i].id);}this.doFilterMembers(selected,false);}else{this.doFilterMember("All",true);}};SlicerSearch.prototype.selectMembers=function(members,membersFormated,l){if(this.level==l||members[0]=="All"){if(members!=null&&members.length==1&&members[0]=="All"){if(this.searchCombo.selected.length>0){this.searchCombo.delSel();}}else{this.searchCombo.selByName=[];this.searchCombo.selected=[];for(var i=0;i<members.length;
i++){var m=members[i];var mF=null;if(this.dimId.membersOnServer){mF=membersFormated[i];}else{mF=this.getMemberFormated(m);}this.searchCombo.addSelected(new SearchComboValName(m,mF,i));}}if(this.searchCombo.result==null||this.searchCombo.length==0){hideResults(this.searchCombo);}}};SlicerSearch.prototype.needToUpdate=function(){return this.hideEmpty;};SlicerSearch.prototype.updateSlicer=function(){this.updated=true;this.updateMembersAvailable();};SlicerSearch.prototype.drawResult=function(){var i=0;var nodes=this.searchCombo.elem.childNodes;while(i<nodes.length){this.searchCombo.elem.removeChild(nodes[i]);}var ul=document.createElement("ul");ul.className="sbox";if(this.searchCombo.result&&(this.searchCombo.result.length>0)){var displayRes={};var iRes=0;var pos=0;var nr=0;var numOther=0;var hasResult=false;while(iRes<this.searchCombo.result.length){var resSet=this.searchCombo.result[iRes];var lRes=0;var displayResLength=0;while(lRes<resSet.length){var resObj=resSet[lRes];var txt=resObj.txt;
var id=resObj.id;if(!displayRes[id]){if(this.hideEmpty&&this.updated){if(this.mapMembersActivate[id]){var li=document.createElement("li");li.refObj=this.searchCombo;li.obj=resObj;li.pos=pos;li.innerHTML=txt;if(!isTouchDevice()){li.onmouseover=function(){SBitPos(this);};li.onclick=function(){SBselect(this);};}else{li.ontouchend=function(){SBselect(this);};}ul.appendChild(li);displayRes[id]=true;displayResLength++;hasResult=true;++nr;}}else{var li=document.createElement("li");li.refObj=this.searchCombo;li.obj=resObj;li.pos=pos;li.innerHTML=txt;if(!isTouchDevice()){li.onmouseover=function(){SBitPos(this);};li.onclick=function(){SBselect(this);};}else{li.ontouchend=function(){SBselect(this);};}ul.appendChild(li);displayRes[txt]=true;displayResLength++;hasResult=true;++nr;}}++pos;++lRes;if(nr==this.searchCombo.maxDisp){break;}}if(lRes<displayResLength){numOther+=resSet.length-lRes;}if(nr==this.searchCombo.maxDisp){break;}++iRes;}while(iRes<this.searchCombo.result.length){numOther+=this.searchCombo.result[iRes].length;
++iRes;}this.searchCombo.elem.appendChild(ul);if(hasResult){this.searchCombo.elem.appendChild(ul);if(numOther>0){var div=document.createElement("div");div.className="elOther";div.innerHTML=this.searchCombo.extraothers+numOther+Properties[this.searchCombo.lcl]["Others"];this.searchCombo.elem.appendChild(div);}}else{var li=document.createElement("li");li.innerHTML=Properties[this.searchCombo.lcl]["NoResult"];ul.appendChild(li);this.searchCombo.elem.appendChild(ul);}}else{var li=document.createElement("li");li.innerHTML=Properties[this.searchCombo.lcl]["NoResult"];ul.appendChild(li);this.searchCombo.elem.appendChild(ul);}};function searchInputChanged(event){event=event||window.event;var search=event.target;if(typeof search=="undefined"){search=event.srcElement;}var searchCombo=search.searchCombo;if(search&&search.value==""){hideResults(searchCombo);}else{showResults(searchCombo);}}function hideResults(searchCombo){searchCombo.elem.style.zIndex="0";searchCombo.elem.style.overflow="hidden";searchCombo.elem.style.display="none";
}function showResults(searchCombo){searchCombo.elem.style.zIndex="3000";searchCombo.elem.style.overflow="visible";searchCombo.elem.style.display="block";}SlicerCombo=function(id,dimSelPanel,dimId,dimName,continuous,dm,hierarchy,level,pageId,options){Slicer.call(this,id,dimSelPanel,dimId,dimName,continuous,dm,hierarchy,level,pageId,options);this.viz="SlicerCombo";this.selectedMembers="All";};SlicerCombo.prototype=new Slicer();SlicerCombo.prototype.drawMembers=function(){if(this.divSlicer){this.divSlicer.className="slicerComboDiv";var i=0;var childs=this.divSlicer.childNodes;while(i<childs.length){this.divSlicer.removeChild(childs[i]);}this.divSlicer.style.overflow="visible";var slicer=this;this.getMembers();this.membersOnServer=this.dim.membersOnServer;if(this.authorizeReverseFilter){this.drawReverseFilter();}var table=document.createElement("table");setStyle(table,"width: 100%");var tbody=document.createElement("tbody");var tr=document.createElement("tr");tbody.appendChild(tr);table.appendChild(tbody);
this.divSlicer.appendChild(table);if(!this.hideHeader){if(isIE6()||isIE7()){var td=document.createElement("td");var span=document.createElement("span");span.className="slicerComboTDDim";span.innerHTML=this.dimName;td.appendChild(span);tr.appendChild(td);}else{var td=document.createElement("td");td.className="slicerComboTDDim";td.innerHTML=this.dimName;tr.appendChild(td);}}else{table.style.width="100%";}var tdCombo=document.createElement("td");tdCombo.id=this.id+"_combo";tdCombo.className="slicerComboDiv";setStyle(tdCombo,"overflow:visible; height:100%; width: 100%");tr.appendChild(tdCombo);this.searchbox=new SearchComboChosen(tdCombo,this.multiSelect,this.dimName,!this.hideAll,false,this.hideAll);this.searchbox.maxDisp=ddCtrl.LIMIT_RESULT_SEARCHBOX;this.searchbox.nbPreviewRes=ddCtrl.LIMIT_RESULT_SEARCHBOX;this.searchbox.addSelectionListener(function(){slicer.selectMemberByCombo();});this.searchbox.parentObj=this;if(this.sortType!==undefined&&this.sortType>-1&&this.sortReverse!==undefined){this.searchbox.setSort("id",this.sortType,this.sortReverse);
}else{if(this.dim.sort){if(this.dim.sortOnCaption){this.searchbox.setSort("txt",this.dim.sortType,this.dim.sortReverse);}else{this.searchbox.setSort("id",this.dim.sortType,this.dim.sortReverse);}}}if(this.dim.membersOnServer){var hierarchyName=null;var levelName=null;if(this.dim.hierarchies[this.hierarchy]){var hierarchy=this.dim.hierarchies[this.hierarchy];if(hierarchy.levels[this.level]){hierarchyName=hierarchy.id;levelName=hierarchy.levels[this.level].id;}}var dmsel=null;var limit=ddCtrl.LIMIT_RESULT_SEARCHBOX;if(this.hideEmpty){limit=Math.min(limit,this.dim.nbMembers);dmsel=this.dmSel;}this.searchbox.setAnalyzerHandler(new AnalyzerHandler([this.dm.cubeId],[this.dimId],hierarchyName,levelName,limit,dmsel));}else{if(this.members.length>ddCtrl.LIMITINDEXATION){var hierarchyName=null;var levelName=null;if(this.dim.hierarchies[this.hierarchy]){var hierarchy=this.dim.hierarchies[this.hierarchy];if(hierarchy.levels[this.level]){hierarchyName=hierarchy.id;levelName=hierarchy.levels[this.level].id;
}}var dmsel=null;var limit=ddCtrl.LIMIT_RESULT_SEARCHBOX;if(this.hideEmpty){limit=Math.min(limit,this.dim.nbMembers);dmsel=this.dmSel;}this.searchbox.setAnalyzerHandler(new AnalyzerHandler([this.dm.cubeId],[this.dimId],hierarchyName,levelName,limit,dmsel));var length=Math.min(ddCtrl.LIMIT_RESULT_SEARCHBOX,this.members.length);for(var i=0;i<length;i++){var member=this.members[i];var fMember=this.getMemberFormated(member);this.searchbox.add(fMember,new SearchComboValName(member,fMember,i));}}else{for(var i=0;i<this.members.length;i++){var member=this.members[i];var fMember=this.getMemberFormated(member);this.searchbox.add(fMember,new SearchComboValName(member,fMember,i));}}}var mbrToFilter=null;if(this.forbidEmptySelection||this.filter=="first"||this.members.length==1){if(this.members.length>0){mbrToFilter=this.members[0];}else{if(typeof(this.dim.min)=="number"&&!isNaN(this.dim.min)){if(this.level==-1){mbrToFilter=this.dim.min;}else{mbrToFilter=this.getGroupMbr(this.dim.min);}}}}else{if(this.filter=="last"){if(this.members.length>0){mbrToFilter=this.members[this.members.length-1];
}else{if(typeof(this.dim.max)=="number"&&!isNaN(this.dim.max)){if(this.level==-1){mbrToFilter=this.dim.max;}else{mbrToFilter=this.getGroupMbr(this.dim.max);}}}}}if(mbrToFilter!=null){var bSelectDateMembers=this.selectDateMembers([mbrToFilter]);if(!bSelectDateMembers&&!this.panel.hasFilter()){this.doFilterMember(mbrToFilter);}}}};SlicerCombo.prototype.resize=function(){};SlicerCombo.prototype.changeOverflow=function(sOverflow){if(ddCtrl.isNewDashboard){var portletElt=document.getElementById(this.frameId.replace("slicer_",""));portletElt.style.overflow=sOverflow;var portletContentId=this.frameId.replace("slicer_","content_");var portletContentElt=document.getElementById(portletContentId);portletContentElt.style.overflow=sOverflow;portletContentElt.parentElement.style.overflow=sOverflow;var curElt=this.divSlicer.parentElement;while(curElt!=null&&curElt.id!=portletContentId){curElt.style.overflow=sOverflow;curElt=curElt.parentElement;}}else{var curElt=this.divSlicer.parentElement;while(curElt!=null&&curElt.className!="x-panel-bwrap"){curElt.style.overflow="visible";
curElt=curElt.parentElement;}curElt.style.overflow="visible";}};SlicerCombo.prototype.selectMemberByCombo=function(){var selMbrs=new Array();var bAllSelected=false;var sel=this.searchbox.selected;if(sel.length>0){for(var i=0;i<sel.length;i++){var selObj=sel[i];if(selObj.id=="All"){bAllSelected=true;}selMbrs.push(selObj.id);this.mapMembersCaption[selObj.id]=selObj.txt;}}if(selMbrs.length>0&&!bAllSelected){var bSelectDateMembers=this.selectDateMembers(selMbrs);if(!bSelectDateMembers){this.doFilterMembers(selMbrs,false);}}else{if(!this.panel.hideAll){var bSelectDateMembers=this.selectDateMembers(["All"]);if(!bSelectDateMembers){this.doFilterMember("All",true);}}else{var h=this.hierarchy;var l=this.level;var hId=null;var lId=null;if(this.panel.hasHierarchy){h=this.panel.getSelectedHierarchyIndex();l=this.panel.getSelectedLevelIndex();hId=this.panel.getSelectedHierarchyId();lId=this.panel.getSelectedLevelId();}var membersFormated=this.panel.getSelectedFormatedElements();var members=this.panel.getSelectedElements();
if((this.hierarchyId==hId||this.hierarchy==h)&&(this.levelId==lId||this.level==l)){this.selectMembers(members,membersFormated,l);}}}};SlicerCombo.prototype.selectMembers=function(members,membersFormated,l){if(this.level==l||members[0]=="All"){if(members.length>0){var mbrsFormated=new Array();if(this.dim.membersOnServer){mbrsFormated=membersFormated;}else{for(var i=0;i<members.length;i++){var m=members[i];var mF=this.getMemberFormated(m);mbrsFormated.push(mF);}}this.updateMember(members,mbrsFormated);}}};SlicerCombo.prototype.updateMember=function(members,membersFormated){var selObjList=[];if(members.length>0&&members[0]!="All"){for(var i=0;i<members.length;i++){var selObj=new SearchComboValName(members[i],membersFormated[i],i);selObjList.push(selObj);}this.searchbox.delSel();this.searchbox.addSelectedList(selObjList);}else{this.searchbox.delSel();}};SlicerCombo.prototype.needToUpdate=function(){return this.hideEmpty;};SlicerCombo.prototype.updateSlicer=function(members,membersFormated){this.searchbox.clearResult();
this.searchbox.clearField();this.searchbox.clearTST();var length=this.membersActivate.length;for(var i=0;i<length;i++){var member=this.membersActivate[i];var fMember=this.getMemberFormated(member);this.searchbox.add(fMember,new SearchComboValName(member,fMember,i));}};SlicerSlider=function(id,dimSelPanel,dimId,dimName,continuous,dm,hierarchy,level,pageId,options){Slicer.call(this,id,dimSelPanel,dimId,dimName,continuous,dm,hierarchy,level,pageId,options);this.viz="SlicerSlider";};SlicerSlider.prototype=new Slicer();SlicerSlider.prototype.drawMembers=function(){if(this.divSlicer){this.divSlicer.className="slicerComboDiv";var i=0;var childs=this.divSlicer.childNodes;while(i<childs.length){this.divSlicer.removeChild(childs[i]);}if(!this.bDrawn){this.bDrawn=true;}this.getMembers();if(this.authorizeReverseFilter){this.drawReverseFilter();}if(!this.hideHeader){var divHeader=document.createElement("div");divHeader.className="divHeader";var tableHeader=document.createElement("table");tableHeader.className="slicerTable";
tableHeader.setAttribute("width","100%");var tbodyHeader=document.createElement("tbody");tbodyHeader.className="slicerTable";var trHeader=document.createElement("tr");trHeader.className="trHeaderFilter";var tdHeader=document.createElement("td");tdHeader.innerHTML=this.dimName;tdHeader.className="tdHeaderFilter";trHeader.appendChild(tdHeader);tbodyHeader.appendChild(trHeader);tableHeader.appendChild(tbodyHeader);divHeader.appendChild(tableHeader);this.divSlicer.appendChild(divHeader);}var divText=document.createElement("div");setStyle(divText,"width:100%");var minElt=document.createElement("span");this.minId=this.frameId+"_min";minElt.id=this.minId;minElt.className="slicerSliderMin";var maxElt=document.createElement("span");this.maxId=this.frameId+"_max";maxElt.id=this.maxId;maxElt.className="slicerSliderMax";divText.appendChild(minElt);divText.appendChild(maxElt);this.divSlicer.appendChild(divText);var slider=document.createElement("div");this.sliderId="slider_"+this.dimId+"_"+this.pageId;
slider.id=this.sliderId;slider.className="slicerSlider";slider.obj=this;this.divSlicer.appendChild(slider);var bPreselect=true;if(typeof(this.min)!="number"||isNaN(this.min)){if(typeof(this.dim.min)=="number"&&!isNaN(this.dim.min)){this.min=this.dim.min;}else{var i=0;var mbr=this.members[i];while(i<this.members.length&&(mbr==null||mbr=="")){mbr=this.members[i];i++;}this.min=this.members[i];}bPreselect=false;}if(typeof(this.max)!="number"||isNaN(this.max)){if(typeof(this.dim.max)=="number"&&!isNaN(this.dim.max)){this.max=this.dim.max;}else{if(!this.dim.membersOnServer){this.max=this.members[this.members.length-1];}else{if(this.dim.time){this.max=new Date().getTime()/1000;}}}}if(this.level==-1){if(this.dim.time){this.min=this.transformDate(this.min,0);this.max=this.transformDate(this.max,0);}this.format=this.dim.format;}else{this.min=this.getGroupMbr(this.min);this.max=this.getGroupMbr(this.max);var level=this.dim.hierarchies[this.hierarchy].levels[this.level];this.format=level.format;}var slicer=this;
this.update=true;if(this.range){if(bPreselect&&!this.bDrawn){ddCtrl.setFilterMinMax(this.dimId,this.min,this.max);}this.drawRangeSlider();}else{this.drawSlider();}if($("[id='"+slicer.sliderId+"']").draggable){$("[id='"+slicer.sliderId+"']").draggable();}}};SlicerSlider.prototype.resize=function(){};SlicerSlider.prototype.drawRangeSlider=function(){var slicer=this;$(function(){$("[id='"+slicer.sliderId+"']").slider({range:true,min:slicer.min,max:slicer.max,values:[slicer.min,slicer.max],slide:function(event,ui){var min=ui.values[0];var max=ui.values[1];if(slicer.dim.time){min=slicer.transformDate(min);max=slicer.transformDate(max);}document.getElementById(slicer.minId).innerHTML=slicer.getMemberFormated(min);document.getElementById(slicer.maxId).innerHTML=slicer.getMemberFormated(max);},change:function(event,ui){if(event.originalEvent){slicer.update=false;var min=ui.values[0];var max=ui.values[1];if(slicer.dim.time){if(slicer.level==-1){min=slicer.transformDate(min);max=slicer.transformDate(max,1);
}else{var level=slicer.dim.hierarchies[slicer.hierarchy].levels[slicer.level];var s=slicer.getGroupMbr(min);var fMin=level.fMin;min=eval(fMin);var s=slicer.getGroupMbr(max);var fMax=level.fMax;max=eval(fMax);}if(min!=ui.values[0]||max!=ui.values[1]){$("[id='"+this.sliderId+"']").slider("option","values",[min,max]);}}else{if(slicer.level>-1){var grpMin=null;var grpMax=null;var level=slicer.dim.hierarchies[slicer.hierarchy].levels[slicer.level];for(var i=0;i<level.groups.length;i++){var grp=level.groups[i];if(grp.isValueIn(min)&&grpMin==null){grpMin=grp;min=grpMin.minfval;}if(grp.isValueIn(max)&&grpMax==null){grpMax=grp;max=grpMax.maxfval;}if(grpMin!=null&&grpMax!=null){break;}}}else{max+=1;}}ddCtrl.setFilterMinMax(slicer.dimId,min,max);slicer.update=true;}}});var min=slicer.min;var max=slicer.max;if(slicer.level!=-1){min=slicer.getGroupMbr(min);max=slicer.getGroupMbr(max);}else{if(slicer.dim.time){min=slicer.transformDate(min,0);max=slicer.transformDate(max,0);}}document.getElementById(slicer.minId).innerHTML=slicer.getMemberFormated(min);
document.getElementById(slicer.maxId).innerHTML=slicer.getMemberFormated(max);$("[id='"+slicer.sliderId+"']").focusin(function(event){if(event.stopPropagation){event.stopPropagation();}});});};SlicerSlider.prototype.drawSlider=function(){var slicer=this;if(!this.panel.hasFilter()){var mbrToFilter=null;if(this.filter=="first"){if(this.members.length>0){mbrToFilter=this.members[0];}else{if(typeof(this.dim.min)=="number"&&!isNaN(this.dim.min)){if(this.level==-1){mbrToFilter=this.dim.min;}else{mbrToFilter=this.getGroupMbr(this.dim.min);}}}}else{if(this.filter=="last"){if(this.members.length>0){mbrToFilter=this.members[this.members.length-1];}else{if(typeof(this.dim.max)=="number"&&!isNaN(this.dim.max)){if(this.level==-1){mbrToFilter=this.dim.max;}else{mbrToFilter=this.getGroupMbr(this.dim.max);}}}}else{mbrToFilter=this.min;}}if(mbrToFilter){this.doFilterMember(mbrToFilter);}}$(function(){$("[id='"+slicer.sliderId+"']").slider({min:slicer.min,max:slicer.max,value:slicer.min,slide:function(event,ui){var value=ui.value;
if(slicer.dim.time){value=slicer.transformDate(value);}document.getElementById(slicer.minId).innerHTML=slicer.getMemberFormated(value);},change:function(event,ui){if(event.originalEvent){slicer.update=false;var value=ui.value;if(slicer.dim.time){value=slicer.transformDate(value);}slicer.doFilterMember(value);slicer.update=true;}}});document.getElementById(slicer.minId).innerHTML=slicer.getMemberFormated($("[id='"+slicer.sliderId+"']").slider("value"));$("[id='"+slicer.sliderId+"']").focusin(function(event){if(event.stopPropagation){event.stopPropagation();}});});};SlicerSlider.prototype.transformDate=function(t,inc){if(typeof(inc)=="undefined"){inc=0;}if(this.level==-1){var d=new Date(t*1000);if(this.dateGranularity=="year"){t=new Date(d.getFullYear()+inc,0,1)/1000;}else{if(this.dateGranularity=="month"){t=new Date(d.getFullYear(),d.getMonth()+inc,1)/1000;}else{if(this.dateGranularity=="day"){t=new Date(d.getFullYear(),d.getMonth(),d.getDate()+inc)/1000;}else{if(this.dateGranularity=="hour"){t=new Date(d.getFullYear(),d.getMonth(),d.getDate(),d.getHours()+inc)/1000;
}else{if(this.dateGranularity=="minute"){t=new Date(d.getFullYear(),d.getMonth(),d.getDate(),d.getHours(),d.getMinutes()+inc)/1000;}else{if(this.dateGranularity=="second"){t=new Date(d.getFullYear(),d.getMonth(),d.getDate(),d.getHours(),d.getMinutes(),d.getSeconds()+inc)/1000;}else{t=new Date(d.getFullYear(),d.getMonth(),d.getDate()+inc)/1000;}}}}}}}else{t=this.getGroupMbr(t);}return t;};SlicerSlider.prototype.selectMembers=function(members,membersFormated,l,h,rangeMin,rangeMax){if(this.range){$("[id='"+this.sliderId+"']").removeClass("ui-state-disabled");var min=this.min;var max=this.max;if(members.length>0&&members[0]!="All"){if(!isNaN(rangeMin)&&!isNaN(rangeMax)){min=rangeMin;if(this.dim.time){max=rangeMax-(24*3600);}else{max=rangeMax-1;}}else{if(l>-1&&members&&members.length==1){var selMbr=members[0];var level=this.dim.hierarchies[h].levels[l];if(level&&level.fMin&&level.fMax){var filter=getFilterContinuous(this.dmSel,this.dim,h,l,level.fMin,level.fMax,selMbr);if(!isNaN(filter.min)&&!isNaN(filter.max)){min=filter.min;
if(filter.dim.time){max=filter.max-(24*3600);}else{max=filter.max-1;}}}}else{var bFollowingMembers=true;if(members.length>1&&this.update){var lastIdx=-1;for(var i=0;i<members.length;i++){if(lastIdx==-1){lastIdx=this.membersIndex[members[i]];}else{if(lastIdx+1==this.membersIndex[members[i]]){lastIdx=this.membersIndex[members[i]];}else{bFollowingMembers=false;break;}}}}else{bFollowingMembers=false;}if(bFollowingMembers){min=members[0];max=members[members.length-1];}else{$("[id='"+this.sliderId+"']").addClass("ui-state-disabled");}}}}if(this.update){$("[id='"+this.sliderId+"']").slider("option","values",[min,max]);if(this.level!=-1){min=this.getGroupMbr(min);max=this.getGroupMbr(max);}else{if(this.dim.time){min=this.transformDate(min,0);max=this.transformDate(max,0);}}document.getElementById(this.minId).innerHTML=this.getMemberFormated(min);document.getElementById(this.maxId).innerHTML=this.getMemberFormated(max);}}else{if(members.length>0&&members[0]!="All"){if(!isNaN(rangeMin)&&!isNaN(rangeMax)){$("[id='"+this.sliderId+"']").addClass("ui-state-disabled");
document.getElementById(this.minId).innerHTML="";}else{$("[id='"+this.sliderId+"']").slider("option","value",members[0]);document.getElementById(this.minId).innerHTML=this.getMemberFormated(members[0]);}}else{$("[id='"+this.sliderId+"']").addClass("ui-state-disabled");document.getElementById(this.minId).innerHTML="";}}};SlicerSlider.prototype.needToUpdate=function(){return this.hideEmpty&&this.range;};SlicerSlider.prototype.updateSlicer=function(){if(this.membersActivate.length>0){$("[id='"+this.sliderId+"']").removeClass("ui-state-disabled");var min=this.membersActivate[0];var max=this.membersActivate[this.membersActivate.length-1];this.min=min;this.max=max;$("[id='"+this.sliderId+"']").slider("option","min",min);$("[id='"+this.sliderId+"']").slider("option","max",max);}else{$("[id='"+this.sliderId+"']").addClass("ui-state-disabled");}};SlicerDatePicker=function(id,dimSelPanel,dimId,dimName,continuous,dm,hierarchy,level,pageId,options){Slicer.call(this,id,dimSelPanel,dimId,dimName,continuous,dm,hierarchy,level,pageId,options);
this.viz="SlicerSlider";this.isDays=true;};SlicerDatePicker.prototype=new Slicer();SlicerDatePicker.prototype.drawMembers=function(){if(this.divSlicer){this.divSlicer.className="slicerComboDiv";var i=0;var childs=this.divSlicer.childNodes;while(i<childs.length){this.divSlicer.removeChild(childs[i]);}if(!this.bDrawn){this.bDrawn=true;}this.getMembers();if(this.authorizeReverseFilter){this.drawReverseFilter();}if(!this.hideHeader){var divHeader=document.createElement("div");divHeader.className="divHeader";var tableHeader=document.createElement("table");tableHeader.className="slicerTable";tableHeader.setAttribute("width","100%");var tbodyHeader=document.createElement("tbody");tbodyHeader.className="slicerTable";var trHeader=document.createElement("tr");trHeader.className="trHeaderFilter";var tdHeader=document.createElement("td");tdHeader.innerHTML=this.dimName;tdHeader.className="tdHeaderFilter";trHeader.appendChild(tdHeader);tbodyHeader.appendChild(trHeader);tableHeader.appendChild(tbodyHeader);
divHeader.appendChild(tableHeader);this.divSlicer.appendChild(divHeader);}this.div=document.createElement("div");this.div.className="slicerDatePickerDiv";this.divSlicer.appendChild(this.div);var pMin=document.createElement("span");if(this.range){pMin.innerHTML=Properties[getLocale()]["From"]+"&nbsp;";}else{pMin.innerHTML=this.dimName+"&nbsp;";}pMin.className="slicerDatePickerSpanMin";var minElt=document.createElement("input");this.minId=this.frameId+"_minText";minElt.id=this.minId;minElt.type="text";minElt.className="slicerDatePickerInput";pMin.appendChild(minElt);this.div.appendChild(pMin);var bPreselect=true;if(typeof(this.min)!="number"||isNaN(this.min)){if(typeof(this.dim.min)=="number"&&!isNaN(this.dim.min)){this.min=this.dim.min;}else{var i=0;var mbr=this.members[i];while(i<this.members.length&&(mbr==null||mbr=="")){mbr=this.members[i];i++;}this.min=this.members[i];}bPreselect=false;}if(typeof(this.max)!="number"||isNaN(this.max)){if(typeof(this.dim.max)=="number"&&!isNaN(this.dim.max)){this.max=this.dim.max;
}else{if(!this.dim.membersOnServer){this.max=this.members[this.members.length-1];}else{this.max=new Date().getTime()/1000;}}}var dMin=new Date(this.min*1000);if(dMin.getHours()!=0||dMin.getMinutes()!=0||dMin.getSeconds()!=0){this.min=new Date(dMin.getFullYear(),dMin.getMonth(),dMin.getDate()).getTime()/1000;this.isDays=false;}var dMax=new Date(this.max*1000);if(dMax.getHours()!=0||dMax.getMinutes()!=0||dMax.getSeconds()!=0){this.max=new Date(dMax.getFullYear(),dMax.getMonth(),dMax.getDate()).getTime()/1000;this.isDays=false;}if(this.isDays){this.format=this.dim.format;}else{ddCtrl.loadFormatRepo();if(ddCtrl.formatRepo&&ddCtrl.formatRepo.Date){this.format=ddCtrl.formatRepo.Date;}}this.update=true;if(this.range){if(bPreselect&&!this.bDrawn){ddCtrl.setFilterMinMax(this.dimId,this.min,this.max);}this.drawRangeDatePicker();}else{this.drawDatePicker();}}};SlicerDatePicker.prototype.resize=function(){};SlicerDatePicker.prototype.drawRangeDatePicker=function(){var slicer=this;var lang=getLocale();
var minDate=new Date(this.min*1000);this.selectedMin=this.min;var maxDate=new Date(this.max*1000);this.selectedMax=this.max;var pMax=document.createElement("span");pMax.innerHTML=Properties[getLocale()]["To"]+"&nbsp;";pMax.className="slicerDatePickerSpanMax";var maxElt=document.createElement("input");this.maxId=this.frameId+"_maxText";maxElt.id=this.maxId;maxElt.type="text";maxElt.className="slicerDatePickerInput";pMax.appendChild(maxElt);this.div.appendChild(pMax);$(function(){$.datepicker.setDefaults($.datepicker.regional[lang]);$("[id='"+slicer.minId+"']").datepicker({changeMonth:true,changeYear:true,showOn:"button",buttonImage:"icons/16-calendar.png",buttonImageOnly:true,defaultDate:minDate,minDate:minDate,maxDate:maxDate,onSelect:function(date,inst){var t=new Date(inst.selectedYear,inst.selectedMonth,inst.selectedDay).getTime()/1000;slicer.selectedMin=t;slicer.doFilter();}});$("[id='"+slicer.minId+"']").change(function(){var curDate=$("[id='"+slicer.minId+"']").datepicker("getDate");
slicer.selectedMin=curDate.getTime()/1000;slicer.doFilter();});$("[id='"+slicer.minId+"']").focusin(function(event){if(event.stopPropagation){event.stopPropagation();}});$("[id='"+slicer.maxId+"']").datepicker({changeMonth:true,changeYear:true,showOn:"button",buttonImage:"icons/16-calendar.png",buttonImageOnly:true,defaultDate:maxDate,minDate:minDate,maxDate:maxDate,onSelect:function(date,inst){var t=new Date(inst.selectedYear,inst.selectedMonth,inst.selectedDay).getTime()/1000;slicer.selectedMax=t;slicer.doFilter();}});$("[id='"+slicer.maxId+"']").change(function(){var curDate=$("[id='"+slicer.maxId+"']").datepicker("getDate");slicer.selectedMax=curDate.getTime()/1000;slicer.doFilter();});$("[id='"+slicer.maxId+"']").focusin(function(event){if(event.stopPropagation){event.stopPropagation();}});});};SlicerDatePicker.prototype.drawDatePicker=function(){var slicer=this;var lang=getLocale();var minDate=new Date(this.min*1000);var maxDate=new Date(this.max*1000);if(!this.panel.hasFilter()){var mbrToFilter=null;
if(this.filter=="first"){if(this.members.length>0){mbrToFilter=this.members[0];}else{if(typeof(this.dim.min)=="number"&&!isNaN(this.dim.min)){mbrToFilter=this.dim.min;}}}else{if(this.filter=="last"){if(this.members.length>0){mbrToFilter=this.members[this.members.length-1];}else{if(typeof(this.dim.max)=="number"&&!isNaN(this.dim.max)){mbrToFilter=this.dim.max;}}}else{mbrToFilter=this.min;}}if(mbrToFilter){this.doFilterMember(mbrToFilter);}}$(function(){$.datepicker.setDefaults($.datepicker.regional[lang]);$("[id='"+slicer.minId+"']").datepicker({changeMonth:true,changeYear:true,showOn:"button",buttonImage:"icons/16-calendar.png",buttonImageOnly:true,defaultDate:minDate,minDate:minDate,maxDate:maxDate,onSelect:function(date,inst){if(slicer.isDays){var t=new Date(inst.selectedYear,inst.selectedMonth,inst.selectedDay).getTime()/1000;slicer.selectedMbr=t;slicer.doFilter();}else{var tMin=new Date(inst.selectedYear,inst.selectedMonth,inst.selectedDay).getTime()/1000;var tMax=new Date(inst.selectedYear,inst.selectedMonth,parseInt(inst.selectedDay)+1).getTime()/1000;
ddCtrl.setFilterMinMax(slicer.dimId,tMin,tMax);}},beforeShowDay:function(date){if(slicer.hideEmpty){var t=date.getTime()/1000;if(slicer.mapMembersActivate[t]){return[true];}else{return[false];}}else{return[true];}}});$("[id='"+slicer.minId+"']").change(function(){var curDate=$("[id='"+slicer.minId+"']").datepicker("getDate");if(slicer.isDays){var t=curDate.getTime()/1000;slicer.selectedMbr=t;slicer.doFilter();}else{var tMin=curDate.getTime()/1000;var tMax=new Date(curDate.getFullYear(),curDate.getMonth(),curDate.getDate()+1).getTime()/1000;ddCtrl.setFilterMinMax(slicer.dimId,tMin,tMax);}});$("[id='"+slicer.minId+"']").focusin(function(event){if(event.stopPropagation){event.stopPropagation();}});});if(!this.panel.hasFilter()&&this.members.length>0){if(this.filter=="first"){this.doFilterMember(this.members[0]);}else{if(this.filter=="last"){this.doFilterMember(this.members[this.members.length-1]);}}}};SlicerDatePicker.prototype.doFilter=function(){if(this.range){ddCtrl.setFilterMinMax(this.dimId,this.selectedMin,this.selectedMax+(24*3600));
}else{this.doFilterMember(this.selectedMbr);}};SlicerDatePicker.prototype.selectMembers=function(members,membersFormated,l,h,rangeMin,rangeMax){if(this.range){if(members&&members[0]!="All"){var min=null;var max=null;if(!isNaN(rangeMin)&&!isNaN(rangeMax)){min=rangeMin;if(this.dim.time){max=rangeMax-(24*3600);}else{max=rangeMax-1;}}else{if(l>-1&&members&&members.length==1){var selMbr=members[0];var level=this.dim.hierarchies[h].levels[l];if(level&&level.fMin&&level.fMax){var filter=getFilterContinuous(this.dmSel,this.dim,h,l,level.fMin,level.fMax,selMbr);if(!isNaN(filter.min)&&!isNaN(filter.max)){min=filter.min;if(this.dim.time){max=filter.max-(24*3600);}else{max=filter.max-1;}}}}else{var bFollowingMembers=true;if(members.length>1&&this.update){var lastIdx=-1;for(var i=0;i<members.length;i++){if(lastIdx==-1){lastIdx=this.membersIndex[members[i]];}else{if(lastIdx+1==this.membersIndex[members[i]]){lastIdx=this.membersIndex[members[i]];}else{bFollowingMembers=false;break;}}}}else{bFollowingMembers=false;
}if(bFollowingMembers){min=members[0];max=members[members.length-1];}}}if(min!=null&&max!=null){this.selectedMin=min;$("[id='"+this.minId+"']").datepicker("setDate",new Date(min*1000));this.selectedMax=max;$("[id='"+this.maxId+"']").datepicker("setDate",new Date(max*1000));}else{$("[id='"+this.minId+"']").datepicker("setDate",null);$("[id='"+this.maxId+"']").datepicker("setDate",null);}}else{this.selectedMin=this.min;$("[id='"+this.minId+"']").datepicker("setDate",new Date(this.min*1000));this.selectedMax=this.max;$("[id='"+this.maxId+"']").datepicker("setDate",new Date(this.max*1000));}}else{if(members&&members[0]!="All"){var mbr=members[0];this.selectedMbr=mbr;var date=new Date(mbr*1000);$("[id='"+this.minId+"']").datepicker("setDate",date);}else{$("[id='"+this.minId+"']").datepicker("setDate",null);}}};SlicerDatePicker.prototype.needToUpdate=function(){return this.hideEmpty&&!this.range;};SlicerDatePicker.prototype.updateSlicer=function(){this.updateMembersAvailable();};SlicerTree=function(id,dimSelPanel,dimId,dimName,continuous,dm,hierarchy,level,pageId,options){Slicer.call(this,id,dimSelPanel,dimId,dimName,continuous,dm,hierarchy,level,pageId,options);
this.viz="SlicerTree";this.childSubQueries=new Object();this.expandedPaths=[];this.expandedStates={};this.selectedMembers={};this.updateOnSelect=true;};SlicerTree.prototype=new Slicer();SlicerTree.prototype.needToUpdate=function(){return true;};SlicerTree.prototype.updateSlicer=function(){var slicer=this;var members=this.panel.getSelectedElements();var membersFormated=this.panel.getSelectedFormatedElements();var hId=this.panel.getSelectedHierarchyId();var lId=this.panel.getSelectedLevelId();this.updateOnSelect=false;$("[id='"+slicer.divContent.id+"']").jstree("deselect_all",true);if(members.length>0&&members[0]!="All"&&this.hierarchyId==hId){this.selectedMembers={};var lvl=-1;if(lId!=null){for(var iL=0;iL<this.dim.hierarchies[this.hierarchy].levels.length;iL++){var level=this.dim.hierarchies[this.hierarchy].levels[iL];if(level.id==lId){lvl=iL;break;}}}for(var i=0;i<members.length;i++){var member=members[i];var id=this.divSlicer.id+"_"+lvl+"_"+member;this.selectedMembers[id]=true;var node=$("[id='"+slicer.divContent.id+"']").jstree("get_node",id);
if(node){$("[id='"+slicer.divContent.id+"']").jstree("select_node",node);}}this.span.innerHTML=membersFormated[0];this.link.className="chzn-single";this.close.style.display="block";}else{this.span.innerHTML=this.dimName;this.link.className="chzn-single chzn-default";this.close.style.display="none";}this.updateOnSelect=true;if(this.hideEmpty){if(this.dmSel.filterByDimName[this.dimId]){var dim=this.dm.getDimensionById(this.dimId);this.dmSel.removeFilterByDimension(dim);}this.executeAll(true);this.drawTree();}else{for(var i=0;i<this.dmSel.dimsToFilter.length;i++){var filter=this.dmSel.dimsToFilter[i];this.dmSel.removeFilterByDimension(filter.dim);}}};SlicerTree.prototype.drawMembers=function(){if(this.divSlicer){this.divSlicer.className="slicerComboDiv";var i=0;var childs=this.divSlicer.childNodes;while(i<childs.length){this.divSlicer.removeChild(childs[i]);}this.divSlicer.style.overflow="visible";var slicer=this;this.nbLevels=this.level+1;this.treeIsVisible=false;var table=document.createElement("table");
setStyle(table,"width: 100%");var tbody=document.createElement("tbody");var tr=document.createElement("tr");tbody.appendChild(tr);table.appendChild(tbody);this.divSlicer.appendChild(table);if(!this.hideHeader){if(isIE6()||isIE7()){var td=document.createElement("td");var span=document.createElement("span");span.className="slicerComboTDDim";span.innerHTML=this.dimName;td.appendChild(span);tr.appendChild(td);}else{var td=document.createElement("td");td.className="slicerComboTDDim";td.innerHTML=this.dimName;tr.appendChild(td);}}else{table.style.width="100%";}var td=document.createElement("td");td.className="slicerComboDiv";setStyle(td,"overflow:visible; height:100%; width:100%");tr.appendChild(td);this.container=document.createElement("div");this.container.className="chzn-container chzn-container-single";setStyle(this.container,"width:100%; cursor:pointer");this.link=document.createElement("a");this.link.className="chzn-single chzn-default";this.span=document.createElement("span");this.span.innerHTML=this.dimName;
this.close=document.createElement("abbr");this.close.className="search-choice-close";this.close.style.display="none";this.link.appendChild(this.span);this.link.appendChild(this.close);this.image=document.createElement("div");var b=document.createElement("b");this.image.appendChild(b);this.link.appendChild(this.image);this.container.appendChild(this.link);td.appendChild(this.container);this.dropdown=document.createElement("div");this.dropdown.className="chzn-drop";setStyle(this.dropdown,"left:-9000px; overflow:auto");this.container.appendChild(this.dropdown);this.divContent=document.createElement("div");this.divContent.id=this.id.replace("slicer_","slicercontent_");this.divContent.className="divContent";this.dropdown.appendChild(this.divContent);this.container.onclick=function(e){e=e||window.event;if(e.stopPropagation){e.stopPropagation();}e.cancelBubble=true;};this.link.onclick=function(e){e=e||window.event;if(e.stopPropagation){e.stopPropagation();}e.cancelBubble=true;var maxHeight=getWindowSize().height-e.clientY;
slicer.divContent.style.maxHeight=maxHeight+"px";if(slicer.treeIsVisible){slicer.hideTree();}else{slicer.showTree();}};document.onclick=function(){if(slicer.treeIsVisible){slicer.hideTree();}};this.close.onclick=function(e){e=e||window.event;if(e.stopPropagation){e.stopPropagation();}e.cancelBubble=true;slicer.link.className="chzn-single chzn-default";slicer.span.innerHTML=slicer.dimName;this.style.display="none";$("[id='"+slicer.divContent.id+"']").jstree("deselect_all",true);slicer.panel.selectMembers(slicer.hierarchyId,slicer.levelId,["All"],getLocMessage("All"),slicer.isReverseFilter);};this.drawTree();}};SlicerTree.prototype.changeOverflow=function(sOverflow){if(ddCtrl.isNewDashboard){var portletElt=document.getElementById(this.frameId.replace("slicer_",""));portletElt.style.overflow=sOverflow;var portletContentId=this.frameId.replace("slicer_","content_");var portletContentElt=document.getElementById(portletContentId);portletContentElt.style.overflow=sOverflow;portletContentElt.parentElement.style.overflow=sOverflow;
var curElt=this.divSlicer.parentElement;while(curElt!=null&&curElt.id!=portletContentId){curElt.style.overflow=sOverflow;curElt=curElt.parentElement;}}else{var curElt=this.divSlicer.parentElement;while(curElt!=null&&curElt.className!="x-panel-bwrap"){curElt.style.overflow="visible";curElt=curElt.parentElement;}curElt.style.overflow="visible";}};SlicerTree.prototype.resize=function(){};SlicerTree.prototype.showTree=function(){this.treeIsVisible=true;var top=this.container.offsetHeight;var width=this.container.offsetWidth-2;addClass(this.container,"chzn-container-active");setStyle(this.dropdown,"width:"+width+"px; top:"+top+"px");addClass(this.link,"chzn-single-with-drop");this.changeOverflow("visible");};SlicerTree.prototype.hideTree=function(){this.treeIsVisible=false;this.dropdown.style.left="-9000px";removeClass(this.link,"chzn-single-with-drop");removeClass(this.container,"chzn-container-active");this.changeOverflow("hidden");};SlicerTree.prototype.drawTree=function(){var slicer=this;
if(this.rootElement){$(function(){$("[id='"+slicer.divContent.id+"']").jstree("destroy");});}this.rootElement=document.createElement("ul");this.divContent.appendChild(this.rootElement);this.drawLines(getDataFromDMSel(this.dmSel,this),[],this.rootElement);$(function(){$("[id='"+slicer.divContent.id+"']").on("loaded.jstree",function(e,data){for(id in slicer.selectedMembers){data.instance.select_node(id);}});$("[id='"+slicer.divContent.id+"']").jstree({core:{themes:{icons:false},multiple:false}});$("[id='"+slicer.divContent.id+"']").on("select_node.jstree",function(e,data){if(!slicer.updateOnSelect){return;}var mbrs=[];var mbrsF=[];var levelId=null;for(var i=0;i<data.selected.length;i++){var elt=document.getElementById(data.selected[i]);var member=elt.getAttribute("member");var memberFormated=elt.getAttribute("memberFormated");var parentPath=eval(elt.getAttribute("parentPath"));var level=slicer.level-parentPath.length;var curLevel=null;if(level>-1){curLevel=slicer.dim.hierarchies[slicer.hierarchy].levels[level].id;
}else{curLevel=null;}if(curLevel!=levelId){mbrs=[];mbrsF=[];slicer.selectedMembers={};levelId=curLevel;}mbrs.push(member);mbrsF.push(memberFormated);slicer.selectedMembers[elt.id]=true;}if(mbrsF.length>0){slicer.span.innerHTML=mbrsF[0];slicer.link.className="chzn-single";slicer.close.style.display="block";}else{slicer.span.innerHTML=slicer.dimName;slicer.link.className="chzn-single chzn-default";slicer.close.style.display="none";}slicer.hideTree();slicer.panel.selectMembers(slicer.hierarchyId,levelId,mbrs,mbrsF,slicer.isReverseFilter);});$("[id='"+slicer.divContent.id+"']").on("before_open.jstree",function(e,data){var elt=document.getElementById(data.node.id);var member=elt.getAttribute("member");var parentPath=eval(elt.getAttribute("parentPath"));slicer.scrollTop=slicer.divContent.scrollTop;slicer.expandMember(parentPath,member);slicer.executeAll(false);slicer.drawTree();});$("[id='"+slicer.divContent.id+"']").on("after_close.jstree",function(e,data){var elt=document.getElementById(data.node.id);
var member=elt.getAttribute("member");var parentPath=eval(elt.getAttribute("parentPath"));slicer.scrollTop=slicer.divContent.scrollTop;slicer.expandMember(parentPath,member);slicer.executeAll(false);slicer.drawTree();});});if(this.scrollTop){this.divContent.scrollTop=this.scrollTop;}};SlicerTree.prototype.drawLines=function(members,parentPath,parentElt){var slicer=this;for(var i=0;i<members.length;i++){var currentPath=null;var expandOrFold=false;var strExpandFold="";var mbrObj=members[i];var member=mbrObj.member;var memberFormated=mbrObj.memberFormated;currentPath=cloneArray(parentPath);currentPath.push(new ParentPathElement(member,memberFormated));var curLvl=this.level-parentPath.length;var li=document.createElement("li");li.id=this.divSlicer.id+"_"+curLvl+"_"+member;li.setAttribute("member",member);li.setAttribute("memberFormated",memberFormated);li.setAttribute("parentPath",JSON.stringify(parentPath));li.appendChild(document.createTextNode(memberFormated));parentElt.appendChild(li);var expandable=curLvl>-1;
if(expandable){expandOrFold=true;}if(expandable){var ul=document.createElement("ul");li.appendChild(ul);var cube=this.getSubCube(parentPath,member);if(cube&&cube.expanded){addClass(li,"jstree-open");var parentPath2=cloneArray(parentPath);parentPath2.push(new ParentPathElement(member,memberFormated));this.expandedPaths.push(parentPath2);this.drawLines(cube.members,parentPath2,ul);}else{addClass(li,"jstree-closed");ul.innerHTML="<li></li>";}}}};SlicerTree.prototype.clickExpandOrFold=function(li){this.expandMember(li.parentPath,li.member);this.executeAll(false);this.drawTree();};SlicerTree.prototype.expandMember=function(parentPath,member){var parentCube=null;var dmsel=this.dmSel;if(parentPath.length>0){var parentCube=this.getCurrentSubCube(parentPath);if(parentCube){dmsel=parentCube.dmsel;}}var expanded=this.createSubQuery(parentCube,dmsel,member);var parentPath2=cloneArray(parentPath);parentPath2.push(new ParentPathElement(member,null));this.expandedStates[parentPath2.toString()]=expanded;
};SlicerTree.prototype.createSubQuery=function(parentSQ,dmsel,member){var dimEx=dmsel.dimsToExplore[dmsel.axis[1][0]];var gPos;if(dimEx.hierarchy){var lvl=dimEx.hierarchy.levels[dimEx.lPos];gPos=lvl.getMemberPosById(member);}else{gPos=dimEx.dim.getMemberPosById(member);}var nuplet="";var subCube=null;if(parentSQ==null){subCube=this.childSubQueries[member];}else{subCube=parentSQ.childSubQueries[member];}if(subCube){subCube.expanded=!subCube.expanded;}if(!subCube||subCube.expanded){var filter=null;if(typeof(gPos)=="undefined"||gPos==-1){filter=new FilterSelection(dimEx.dim,dimEx.hPos,dimEx.lPos,[],[member]);}else{filter=new FilterSelection(dimEx.dim,dimEx.hPos,dimEx.lPos,[gPos]);}subCube=new SubQuery(parentSQ,filter,(parentSQ?parentSQ.lvl-1:this.level-1));if(parentSQ==null){this.childSubQueries[member]=subCube;}else{parentSQ.childSubQueries[member]=subCube;}return true;}else{if(subCube&&!subCube.expanded){if(parentSQ==null){this.childSubQueries[member]=null;}else{parentSQ.childSubQueries[member]=null;
}return false;}}};SlicerTree.prototype.getCurrentSubCube=function(currentPath){if(currentPath.length>0){var parentMember=currentPath[currentPath.length-1].member;var grandParentPath=currentPath.slice(0,currentPath.length-1);parentCube=this.getSubCube(grandParentPath,parentMember);return parentCube;}return null;};SlicerTree.prototype.getSubCube=function(parentPath,member){var curCube=this;for(var i=0;i<parentPath.length;++i){if(curCube.childSubQueries[parentPath[i].member]){curCube=curCube.childSubQueries[parentPath[i].member];}else{return null;}}if(curCube.childSubQueries[member]){return curCube.childSubQueries[member];}else{return null;}};SlicerTree.prototype.executeAll=function(bForceRecalc){for(var i in this.childSubQueries){if(i!="indexOf"){if(this.childSubQueries[i]&&this.childSubQueries[i].expanded){this.childSubQueries[i].execute(this.dmSel.dm,this.dmSel,bForceRecalc);}}}};ParentPathElement=function(sMember,sFormated){this.member=sMember;this.formated=sFormated;};ParentPathElement.prototype.toString=function(){return this.member;
};ParentPathElement.prototype.toJSON=function(){return{member:this.member,formated:this.formated};};function SubQuery(parentSQ,filter,lvl){this.expanded=true;this.filter=filter;this.members=null;this.lvl=lvl;this.parentSubQuery=parentSQ;this.childSubQueries=new Object();this.dmsel=null;}SubQuery.prototype.execute=function(dm,dmsel,bForceRecalc){if(bForceRecalc||this.members==null||this.dmsel==null){this.dmsel=dmsel.specificClone();var oldDimEx=dmsel.dimsToExplore[0];var dimEx=new DimExplorer(oldDimEx.dim,oldDimEx.hPos,this.lvl,true);this.dmsel.replaceDimExplorer(1,dimEx);if(!this.filter.dim.membersOnServer){var newfilter=this.filter;if(this.filter){var currentFilter=this.dmsel.getFilterByDimension(this.filter.dim);if(currentFilter){var mergedFilter=mergeFilters(this.filter,currentFilter);if(mergedFilter!=null){newfilter=mergedFilter;}}}this.dmsel.setFilter(newfilter);}else{var currentFilter=this.dmsel.getFilterByDimension(this.filter.dim);if(currentFilter){this.dmsel.setFilter(currentFilter,true);
}if(this.filter){this.dmsel.addFilter(this.filter);}}this.members=getDataFromDMSel(this.dmsel,this);bForceRecalc=true;}for(var i in this.childSubQueries){if(this.childSubQueries[i]&&this.childSubQueries[i].expanded){this.childSubQueries[i].execute(dm,this.dmsel,bForceRecalc);}}};function getDataFromDMSel(dmsel,obj){var cubRes=null;try{cubRes=dmsel.dm.getDataFromSelection(dmsel,obj);}catch(e){errObj=e;if(typeof(e)=="string"||typeof(e.message)=="string"){alert(e);}else{if(typeof(errObj.errorCode)!="undefined"){if((errObj.errorCode==401||errObj.errorCode==403)&&ddCtrl.checkSession){ddCtrl.checkSession();}else{if(typeof(errObj.errorMsg)!="undefined"){alert(errObj.errorMsg);}}}else{if(typeof(errObj.errorMsg)!="undefined"){alert(errObj.errorMsg);}}}}var sNullValue=undefined;if(cubRes!=null){var members=[];for(var i=0;i<cubRes.lines.length;i++){var idx=cubRes.lines[i][1];var id=cubRes.axis[1][idx].id;members.push(new Member(id,cubRes.axis[1][idx].formated));}return members;}else{return null;}}var CONCURRENT_FILTER_MODE=0;
DimSelPanel=function(parent,dimId,dimName,domId){this.parent=parent;this.id=dimId;this.name=dimName;this.continuous=false;this.domId=domId;this.dimsByPageId={};this.dimsList=[];this.dmList=[];this.hierarchiesList=[];this.filter=false;this.hiddenByPageId={};this.useSearchBox=true;this.updaterFunc=null;this.updateOnChange=true;this.hasHierarchy=false;this.rangeValues={};this.multiSelect=true;this.hideAll=false;this.hideEmpty=false;this.slicers={};if(typeof(getComboAttribute)=="function"){this.multiSelect=getComboAttribute(this.id,"multiselect",true);this.hideAll=getComboAttribute(this.id,"hideall",false);this.hideEmpty=getComboAttribute(this.id,"hideempty",false);}this.reverseFilter=false;this.panelUI=DimSelPanelUI.createDimSelPanelUI(this);};DimSelPanel.prototype.getComboMembers=function(){return this.panelUI.comboMembers;};DimSelPanel.prototype.show=function(){this.panelUI.show();};DimSelPanel.prototype.hide=function(){this.panelUI.hide();};DimSelPanel.prototype.setPos=function(x,y){this.panelUI.setPos(x,y);
};DimSelPanel.prototype.setCurPage=function(pageid){this.pageID=pageid;};DimSelPanel.prototype.dmExist=function(dm){for(var i=0;i<this.dmList;i++){if(dm.cubeId==this.dmList[i]){return true;}}return false;};DimSelPanel.prototype.isRegistered=function(pageId){return this.hiddenByPageId[pageId]!==undefined;};DimSelPanel.prototype.addDim=function(dm,dim,pageid,hidden,hideHierLevel,frameId){if(typeof(this.hiddenByPageId[pageid])=="undefined"||this.hiddenByPageId[pageid]){this.hiddenByPageId[pageid]=hidden;}this.continuous=dim.continuous;if(!this.dmExist(dm)){var dimList=this.dimsByPageId[pageid];if(dimList==null){dimList=[];this.dimsByPageId[pageid]=dimList;}dimList.push(dim);this.dimsList.push(dim);this.dmList.push(dm.cubeId);this.rangeValues.min=dim.min;this.rangeValues.max=dim.max;var newHierarchies=[];if(dim.hierarchies.length>0){this.hasHierarchy=true;var iH=0;while(iH<dim.hierarchies.length){if(!this.isHierarchyDefined(dim.hierarchies[iH])){this.hierarchiesList.push(dim.hierarchies[iH]);
newHierarchies.push(dim.hierarchies[iH]);}iH++;}}this.panelUI.addDim(dim,newHierarchies,hideHierLevel);if(this.hideEmpty){ddCtrl.addDimensionFilterListener(this);var slicerId=dm.cubeId+"_root";var slicer=this.slicers[slicerId];if(!slicer){slicer=new DimSelPanelSlicer(slicerId,this,this.id,this.continuous,dm,-1,-1,null);this.slicers[slicerId]=slicer;}}}};DimSelPanel.prototype.getHTMLElement=function(){return this.panelUI.getHTMLElement();};function isSameHierarchy(h1,h2){if(h1.id!=h2.id){return false;}else{if(h1.levels.length!=h2.levels.length){return false;}else{for(var i=0;i<h1.levels.length;i++){var l1=h1.levels[i];var l2=h2.levels[i];if(l1.id!=l2.id){return false;}}}}return true;}DimSelPanel.prototype.isHierarchyDefined=function(hierarchy){var i=0;while(i<this.hierarchiesList.length){if(isSameHierarchy(this.hierarchiesList[i],hierarchy)){return true;}++i;}return false;};DimSelPanel.prototype.addMember=function(h,l,member,memberFormated){if(h==null){h=-1;if(l==null){l=-1;}}else{if(typeof(h)=="string"){for(var iH=0;
iH<this.hierarchiesList.length;iH++){var hierarchy=this.hierarchiesList[iH];if(hierarchy.id==h){if(l==null){l=-1;}else{if(typeof(l)=="string"){for(var iL=0;iL<hierarchy.levels.length;iL++){if(hierarchy.levels[iL].id==l){h=iH;l=iL;break;}}}else{h=iH;}}}}}}var bAdd=true;var selElts=this.getSelectedElements();if(selElts&&h==this.getSelectedHierarchyIndex()&&l==this.getSelectedLevelIndex()){for(var i=0;i<selElts.length;i++){if(selElts[i]==member){bAdd=false;break;}}}this.setReverseFilter(false);if(bAdd){this.panelUI.addMember(h,l,member,memberFormated);}else{this.panelUI.removeFilterDMSels(member);}};DimSelPanel.prototype.addMembers=function(h,l,members,membersFormated,bReverse){if(h==null){h=-1;if(l==null){l=-1;}}else{if(typeof(h)=="string"){for(var iH=0;iH<this.hierarchiesList.length;iH++){var hierarchy=this.hierarchiesList[iH];if(hierarchy.id==h){if(l==null){l=-1;}else{if(typeof(l)=="string"){for(var iL=0;iL<hierarchy.levels.length;iL++){if(hierarchy.levels[iL].id==l){h=iH;l=iL;break;}}}else{h=iH;
}}}}}}this.setReverseFilter(bReverse);this.panelUI.addMembers(h,l,members,membersFormated);};DimSelPanel.prototype.setLevel=function(h,l){this.panelUI.setLevel(h,l);};DimSelPanel.prototype.updateLevels=function(){this.panelUI.updateLevels();};DimSelPanel.prototype.selectMembers=function(h,l,members,membersFormated,bForce,bReverse,bUpdate){var isReverse=false;if(typeof(bReverse)!="undefined"){isReverse=bReverse;}if(this.hideAll&&members.length==1&&members[0]=="All"){return;}if(h==null){h=-1;if(l==null){l=-1;}}else{if(typeof(h)=="string"){for(var iH=0;iH<this.hierarchiesList.length;iH++){var hierarchy=this.hierarchiesList[iH];if(hierarchy.id==h){if(l==null){l=-1;}else{if(typeof(l)=="string"){for(var iL=0;iL<hierarchy.levels.length;iL++){if(hierarchy.levels[iL].id==l){h=iH;l=iL;break;}}}else{h=iH;}}}}}}var selElts=this.getSelectedElements();var bSame=true;if(members.length==1&&members[0]=="All"&&selElts.length==1&&selElts[0]=="All"){bSame=true;}else{if(isReverse!=this.reverseFilter){bSame=false;
}else{if(h!=this.getSelectedHierarchyIndex()||l!=this.getSelectedLevelIndex()){bSame=false;}else{if(members.length!=selElts.length){bSame=false;}else{for(var i=0;i<members.length;i++){if(members[i]!=selElts[i]){bSame=false;break;}}}}}}if(!bSame||bForce){this.continuousFilter=false;this.setReverseFilter(bReverse);this.panelUI.selectMembers(h,l,members,membersFormated,bUpdate);}};DimSelPanel.prototype.selectMember=function(h,l,id,update,memberFormated){if(this.hideAll&&id=="All"){return;}if(h==null){h=-1;}else{if(typeof(h)=="string"){for(var iH=0;iH<this.hierarchiesList.length;iH++){var hierarchy=this.hierarchiesList[iH];if(hierarchy.id==h){if(l==null){l=-1;}else{if(typeof(l)=="string"){for(var iL=0;iL<hierarchy.levels.length;iL++){if(hierarchy.levels[iL].id==l){h=iH;l=iL;break;}}}else{h=iH;}}}}}}var selElts=this.getSelectedElements();var selH=this.getSelectedHierarchyIndex();var selL=this.getSelectedLevelIndex();var bSelIsRoot=(selH==-1||l==-1);var bIsRoot=(h==-1||l==-1);if(typeof(update)=="undefined"&&selElts.length==1&&selElts[0]==id&&((h==selH&&l==selL)||(bSelIsRoot&&bIsRoot))){return;
}if(typeof(update)=="undefined"){this.updateOnChange=true;}else{this.updateOnChange=update;}this.continuousFilter=false;this.panelUI.selectMember(h,l,id,true,memberFormated);};DimSelPanel.prototype.selectMemberAll=function(){if(!this.hideAll){var selElts=this.getSelectedElements();if(selElts.length==1&&selElts[0]=="All"){return;}this.continuousFilter=false;this.panelUI.selectMember(-1,-1,"All",true);}};DimSelPanel.prototype.setFilterRange=function(min,max){this.continuousFilter=true;this.min=min;this.max=max;var dim=this.dimsList[0];this.setRange(min,max,dim.format,false);this.updateDMSels();this.dimSelChangeHandler();if(this.updateOnChange&&this.updaterFunc!=null){this.updaterFunc.onChange();}};DimSelPanel.prototype.setFilterMinMax=function(min,max){var format=this.dimsList[0].format;this.setRange(min,max,format,true);};DimSelPanel.prototype.setRange=function(min,max,format,bUpdate){this.isRangeFilter=true;this.panelUI.setRange(min,max,format,bUpdate);};DimSelPanel.prototype.getMembersVal=function(){return members=this.panelUI.getMembersVal();
};DimSelPanel.prototype.getMembers=function(){return this.panelUI.getMembers();};DimSelPanel.prototype.getMembersFormated=function(){return this.panelUI.getMembersFormated();};DimSelPanel.prototype.getMin=function(){return this.panelUI.getMin();};DimSelPanel.prototype.getMinFormated=function(){var min=this.getMin();var minFormated=formatNum(min,this.dimsList[0].format);return minFormated;};DimSelPanel.prototype.getMax=function(){return this.panelUI.getMax();};DimSelPanel.prototype.getMaxFormated=function(){var max=this.getMax();var maxFormated=formatNum(max,this.dimsList[0].format);return maxFormated;};DimSelPanel.prototype.getSelectedHierarchyIndex=function(){return this.panelUI.getSelectedHierarchyIndex();};DimSelPanel.prototype.getSelectedHierarchy=function(){return this.panelUI.getSelectedHierarchy();};DimSelPanel.prototype.getSelectedHierarchyId=function(){return this.panelUI.getSelectedHierarchyId();};DimSelPanel.prototype.getSelectedHierarchyName=function(){return this.panelUI.getSelectedHierarchyName();
};DimSelPanel.prototype.getSelectedLevelIndex=function(){return this.panelUI.getSelectedLevelIndex();};DimSelPanel.prototype.getSelectedLevelId=function(){return this.panelUI.getSelectedLevelId();};DimSelPanel.prototype.getSelectedLevelName=function(){return this.panelUI.getSelectedLevelName();};DimSelPanel.prototype.getSelectedElements=function(){return this.panelUI.getSelectedElements();};DimSelPanel.prototype.getSelectedFormatedElements=function(){return this.panelUI.getSelectedFormatedElements();};DimSelPanel.prototype.getSelectedElementsAsString=function(){if(this.isRange){var minFormated=this.getMinFormated();var maxFormated=this.getMaxFormated();return minFormated+"_"+maxFormated;}else{var filterString="";var membersFormated=this.getSelectedFormatedElements();for(var i=0;i<membersFormated.length;i++){var memberFormated=membersFormated[i];if(filterString==""){filterString=memberFormated;}else{filterString+=","+memberFormated;}}return filterString;}return"";};DimSelPanel.prototype.removeFilterDMSels=function(member){if(!this.hideAll||this.getSelectedElements().length>1){if(this.getSelectedHierarchyId()!=null&&this.getSelectedHierarchyId()=="Range"){this.selectMemberAll();
}else{this.panelUI.removeFilterDMSels(member);}}};DimSelPanel.prototype.hasFilter=function(){var mbrIdx=this.panelUI.getSelectedMemberIndex();if(this.panelUI.trRemoveFilters||this.hideAll){if(mbrIdx==-1){return false;}return true;}else{if(mbrIdx==0||mbrIdx==-1){return false;}return true;}};DimSelPanel.prototype.updateDMSel=function(curDM,curDMSel){var dim=curDM.getDimensionById(this.id);if(dim==null){return false;}if(typeof(ddCtrl.isPageVisible)=="function"&&!ddCtrl.isPageVisible(curDMSel.pageId,curDMSel.frameId)){return false;}if(this.changePage&&!curDMSel.filterByDimName[this.id]&&!this.filter){return false;}if(curDMSel.dimensionsToExcludeForNavigation[this.id]){return false;}if(ddCtrl.urlParams){if(typeof(ddCtrl.urlParams[dim.id])!="undefined"){delete ddCtrl.urlParams[dim.id];}if(typeof(ddCtrl.urlParams[dim.name])!="undefined"){delete ddCtrl.urlParams[dim.name];}if(typeof(ddCtrl.urlParams["L"+dim.id])!="undefined"){delete ddCtrl.urlParams["L"+dim.id];}if(typeof(ddCtrl.urlParams["L"+dim.name])!="undefined"){delete ddCtrl.urlParams["L"+dim.name];
}if(typeof(ddCtrl.urlParams["H"+dim.id])!="undefined"){delete ddCtrl.urlParams["H"+dim.id];}if(typeof(ddCtrl.urlParams["H"+dim.name])!="undefined"){delete ddCtrl.urlParams["H"+dim.name];}if(typeof(ddCtrl.urlParams[dim.id+"_min"])!="undefined"){delete ddCtrl.urlParams[dim.id+"_min"];}if(typeof(ddCtrl.urlParams[dim.name+"_min"])!="undefined"){delete ddCtrl.urlParams[dim.name+"_min"];}if(typeof(ddCtrl.urlParams[dim.id+"_max"])!="undefined"){delete ddCtrl.urlParams[dim.id+"_max"];}if(typeof(ddCtrl.urlParams[dim.name+"_max"])!="undefined"){delete ddCtrl.urlParams[dim.name+"_max"];}}var bHasChanged=false;if(!this.hasFilter()&&!this.continuousFilter){if(curDMSel.filterByDimName[dim.id]){curDMSel.removeFilterByDimension(dim);bHasChanged=true;}else{bHasChanged=false;}this.panelUI.selectMember("All",false);this.isRangeFilter=false;}else{addFilterIndicator(this);if(this.continuousFilter){var filter=null;if(this.valueF!=null){filter=getFilterContinuous(curDMSel,dim,-1,-1,this.minF,this.maxF,this.valueF);
}else{filter=new FilterSelectionContinuous(dim,-1,-1,this.min,this.max,this.valueF);}curDMSel.setFilter(filter);}else{var h=-1;var l=-1;var hierarchyId=this.getSelectedHierarchyId();if(hierarchyId!=null){if(hierarchyId=="Range"){this.isRangeFilter=true;}else{if(hierarchyId=="MembersList"){h=-1;l=-1;}else{this.isRangeFilter=false;h=this.getHierarchyPos(dim,hierarchyId);if(h!=-1){var hier=dim.hierarchies[h];l=this.getLevelPos(dim,hier.id,this.getSelectedLevelId());}else{if(l!=-1){return false;}}}}}if(this.isRangeFilter){var min=this.getMin();var max=this.getMax();if(min!=this.rangeValues.min||max!=(this.rangeValues.max+(24*3600))){filter=new FilterSelectionContinuous(dim,-1,-1,min,max);}else{curDMSel.removeFilterByDimension(dim);removeFilterIndicator(this);return true;}}else{var selIdx=this.getMemberPos(dim,h,l,this.getSelectedElements());var filter;if(dim.continuous&&(h>=0)&&(l>=0)&&!dim.hierarchies[h].levels[l].groupformula){filter=new FilterSelectionMultiContinuous(dim,h,l,selIdx,this.getSelectedElements());
}else{filter=new FilterSelection(dim,h,l,selIdx,this.getSelectedElements());}}if(this.reverseFilter){filter.mode=REVERSE_MODE;}var curFilter=curDMSel.filterByDimName[this.id];if(!curFilter||!curFilter.equals(filter)){curDMSel.setFilter(filter);bHasChanged=true;}}}return bHasChanged;};DimSelPanel.prototype.updateDMSels=function(dmSelToIgnore){if(typeof(dmList)=="undefined"||typeof(dmSelList)=="undefined"){return;}this.removeZoom();this.filter=!(!this.hasFilter()&&!this.continuousFilter);var filterHasChanged=false;var dmIt=0;while(dmIt<dmList.length){var curDM=dmList[dmIt];var curDMSel=dmSelList[dmIt];if(typeof(dmSelToIgnore)=="undefined"||(typeof(dmSelToIgnore)!="undefined"&&dmSelToIgnore!=curDMSel)){var bHasChanged=this.updateDMSel(curDM,curDMSel);if(bHasChanged){filterHasChanged=true;}}dmIt++;}return filterHasChanged;};DimSelPanel.prototype.getHierarchyPos=function(dim,hierarchyId){var srcH=null;for(var i=0;i<this.hierarchiesList.length;i++){if(this.hierarchiesList[i].id==hierarchyId){srcH=this.hierarchiesList[i];
break;}}if(srcH!=null){for(var i=0;i<dim.hierarchies.length;i++){var hierarchy=dim.hierarchies[i];if(hierarchy!=null){if(this.equalHierarchies(srcH,hierarchy)){return i;}}}}return -1;};DimSelPanel.prototype.equalHierarchies=function(h1,h2){if(h1==h2){return true;}else{if(h1!=h2&&(h1==null||h2==null)){return false;}else{var h1Continuous=h1.levels&&h1.levels.length>0&&typeof h1.levels[0].fMin!="undefined"&&typeof h1.levels[0].fMax!="undefined";var h2Continuous=h2.levels&&h2.levels.length>0&&typeof h2.levels[0].fMin!="undefined"&&typeof h2.levels[0].fMax!="undefined";if(h1Continuous&&h2Continuous){if(h1.levels.length==h2.levels.length){for(var l=0;l<h1.levels.length;l++){if(h1.levels[l].fMin!=h2.levels[l].fMin||h1.levels[l].fMax!=h2.levels[l].fMax||h1.levels[l].groupformula!=h2.levels[l].groupformula){return false;}}return true;}}else{if(!h1Continuous&&!h2Continuous){return h1.id==h2.id;}}}}return false;};DimSelPanel.prototype.getLevelPos=function(dim,hierarchyId,levelId){for(var iH=0;iH<dim.hierarchies.length;
iH++){var hierarchy=dim.hierarchies[iH];if(hierarchy.id==hierarchyId){for(var iL=0;iL<hierarchy.levels.length;iL++){var level=hierarchy.levels[iL];if(level.id==levelId){return iL;}}}}return -1;};DimSelPanel.prototype.getMemberPos=function(dim,h,l,memberId){var arrayPos=[];if((h==-1)||(l==-1)){if(!dim.indexedMembers){dim.indexedMembers=[];for(var im=0;im<dim.members.length;++im){dim.indexedMembers[dim.members[im]]=im;}}if(dim.continuous){for(var im=0;im<memberId.length;++im){var mbr=memberId[im];if(memberId[im]!=null){mbr=parseInt(mbr);}var mbrPos=dim.indexedMembers[mbr];if(typeof(mbrPos)!="undefined"){arrayPos.push(mbrPos);}}}else{for(var im=0;im<memberId.length;++im){var mbrPos=dim.indexedMembers[memberId[im]];if(typeof(mbrPos)!="undefined"){arrayPos.push(mbrPos);}}}}else{var hierarchy=dim.hierarchies[h];if(hierarchy&&hierarchy.id){var level=hierarchy.levels[l];level.prepare(dim);var i=0;while(i<memberId.length){var val=level.getMemberPosById(memberId[i]);if(typeof(val)!="undefined"){arrayPos.push(val);
}++i;}}else{if(dim.continuous){var rootMembersPos=[];hierarchy=this.hierarchiesList[h];var level=hierarchy.levels[l];level.prepare(dim);var iMbr=0;while(iMbr<dim.members.length){var t=dim.members[iMbr];var grp=level.evalGroupFormula(t);for(var i=0;i<memberId.length;i++){var grpPos=level.getMemberPosById(memberId[i]);var group=level.groups[grpPos];if(group&&group.name==grp){rootMembersPos.push(iMbr);break;}}iMbr++;}return rootMembersPos;}else{var rootMembersPos=[];var rootMembersPosTest={};hierarchy=this.hierarchiesList[h];var level=hierarchy.levels[l];level.prepare(dim);var i=0;while(i<memberId.length){var pos=level.getMemberPosById(memberId[i]);var group=level.groups[pos];var grpMembers=group.members;var iMbr=0;while(iMbr<grpMembers.length){if(!rootMembersPosTest[grpMembers[iMbr]]){rootMembersPosTest[grpMembers[iMbr]]=true;rootMembersPos.push(grpMembers[iMbr]);}iMbr++;}++i;}return rootMembersPos;}}}return arrayPos;};DimSelPanel.prototype.updateMembersWithHL=function(dimEx,iH,iL,memberId,bForceShowId){this.panelUI.updateMembersWithHL(dimEx,iH,iL,memberId,bForceShowId);
};function ArraySortAscending(a,b){return(a-b);}DimSelPanel.prototype.removeComboMembersChangeListeners=function(){this.panelUI.removeComboMembersChangeListeners();};DimSelPanel.prototype.onChange=function(srcObjId){this.continuousFilter=false;if(!this.hasFilter()){removeFilterIndicator(this);}this.updateDMSels();this.dimSelChangeHandler();if(this.updateOnChange&&this.updaterFunc!=null){this.updaterFunc.onChange();}};DimSelPanel.prototype.initCombo=function(dimEx){var bMbrsSelected=this.panelUI.initCombo(dimEx,this.filter);if(bMbrsSelected){this.updateDMSels();}return bMbrsSelected;};DimSelPanel.prototype.initPanel=function(filter,dmSel){var filterHierId=null;var filterLvlId=null;if(filter.hierarchy>-1&&filter.hierarchy<filter.dim.hierarchies.length){filterHierId=filter.dim.hierarchies[filter.hierarchy].id;if(filter.level>-1){filterLvlId=filter.dim.hierarchies[filter.hierarchy].levels[filter.level].id;}}var filterIsReverse=(filter.mode==REVERSE_MODE);var curHierId=this.getSelectedHierarchyId();
var curLvlId=this.getSelectedLevelId();if(curLvlId=="root"){curLvlId=null;}var curMbrs=[];var oldMbrsSelected=this.getSelectedElements();for(i=0;i<oldMbrsSelected.length;i++){if(oldMbrsSelected[i]!="All"){curMbrs.push(oldMbrsSelected[i]);}}var mergeMode=CONCURRENT_FILTER_MODE;if(mergeMode==0){if(curHierId!=filterHierId||curLvlId!=filterLvlId||filterIsReverse!=this.reverseFilter){mergeMode=1;}}var isReverseFilter=filter.mode==REVERSE_MODE;if(typeof(filter.min)!="undefined"&&typeof(filter.max)!="undefined"){this.setReverseFilter(isReverseFilter);this.setRange(filter.min,filter.max,filter.dim.format,false);this.updateDMSels();}else{if(filter.grps){if(mergeMode==0){var selMbrs=curMbrs;for(var i=0;i<filter.grps.length;i++){if(filter.hierarchy>-1&&filter.level>-1){var member=filter.dim.hierarchies[filter.hierarchy].levels[filter.level].groups[filter.grps[i]].name;selMbrs.push(member);}else{var member=filter.dim.members[filter.grps[i]];selMbrs.push(member);}}this.selectMembers(curHierId,curLvlId,selMbrs,null,false,isReverseFilter,false);
this.updateDMSels();}else{if(mergeMode==1){var selMbrs=[];for(var i=0;i<filter.grps.length;i++){if(filter.hierarchy>-1&&filter.level>-1){var member=filter.dim.hierarchies[filter.hierarchy].levels[filter.level].groups[filter.grps[i]].name;selMbrs.push(member);}else{var member=filter.dim.members[filter.grps[i]];selMbrs.push(member);}}this.selectMembers(filterHierId,filterLvlId,selMbrs,null,false,filterIsReverse,false);this.updateDMSels();}else{if(mergeMode==2){this.updateDMSels(dmSel);}}}}else{if((!filter.selectedMembers||filter.selectedMembers.length==0)&&!filter.origIds||filter.origIds.length==0){filter.selectedMembers.push(ddCtrl.getLocMessage("NoneMember"));}if(filter.selectedMembers&&filter.selectedMembers.length>0){if(mergeMode==0){var selMbrs=curMbrs;for(i=0;i<filter.selectedMembers.length;i++){if(filter.selectedMembers[i]!="All"){selMbrs.push(filter.selectedMembers[i]);}}this.selectMembers(curHierId,curLvlId,selMbrs,null,false,isReverseFilter,false);this.updateDMSels();}else{if(mergeMode==1){this.selectMembers(filterHierId,filterLvlId,filter.selectedMembers,null,false,filterIsReverse,false);
this.updateDMSels();}else{if(mergeMode==2){this.updateDMSels(dmSel);}}}}else{if(filter.origIds&&filter.origIds.length>0){if(mergeMode==0){var selMbrs=curMbrs;for(var i=0;i<filter.origIds.length;i++){if(filter.hierarchy>-1&&filter.level>-1){var member=filter.dim.hierarchies[filter.hierarchy].levels[filter.level].groups[filter.origIds[i]].name;selMbrs.push(member);}else{var memberName=filter.dim.members[ids[i]];selMbrs.push(member);}}this.selectMembers(curHierId,curLvlId,selMbrs,null,false,isReverseFilter,false);this.updateDMSels();}else{if(mergeMode==1){var selMbrs=[];for(var i=0;i<filter.origIds.length;i++){if(filter.hierarchy>-1&&filter.level>-1){var member=filter.dim.hierarchies[filter.hierarchy].levels[filter.level].groups[filter.origIds[i]].name;selMbrs.push(member);}else{var memberName=filter.dim.members[ids[i]];selMbrs.push(member);}}this.selectMembers(filterHierId,filterLvlId,selMbrs,null,false,filterIsReverse,false);this.updateDMSels();}else{if(mergeMode==2){this.updateDMSels(dmSel);
}}}}}}}};DimSelPanel.prototype.setReverseFilter=function(isReverseFilter){this.reverseFilter=isReverseFilter;this.panelUI.setReverseFilter(isReverseFilter);};DimSelPanel.prototype.doReverseFilter=function(isReverseFilter){this.reverseFilter=isReverseFilter;this.panelUI.setReverseFilter(isReverseFilter);if(this.filter){this.updateDMSels();this.dimSelChangeHandler();if(this.updateOnChange&&this.updaterFunc!=null){this.updaterFunc.onChange();}}};DimSelPanel.prototype.addChangeListener=function(obj){if(this.changeListener==null){this.changeListener=[];}this.changeListener.push(obj);};DimSelPanel.prototype.dimSelChangeHandler=function(){if(this.changeListener!=null){var i=0;while(i<this.changeListener.length){if(this.changeListener[i]){try{this.changeListener[i].onChange(this);}catch(e){}}++i;}}if(ddCtrl.fireDimensionFilterEvent){var hierarchy=this.getSelectedHierarchyId();var level=this.getSelectedLevelId();ddCtrl.fireDimensionFilterEvent(this.id,hierarchy,level,this.getSelectedElements(),this.getSelectedFormatedElements(),this.reverseFilter);
}};DimSelPanel.prototype.drawResult=function(membersAvailable){var searchCombo=this.panelUI.comboMembers.searchCombo;var i=0;var nodes=searchCombo.elem.childNodes;while(i<nodes.length){searchCombo.elem.removeChild(nodes[i]);}var ul=document.createElement("ul");ul.className="sbox";var test=false;if(searchCombo.result&&(searchCombo.result.length>0)){var displayRes={};var iRes=0;var pos=0;var nr=0;var numOther=0;var hasResult=false;while(iRes<searchCombo.result.length){var resSet=searchCombo.result[iRes];var lRes=0;var displayResLength=0;while(lRes<resSet.length){var obj=resSet[lRes];var txt=obj.txt;var id=obj.id;if(!displayRes[id]){if(this.hideEmpty){if(membersAvailable[id]){var li=document.createElement("li");li.refObj=searchCombo;li.pos=pos;li.obj=obj;li.innerHTML=txt;if(!isTouchDevice()){li.onmouseover=function(){SBitPos(this);};li.onclick=function(){SBselect(this);};}else{li.ontouchend=function(){SBselect(this);};}ul.appendChild(li);displayRes[id]=true;displayResLength++;hasResult=true;
++nr;}}else{var li=document.createElement("li");li.refObj=searchCombo;li.pos=pos;li.obj=obj;li.innerHTML=txt;if(!isTouchDevice()){li.onmouseover=function(){SBitPos(this);};li.onclick=function(){SBselect(this);};}else{li.ontouchend=function(){SBselect(this);};}ul.appendChild(li);displayRes[txt]=true;displayResLength++;hasResult=true;++nr;}}++pos;++lRes;if(nr==searchCombo.maxDisp){break;}}if(lRes<displayResLength){numOther+=resSet.length-lRes;}if(nr==searchCombo.maxDisp){break;}++iRes;}while(iRes<searchCombo.result.length){numOther+=searchCombo.result[iRes].length;++iRes;}searchCombo.elem.appendChild(ul);if(hasResult){searchCombo.elem.appendChild(ul);if(numOther>0){var div=document.createElement("div");div.className="elOther";div.innerHTML=searchCombo.extraothers+numOther+Properties[searchCombo.lcl]["Others"];searchCombo.elem.appendChild(div);}}else{var li=document.createElement("li");li.innerHTML=Properties[searchCombo.lcl]["NoResult"];ul.appendChild(li);searchCombo.elem.appendChild(ul);
}}else{var li=document.createElement("li");li.innerHTML=Properties[searchCombo.lcl]["NoResult"];ul.appendChild(li);searchCombo.elem.appendChild(ul);}};DimSelPanel.prototype.onDimensionFilter=function(dimId,hierarchyId,levelId,members,membersFormated){if(this.id!=dimId){var slicerToRefresh=[];for(var slicerId in this.slicers){var slicer=this.slicers[slicerId];var dm=slicer.dm;if(dm.getDimensionById(dimId)!=null&&slicer.isSameHierarchyLevel()){slicerToRefresh.push(slicer);}}this.nbSlicersToRefresh=slicerToRefresh.length;for(var i=0;i<slicerToRefresh.length;i++){var slicer=slicerToRefresh[i];slicer.updateMembersAvailable(true);}}};DimSelPanel.prototype.fillMembersAvailable=function(hierarchyId,levelId){var dimPanel=this;this.membersActivate=[];this.mapMembersActivate={};this.nbSlicersToRefresh=0;var slicerToRefresh=[];for(var i=0;i<this.dmList.length;i++){var dmId=this.dmList[i];var slicerId=dmId;if(hierarchyId&&levelId){slicerId+="_"+hierarchyId+"_"+levelId;}else{hierarchyId="";levelId="";
slicerId+="_root";}var slicer=this.slicers[slicerId];if(!slicer){this.nbXHR++;var dm=this.mapCube[dmId];slicer=new DimSelPanelSlicer(slicerId,this,this.id,this.continuous,dm,hierarchyId,levelId,null);this.slicers[slicerId]=slicer;}slicerToRefresh.push(slicer);}this.nbSlicersToRefresh=slicerToRefresh.length;for(var i=0;i<slicerToRefresh.length;i++){var slicer=slicerToRefresh[i];slicer.updateMembersAvailable(true);}};DimSelPanel.prototype.doFillMembersAvailable=function(){this.membersActivate=[];this.mapMembersActivate={};for(var slicerId in this.slicers){var slicer=this.slicers[slicerId];if(slicer.isSameHierarchyLevel()){for(var i=0;i<slicer.membersActivate.length;i++){var mbr=slicer.membersActivate[i];if(!this.mapMembersActivate[mbr]){var caption=slicer.mapMembersCaption[mbr];var mbrObj={};mbrObj.member=mbr;mbrObj.caption=caption;this.membersActivate.push(mbrObj);this.mapMembersActivate[mbr];}}}}this.panelUI.updateMembers(true);delete this.membersActivate;delete this.mapMembersActivate;
};DimSelPanel.prototype.getAllMembersAvailableOld=function(hierarchyId,levelId,objType){var members=new Object();for(var i=0;i<this.dmList.length;i++){var mbrs=this.getMembersAvailableOld(this.dmList[i],hierarchyId,levelId,"map");for(var mbr in mbrs){if(members[mbr]===undefined){members[mbr]=mbrs[mbr];}}}return members;};DimSelPanel.prototype.getMembersAvailableOld=function(dmId,hierarchyId,levelId,objType){if(!this.hideEmpty){return null;}var slicerId=dmId;if(hierarchyId&&levelId){slicerId+="_"+hierarchyId+"_"+levelId;}else{hierarchyId="";levelId="";slicerId+="_root";}var slicer=this.slicers[slicerId];if(!slicer){var dm=this.mapCube[dmId];slicer=new DimSelPanelSlicer(slicerId,this,this.id,this.continuous,dm,hierarchyId,levelId,null);this.slicers[slicerId]=slicer;slicer.updateMembersAvailable(false);}if(objType=="list"){return slicer.membersActivate;}else{return slicer.mapMembersActivate;}};DimSelPanelSlicer=function(id,dimSelPanel,dimId,continuous,dm,hierarchy,level,pageId){Slicer.call(this,id,dimSelPanel,dimId,dimId,continuous,dm,hierarchy,level,pageId);
this.hideEmpty=true;this.getMembers();this.membersActivate=this.members;for(var i=0;i<this.membersActivate.length;i++){var member=this.membersActivate[i];var memberFormated=this.getMemberFormated(member);this.mapMembersActivate[member]=memberFormated;}};DimSelPanelSlicer.prototype=new Slicer();DimSelPanelSlicer.prototype.createDMSel=function(){if(typeof(DataModelSelection)!="undefined"&&typeof(this.dm)!="undefined"){this.dmSel=new DataModelSelection();this.dmSel.attachedDM(this.dm);this.dmSel.pageId=this.pageId;this.dmSel.frameId=this.frameId;this.dmSel.pivot=0;var hPos=this.hierarchy;var lPos=this.level;if(this.hierarchy==null){hPos=-1;lPos=-1;}else{if(typeof(this.hierarchy)=="string"){for(var iH=0;iH<this.dim.hierarchies.length;iH++){var hierarchy=this.dim.hierarchies[iH];if(hierarchy.id==this.hierarchy){hPos=iH;if(this.level=="root"||this.level==null){lPos=-1;}else{for(var iL=0;iL<hierarchy.levels.length;iL++){if(hierarchy.levels[iL].id==this.level){lPos=iL;break;}}}break;}}}}this.dmSel.addBrowse(1,this.dim,hPos,lPos);
if(!this.dim.order){if(this.dim.sort){var axisSort=new AxisSort(1,this.dim.sortType,this.dim.sortReverse,-1,null,this.dim.sortOnCaption);this.dmSel.addAxisSort(axisSort);}else{var axisSort=new AxisSort(1,S_ALPHA,false,-1,null,false);this.dmSel.addAxisSort(axisSort);}}for(var i=0;i<this.dm.dimensions.length;i++){var dim=this.dm.dimensions[i];var panel=dimPanelList[dim.id+dim.continuous];if(panel){panel.updateDMSel(this.dm,this.dmSel);}}ddCtrl.svgdocList.push(this);ddCtrl.dmList.push(this.dm);ddCtrl.dmSelList.push(this.dmSel);ddCtrl.chartList.push(this);}};DimSelPanelSlicer.prototype.refreshDM=function(){};DimSelPanelSlicer.prototype.updateMembersAvailable=function(bAsync){var bParseInt=false;if(this.dim.continuous){if(this.hierarchy!=-1&&this.level!=-1){var level=this.dim.hierarchies[this.hierarchy].levels[this.level];if(level.groupformula){bParseInt=true;}}else{bParseInt=true;}}var filter=this.dmSel.getFilterByDimension(this.dim);if(filter&&((filter.level==-1&&this.level==-1)||(filter.hierarchy==this.hierarchy&&filter.level==this.level))){this.dmSel.removeFilterByDimension(this.dim);
}var prevSel=this.lastSel;var dimPanelSlicer=this;if(bAsync){this.dm.getDataFromSelectionAsync(this.dmSel,this,function(values,errObj){if(errObj){if(typeof(errObj)=="string"||typeof(errObj.message)=="string"){alert(errObj);}else{if(typeof(errObj.errorCode)!="undefined"){if((errObj.errorCode==401||errObj.errorCode==403)&&ddCtrl.checkSession){ddCtrl.checkSession();}else{if(typeof(errObj.errorMsg)!="undefined"){alert(errObj.errorMsg);}}}else{if(typeof(errObj.errorMsg)!="undefined"){alert(errObj.errorMsg);}}}}else{if(values!=null){dimPanelSlicer.membersActivate=[];dimPanelSlicer.mapMembersActivate={};dimPanelSlicer.mapMembersCaption={};for(var i=0;i<values.lines.length;i++){var idx=values.lines[i][1];var id=values.axis[1][idx].id;var name=values.axis[1][idx].id;if(values.axis[1][idx].formated){name=values.axis[1][idx].formated;}if(bParseInt){id=id|0;}dimPanelSlicer.membersActivate.push(id);dimPanelSlicer.mapMembersActivate[id]=name;dimPanelSlicer.mapMembersCaption[id]=name;}}dimPanelSlicer.panel.nbSlicersToRefresh--;
if(dimPanelSlicer.panel.nbSlicersToRefresh==0){dimPanelSlicer.panel.doFillMembersAvailable();}}});}else{var cubRes=null;try{cubRes=this.dm.getDataFromSelection(this.dmSel,this);}catch(e){errObj=e;if(typeof(e)=="string"||typeof(e.message)=="string"){alert(e);}else{if(typeof(errObj.errorCode)!="undefined"){if((errObj.errorCode==401||errObj.errorCode==403)&&ddCtrl.checkSession){ddCtrl.checkSession();}else{if(typeof(errObj.errorMsg)!="undefined"){alert(errObj.errorMsg);}}}else{if(typeof(errObj.errorMsg)!="undefined"){alert(errObj.errorMsg);}}}}if(cubRes!=null){this.membersActivate=[];this.mapMembersActivate={};this.mapMembersCaption={};for(var i=0;i<cubRes.lines.length;i++){var idx=cubRes.lines[i][1];var id=cubRes.axis[1][idx].id;var name=cubRes.axis[1][idx].id;if(cubRes.axis[1][idx].formated){name=cubRes.axis[1][idx].formated;}if(bParseInt){id=id|0;}this.membersActivate.push(id);this.mapMembersActivate[id]=name;this.mapMembersCaption[id]=name;}}return true;}};DimSelPanel.prototype.removeZoom=function(chart){if(ddCtrl&&ddCtrl.infoZoom){for(var key in ddCtrl.infoZoom){ddCtrl.infoZoom[key]=null;
}}};imgFolder="icons/";var SPACE_UNDER_COMBO=8;var PANEL_OFFSET=-2;DimSelPanelUI=function(panel){this.panel=panel;this.hierarchiesList=new Array();this.comboHierarchy=null;this.comboLevel=null;this.comboMembers=null;this.HTMLElement=null;this.isDate=false;};DimSelPanelUI.createDimSelPanelUI=function(panel){return new PopDownDimSelPanelUI(panel);};DimSelPanelUI.prototype.onChange=function(srcObjId){if(this.comboMembers.isLoading()){this.comboMembers.displayMore();}else{if(srcObjId[0]=="H"||srcObjId.substr(0,1)=="H"){this.updateLevels();this.updateMembers();}else{if(srcObjId[0]=="L"||srcObjId.substr(0,1)=="L"){this.updateMembers();}}if(this.trRemoveFilters){var selIdx=this.getSelectedMemberIndex();if(selIdx==-1){this.removeFiltersElt.className="selHierTitleSpan";}else{this.removeFiltersElt.className="selHierTitleSpanWhite";}}this.panel.onChange(this);}};DimSelPanelUI.prototype.initCombo=function(dimEx,hasFilter){if(!this.comboMembers){return false;}var hierarchy=null;var level=null;var members=null;
var membersFormated=null;if(hasFilter){if(this.comboHierarchy){hierarchy=this.getSelectedHierarchyId();level=this.getSelectedLevelId();}members=this.getSelectedElements();membersFormated=this.getSelectedFormatedElements();}if(hierarchy!=null&&hierarchy=="Range"){return true;}this.updateLevels();this.updateMembers();var bMbrsSelected=false;if(members!=null){bMbrsSelected=true;if(hierarchy!=null){this.comboHierarchy.selectMember(hierarchy,false);this.updateLevels();}if(level!=null){this.comboLevel.selectMember(level,false);this.updateMembers();}this.comboMembers.selectMembers(members,false,membersFormated);}else{if(this.panel.hideAll&&!this.panel.multiSelect){bMbrsSelected=true;}else{if(dimEx!=null&&dimEx.hierarchy){var i=0;while(i<this.hierarchiesList.length){if(isSameHierarchy(this.hierarchiesList[i],dimEx.hierarchy)){this.setLevel(i,-1);}++i;}}}}return bMbrsSelected;};DimSelPanelUI.prototype.initPanel=function(filter){var updateMember=false;if(this.comboHierarchy&&filter.hierarchy!=-1){if(this.comboHierarchy.getSelectedIndex()!=filter.hierarchy){this.comboHierarchy.setSelectedIndex(filter.hierarchy);
this.updateLevels();updateMember=true;}}if(this.comboLevel&&filter.level!=-1){if(this.comboLevel.getSelectedIndex()!=filter.level+1){this.comboLevel.setSelectedIndex(filter.level+1);updateMember=true;}}return updateMember;};DimSelPanelUI.prototype.addElement=function(value,formatedValue,selected){if(!this.comboMembers){return;}this.comboMembers.addElement(value,formatedValue,selected);};DimSelPanelUI.prototype.addMember=function(h,l,member,memberFormated){this.setLevel(h,l);this.comboMembers.addMember(member,memberFormated,true);};DimSelPanelUI.prototype.addMembers=function(h,l,members,membersFormated){this.setLevel(h,l);this.comboMembers.addMembers(members,membersFormated,true);};DimSelPanelUI.prototype.selectMember=function(h,l,id,dispatch,memberFormated){if(arguments.length>=4){this.setLevel(h,l);}else{id=arguments[0];dispatch=arguments[1];}if(id=="All"&&(this.trRemoveFilters||this.panel.hideAll)){this.comboMembers.unselectAllElements(dispatch);}else{this.comboMembers.selectMember(id,dispatch,memberFormated);
}};DimSelPanelUI.prototype.selectMembers=function(h,l,arrId,membersFormated,update){var bUpdate=true;if(typeof(update)!="undefined"){bUpdate=update;}this.setLevel(h,l);if(arrId.length==1&&arrId[0]=="All"&&(this.trRemoveFilters||this.panel.hideAll)){this.comboMembers.unselectAllElements(true);}else{this.comboMembers.selectMembers(arrId,bUpdate,membersFormated);}};DimSelPanelUI.prototype.getSelectedHierarchy=function(){if(this.comboHierarchy!=null&&this.comboHierarchy.getSelectedElements()!=null&&this.comboHierarchy.getSelectedElements().length>0){var hIndex=this.comboHierarchy.HTMLElement.selectedIndex;var hierarchy=this.hierarchiesList[hIndex];return hierarchy;}return null;};DimSelPanelUI.prototype.getSelectedHierarchyIndex=function(){if(!this.comboHierarchy){return -1;}return this.comboHierarchy.getSelectedIndex();};DimSelPanelUI.prototype.setSelectedHierarchyIndex=function(h){if(this.comboHierarchy){return this.comboHierarchy.setSelectedIndex(h,false);}};DimSelPanelUI.prototype.getSelectedHierarchyId=function(){if(this.comboHierarchy!=null){var hierarchy=this.getSelectedHierarchy();
if(hierarchy){return hierarchy.id;}else{if(this.comboHierarchy.getSelectedElements()!=null&&this.comboHierarchy.getSelectedElements().length>0){return this.comboHierarchy.getSelectedElements()[0];}}}return null;};DimSelPanelUI.prototype.getSelectedHierarchyName=function(){if(this.comboHierarchy!=null){var hierarchy=this.getSelectedHierarchy();if(hierarchy){return hierarchy.name;}else{if(this.comboHierarchy.getSelectedFormatedElements()!=null&&this.comboHierarchy.getSelectedFormatedElements().length>0){return this.comboHierarchy.getSelectedFormatedElements()[0];}}}return null;};DimSelPanelUI.prototype.getSelectedLevelIndex=function(){if(!this.comboLevel||this.getSelectedHierarchyId()=="Range"){return -1;}if(this.panel.hideRoot){return this.comboLevel.getSelectedIndex();}else{return this.comboLevel.getSelectedIndex()-1;}};DimSelPanelUI.prototype.setSelectedLevelIndex=function(l){if(!this.comboLevel){return;}if(l==-1&&this.panel.hideRoot){l=0;}if(this.panel.hideRoot){this.comboLevel.setSelectedIndex(l,false);
}else{this.comboLevel.setSelectedIndex(l+1,false);}};DimSelPanelUI.prototype.getSelectedLevelId=function(){if(this.comboLevel&&this.comboLevel.getSelectedElements().length>0){return this.comboLevel.getSelectedElements()[0];}return null;};DimSelPanelUI.prototype.getSelectedLevelName=function(){if(this.comboLevel&&this.comboLevel.getSelectedFormatedElements().length>0){return this.comboLevel.getSelectedFormatedElements()[0];}return null;};DimSelPanelUI.prototype.getSelectedElements=function(){var selEts=this.comboMembers.getSelectedElements();if(selEts.length==0){selEts.push("All");}return selEts;};DimSelPanelUI.prototype.getSelectedFormatedElements=function(){var selEts=this.comboMembers.getSelectedFormatedElements();if(selEts.length==0){selEts.push("All");}return selEts;};DimSelPanelUI.prototype.getSelectedMemberIndex=function(){return this.comboMembers.getSelectedIndex();};DimSelPanelUI.prototype.setSelectedMemberIndexes=function(ids){if(this.trRemoveFilters){this.removeFiltersElt.className="selHierTitleSpanWhite";
}this.comboMembers.setSelectedIndexes(ids,1);};DimSelPanelUI.prototype.getMembers=function(){return this.comboMembers.members;};DimSelPanelUI.prototype.getMembersVal=function(){return this.comboMembers.membersVal;};DimSelPanelUI.prototype.getMembersFormated=function(){return this.comboMembers.membersDisplay;};DimSelPanelUI.prototype.getMin=function(){try{return this.comboMembers.getMin();}catch(e){}};DimSelPanelUI.prototype.getMax=function(){try{return this.comboMembers.getMax();}catch(e){}};DimSelPanelUI.prototype.removeFilterDMSels=function(member){this.comboMembers.unselectElement(member);};DimSelPanelUI.prototype.setLevel=function(h,l){if(h==null){h=-1;if(l==null){l=-1;}}else{if(typeof(h)=="string"){for(var iH=0;iH<this.hierarchiesList.length;iH++){var hierarchy=this.hierarchiesList[iH];if(hierarchy.id==h){if(l==null){l=-1;}else{if(typeof(l)=="string"){for(var iL=0;iL<hierarchy.levels.length;iL++){if(hierarchy.levels[iL].id==l){h=iH;l=iL;break;}}}else{h=iH;}}}}}}if((this.panel.hasHierarchy||this.panel.dimsList[0].continuous)&&h==-1){h=0;
}if(h>=0){var curh=this.getSelectedHierarchyIndex();var curl=this.getSelectedLevelIndex();if(curh!=h){this.setSelectedHierarchyIndex(h);this.updateLevels();this.setSelectedLevelIndex(l);this.updateMembers();}else{if(curl!=l){this.setSelectedLevelIndex(l);this.updateMembers();}}}};DimSelPanelUI.prototype.setRange=function(min,max,format,bUpdate){if(this.comboHierarchy&&this.panel.dimsList[0].continuous){if(this.getSelectedHierarchyId()!="Range"){if(bUpdate){this.comboHierarchy.selectMember("Range",true);}else{this.comboHierarchy.selectMember("Range",false);this.updateLevels();this.updateMembers();}}this.comboMembers.setRange(min,max,format,bUpdate);}else{var mbrs=new Array();for(var i=0;i<this.comboMembers.membersVal.length;i++){var mbr=this.comboMembers.membersVal[i];try{mbr=parseInt(mbr);if(mbr>=min&&mbr<max){mbrs.push(mbr);}}catch(e){}}this.setLevel(-1,-1);this.comboMembers.selectMembers(mbrs,false);}};DimSelPanelUI.prototype.updateLevels=function(){if(this.comboLevel!=null){var h=this.getSelectedHierarchy();
if(h){this.comboLevel.removeAllElements();if(!this.panel.hideRoot){this.comboLevel.addElement("root",Properties[getLocale()]["Root"],false);}var mi=0;while(mi<h.levels.length){this.comboLevel.addElement(h.levels[mi].id,h.levels[mi].name,false);mi++;}this.comboLevel.setEnabled(true);}else{if(this.getSelectedHierarchyId()=="Range"){this.comboLevel.removeAllElements();this.comboLevel.setEnabled(false);}}}};DimSelPanelUI.prototype.removeComboMembersChangeListeners=function(){this.comboMembers.removeChangeListeners();};DimSelPanelUI.prototype.updateMembers=function(keepSelection){var bSelectAll=true;var selMbrs=null;if(keepSelection){selMbrs={};var mbrs=this.getSelectedElements();for(var i=0;i<mbrs.length;i++){if(mbrs[i]!="All"){selMbrs[mbrs[i]]=mbrs[i];bSelectAll=false;}}}var combo=this.comboMembers;if(this.comboMembers!=null){this.comboMembers.removeAllElements();if(this.comboHierarchy!=null){var hierarchyId=this.getSelectedHierarchyId();if(this.getSelectedLevelIndex()>=0){if(this.panel.hideEmpty&&!this.panel.membersActivate){this.panel.fillMembersAvailable(this.getSelectedHierarchyId(),this.getSelectedLevelId());
}else{this.fillComboGroups(selMbrs,bSelectAll);}}else{if(hierarchyId=="Range"){this.fillCombo(selMbrs,bSelectAll);if(keepSelection){if(this.getMin()!=null){min=this.getMin();}if(this.getMax()!=null){max=this.getMax();}}}else{if(this.panel.hideEmpty&&!this.panel.membersActivate){this.panel.fillMembersAvailable(null,null);}else{this.fillCombo(selMbrs,bSelectAll);}}}}else{if(this.panel.hideEmpty&!this.panel.membersActivate){this.panel.fillMembersAvailable(null,null);}else{this.fillCombo(selMbrs,bSelectAll);}}}};DimSelPanelUI.prototype.changeUIMembersIfNeeded=function(membersLength,membersOnServer,bRange,bSelectAll,nullValue){var useSearch=membersLength>ddCtrl.LIMITSEARCHBOX||membersOnServer;this.comboMembers.removeAllElements();if(this.comboMembers.getClass()=="SearchComboUI"){if(bRange){var parent=this.comboMembers.getParent();removeAllChilds(parent);this.comboMembers=new RangeCombo(parent,"M"+this.panel.domId,this.isDate);this.comboMembers.removeChangeListeners();this.comboMembers.addChangeListener(this);
}else{if(useSearch){if(this.comboMembers.searchCombo.analyzerH){this.comboMembers.searchCombo.removeAnalyzerHandler();}if(nullValue!==undefined){this.comboMembers.searchCombo.nullValue=nullValue;}}else{var parent=this.comboMembers.getParent();removeAllChilds(parent);this.comboMembers=new Combo(parent,"selHierCombo","M"+this.panel.domId);if(this.panel.multiSelect){this.comboMembers.setMultiSize(10);}this.comboMembers.removeChangeListeners();this.comboMembers.addChangeListener(this);}}}else{if(this.comboMembers.getClass()=="Combo"){if(bRange){var parent=this.comboMembers.getParent();removeAllChilds(parent);this.comboMembers=new RangeCombo(parent,"M"+this.panel.domId,this.isDate);this.comboMembers.removeChangeListeners();this.comboMembers.addChangeListener(this);}else{if(useSearch){var parent=this.comboMembers.getParent();removeAllChilds(parent);this.comboMembers=new SearchComboUI(parent,"M"+this.panel.domId);this.comboMembers.removeChangeListeners();this.comboMembers.addChangeListener(this);
if(nullValue!==undefined){this.comboMembers.searchCombo.nullValue=nullValue;}}}}else{if(this.comboMembers.getClass()=="RangeCombo"){if(useSearch){var parent=this.comboMembers.getParent();removeAllChilds(parent);this.comboMembers=new SearchComboUI(parent,"M"+this.panel.domId);this.comboMembers.removeChangeListeners();this.comboMembers.addChangeListener(this);if(nullValue!==undefined){this.comboMembers.searchCombo.nullValue=nullValue;}}else{if(!bRange){var parent=this.comboMembers.getParent();removeAllChilds(parent);this.comboMembers=new Combo(parent,"selHierCombo","M"+this.panel.domId);if(this.panel.multiSelect){this.comboMembers.setMultiSize(10);}this.comboMembers.removeChangeListeners();this.comboMembers.addChangeListener(this);}}}}}this.comboMembers.setMultiSelect(this.panel.multiSelect);if(!this.trRemoveFilters&&!this.panel.hideAll){this.comboMembers.addElement("All",Properties[getLocale()]["All"],bSelectAll);}if(this.comboMembers.getClass()!="RangeCombo"&&nullValue!==undefined){this.comboMembers.addElement(nullValue,Properties[getLocale()]["EmptyMember"]);
}};DimSelPanelUI.prototype.updateMembersWithHL=function(dimEx,iH,iL,memberId,bForceShowId){if(this.comboMembers!=null){this.comboMembers.removeAllElements();this.comboMembers.addElement("All",Properties[getLocale()]["All"],true);var sortedGroups=new Array();var mapMember={};this.comboMembers.format=dimEx.dim.format;var lvl=null;if(dimEx.hierarchy){lvl=dimEx.hierarchy.levels[iL];this.comboMembers.format=lvl.format;if(typeof(memberId)=="undefined"||memberId==null){var mi=0;while(mi<lvl.groups.length){var val=lvl.groups[mi].name;if(lvl.groups[mi].members.length>0){sortedGroups.push(val);mapMember[val]=lvl.groups[mi].caption;}++mi;}}else{if(dimEx.dim.continuous){var lvl=dimEx.hierarchy.levels[iL];var members=null;var group=lvl.groupsByName["z"+memberId];var members=group.members;var s=parseFloat(memberId);var min=eval(lvl.fMin);var max=eval(lvl.fMax);var lvlDown=dimEx.hierarchy.levels[iL-1];if(lvlDown){var mIT=0;while(mIT<lvlDown.groups.length){if(min<=lvlDown.groups[mIT].id&&lvlDown.groups[mIT].id<=max){sortedGroups.push(lvlDown.groups[mIT].id);
}++mIT;}this.comboMembers.format=lvlDown.format;}}else{var gPos=lvl.getMemberPosById(memberId);var members=lvl.groups[gPos].members;var nextLpos=iL-1;if(nextLpos>=0){var lvl=dimEx.hierarchy.levels[nextLpos];var mIT=0;while(mIT<members.length){sortedGroups.push(lvl.groups[members[mIT]].name);mapMember[lvl.groups[members[mIT]].name]=lvl.groups[members[mIT]].caption;++mIT;}}else{var mIT=0;while(mIT<members.length){sortedGroups.push(dimEx.dim.members[members[mIT]]);++mIT;}}}}}else{this.fillComboOLAP();return;}if(lvl!=null&&typeof lvl.groups[0].name==typeof 1){try{sortedGroups.sort(ArraySortAscending);}catch(e){sortedGroups.sort();}}else{sortedGroups.sort();}var mi=0;while(mi<sortedGroups.length){if(this.comboMembers.format!=null||typeof(mapMember[sortedGroups[mi]])=="undefined"||bForceShowId){this.comboMembers.addElementFormat(sortedGroups[mi],false);}else{this.comboMembers.addElement(sortedGroups[mi],mapMember[sortedGroups[mi]],false);}++mi;}}};DimSelPanelUI.prototype.fillCombo=function(selMbrs,bSelectAll){var members=[];
var mapMembers={};var previewMembers=[];var mapPreviewMembers={};var membersAvailable={};var dimId;var bSort;var sortType=S_ALPHA;var sortReverse=false;var sortOnCaption=false;var format;var membersOnServer;var nullValue=undefined;var bHasPrevSelection=!bSelectAll;var i=0;while(i<this.panel.dimsList.length){var dim=this.panel.dimsList[i];if(i==0){dimId=dim.id;bSort=!dim.order;sortType=dim.sortType;sortReverse=dim.sortReverse;sortOnCaption=dim.sortOnCaption;}if(format==null){format=dim.format;}membersOnServer|=dim.membersOnServer;if(dim.nullValue!==undefined&&nullValue===undefined){nullValue=dim.nullValue;}i++;}if(this.panel.hideEmpty){var bResultHasNull=false;bSort=false;for(var i=0;i<this.panel.membersActivate.length;i++){var mbrObj=this.panel.membersActivate[i];var mbr=mbrObj.member;members.push(mbrObj);mapMembers[mbr]=mbr;membersAvailable[mbr]=mbr;if(mbr==nullValue){bResultHasNull=true;}}if(!bResultHasNull){nullValue=undefined;}if(selMbrs){var selMbrs2=new Object();for(var mbrAvailable in membersAvailable){if(selMbrs[mbrAvailable]){selMbrs2[mbrAvailable]=true;
}}selMbrs=selMbrs2;}}else{var i=0;while(i<this.panel.dimsList.length){var dim=this.panel.dimsList[i];var dm=this.panel.dmList[i];var dimMembers=dim.members;if(dim.previewMembers){for(var iMbr=0;iMbr<dim.previewMembers.length;iMbr++){var member=dim.previewMembers[iMbr];if(mapPreviewMembers[member]===undefined){mapPreviewMembers[member]=member;previewMembers.push(member);if(dim.captionDim&&dim.captions[iMbr]){var caption=dim.captions[iMbr];mapMembers[member]=caption;}}}}for(var iMbr=0;iMbr<dimMembers.length;iMbr++){if(mapMembers[dimMembers[iMbr]]===undefined){var mbrObj={};mbrObj.member=dimMembers[iMbr];mapMembers[dimMembers[iMbr]]=mbrObj.member;if(dim.captionDim&&dim.captions[iMbr]){mbrObj.caption=dim.captions[iMbr];mapMembers[dimMembers[iMbr]]=mbrObj.caption;}members.push(mbrObj);}}i++;}}this.fillMembers(members,mapMembers,previewMembers,membersAvailable,membersOnServer,bSort,sortType,sortReverse,sortOnCaption,format,selMbrs,bSelectAll,nullValue);};DimSelPanelUI.prototype.fillComboGroups=function(selMbrs,bSelectAll){var members=[];
var mapMembers={};var previewMembers=[];var mapPreviewMembers={};var membersAvailable={};var dimId;var hierarchyId=this.getSelectedHierarchyId();var levelId=this.getSelectedLevelId();var bSort;var sortType=S_ALPHA;var sortReverse=false;var sortOnCaption=false;var format;var membersOnServer;var nullValue=undefined;var bHasPrevSelection=!bSelectAll;for(var iD=0;iD<this.panel.dimsList.length;iD++){var dim=this.panel.dimsList[iD];var dm=this.panel.dmList[iD];if(iD==0){dimId=dim.id;sortType=dim.sortType;sortReverse=dim.sortReverse;sortOnCaption=dim.sortOnCaption;}for(var iH=0;iH<dim.hierarchies.length;iH++){var hierarchy=dim.hierarchies[iH];if(hierarchy.id==hierarchyId){for(var iL=0;iL<hierarchy.levels.length;iL++){var level=hierarchy.levels[iL];if(level.id==levelId){if(format==null){format=level.format;}membersOnServer|=level.groupsOnServer;if(level.nullValue!==undefined&&nullValue===undefined){nullValue=dim.nullValue;}if(bSort==null){bSort=!dim.order;}}}}}}if(this.panel.hideEmpty){var bResultHasNull=false;
bSort=false;for(var i=0;i<this.panel.membersActivate.length;i++){var mbrObj=this.panel.membersActivate[i];var mbr=mbrObj.member;members.push(mbrObj);mapMembers[mbr]=mbr;membersAvailable[mbr]=mbr;if(mbr==nullValue){bResultHasNull=true;}}if(!bResultHasNull){nullValue=undefined;}if(selMbrs){var selMbrs2=new Object();for(var mbrAvailable in membersAvailable){if(selMbrs[mbrAvailable]){selMbrs2[mbrAvailable]=true;}}selMbrs=selMbrs2;}}else{for(var iD=0;iD<this.panel.dimsList.length;iD++){var dim=this.panel.dimsList[iD];var dm=this.panel.dmList[iD];for(var iH=0;iH<dim.hierarchies.length;iH++){var hierarchy=dim.hierarchies[iH];if(hierarchy.id==hierarchyId){for(var iL=0;iL<hierarchy.levels.length;iL++){var level=hierarchy.levels[iL];if(level.id==levelId){level.prepare(dim);for(iG=0;iG<level.groups.length;iG++){var grp=level.groups[iG];var grpId=grp.id;var grpName=grp.name;if(mapMembers[grpName]===undefined){var mbrObj={};mbrObj.member=grpName;mapMembers[grpName]=mbrObj.member;if(level.groups[iG].caption){mbrObj.caption=level.groups[iG].caption;
mapMembers[grpName]=mbrObj.caption;}members.push(mbrObj);}}if(level.previewGroups){for(iG=0;iG<level.previewGroups.length;iG++){var grp=level.previewGroups[iG];var grpId=grp.id;var grpName=grp.name;if(mapPreviewMembers[grpName]===undefined){previewMembers.push(grpName);if(level.previewGroups[iG].caption){mapMembers[grpName]=level.previewGroups[iG].caption;}else{mapMembers[grpName]=grpName;}}}}}}}}}}this.fillMembers(members,mapMembers,previewMembers,membersAvailable,membersOnServer,bSort,sortType,sortReverse,sortOnCaption,format,selMbrs,bSelectAll,nullValue);};DimSelPanelUI.prototype.fillMembers=function(members,mapMembers,previewMembers,membersAvailable,membersOnServer,bSort,sortType,sortReverse,sortOnCaption,format,selMbrs,bSelectAll,nullValue){var dim=this.panel.dimsList[0];var hierarchyId=null;var levelId=null;if(this.getSelectedLevelIndex()>=0){hierarchyId=this.getSelectedHierarchyId();levelId=this.getSelectedLevelId();}var bHasPrevSelection=!bSelectAll;var nbMembers=members.length;
var bRange=false;if(this.getSelectedHierarchyId()=="Range"){nbMembers=0;membersOnServer=0;bRange=true;bSelectAll=true;nullValue=undefined;sortType=S_NUMERIC;sortReverse=false;}this.changeUIMembersIfNeeded(nbMembers,membersOnServer,bRange,bSelectAll,nullValue);if(this.comboMembers.searchCombo){if(this.panel.hideEmpty){var obj=this.panel;this.comboMembers.searchCombo.setResultListener(function(){obj.drawResult(membersAvailable);});}this.comboMembers.format=format;if(!isOffline()&&(members.length>ddCtrl.LIMITINDEXATION||membersOnServer)){var limit=ddCtrl.LIMIT_RESULT_SEARCHBOX;if(this.panel.hideEmpty){limit=dim.nbMembers;}this.comboMembers.searchCombo.setAnalyzerHandler(new AnalyzerHandler(this.panel.dmList,[dim.id],hierarchyId,levelId,limit));if(this.panel.hideEmpty){var mbrs=[];for(var mbr in selMbrs){if(mapMembers[mbr]){var mbrObj=new Object();mbrObj.member=mbr;mbrs.push(mbrObj);}}for(var i=0;i<members.length;i++){if(mbrs.length<ddCtrl.LIMITINDEXATION){mbrs.push(members[i]);}else{break;
}}members=mbrs;}}if(!this.panel.hideEmpty){if(membersOnServer){for(var i=0;i<previewMembers.length;i++){if(members.length<ddCtrl.LIMIT_RESULT_SEARCHBOX){var mbrObj=new Object();mbrObj.member=previewMembers[i];if(dim.captionDim&&dim.captions[i]){mapMembers[previewMembers[i]]=dim.captions[i];mbrObj.caption=dim.captions[i];}else{mapMembers[previewMembers[i]]=previewMembers[i];}members.push(mbrObj);}else{break;}}}}}this._sortAndAddWithCaptions(members,bSort,sortType,sortReverse,sortOnCaption,format,selMbrs,bHasPrevSelection,nullValue);};DimSelPanelUI.prototype.fillComboOLAP=function(selMbrs,bSelectAll){var members=[];var mapMembers={};var sort=null;var format=null;var bSort;var membersOnServer=false;var nbMembers=0;var bHasPrevSelection=!bSelectAll;var i=0;while(i<this.panel.dimsList.length){var dim=this.panel.dimsList[i];var dm=this.panel.dmList[i];if(i==0){nbMembers=dim.members.length;bSort=!dim.order;}if(sort==null){sort=dim.sort;}if(format==null){format=dim.format;}if(!membersOnServer){membersOnServer=dim.membersOnServer;
}var dimMembers=dim.members;if(this.panel.hideEmpty){dimMembers=this.panel.getMembersAvailableOld(dm,null,null,"list");nbMembers=dimMembers.length;}if(!isOffline()&&(nbMembers>ddCtrl.LIMITINDEXATION||membersOnServer)){nbMembers=dim.members.length;if(nbMembers<members.length){nbMembers=members.length;}this.changeUIMembersIfNeeded(dim.members.length,membersOnServer,false,bSelectAll,dim.nullValue);this.comboMembers.format=format;if(this.comboMembers.searchCombo){this.comboMembers.searchCombo.setAnalyzerHandler(new AnalyzerHandler(this.panel.dmList,[dim.id],null,null));var bHasMembersAvailable=false;var resMembers=new Array();if(this.panel.hideEmpty){membersAvailable=this.panel.getAllMembersAvailableOld(null,null,"map");var obj=this.panel;this.comboMembers.searchCombo.setResultListener(function(){obj.drawResult(membersAvailable);});var i=0;for(var mbr in membersAvailable){if(i==ddCtrl.LIMIT_RESULT_SEARCHBOX){break;}bHasMembersAvailable=true;resMembers.push(mbr);i++;}var bSelectMbrs=false;var membersToSelect=new Object();
if(selMbrs){for(var mbrAvailable in membersAvailable){if(selMbrs[mbrAvailable]){membersToSelect[mbrAvailable]=mbrAvailable;bSelectMbrs=true;}}if(bSelectMbrs){this._sortAndAddWithCaptionsOld(members,bSort,sort,mapMembers,format,membersToSelect,bHasPrevSelection,dim.nullValue);}}}if(!bHasMembersAvailable){if(dim.previewMembers){resMembers=dim.previewMembers;}else{resMembers=dim.members;}var pos=0;if(dim.nullValue!==undefined){this.comboMembers.searchCombo.nullValue=dim.nullValue;var mbrObj=new SearchComboValName(dim.nullValue,Properties[getLocale()]["EmptyMember"],pos);this.comboMembers.searchCombo.add(mbrF,mbrObj);pos++;}}for(var i=0;i<resMembers.length;i++){if(i==ddCtrl.LIMIT_RESULT_SEARCHBOX){break;}var mbr=resMembers[i];if(dim.nullValue===undefined||mbr!=dim.nullValue){var mbrF=mbr;if(dim.format){mbrF=formatNum(mbr,dim.format);}var mbrObj=new SearchComboValName(mbr,mbrF,pos);this.comboMembers.searchCombo.add(mbrF,mbrObj);pos++;}}}return;}members=members.concat(dimMembers);if(!dim.continuous&&dim.captionDim){for(var iMbr=0;
iMbr<dimMembers.length;iMbr++){var caption=dim.captions[iMbr];if(caption){mapMembers[dimMembers[iMbr]]=caption;}else{mapMembers[dimMembers[iMbr]]=dimMembers[iMbr];}}}i++;}this.changeUIMembersIfNeeded(nbMembers,membersOnServer,false,bSelectAll,dim.nullValue);this._sortAndAddWithCaptionsOld(members,bSort,sort,mapMembers,format,selMbrs,bHasPrevSelection,dim.nullValue);};DimSelPanelUI.prototype._sortAndAddWithCaptions=function(members,bSort,sortType,sortReverse,sortOnCaption,format,selMbrs,bHasPrevSelection,nullValue){if(bSort){var sortFunc=null;if(sortType==S_ALPHA){if(sortOnCaption){if(sortReverse){sortFunc=sortAlphaRCaptionFunc;}else{sortFunc=sortAlphaCaptionFunc;}}else{if(sortReverse){sortFunc=sortAlphaRFunc;}else{sortFunc=sortAlphaFunc;}}}else{if(sortType==S_NUMERIC){if(sortReverse){sortFunc=sortNumRFunc;}else{sortFunc=sortNumFunc;}}else{if(members[0]!=null&&typeof members[0].member==typeof 1){sortFunc=sortNumFunc;}else{sortFunc=sortAlphaFunc;}}}members.sort(sortFunc);}var i=0;this.comboMembers.format=format;
var bHasSelection=false;var mapCaptions={};for(var i=0;i<members.length;i++){var mbrObj=members[i];var mbr=mbrObj.member;var mbrF=mbrObj.caption;if(this.getSelectedHierarchyId()!="Range"){var selected=false;if(selMbrs!=null&&typeof(selMbrs)!="undefined"&&typeof(selMbrs[mbr])!="undefined"){selected=true;bHasSelection=true;}if(nullValue===undefined||mbr!=nullValue){if(typeof(mbrF)!="undefined"&&mbrF!=null){mapCaptions[mbr]=mbrF;this.comboMembers.addElement(mbr,mbrF,selected);}if(this.comboMembers.format!=null){this.comboMembers.addElementFormat(mbr,selected);}else{this.comboMembers.addElement(mbr,mbr,selected);}}}else{if(typeof(mbrF)!="undefined"&&mbrF!=null){mapCaptions[mbr]=mbrF;}}}if(this.getSelectedHierarchyId()=="Range"){var min=this.panel.rangeValues.min;var max=this.panel.rangeValues.max;if(members.length>0){min=members[0].member;max=members[members.length-1].member;}if(this.isDate){max+=(24*3600);}else{max+=1;}this.comboMembers.setCaptions(mapCaptions);this.comboMembers.setRange(min,max,this.panel.dimsList[0].format);
}else{if(this.panel.hideEmpty&&bHasPrevSelection&&!bHasSelection&&!this.panel.hideAll){this.comboMembers.selectMember("All",true);}}};function sortAlphaFunc(a,b){return ssortAlpha(a.member,b.member);}function sortAlphaRFunc(a,b){return ssortAlphaR(a.member,b.member);}function sortNumFunc(a,b){return ssortnum(a.member,b.member);}function sortNumRFunc(a,b){return ssortnumR(a.member,b.member);}function sortAlphaCaptionFunc(a,b){var captionA=a.member;if(typeof(a.caption)!="undefined"&&a.caption!=null){captionA=a.caption;}var captionB=b.member;if(typeof(b.caption)!="undefined"&&b.caption!=null){captionB=b.caption;}return ssortAlpha(captionA,captionB);}function sortAlphaRCaptionFunc(a,b){var captionA=a.member;if(typeof(a.caption)!="undefined"&&a.caption!=null){captionA=a.caption;}var captionB=b.member;if(typeof(b.caption)!="undefined"&&b.caption!=null){captionB=b.caption;}return ssortAlphaR(captionA,captionB);}DimSelPanelUI.prototype._sortAndAddWithCaptionsOld=function(members,bSort,sortAlgo,mapMember,format,selMbrs,bHasPrevSelection,nullValue){if(bSort){if(sortAlgo){try{members.sort(sortAlgo);
}catch(e){members.sort();}}else{if(typeof members[0]==typeof 1){try{members.sort(ArraySortAscending);}catch(e){members.sort();}}else{members.sort();}}}var i=0;this.comboMembers.format=format;var bHasSelection=false;while(i<members.length){var selected=false;if(selMbrs!=null&&typeof(selMbrs)!="undefined"&&typeof(selMbrs[members[i]])!="undefined"){selected=true;bHasSelection=true;}if(nullValue===undefined||members[i]!=nullValue){if(this.comboMembers.format!=null||typeof(mapMember[members[i]])=="undefined"){this.comboMembers.addElementFormat(members[i],selected);}else{this.comboMembers.addElement(members[i],mapMember[members[i]],selected);}}i++;}if(this.panel.hideEmpty&&bHasPrevSelection&&!bHasSelection&&!this.panel.hideAll){this.comboMembers.selectMember("All",true);}};DimSelPanelUI.prototype.addDim=function(dim,hierarchies,hideHierLevel){if(dim.time){this.isDate=true;}if(hierarchies.length>0){if(!hideHierLevel){this.createComboHierarchy();var iH=0;while(iH<hierarchies.length){this.hierarchiesList.push(hierarchies[iH]);
iH++;}var selHierarchy=null;if(this.comboHierarchy!=null&&this.comboHierarchy.getSelectedElements()!=null&&this.comboHierarchy.getSelectedElements().length>0){selHierarchy=this.comboHierarchy.getSelectedElements()[0];}this.comboHierarchy.removeAllElements();iH=0;while(iH<this.hierarchiesList.length){var hierarchy=this.hierarchiesList[iH];var selected=false;if(hierarchy.id==selHierarchy){selected=true;}this.addComboHierarchy(hierarchy,selected);iH++;}if(dim.continuous){var selected=false;if(selHierarchy=="Range"){selected=true;}this.addComboRange(selected);}this.addComboLevel();}}else{if(dim.continuous){if(this.hierarchiesList.length==0){this.addComboElements();}this.addComboRange();}}this.addComboMembers(dim);this.addReverseFilterSelection();};DimSelPanelUI.prototype.getHTMLElement=function(){return this.HTMLElement;};PopDownDimSelPanelUI=function(panel){DimSelPanelUI.call(this,panel);this.createUIPriv();};PopDownDimSelPanelUI.prototype=new DimSelPanelUI();PopDownDimSelPanelUI.prototype.createUIPriv=function(){this.HTMLElement=document.createElement("div");
this.HTMLElement.setAttribute("id","dimSel"+this.panel.domId);var style="z-index:2500;display:none;position:absolute;";if(typeof(setPos)!="undefined"){style+="cursor:e-resize";}setStyle(this.HTMLElement,style);var tbl=document.createElement("table");tbl.setAttribute("id","dimTbl"+this.panel.domId);tbl.className="selHierPanel";if(typeof(showHideIframe)!="undefined"){tbl.onmouseup=function(e){showHideIframe("visible");};}if(typeof(setPos)!="undefined"){tbl.onmousedown=function(e){setPos(this.id,e);};}this.tbody=document.createElement("tbody");tbl.appendChild(this.tbody);this.HTMLElement.appendChild(tbl);if(this.panel.parent){this.panel.parent.appendChild(this.HTMLElement);}};PopDownDimSelPanelUI.prototype.isHidden=function(){if(this.HTMLElement.style.display=="none"){return true;}return false;};PopDownDimSelPanelUI.prototype.show=function(){var tbl=this.HTMLElement.firstChild;var width=tbl.style.width;this.HTMLElement.style.width=width;var tdImg=document.getElementById("dimImg"+this.panel.domId);
if(this.HTMLElement.style.display=="none"){tdImg.className="selHierFoldImg";this.HTMLElement.style.display="";var tbl=document.getElementById("dimTbl"+this.panel.domId);if(isIE()){var left=document.getElementById("dim"+this.panel.domId).offsetLeft-this.HTMLElement.offsetLeft;this.calcPanelSizePriv(tbl,"dim"+this.panel.domId,width,left);}else{this.calcPanelSizePriv(tbl,"dim"+this.panel.domId,width);}}else{tdImg.className="selHierUnfoldImg";this.HTMLElement.style.display="none";}};PopDownDimSelPanelUI.prototype.hide=function(){this.HTMLElement.style.display="none";var HTMLElementPanel=document.getElementById("dimTbl"+this.panel.domId);HTMLElementPanel.style.display="none";var tdImg=document.getElementById("dimImg"+this.panel.domId);tdImg.className="selHierUnfoldImg";};PopDownDimSelPanelUI.prototype.calcPanelSizePriv=function(tbl,id,width,left){var obj=document.getElementById(id);if(!obj){return;}var top=0;var offLeft=0;var height=obj.clientHeight;var i=0;while((obj!=null)&&(obj!=obj.parent)){top+=obj.offsetTop+SPACE_UNDER_COMBO;
offLeft+=obj.offsetLeft+PANEL_OFFSET;obj=obj.parent;if((obj==null)||(obj.style.position=="absolute")){break;}++i;}if(typeof(left)=="undefined"){left=offLeft;}var banner=document.getElementById("banner");if(banner){top+=17;var display=banner.style.display;if(display=="none"){var simpleBanner=document.getElementById("simpleBanner");top=top-simpleBanner.offsetHeight;}else{top=top-banner.offsetHeight;}}else{top+=height;}if(isIE()){tbl.style.setAttribute("cssText","z-index:2000;position:absolute;top:"+top+"px;left:"+left+"px;width:"+width+";");}else{tbl.setAttribute("style","z-index:2000;position:absolute;top:"+top+"px;left:"+left+"px;width:"+width+";");}};PopDownDimSelPanelUI.prototype.setPos=function(x,y){var tbl=document.getElementById("dimTbl"+this.panel.domId);this.calcPanelSizePriv(tbl,"dim"+this.panel.domId,ddCtrl.comboWidth+"px");};PopDownDimSelPanelUI.prototype.createComboHierarchy=function(){if(!this.comboHierarchy){var tr=document.createElement("tr");if(isIE()){tr.style.setAttribute("cssText","width:90px");
}var td=document.createElement("td");if(isIE()){td.style.setAttribute("cssText","width:90px");}this.comboHierarchy=new Combo(td,"selHierCombo","H"+this.panel.domId);this.comboHierarchy.addChangeListener(this);tr.appendChild(td);if(this.trMembers){this.tbody.insertBefore(tr,this.trMembers);}else{this.tbody.appendChild(tr);}}};PopDownDimSelPanelUI.prototype.addComboHierarchy=function(hierarchy,selected){var name=hierarchy.name;for(var i=0;i<this.hierarchiesList.length;i++){var hier=this.hierarchiesList[i];if(hier.name==hierarchy.name&&hier.id!=hierarchy.id){name+=" ("+hierarchy.id+")";}}var id=hierarchy.id;var i=1;while(this.comboHierarchy.hasMember(id)){id=hierarchy.id+" ("+i+")";i++;}this.comboHierarchy.addElement(id,name,selected);};PopDownDimSelPanelUI.prototype.addComboElements=function(){if(!this.comboHierarchy){var tr=document.createElement("tr");if(isIE()){tr.style.setAttribute("cssText","width:90px");}var td=document.createElement("td");if(isIE()){td.style.setAttribute("cssText","width:90px");
}this.comboHierarchy=new Combo(td,"selHierCombo","H"+this.panel.domId);this.comboHierarchy.addChangeListener(this);tr.appendChild(td);if(this.trMembers){this.tbody.insertBefore(tr,this.trMembers);}else{this.tbody.appendChild(tr);}}this.comboHierarchy.addElement("MembersList",Properties[getLocale()]["MembersList"],false);};PopDownDimSelPanelUI.prototype.addComboRange=function(selected){if(!this.comboHierarchy){var tr=document.createElement("tr");if(isIE()){tr.style.setAttribute("cssText","width:90px");}var td=document.createElement("td");if(isIE()){td.style.setAttribute("cssText","width:90px");}this.comboHierarchy=new Combo(td,"selHierCombo","H"+this.panel.domId);this.comboHierarchy.addChangeListener(this);tr.appendChild(td);if(this.trMembers){this.tbody.insertBefore(tr,this.trMembers);}else{this.tbody.appendChild(tr);}}this.comboHierarchy.addElement("Range",Properties[getLocale()]["Range"],selected);};PopDownDimSelPanelUI.prototype.addComboLevel=function(){if(!this.comboLevel){var tr=document.createElement("tr");
var td=document.createElement("td");this.comboLevel=new Combo(td,"selHierCombo","L"+this.panel.domId);this.comboLevel.addChangeListener(this);tr.appendChild(td);if(this.trMembers){this.tbody.insertBefore(tr,this.trMembers);}else{this.tbody.appendChild(tr);}}};PopDownDimSelPanelUI.prototype.addComboMembers=function(dim){if(!this.comboMembers){if(isTouchDevice()){this.trRemoveFilters=document.createElement("tr");this.trRemoveFilters.className="selHierTitle";var td=document.createElement("td");this.removeFiltersElt=document.createElement("span");this.removeFiltersElt.className="selHierTitleSpan";this.removeFiltersElt.id="dimSelAll"+this.panel.domId;var obj=this;this.trRemoveFilters.onclick=function(){obj.comboMembers.unselectAllElements(true);};var text=document.createTextNode(Properties[getLocale()]["RemoveFilters"]);this.removeFiltersElt.appendChild(text);td.appendChild(this.removeFiltersElt);this.trRemoveFilters.appendChild(td);this.tbody.appendChild(this.trRemoveFilters);}this.trMembers=document.createElement("tr");
var td=document.createElement("td");this.trMembers.appendChild(td);this.tbody.appendChild(this.trMembers);if(this.panel.useSearchBox&&(dim.members.length>ddCtrl.LIMITSEARCHBOX||dim.membersOnServer)){this.comboMembers=new SearchComboUI(td,"M"+this.panel.domId);if(dim.nullValue!==undefined){this.comboMembers.searchCombo.nullValue=dim.nullValue;}}else{this.comboMembers=new Combo(td,"selHierCombo","M"+this.panel.domId);if(this.panel.multiSelect){this.comboMembers.setMultiSize(10);}}this.comboMembers.setMultiSelect(this.panel.multiSelect);this.comboMembers.addChangeListener(this);}};PopDownDimSelPanelUI.prototype.addReverseFilterSelection=function(){if(!this.reverseFilterSel){var tr=document.createElement("tr");var td=document.createElement("td");var span=document.createElement("span");span.className="selHierCombo";setStyle(span,"display: inline-block");this.reverseFilterSel=document.createElement("input");this.reverseFilterSel.type="checkbox";setStyle(this.reverseFilterSel,"margin: 0px 2px 0px 0px; vertical-align: middle;");
var obj=this;this.reverseFilterSel.onclick=function(){obj.panel.reverseFilter=this.checked;if(obj.panel.filter){obj.panel.updateDMSels();obj.panel.dimSelChangeHandler();if(obj.panel.updateOnChange&&obj.panel.updaterFunc!=null){obj.panel.updaterFunc.onChange();}}};span.appendChild(this.reverseFilterSel);span.appendChild(document.createTextNode(getLocMessage("Exclude")));td.appendChild(span);tr.appendChild(td);this.tbody.appendChild(tr);}};PopDownDimSelPanelUI.prototype.setReverseFilter=function(isReverseFilter){if(this.reverseFilterSel){this.reverseFilterSel.checked=isReverseFilter;}};SideBarDimSelPanelUI=function(panel){DimSelPanelUI.call(this,panel);this.createUIPriv();};SideBarDimSelPanelUI.prototype=new DimSelPanelUI();SideBarDimSelPanelUI.prototype.createUIPriv=function(){this.HTMLElement=document.createElement("div");this.HTMLElement.setAttribute("id","dimSel"+this.panel.domId);setStyle(this.HTMLElement,"width: 300px; height: 200px; display: none");this.HTMLElement.className="combo-2";
if(this.panel.parent){this.panel.parent.appendChild(this.HTMLElement);}};SideBarDimSelPanelUI.prototype.show=function(){this.HTMLElement.style.display="block";};SideBarDimSelPanelUI.prototype.hide=function(){this.HTMLElement.style.display="none";};SideBarDimSelPanelUI.prototype.createComboHierarchy=function(hierarchy){};SideBarDimSelPanelUI.prototype.addComboHierarchy=function(hierarchy){};SideBarDimSelPanelUI.prototype.addComboLevel=function(){};SideBarDimSelPanelUI.prototype.addComboMembers=function(){if(!this.comboMembers){var divMember=document.createElement("div");divMember.setAttribute("id","dimSel"+this.panel.domId+"-divM");var membersDivId="M-"+divMember.id+"-M"+this.panel.domId;var titleDiv=document.createElement("div");titleDiv.className="dimensionChildrenComboTitle";titleDiv.appendChild(document.createTextNode("Members"));this.comboMembers=new ComboList(divMember,"dimensionChildrenCombo",membersDivId,true);this.HTMLElement.appendChild(divMember);}};SideBarDimSelPanelUI.prototype.setPos=function(x,y){};
var NO_AGG=-1;var AGG_SUM=0;var AGG_AVG=1;var AGG_MIN=2;var AGG_MAX=3;var AGG_RSM=4;var AGG_ARSUM=7;var AGG_OR=10;var AGG_MEDIAN=11;var AGG_DCOUNT=104;var AGG_DMEMBER=105;var FILTER_NONE=-1;var FILTER_TOP=0;var FILTER_BOTTOM=1;var FILTER_RANGE=2;function kmult(arg0,arg1){return(arg0-0)*(arg1-0);}function kdiff(arg0,arg1){return(arg0-0)-(arg1-0);}function kdiv(arg0,arg1){return(arg0-0)/(arg1-0);}function kadd(arg0,arg1){return(arg0-0)+(arg1-0);}var INCREASE=0;var DECREASE=1;var STABLE=2;var INCOPTIMORDER=20;var msg_other=new Array();msg_other.fr="Autres";msg_other.en="Other";if(typeof ddCtrl!="undefined"&&ddCtrl!=null){if(typeof ddCtrl.__v=="undefined"){ddCtrl.__v={};}if(typeof __v=="undefined"){__v=ddCtrl.__v;}}if(typeof __v=="undefined"){__v={};}function DDVariable(name,def,min,max,inc,values,displayName,format){this.name=name;this.cur=def;this.def=def;this.min=min;this.max=max;this.inc=inc;this.values=values;if(values!=null&&typeof(values.length)!="undefined"){this.values={};for(var key in values){if(typeof(key)!="function"){try{key=parseFloat(key);
if(isNumeric(key)){this.values[key]=values[key];}}catch(e){}}}}this.displayName=displayName;this.format=format;}DDVariable.prototype.toJSON=function(){return{name:this.name,cur:this.cur,def:this.def,min:this.min,max:this.max,inc:this.inc};};DDVariable.prototype.getValue=function(){return this.cur;};DDVariable.prototype.getFormatedValue=function(){if(this.values&&typeof(this.values[this.cur])!="undefined"){return this.values[this.cur];}return formatNum(this.cur,this.format);};function getDDVar(name){try{return __v[name].cur;}catch(e){return undefined;}}function setDDVar(name,cur){if(typeof(__v[name])!="undefined"){__v[name].cur=cur;}else{throw"DDVar '"+name+"' is not registered yet. Use DataModel.registerDDVar(name, def, min, max, inc, values, displayName, format)";}}AxisValue=function(id,formated){this.id=id;this.formated=formated;};A_MV=function(formula,nbvar,selection,mcube,iM,nuplet,dm){this.aggs=[];this.aggsProtected=null;this.formula=formula;this.nbvar=nbvar;this.selection=selection;
this.mcube=mcube;this.iM=iM;this.nuplet=nuplet;this.valCal=null;this.bCalculated=false;this.checkSecondPass=false;this.needSecondPass=false;if(formula.toString().indexOf("needSecondPass")>=0){this.needSecondPass=true;}this.dm=dm;};A_MV.prototype.clone=function(){var nMV=new A_MV(this.formula,this.nbvar,this.selection,this.iM,this.mcube,this.nuplet,this.dm);for(var i=0;i<this.aggs.length;++i){if(this.aggs[i]){nMV.aggs[i]=this.aggs[i].clone();}}if(this.aggsProtected!=null){nMV.aggsProtected={};for(var attr in this.aggsProtected){if(this.aggsProtected[attr]){nMV.aggsProtected[attr]=true;}}}if(this.expInfo!=null){nMV.expInfo={};for(var iA in this.expInfo){if(this.expInfo.hasOwnProperty(iA)){var nups={};var nupSrc=this.expInfo[iA];for(var nuplet in nupSrc){if(nupSrc.hasOwnProperty(nuplet)){nups[nuplet]=true;}}nMV.expInfo[iA]=nups;}}}nMV.bCalculated=this.bCalculated;nMV.valCal=this.valCal;return nMV;};A_MV.prototype.aggProtect=function(i){if(this.aggsProtected==null){this.aggsProtected={};}this.aggsProtected[i]=true;
};A_MV.prototype.getVal=function(line,rcube,phase){this.computeValue(line,rcube,phase);return this.valCal;};A_MV.prototype.computeValue=function(line,rcube,phase){if(!this.bCalculated){for(var i=0;i<this.nbvar;++i){if(!this.aggs[i]){this.aggs[i]=new A_SUM(null);}else{if(this.aggs[i] instanceof A_ARSUM){this.needSecondPass=true;}}}if(typeof(_global)!="undefined"){_global.__phase=phase;_global.__line=line;}var val=this.formula(this.aggs,line,rcube,phase);if((val==Number.POSITIVE_INFINITY)||(val==Number.NEGATIVE_INFINITY)){this.valCal=NaN;}else{this.valCal=val;}this.bCalculated=true;}else{if(this.needSecondPass&&phase>0){this.needSecondPass=false;if(typeof(_global)!="undefined"){_global.__phase=phase;_global.__line=line;}var val=this.formula(this.aggs,line,rcube,phase);if((val==Number.POSITIVE_INFINITY)||(val==Number.NEGATIVE_INFINITY)){this.valCal=NaN;}else{this.valCal=val;}}}};A_MV.prototype.aggValU=function(i,v){this.bCalculated=false;this.aggs[i].aggVal(v);};A_MV.prototype.aggVal=function(v,bOverideProtection){this.bCalculated=false;
var mx=this.aggs.length;if(v.aggs.length>mx){mx=v.aggs.length;}for(var i=0;i<mx;++i){if(this.aggs[i]){if(v.aggs[i]&&(bOverideProtection||this.aggsProtected==null||!this.aggsProtected[i])){if(!this.containsOrAddExpInfo(i,v)){this.aggs[i].aggVal(v.aggs[i]);}}}else{if(v.aggs[i]){this.aggs[i]=v.aggs[i].clone();}}}};A_MV.prototype.aggValDblU=function(i,v,am,l){this.bCalculated=false;if(this.aggs[i]==null){this.aggs[i]=new am.agg(v,this.mcube,this.iM+"-"+i,this.nuplet,this.dm,am.param,l);}else{this.aggs[i].aggValDbl(v,this.nuplet,l);}};A_MV.prototype.isSet=function(i){return this.aggs[i]!=null;};A_MV.prototype.isNull=function(line,rcube,phase){this.computeValue(line,rcube,phase);return this.valCal==null;};A_MV.prototype.getKey=function(){return"A_MV";};A_MV.prototype.setTotal=function(){for(var i=0;i<this.aggs.length;++i){if(this.aggs[i]&&this.aggs[i].setMember){this.aggs[i].setMember("OverAll");this.bCalculated=false;}}};A_MV.prototype.setExpInfo=function(iA,dnuplet){if(!this.expInfo){this.expInfo={};
}var existNup=this.expInfo[iA];if(!existNup){existNup={};this.expInfo[iA]=existNup;}existNup[dnuplet]=true;};A_MV.prototype.getExpInfo=function(iA){if(!this.expInfo){return null;}return this.expInfo[iA];};A_MV.prototype.containsOrAddExpInfo=function(iA,valDst){var expInf=valDst.getExpInfo(iA);if(!expInf){return false;}if(!this.expInfo){this.expInfo={};}var curExpInf=this.expInfo[iA];if(!curExpInf){curExpInf={};this.expInfo[iA]=curExpInf;}var contains=false;for(var nup in expInf){if(curExpInf[nup]){contains=true;}curExpInf[nup]=true;}return contains;};A_SUM=function(val){this.val=val;};A_SUM.prototype.clone=function(){return new A_SUM(this.val);};A_SUM.prototype.getVal=function(){return this.val;};A_SUM.prototype.aggVal=function(val){if(val){this.val+=val.val;}};A_SUM.prototype.aggValDbl=function(v){this.val+=v;};A_SUM.prototype.isNull=function(){return(this.getVal()==null);};A_SUM.prototype.getKey=function(){return"A_SUM";};A_AVG=function(val){if(val==null){this.val=0;this.count=0;}else{this.val=val;
this.count=1;}};A_AVG.prototype.clone=function(){var nval=new A_AVG(this.val);nval.count=this.count;return nval;};A_AVG.prototype.getVal=function(){return this.val/this.count;};A_AVG.prototype.aggVal=function(val){if(val){this.val+=val.val;this.count+=val.count;}};A_AVG.prototype.aggValDbl=function(v){this.val+=v;this.count++;};A_AVG.prototype.isNull=function(){return(this.getVal()==null);};A_AVG.prototype.getKey=function(){return"A_AVG";};A_MIN=function(val){this.val=val;};A_MIN.prototype.clone=function(){return new A_MIN(this.val);};A_MIN.prototype.getVal=function(){return this.val;};A_MIN.prototype.aggVal=function(val){if(val){if(val.val<this.val){this.val=val.val;}}};A_MIN.prototype.aggValDbl=function(v){if(this.val==null){this.val=v;}else{if(v<this.val){this.val=v;}}};A_MIN.prototype.isNull=function(){return(this.getVal()==null);};A_MIN.prototype.getKey=function(){return"A_MIN";};A_MAX=function(val){this.val=val;};A_MAX.prototype.clone=function(){return new A_MAX(this.val);};A_MAX.prototype.getVal=function(){return this.val;
};A_MAX.prototype.aggVal=function(val){if(val){if(val.val>this.val){this.val=val.val;}}};A_MAX.prototype.aggValDbl=function(v){if(this.val==null){this.val=v;}else{if(v>this.val){this.val=v;}}};A_MAX.prototype.isNull=function(){return(this.getVal()==null);};A_MAX.prototype.getKey=function(){return"A_MAX";};A_OR=function(val){this.val=val;};A_OR.prototype.clone=function(){var nval=new A_OR(this.val);return nval;};A_OR.prototype.getVal=function(){return this.val;};A_OR.prototype.aggVal=function(val){if(val){this.val|=val.val;}};A_OR.prototype.aggValDbl=function(v){this.val|=v;};A_OR.prototype.isNull=function(){return(this.getVal()==null);};A_OR.prototype.getKey=function(){return"A_OR";};A_MEDIAN=function(val){this.val=Number.NaN;this.storage=[];this.percentile=50;if(!isNaN(val)){this.storage.push(val);}};A_MEDIAN.prototype.clone=function(){return new A_MEDIAN(this.val);};A_MEDIAN.prototype.getVal=function(){if(isNaN(this.val)){var size=this.storage.length;var size_2=Math.floor(size/2);this.storage.sort(ssortnum);
if((size&1)==1){val=this.storage[size_2];}else{val=this.storage[size_2-1];val+=this.storage[size_2];val/=2;}return val;}else{return val;}};A_MEDIAN.prototype.aggVal=function(val){};A_MEDIAN.prototype.aggValDbl=function(v){this.storage.push(v);};A_MEDIAN.prototype.isNull=function(){return(this.getVal()==null);};A_MEDIAN.prototype.getKey=function(){return"A_MEDIAN";};A_DMEMBER=function(val){this.mbr=val;};A_DMEMBER.prototype.clone=function(){var dmbr=new A_DMEMBER(this.mbr);dmbr.mbr=this.mbr;return dmbr;};A_DMEMBER.prototype.getVal=function(){return this.mbr;};A_DMEMBER.prototype.aggVal=function(val){};A_DMEMBER.prototype.aggValDbl=function(v){if(v!=this.mbr){this.mbr=null;}else{this.mbr=v;}};A_DMEMBER.prototype.isNull=function(){return(this.getVal()==null);};A_DMEMBER.prototype.getKey=function(){return"A_DMEMBER";};A_DMEMBER.prototype.setMember=function(mbr){this.mbr=mbr;};A_DCOUNT=function(val){this.members=[];this.cnt=1;this.members[val]=1;};A_DCOUNT.prototype.clone=function(){var dcnt=new A_DCOUNT(this.val);
dcnt.members=this.members.slice(0);dcnt.cnt=this.cnt;return dcnt;};A_DCOUNT.prototype.getVal=function(){return this.cnt;};A_DCOUNT.prototype.aggVal=function(val){for(v in val.members){this.aggValDbl(v);}};A_DCOUNT.prototype.aggValDbl=function(v){if(!this.members[v]){this.cnt++;this.members[v]=1;}else{this.members[v]++;}};A_DCOUNT.prototype.isNull=function(){return(this.getVal()==null);};A_DCOUNT.prototype.getKey=function(){return"A_DCOUNT";};ConditionObj=function(dimid,val,agg,func){this.dimid=dimid;this.val=val;this.agg=agg;this.func=func;};A_CDCOUNT=function(val){this.members=[];this.agg=val.agg;this.members[val.dimid]=new val.agg(val.val);this.mbrs=[val.dimid];this.func=val.func;};A_CDCOUNT.prototype.clone=function(){var dcnt=new A_CDCOUNT(new ConditionObj(0,0,this.agg,this.func));dcnt.members=[];var i=0;while(i<this.mbrs.length){var idx=this.mbrs[i];dcnt.members[idx]=this.members[idx].clone();++i;}dcnt.mbrs=this.mbrs.slice(0);return dcnt;};A_CDCOUNT.prototype.getVal=function(){var cnt=0;
var i=0;while(i<this.mbrs.length){if(this.func(this.members[this.mbrs[i]].getVal())){cnt++;}++i;}return cnt;};A_CDCOUNT.prototype.aggVal=function(val){for(var v in val.members){if(!this.members[v]){this.members[v]=val.members[v].clone();this.mbrs.push(v);}else{this.members[v].aggVal(val.members[v]);}}};A_CDCOUNT.prototype.aggValDbl=function(val){if(!this.members[val.dimid]){this.members[val.dimid]=new this.agg(val.val);this.mbrs.push(val.dimid);}else{var d=val.val;if(d!=null&&!isNaN(d)){this.members[val.dimid].aggValDbl(d);}}};A_CDCOUNT.prototype.isNull=function(){return(this.getVal()==null);};A_CDCOUNT.prototype.getKey=function(){return"A_CDCOUNT";};A_RSUM=function(val){this.val=val;};A_RSUM.prototype.clone=function(){return new A_SUM(this.val);};A_RSUM.prototype.getVal=function(){return this.val;};A_RSUM.prototype.aggVal=function(val){if(val){this.val+=val.val;}};A_RSUM.prototype.aggValDbl=function(v){this.val+=v;};A_RSUM.prototype.isNull=function(){return(this.getVal()==null);};A_RSUM.prototype.getKey=function(){return"A_RSUM";
};A_ARSUM=function(val,mcube,id,nuplet){this.self=this;this.mcube=mcube;this.axisMbrId=-1;this.curSum=[];this.lastPhase=0;this.isOverall=false;this.maxId=-1;if(nuplet!=null){this.init(val,mcube,id,nuplet);}};A_ARSUM.prototype.init=function(val,mcube,id,nuplet){this.id=id;if(mcube.mapRSUM[id]){this.self=mcube.mapRSUM[id];}else{this.val={};mcube.mapRSUM[id]=this.self;}this.nupFrom=nuplet;var splitNup=nuplet.split("-");var curId=splitNup[0]-0;if(curId>this.self.maxId){this.self.maxId=curId;}this.self.val[nuplet]=val;};A_ARSUM.prototype.clone=function(){var arsum=new A_ARSUM();arsum.self=this.self;arsum.mcube=this.mcube;arsum.axisMbrId=this.axisMbrId;arsum.curSum=this.curSum;arsum.nupFrom=this.nupFrom;arsum.lastPhase=this.lastphase;arsum.maxId=this.maxId;return arsum;};A_ARSUM.prototype.getVal=function(line,rcube,phase){if(rcube.axis==null){rcube.prepareAxis(rcube.selection);}var axisId=0;while(axisId<rcube.axis.length-1){if((rcube.measureAxis==axisId)||(rcube.axis[axisId].length==0)){++axisId;
}else{break;}}if(phase==0){if(typeof line=="string"){var cols=line.split("-");line=[0];while(axisId<rcube.selection.axis.length){var axNup=buildAxisNup(rcube.selection,axisId,cols);var axVal=rcube.axisNup[axisId][axNup];if(axVal==null){line.push(0);}else{line.push(axVal.pos);}++axisId;}}var iL=0;while(iL<line.length-1){if(iL!=rcube.measureAxis){var iMbr=line[iL];if(iMbr!=null){var av=rcube.axis[iL][iMbr];if((av==null)||(av.cs==null)||(av.total)){this.isOverall=true;break;}}}++iL;}if(line==null||line.length<=axisId){this.axisMbrId=-1;}else{this.axisMbrId=line[axisId];}return NaN;}else{var splitFrom=this.nupFrom.split("-");if(this.self.lastPhase!=phase){if(splitFrom.length==1){this.self.curSum.push(0);}else{for(var i=0;i<=this.self.maxId;++i){this.self.curSum.push(0);}}this.self.lastPhase=phase;}var pos=0;if(splitFrom.length>1){pos=splitFrom[0]-0;}if(this.axisMbrId!=-1){if(this.isOverall){return this.computeOverall();}var val=this.self.val[this.nupFrom];if(val){this.self.curSum[pos]+=val;
}}return this.self.curSum[pos];}return rsum;};A_ARSUM.prototype.computeOverall=function(){var d=NaN;for(var v in this.self.val){var dr=this.self.val[v];if(dr!=null){if(isNaN(d)){d=dr;}else{d+=dr;}}}return d;};A_ARSUM.prototype.aggVal=function(val){};A_ARSUM.prototype.aggValDbl=function(v,nuplet){if(this.self.val[nuplet]){this.self.val[nuplet]+=v;}else{var splitNup=nuplet.split("-");var curId=splitNup[0]-0;if(curId>this.self.maxId){this.self.maxId=curId;}this.self.val[nuplet]=v;}};A_ARSUM.prototype.isNull=function(line,rcube,phase){return(this.self.getVal(line,rcube,phase)==null);};A_ARSUM.prototype.getKey=function(){return"A_ARSUM";};A_LAST=function(val,cube,id,nup,dm,param,l){if(param){this.agg=param.agg;this.dim=dm.objName[param.dimid];this.col=dm.columns[this.dim.idxCol].data;this.lastDate=this.dim.members[this.col[l]];this.cube=cube;this.id=id;this.nup=nup;this.dm=dm;this.param=param;this.val=new this.agg(val,cube,id,nup,dm,param);}};A_LAST.prototype.clone=function(){var clone=new A_LAST();
clone.agg=this.agg;clone.dim=this.dim;clone.col=this.col;clone.lastDate=this.lastDate;clone.val=this.val.clone();return clone;};A_LAST.prototype.getVal=function(){return this.val.getVal();};A_LAST.prototype.aggVal=function(val){if(val){if(val.lastDate>this.lastDate){this.val=new this.agg(val.getVal(),this.cube,this.id,this.nup,this.dm,this.param);this.lastDate=val.lastDate;}else{if(val.lastDate==this.lastDate){this.val.aggVal(val.val);}}}};A_LAST.prototype.aggValDbl=function(v,nup,l){var lastDate=this.dim.members[this.col[l]];if(lastDate>this.lastDate){this.val=new this.agg(v,this.cube,this.id,this.nup,this.dm,this.param);this.lastDate=lastDate;}else{if(lastDate==this.lastDate){this.val.aggValDbl(v);}}};A_LAST.prototype.isNull=function(){return this.val.isNull();};A_LAST.prototype.getKey=function(){return"A_LAST";};A_RSUM_LAST=function(val){this.val=val;};A_RSUM_LAST.prototype.aggValDbl=function(v){this.val=v;};A_RSUM_LAST.prototype.getVal=function(){return this.val;};A_SEMI=function(val,cube,id,nup,dm,param,l){if(param){this.agg=param.agg;
this.aggD=param.aggD;this.dim=dm.objName[param.dimid];this.col=dm.columns[this.dim.idxCol].data;this.cube=cube;this.id=id;this.nup=nup;this.dm=dm;this.param=param;this.keys={};this.keys[this.dim.members[this.col[l]]]=new this.agg(val,cube,id,nup,dm,param);}};A_SEMI.prototype.clone=function(){var clone=new A_SEMI();clone.agg=this.agg;clone.aggD=this.aggD;clone.dim=this.dim;clone.col=this.col;clone.cube=this.cube;clone.id=this.id;clone.nup=this.nup;clone.dm=this.dm;clone.param=this.param;clone.keys={};for(var iM in this.keys){clone.keys[iM]=this.keys[iM].clone();}return clone;};A_SEMI.prototype.getVal=function(){return this.computeValue();};A_SEMI.prototype.computeValue=function(){var fAgg=null;for(var iM in this.keys){if(fAgg==null){fAgg=new this.aggD(this.keys[iM].getVal());}else{var d=this.keys[iM].getVal();if(d!=null&&!isNaN(d)){fAgg.aggValDbl(d);}}}return fAgg.getVal();};A_SEMI.prototype.aggVal=function(val){if(val){for(var iM in val.keys){if(this.keys[iM]){this.keys[iM].aggVal(val.keys[iM]);
}else{this.keys[iM]=val.keys[iM].clone();}}}};A_SEMI.prototype.aggValDbl=function(v,nup,l){var key=this.dim.members[this.col[l]];if(this.keys[key]){this.keys[key].aggValDbl(v);}else{this.keys[key]=new this.agg(v,this.cube,this.id,nup,this.dm,this.param);}};A_SEMI.prototype.isNull=function(){return this.computeValue()==null;};A_SEMI.prototype.getKey=function(){return"A_SEMI";};function findMbrPos(cube,axisId,mbrId){if(axisId>=cube.axis.length){return -1;}var axis=cube.axis[axisId];var i=0;while(i<axis.length){if(axis[i].id==mbrId){return i;}++i;}return -1;}var __sortInfo={};var __rcube;function processAxis(iAx){var axis=__rcube.axis[iAx];var result={};var i=0;while(i<axis.length){result[i]=axis[i].pos;++i;}return result;}function compAxis(iAx,a,b){if(iAx>=__sortInfo.axisOrder.length){__sortInfo.axisOrder.push(processAxis(iAx));}var aP=__sortInfo.axisOrder[iAx][a[iAx]];var bP=__sortInfo.axisOrder[iAx][b[iAx]];if(aP<bP){return -1;}else{if(aP>bP){return 1;}}return 0;}function sortLines(a,b){var iAx=0;
axisl=__sortInfo.maxAxis;if(a.length<axisl){axisl=a.length;}while(iAx<axisl){var cmp=compAxis(iAx,a,b);if(cmp!=0){return cmp;}++iAx;}return 0;}function partitionTbl(){this.rowAxis=[];this.colAxis=[];this.idx=[];this.idxT=[];}GrpdLines=function(){this.grpLines=[];this.value=null;};function flSorterAsc(a,b){if(a.sppos==-1){if(b.sppos!=-1){return 1;}}if(a.sppos==1){if(b.sppos!=1){return -1;}}if(b.sppos==-1){return -1;}if(b.sppos==1){return 1;}if(a.value==null||isNaN(a.value)){if(b.value==null||isNaN(b.value)){return 0;}return 1;}if(b.value==null||isNaN(b.value)){return -1;}return a.value-b.value;}function flSorterDsc(a,b){if(a.sppos==-1){if(b.sppos!=-1){return 1;}}if(a.sppos==1){if(b.sppos!=1){return -1;}}if(b.sppos==-1){return -1;}if(b.sppos==1){return 1;}if(b.value==null||isNaN(b.value)){if(a.value==null||isNaN(a.value)){return 0;}return -1;}if(a.value==null||isNaN(a.value)){return 1;}return b.value-a.value;}TreeNode=function(parent,axisVal){this.parent=parent;this.axisVal=axisVal;this.childs=new Array();
};TreeNode.prototype.addChild=function(tree){this.childs.push(tree);};TreeNode.prototype.hasChild=function(){return this.childs.length>0;};TreeNode.prototype.elementAtLevel=function(curLevel,level,mapLine){if(curLevel==level){if(this.childs.length>1){var cnt=0;var i=0;while(i<this.childs.length){if(!mapLine[this.childs[i].axisVal.id]){cnt++;}++i;}if(cnt==0){cnt=1;}return cnt;}else{return this.childs.length;}}var iChild=0;var total=0;while(iChild<this.childs.length){total+=this.childs[iChild].elementAtLevel(curLevel+1,level,mapLine);++iChild;}return total;};TreeNode.prototype.computeElementAtLevel=function(level,mapLine){var mapL=mapLine;if(!mapL){mapL=[];}return this.elementAtLevel(0,level,mapL);};TreeNode.prototype.getKey=function(){if(this.parent!=null){return"-"+this.axisVal.pos+this.parent.getKey();}else{return"";}};ResultCube=function(){this.headers=Array();this.lines=Array();this.axis=Array();this.axisIds=Array();this.axisformat=Array();this.values=Array();this.format=Array();this.measureAxis=0;
this.measureStartCol=0;};ResultCube.prototype.needTotal=function(selection){if(selection.overallAxis.length>0){for(var iA=0;iA<selection.aggsForMeasure.length;++iA){if(selection.aggsForMeasure[iA]==AGG_RSM){this.totalStorage=[];break;}}}};ResultCube.prototype.getValue=function(measure,members,bFormated){var nuplet="";var iDimension=0;var format=null;for(var iAxis=0;iAxis<this.axis.length;iAxis++){if(iAxis==this.measureAxis){for(var iM=0;iM<this.axis[iAxis].length;iM++){if(this.axis[iAxis][iM].id==measure){if(iAxis!=0){nuplet+="-";}nuplet+=iM;if(bFormated){format=this.getFormat(iM);}break;}}}else{for(var iD=0;iD<this.axis[iAxis].length;iD++){var axisValue=this.axis[iAxis][iD];if(axisValue.id==members[iDimension]||axisValue.formated==members[iDimension]){if(iAxis!=0){nuplet+="-";}nuplet+=axisValue.pos;break;}}iDimension++;}}var val=this.values[nuplet];if(format!=null){val=formatNum(val,format);}return val;};ResultCube.prototype._compileRowSetQuery=function(queryAxis){var queryNupletMask=new Array();
for(var iAxis=0;iAxis<this.axis.length;iAxis++){if(iAxis!=this.measureAxis){var axisMbr=queryAxis[this.headers[iAxis]];if(typeof(axisMbr)!="undefined"){for(var iD=0;iD<this.axis[iAxis].length;iD++){var axisValue=this.axis[iAxis][iD];if(axisValue.id==axisMbr||axisValue.formated==axisMbr){queryNupletMask.push(iD);break;}}if(queryNupletMask.length<=iAxis){queryNupletMask.push(this.axis[iAxis].length);}}}while(queryNupletMask.length<=iAxis){queryNupletMask.push(-1);}}return queryNupletMask;};ResultCube.prototype._getRowSetForGeneric=function(axId,keyBefore,keyAfter,bufferRows,queryNupletMask,bFormated,rowSet){if(axId==this.measureAxis){this._getRowSetForGeneric(axId+1,keyBefore,keyAfter,bufferRows,queryNupletMask,bFormated,rowSet);}else{if(axId>=this.axis.length){var rowA=bufferRows[1];if(rowA.keep){for(var iMeasure=0;iMeasure<this.axis[this.measureAxis].length;iMeasure++){var key=keyBefore;key+="-";key+=this.axis[this.measureAxis][iMeasure].pos;key+=keyAfter;key=key.substring(1);var value=this.values[key];
rowA.values.push(value);}rowSet.push(rowA.values.slice(0,rowA.values.length));}var tmpRow=bufferRows[0];tmpRow.values.length=0;tmpRow.keep=true;bufferRows[0]=bufferRows[1];bufferRows[1]=tmpRow;}else{if(this.axis[axId].length==0){var keyB=keyBefore;var keyA=keyAfter;if(axId<this.measureAxis){keyB+="-";}else{keyA+="-";}this._getRowSetForGeneric(axId+1,keyB,keyA,bufferRows,queryNupletMask,bFormated,rowSet);}var lastCell=-1;for(var iAx=0;iAx<this.axis[axId].length;++iAx){var keyB=keyBefore;var keyA=keyAfter;if(axId<this.measureAxis){keyB+="-";keyB+=this.axis[axId][iAx].pos;}else{keyA+="-";keyA+=this.axis[axId][iAx].pos;}var rowA=bufferRows[1];var lastCellNew=rowA.values.length==0?-1:rowA.values.length;if(lastCellNew<lastCell){var rowCopy=bufferRows[0];for(var i=0;i<lastCell;++i){rowA.values[i]=rowCopy.values[i];rowA.keep=rowCopy.keep;}}lastCell=rowA.values.length==0?-1:rowA.values.length;var value=null;if(bFormated){value=this.axis[axId][iAx].formated;}else{value=this.axis[axId][iAx].id;}rowA.values[lastCell<0?0:lastCell]=value;
if(queryNupletMask[axId]>-1){rowA.keep&=(queryNupletMask[axId]==iAx);}this._getRowSetForGeneric(axId+1,keyB,keyA,bufferRows,queryNupletMask,bFormated,rowSet);}}}};ResultCube.prototype._getRowSetForTable=function(queryNupletMask,bFormated){var result=new Array();var hKey=new Object();var axisLength=this.axis.length;var i=0;var newLines=new Array();while(i<this.lines.length){var l=this.lines[i];var nl=new Array();nl.push(0);var key="";var keepNuplet=true;for(var iK=1;iK<axisLength;++iK){if(queryNupletMask[iK]>-1){if(queryNupletMask[iK]==l[iK]){keepNuplet=true;}else{keepNuplet=false;break;}}key+=l[iK]+"-";nl.push(l[iK]);}if(keepNuplet&&!hKey[key]){hKey[key]=true;newLines.push(nl);}++i;}var iLine=0;while(iLine<newLines.length){var rowA=new Array();var key=null;var iCol=1;var dupLine=newLines[iLine];var cellCount=0;while(iCol<dupLine.length&&iCol<axisLength){if(key==null){key=""+this.axis[iCol][dupLine[iCol]].pos;}else{if(dupLine[iCol]!=null){key=key+"-"+this.axis[iCol][dupLine[iCol]].pos;}else{key=key+"-";
}}if(dupLine[iCol]!=null){if(bFormated){var memberFormated=this.axis[iCol][dupLine[iCol]].formated;rowA.push(memberFormated);}else{var memberFormated=this.axis[iCol][dupLine[iCol]].id;rowA.push(memberFormated);}}else{rowA.push(null);}cellCount++;iCol++;}var iM=0;while(iM<this.axis[this.measureAxis].length){var keyf=""+this.axis[this.measureAxis][iM].pos;if(key!=null){keyf+="-"+key;}var value=this.values[keyf];rowA.push(value);iM++;cellCount++;}result.push(rowA);iLine++;}return result;};ResultCube.prototype.getRowSet=function(queryAxis,bFormated){var queryNupletMask=this._compileRowSetQuery(queryAxis);if(!this.lines){var rowSet=new Array();var bufferRows=[{values:new Array(),keep:true},{values:new Array(),keep:true}];this._getRowSetForGeneric(0,"","",bufferRows,queryNupletMask,bFormated,rowSet);return rowSet;}else{if(this.lines){return this._getRowSetForTable(queryNupletMask,bFormated);}else{throw"Not impemented for this type of chart, try on a table chart";}}};ResultCube.prototype.changeMeasureAxis=function(oldAxis,newAxis){var tmpAxis=this.axis[oldAxis];
this.axis[oldAxis]=this.axis[newAxis];this.axis[newAxis]=tmpAxis;var tmpHeader=this.headers[oldAxis];this.headers[oldAxis]=this.headers[newAxis];this.headers[newAxis]=tmpHeader;var res=[];for(p in this.values){var key=p.split("-");var tmpdim=key[oldAxis];key[oldAxis]=key[newAxis];key[newAxis]=tmpdim;var fkey=null;for(var i=0;i<key.length;i++){if(fkey==null){fkey=key[i];}else{fkey+="-"+key[i];}}if(this.values.hasOwnProperty(p)){res[fkey]=this.values[p];}}this.measureAxis=newAxis;this.values=res;};ResultCube.prototype.chop=function(axisIdx,retainNull,keepAxis,fusion){var res=[];var axis=this.axis[axisIdx];if(axisIdx!=undefined&&this.axis.length>axisIdx){if(axis.length==0&&!keepAxis){var cube=new ResultCube();var iAx=0;while(iAx<this.axis.length){if(iAx!=axisIdx){cube.headers.push(this.headers[iAx]);cube.axis.push(this.axis[iAx]);var axisIds=[];var iMbr=0;var cAxis=this.axis[iAx];while(iMbr<cAxis.length){axisIds[cAxis[iMbr].id]=cAxis[iMbr].pos;++iMbr;}}++iAx;}cube.measureAxis=this.measureAxis;
cube.format=this.format;cube.measureStartCol=this.measureStartCol-1;cube.ts=this.ts;cube.values=[];cube.linesCnt=this.recursefill(cube.values,null,null,0,axisIdx,"",retainNull,keepAxis);res.push(cube);return res;}var i=0;var cube=null;while(i<axis.length){var axisPos=axis[i].pos;if(!fusion||i==0){cube=new ResultCube();var iAx=0;while(iAx<this.axis.length){if(iAx!=axisIdx){cube.headers.push(this.headers[iAx]);cube.axis.push(this.axis[iAx]);var axisIds=[];var iMbr=0;var cAxis=this.axis[iAx];while(iMbr<cAxis.length){axisIds[cAxis[iMbr].id]=cAxis[iMbr].pos;++iMbr;}}else{if(keepAxis){cube.headers.push(this.headers[iAx]);var axisval=[];axisval.push(axis[i]);cube.axis.push(axisval);}}++iAx;}if(!keepAxis){while(cube.axis.length&&cube.axis[cube.axis.length-1].length==0){cube.axis.pop();}}cube.measureAxis=this.measureAxis;cube.format=this.format;cube.measureStartCol=this.measureStartCol-1;cube.ts=this.ts;cube.values=[];res[axisPos]=cube;}cube.linesCnt=this.recursefill(cube.values,null,null,0,axisIdx,axis[i].pos,retainNull,keepAxis);
++i;}}if(res.length==0){res.push(this);}return res;};ResultCube.prototype.recursefill=function(values,keyp1,keyp2,axisPos,ignoreAxis,ignoreVal,retainNull,keepAxis){if(ignoreAxis==axisPos){return this.recursefill(values,keyp1,keyp2,axisPos+1,ignoreAxis,ignoreVal,retainNull,keepAxis);}else{if(axisPos>=this.axis.length){var skey="";if(keyp1!=null){skey=keyp1+"-"+ignoreVal;}else{skey=ignoreVal;}if(keyp2!=null){skey+="-"+keyp2;}var fkey=keyp1;if(keepAxis){if(fkey!=null){fkey+="-";}else{fkey=""+ignoreVal;}}if(keyp2!=null){if(fkey==null){fkey=""+keyp2;}else{fkey+="-"+keyp2;}}var len=fkey.length-1;while((len>0)&&(fkey.charAt(len)=="-")){--len;}fkey=fkey.substring(0,len+1);var v=this.values[skey];if(typeof v!="undefined"){values[fkey]=v;}else{if(retainNull){values[fkey]=null;}}return 1;}else{var i=0;var nkeyp1=keyp1;var nkeyp2=keyp2;if(this.axis[axisPos].length<=0){if(axisPos<ignoreAxis){if(keyp1!=null){nkeyp1=keyp1+"-";}else{nkeyp1="";}}else{if(keyp2!=null){nkeyp2=keyp2+"-";}else{nkeyp2="-";}}return this.recursefill(values,nkeyp1,nkeyp2,axisPos+1,ignoreAxis,ignoreVal,retainNull,keepAxis);
}else{var c=0;while(i<this.axis[axisPos].length){if(axisPos<ignoreAxis){if(keyp1!=null){nkeyp1=keyp1+"-"+i;}else{nkeyp1=""+i;}}else{if(keyp2!=null){nkeyp2=keyp2+"-"+i;}else{nkeyp2=i;}}c+=this.recursefill(values,nkeyp1,nkeyp2,axisPos+1,ignoreAxis,ignoreVal,retainNull,keepAxis);++i;}return c;}}}};ResultCube.prototype.isHidden=function(axisNav){var i=0;while(i<axisNav.length){if(this.axis[i]){if(this.axis[i].length!=0){if(this.axis[i][axisNav[i]].hidden){return true;}}}++i;}return false;};ResultCube.prototype.findNonHidden=function(axisNav){return this.findCheckHidden(axisNav,true);};ResultCube.prototype.find=function(axisNav){return this.findCheckHidden(axisNav,false);};ResultCube.prototype.findCheckHidden=function(axisNav,checkHidden){var i=0;var key=null;while(i<axisNav.length){if(this.axis[i]){var keypart=null;if(this.axis[i].length!=0){if(checkHidden&&this.axis[i][axisNav[i]].hidden){return null;}keypart=this.axis[i][axisNav[i]].pos;}if(keypart==null){keypart="";}if(key==null){key=keypart;
}else{key+="-"+keypart;}}++i;}return this.values[key];};ResultCube.prototype.buildTree=function(curAx,curTree,symetric,mapLine,addToAxis){if(this.axis[curAx]&&(this.axis[curAx].length>0)){var iAx=0;while(iAx<this.axis[curAx].length){if(curAx==0){var key=this.axis[curAx][iAx].pos+curTree.getKey();if(symetric||typeof(this.values[key])!="undefined"){var tree=new TreeNode(curTree,this.axis[curAx][iAx]);curTree.addChild(tree);}}else{var axVal=this.axis[curAx][iAx];if(!axVal.hidden){if(mapLine&&(curAx==1)&&mapLine[this.axis[curAx][iAx].id]){var pos=axVal.pos;axVal=new AxisValue(iAx,"-");axVal.fake=true;axVal.pos=pos;}var tree=new TreeNode(curTree,axVal);var force=this.buildTree(curAx-1,tree,symetric,mapLine,addToAxis);if(force||symetric||tree.hasChild()){if((curTree.childs.length==1)&&curTree.childs[0].axisVal.fake){curTree.childs[0]=tree;}else{if((curTree.childs.length==0)||!axVal.fake){curTree.addChild(tree);}}}}}++iAx;}if(addToAxis&&(addToAxis.ax==curAx)){var strMbr="-";if(addToAxis.addParent&&curTree.axisVal){strMbr=curTree.axisVal.formated;
}else{if(addToAxis.mbr){strMbr=addToAxis.mbr;}}var axVal=new AxisValue(iAx,strMbr);var tree=new TreeNode(curTree,axVal);curTree.addChild(tree);}}else{if(curAx==0){var key=""+curTree.getKey();if(symetric||(this.values[key]!=null)){return true;}}}return false;};ResultCube.prototype.getAxisTree=function(symetric,mapLine,addToAxis){if(!this.axisTree){this.axisTree=new TreeNode(null,null);this.buildTree(this.axis.length-1,this.axisTree,symetric,mapLine,addToAxis);}return this.axisTree;};ResultCube.prototype.addLine=function(line){this.lines.push(line);};ResultCube.prototype.createIndex=function(noFlatten,revertAxisOrder,retainNull){if(revertAxisOrder){this.createIndexOrdered(noFlatten,revertAxisOrder,retainNull);}else{this.createIndexNoOrder(noFlatten,retainNull);}};ResultCube.prototype.createIndexOrdered=function(noFlatten,revertAxisOrder,retainNull){__rcube=this;__sortInfo={};__sortInfo.axisOrder=[];__sortInfo.maxAxis=this.axis.length;this.lines.sort(sortLines);__sortInfo={};this.createIndexNoOrder(noFlatten,retainNull);
};TotalStorage=function(line,axisId){this.line=line;this.axisId=axisId;this.axisTotal=new Array(line.length-1);this.axisTotal[axisId]=1;};TotalStorage.prototype.getKey=function(cubRes){var key="";for(var i=0;i<this.line.length-1;++i){if(i!=0){key+="-";}if(this.line[i]<cubRes.axis[i].length){key+=cubRes.axis[i][this.line[i]].pos;}}return key;};TotalStorage.prototype.getNup=function(){if(!this.nup){var len=this.line.length-1;this.nup=new NUplet(len);for(var i=0;i<len;++i){this.nup.set(i,this.line[i]);}}return this.nup;};TotalStorage.prototype.getCatchNup=function(){if(!this.catchNup){var len=this.line.length-1;this.catchNup=new NUplet(len);for(var i=0;i<len;++i){if(this.axisTotal[i]==1){this.catchNup.set(i,-1);}else{this.catchNup.set(i,this.line[i]);}}}return this.catchNup;};TotalStorage.prototype.addAxis=function(axisId){this.axisTotal[axisId]=1;};ResultCube.prototype.createIndexNoOrder=function(noFlatten,retainNull){var lineId=0;while(lineId<this.lines.length){var line=this.lines[lineId];
var key=undefined;var i=0;while(i<line.length-1){var pk="";if(line[i]!=null){pk=line[i];}if(key!=undefined){key+="-"+pk;}else{key=pk;}++i;}if(this.totalStorage){var axisTotal=new Array(line.length);var ts=null;for(var ik=0;ik<line.length-1;++ik){if(this.axis[ik]){var av=this.axis[ik][line[ik]];if(av.total){if(ts==null){ts=new TotalStorage(line,ik);this.totalStorage.push(ts);}ts.addAxis(ik);}}}}if(line[line.length-1]&&!noFlatten){var vagg=line[line.length-1];if(!vagg.isNull(line,this,0)){line[line.length-1]=line[line.length-1].getVal(line,this,1);}else{line[line.length-1]=null;}}if(retainNull||(line[line.length-1]!=null)){this.values[key]=line[line.length-1];}++lineId;}};ResultCube.prototype.evalIdx=function(){if(this.pTbl!=null){this.evalOrder(this.pTbl.colAxis,this.pTbl.rowAxis,true);}};ResultCube.prototype.evalOrder=function(axis1,axis2,invert){var ax1=axis1;var ax2=axis2;if(invert){ax1=axis2;ax2=axis1;}var phase=0;for(var i=0;i<ax1.length;++i){phase++;for(var j=0;j<ax2.length;++j){var nup="";
var line=[];var nLineAxInd=0;var iax1=i;var iax2=j;if(invert){iax1=j;iax2=i;}var part=axis1[iax1];nup=part[0];while(nLineAxInd<this.axis.length&&!this.axis[nLineAxInd].length){line[nLineAxInd++]=null;}line[nLineAxInd++]=part[0];for(var iN=1;iN<part.length;++iN){nup+="-";nup+=part[iN];while(nLineAxInd<this.axis.length&&!this.axis[nLineAxInd].length){line[nLineAxInd++]=null;}line[nLineAxInd++]=part[iN];}part=axis2[iax2];for(var iN=0;iN<part.length;++iN){nup+="-";nup+=part[iN];while(nLineAxInd<this.axis.length&&!this.axis[nLineAxInd].length){line[nLineAxInd++]=null;}line[nLineAxInd++]=part[iN];}var agg=this.pTbl.idxT[nup];if(agg!=null){this.pTbl.idx[nup]=agg.getVal(line,this,phase);}}}};ResultCube.prototype.fullMeasureSort=function(measureId,isAsc,keepTotal){if(this.lines.length<=1){return;}var arGrpLine=[];var lastM=-1;var curGrp=new GrpdLines();arGrpLine.push(curGrp);var overAll=null;if(keepTotal){overAll=new Array(this.axis.length);var hasTotal=false;for(var iAx=0;iAx<this.axis.length;++iAx){if(iAx==this.measureAxis){continue;
}var axisR=this.axis[iAx];if(axisR.length<=0){continue;}var localTotal=false;for(var iAxV=0;iAxV<axisR.length;++iAxV){if(axisR[iAxV].total){overAll[iAx]=axisR[iAxV].pos;localTotal=true;hasTotal=true;break;}}if(!localTotal){overAll[iAx]=-1;}}if(!hasTotal){keepTotal=false;}}for(var i=0;i<this.lines.length;++i){var curLine=this.lines[i];var agg=curLine[this.measureStartCol];var d=null;if(agg!=null){d=agg.getVal(curLine,this,0);}var curM=curLine[this.measureAxis];if(curM<=lastM){curGrp=new GrpdLines();arGrpLine.push(curGrp);}lastM=curM;curGrp.grpLines.push(curLine);if(curM==measureId){curGrp.value=d;if(keepTotal){for(var iEl=0;iEl<curLine.length-1;++iEl){if(iEl==this.measureAxis){continue;}var axis=this.axis[iEl];if(axis.length<=0){continue;}if(overAll[iEl]>=0&&curLine[iEl]==overAll[iEl]){curGrp.sppos=axis[overAll[iEl]].sppos;break;}}}}}if(isAsc){arGrpLine.sort(flSorterAsc);}else{arGrpLine.sort(flSorterDsc);}var nLines=[];for(var i=0;i<arGrpLine.length;++i){curGrp=arGrpLine[i];for(var j=0;j<curGrp.grpLines.length;
++j){nLines.push(curGrp.grpLines[j]);}}this.lines=nLines;};ResultCube.prototype.partition=function(iPart,retainNull,selection){var pTbl=new partitionTbl();var i=0;var hashExistRow={};var hashExistCol={};var needRSum={};var iMes=0;while(iMes<selection.aggsForMeasure.length){if(selection.aggsForMeasure[iMes]==AGG_RSM){needRSum[iMes]=true;}++iMes;}var iMeasPos=selection.measureAxis;while(i<this.lines.length){var j=0;var keyCol=null;if((this.measureStartCol>=0)&&(this.lines[i][this.measureStartCol]==null)){i++;continue;}while(j<iPart){if(this.lines[i][j]!=null){if(keyCol==null){keyCol=this.lines[i][j];}else{keyCol+="-"+this.lines[i][j];}}++j;}var keyRow=null;while(j<this.lines[i].length-1){if(keyRow==null){keyRow=this.lines[i][j];}else{keyRow+="-"+this.lines[i][j];}++j;}if(this.lines[i][j]!=undefined){var val=this.lines[i][j].getVal(this.lines[i],this,0);if(val!=null||retainNull||needRSum[this.lines[i][iMeasPos]]){if(keyCol!=null){pTbl.idxT[keyCol+"-"+keyRow]=this.lines[i][j];}else{pTbl.idxT[keyRow]=this.lines[i][j];
}if(hashExistRow[keyRow]==undefined){hashExistRow[keyRow]=true;}if(keyCol!=null&&hashExistCol[keyCol]==undefined){hashExistCol[keyCol]=true;}}}++i;}i=0;while(i<this.lines.length){var j=0;var nL=[];var keyCol=null;if((this.measureStartCol>=0)&&(this.lines[i][this.measureStartCol]==null)){i++;continue;}while(j<iPart){if(this.lines[i][j]!=null){nL.push(this.lines[i][j]);if(keyCol==null){keyCol=this.lines[i][j];}else{keyCol+="-"+this.lines[i][j];}}++j;}if(hashExistCol[keyCol]==true){pTbl.colAxis.push(nL);hashExistCol[keyCol]=false;}nL=[];var keyRow=null;while(j<this.lines[i].length-1){nL.push(this.lines[i][j]);if(keyRow==null){keyRow=this.lines[i][j];}else{keyRow+="-"+this.lines[i][j];}++j;}if(hashExistRow[keyRow]==true){pTbl.rowAxis.push(nL);hashExistRow[keyRow]=false;}++i;}this.pTbl=pTbl;};ResultCube.prototype.addMeasureFormat=function(key,format){this.format[key]=format;};ResultCube.prototype.getFormat=function(key){return this.format[key];};ResultCube.prototype.aggregateLine=function(otherLine,lineCur){var iCol=this.measureStartCol;
if(iCol>=0){while(iCol<lineCur.length){var val=lineCur[iCol];if(val!=null){if(otherLine[iCol]==null){otherLine[iCol]=val;}else{otherLine[iCol].aggVal(val);}}++iCol;}}};ResultCube.prototype.commitFilter=function(axis,filterArray,needOther,selection){var tmpLine=this.lines;this.lines=new Array();var otherLines=new Array();var otherLinesPos=new Array();var i=0;var newAxisPos=[];var newAxis=new Array();if(this.axis[axis][0].total==true){newAxisPos[0]=newAxis.length;filterArray[0]=2;var axVal=this.axis[axis][0];axVal.pos=newAxis.length;axVal.oldPos=0;newAxis.push(axVal);}mapMeasAssoc={};if(needOther){for(var idM=0;idM<selection.measuresToKeep.length;++idM){var m=selection.measuresToKeep[idM];if(m.idxCol<0){var iaM=0;while(iaM<m.assocM.length){if(m.assocM[iaM].removeExpl){var hm=new HoldAM(iaM);var itAx=0;while(itAx<selection.axis.length){var ax=selection.axis[itAx];if(ax){var itDimOnAx=0;var bRemove=true;while(itDimOnAx<ax.length){if(!m.assocM[iaM].removeExpl[ax[itDimOnAx]]){bRemove=false;}++itDimOnAx;
}if(bRemove){hm.ignoredax.push(itAx);}}++itAx;}if(mapMeasAssoc[idM]==null){mapMeasAssoc[idM]=new HoldM();}mapMeasAssoc[idM].assocM.push(hm);}iaM++;}}}}while(i<tmpLine.length){var sId=tmpLine[i][axis];if(!filterArray[sId]){if(needOther){var j=0;var nuplet="";while(j<this.measureStartCol){if(j!=axis){nuplet+=tmpLine[i][j];}++j;}var lpos=otherLinesPos[nuplet];if(lpos!=null){var valCol=this.measureStartCol;if(this.measureStartCol>0){while(valCol<otherLines[lpos].length){var lineTrans=mapMeasAssoc[tmpLine[i][selection.measureAxis]];if(otherLines[lpos][valCol]){var amv=otherLines[lpos][valCol];if(lineTrans!=null){amv.aggVal(lineTrans.convert(tmpLine[i]),true);}else{amv.aggVal(tmpLine[i][valCol],true);}}else{if(lineTrans!=null){otherLines[lpos][valCol]=lineTrans.convert(tmpLine[i]);}else{otherLines[lpos][valCol]=tmpLine[i][valCol];}}++valCol;}}}else{tmpLine[i][axis]=msg_other[getLocale()];otherLinesPos[nuplet]=otherLines.length;otherLines.push(tmpLine[i]);var lineTrans=mapMeasAssoc[tmpLine[i][selection.measureAxis]];
if(lineTrans!=null){lineTrans.convert(tmpLine[i]);}}}}else{if(filterArray[sId]==1){newAxisPos[sId]=newAxis.length;filterArray[sId]=2;var axVal=this.axis[axis][sId];axVal.pos=newAxis.length;axVal.oldPos=sId;newAxis.push(axVal);}tmpLine[i][axis]=newAxisPos[sId];this.lines.push(tmpLine[i]);}++i;}if(otherLines.length){i=0;newAxis.needOther=newAxis.length;while(i<otherLines.length){otherLines[i][axis]=newAxis.needOther;this.lines.push(otherLines[i]);++i;}}this.axis[axis]=newAxis;};ResultCube.prototype.sortAxis=function(axis,type,reverse,onCaption){if(typeof(this.axis[axis])!="undefined"){switch(type){case S_ALPHA:if(onCaption){this.axis[axis].sort(reverse?sortAlphaRCaption:sortAlphaCaption);}else{this.axis[axis].sort(reverse?sortAlphaR:sortAlpha);}break;case S_NUMERIC:this.axis[axis].sort(reverse?sortnumR:sortnum);break;case S_CUSTOM:this.axis[axis].sort(reverse?sortCustomR:sortCustom);break;}}};ResultCube.prototype.aggregateAxisR=function(m,ax,key,arMbr){if(ax>=this.axis.length){if((this.values[key]!=null)&&!isNaN(this.values[key])){m.aggValDbl(this.values[key]);
}return;}if(key==null){key="";}if(ax>0){key+="-";}if(arMbr[ax]==-1){if(this.axis[ax].length==0){this.aggregateAxisR(m,ax+1,key,arMbr);}else{for(var iMbr=0;iMbr<this.axis[ax].length;++iMbr){this.aggregateAxisR(m,ax+1,key+iMbr,arMbr);}}}else{this.aggregateAxisR(m,ax+1,key+arMbr[ax],arMbr);}};ResultCube.prototype.aggregateAxis=function(axis,measure,arMbr,forceHidden){var mapSum=new Array(this.axis[axis].length);var mAll=measure.clone();for(var iT=0;iT<this.axis[axis].length;++iT){if(!this.axis[axis][iT].hidden||forceHidden){var mt=measure.clone();var pos=this.axis[axis][iT].pos;arMbr[axis]=pos;this.aggregateAxisR(mt,0,null,arMbr);if(this.axis[axis][iT].id!="OverAll"){mAll.aggVal(mt);}mapSum[pos]=mt;}}mapSum.push(mAll);return mapSum;};Zones=function(target){this.target=target;this.zones=new Array();};Zones.prototype.getColorForVal=function(val){var color=null;var bFound=false;if(this.zones&&(val!=null)){if(val<this.zones[0].high){color=this.zones[0].color;this.type=this.zones[0].type;bFound=true;
}var iZ=1;if(!bFound){while(iZ<this.zones.length-1){if((val>=this.zones[iZ].low)&&(val<this.zones[iZ].high)){color=this.zones[iZ].color;bFound=true;this.type=this.zones[iZ].type;break;}++iZ;}}if(!bFound){if(val>=this.zones[this.zones.length-1].low){color=this.zones[this.zones.length-1].color;this.type=this.zones[this.zones.length-1].type;}}}return color;};Zone=function(low,high,color,type){this.low=low;this.high=high;this.color=color;this.type=type;};DimTarget=function(dimId,otherVal){this.dimId=dimId;this.otherVal=otherVal;this.values=new Array();};DimTarget.prototype.add=function(mPos,val){this.values[mPos]=val;};Target=function(id,globalValue,type){this.id=id;this.globalValue=globalValue;this.type=type;this.name=id;this.allocations=new Array();this.allocdims=new Array();};Target.prototype.setValOK=function(valOK){this.valOK=parseFloat(valOK);};Target.prototype.setValBad=function(valBad){this.valBad=parseFloat(valBad);};Target.prototype.setZone=function(colorGood,colorOK,valOK,colorBad,valBad,measureOK,measureBad){this.colorGood=colorGood;
this.colorOK=colorOK;this.valOKPercent=(valOK.charAt(valOK.length-1)=="%");this.valOK=parseFloat(valOK);if(measureOK!=null&&measureOK!=""&&typeof(measureOK)!="undefined"){this.measureOK=measureOK;}this.colorBad=colorBad;this.valBadPercent=(valBad.charAt(valBad.length-1)=="%");this.valBad=parseFloat(valBad);if(measureBad!=null&&measureBad!=""&&typeof(measureBad)!="undefined"){this.measureBad=measureBad;}};Target.prototype.setTimeProgress=function(initDate,finalDate,finalVal){this.initDate=initDate;this.finalDate=finalDate;this.finalVal=finalVal;};Target.prototype.setMeasureTarget=function(measureTargetName){this.measureTargetName=measureTargetName;};Target.prototype.getTargetForDate=function(dateCur){if(!this.initDate){return this.globalValue;}if((this.finalDate.getTime()-this.initDate.getTime())==0){return this.globalValue;}return this.globalValue+(dateCur.getTime()-this.initDate.getTime())*(this.finalVal-this.globalValue)/(this.finalDate.getTime()-this.initDate.getTime());};Target.prototype.getTargetAllocatedPercent=function(dm,dmsel,explIds){var multiplier=1;
var i=0;while(i<dmsel.dimsToFilter.length){var filter=dmsel.dimsToFilter[i];var dimTgt=this.allocations[filter.dim.id];if(dimTgt){if(dimTgt.otherVal==-1){var nbMembers=filter.dim.members.length;if(filter.dim.membersOnServer&&typeof(filter.dim.nbMembers)!="undefined"){nbMembers=filter.dim.nbMembers;}if(filter.fsize==0){filter.fsize=nbMembers;}multiplier*=filter.fsize/nbMembers;}else{var mulForDim=0;var includeOther=false;for(var selId in filter.ids){if(!includeOther&&(selId>=dimTgt.values.length)){mulForDim+=dimTgt.otherVal/100;}else{mulForDim+=dimTgt.values[selId]/100;}}multiplier*=mulForDim;}}++i;}if(explIds){i=0;while(i<explIds.length){if(dmsel.axis[i]){var j=0;while(j<dmsel.axis[i].length){var expl=dmsel.dimsToExplore[dmsel.axis[i][j]];var dimTgt=this.allocations[expl.dim.id];if(dimTgt){if(dimTgt.otherVal==-1){var numVal=1;if(expl.mbrCnt){numVal=expl.mbrCnt[expl.members[explIds[i]]];if(!numVal||(numVal<=0)){numVal=1;}}var nbMembers=expl.dim.members.length;if(expl.dim.membersOnServer&&typeof(expl.dim.nbMembers)!="undefined"){nbMembers=expl.dim.nbMembers;
}multiplier*=numVal/nbMembers;}else{var mulForDim=0;var includeOther=false;if(explIds[i]>=dimTgt.values.length){var nbMembers=expl.dim.members.length;if(expl.dim.membersOnServer&&typeof(expl.dim.nbMembers)!="undefined"){nbMembers=expl.dim.nbMembers;}multiplier/=nbMembers;}else{multiplier*=dimTgt.values[explIds[i]]/100;}}}++j;}}++i;}}return multiplier;};TargetBorders=function(){this.min=0;this.max=0;this.okBorder=0;this.okBorder2=0;this.badBorder=0;this.badBorder2=0;this.target=0;};TargetBorders.prototype.clone=function(zone){var nzone=new Array();for(var i=0;i<zone.length;i++){var czone=zone[i];nzone.push({min:czone.min,max:czone.max,addMin:czone.addMin,addMax:czone.addMax,measureIdMin:czone.measureIdMin,measureIdMax:czone.measureIdMax,percentMin:czone.percentMin,percentMax:czone.percentMax,color:czone.color,type:czone.type});}return nzone;};TargetBorders.prototype.calc=function(tObj,dm,dmsel,targetVal,mul,tiAx,values){this.target=targetVal;var newzones=this.clone(tObj.zones);tObj.bordermin=null;
tObj.bordermax=null;for(var i=0;i<newzones.length;i++){var curzone=newzones[i];var valMin2=this.target;var valMin=this.target;if(curzone.percentMin){if(this.target==0&&(curzone.min==Number.NEGATIVE_INFINITY||curzone.min==Number.POSITIVE_INFINITY)){if(curzone.min==Number.NEGATIVE_INFINITY){valMin=Number.NEGATIVE_INFINITY;}else{if(curzone.min==Number.POSITIVE_INFINITY){valMin=Number.POSITIVE_INFINITY;}}valMin2=valMin;}else{valMin*=(1+curzone.min/100);valMin2*=(1-curzone.min/100);}}else{if(curzone.addMin){valMin+=curzone.min;valMin2-=curzone.min;}else{if(curzone.measureIdMin&&curzone.measureIdMin!=""){valMin=tObj.setThresholdsWithMeasuresNew(curzone.measureIdMin,dmsel,tiAx,values);valMin2=-tObj.setThresholdsWithMeasuresNew(curzone.measureIdMin,dmsel,tiAx,values);}else{if(curzone.min==Number.NEGATIVE_INFINITY){valMin=Number.NEGATIVE_INFINITY;}else{if(curzone.min==Number.POSITIVE_INFINITY){valMin=Number.POSITIVE_INFINITY;}else{valMin=curzone.min;}}valMin2=-valMin;}}}valMin*=mul;curzone.min=valMin;
valMin2*=mul;if(valMin!=Number.POSITIVE_INFINITY&&valMin!=Number.NEGATIVE_INFINITY){if(!tObj.bordermin){tObj.bordermin=(valMin<valMin2)?valMin:valMin2;}if(!tObj.bordermax){tObj.bordermax=(valMin>valMin2)?valMin:valMin2;}if(valMin<tObj.bordermin){tObj.bordermin=valMin;}if(valMin2<tObj.bordermin){tObj.bordermin=valMin2;}if(valMin>tObj.bordermax){tObj.bordermax=valMin;}if(valMin2>tObj.bordermax){tObj.bordermax=valMin2;}}var valMax2=this.target;var valMax=this.target;if(curzone.percentMax){if(this.target==0&&(curzone.max==Number.NEGATIVE_INFINITY||curzone.max==Number.POSITIVE_INFINITY)){if(curzone.max==Number.NEGATIVE_INFINITY){valMax=Number.NEGATIVE_INFINITY;}else{if(curzone.max==Number.POSITIVE_INFINITY){valMax=Number.POSITIVE_INFINITY;}}valMax2=valMax;}else{valMax*=(1+curzone.max/100);valMax2*=(1-curzone.max/100);}}else{if(curzone.addMax){valMax+=curzone.max;valMax2-=curzone.max;}else{if(curzone.measureIdMax&&curzone.measureIdMax!=""){valMax=tObj.setThresholdsWithMeasuresNew(curzone.measureIdMax,dmsel,tiAx,values);
valMax2=-tObj.setThresholdsWithMeasuresNew(curzone.measureIdMax,dmsel,tiAx,values);}else{if(curzone.max==Number.NEGATIVE_INFINITY){valMax=Number.NEGATIVE_INFINITY;}else{if(curzone.max==Number.POSITIVE_INFINITY){valMax=Number.POSITIVE_INFINITY;}else{valMax=curzone.max;}}valMax2=-valMax;}}}valMax*=mul;curzone.max=valMax;valMax2*=mul;if(valMax!=Number.POSITIVE_INFINITY&&valMax!=Number.NEGATIVE_INFINITY){if(!tObj.bordermin){tObj.bordermin=(valMax<valMax2)?valMax:valMax2;}if(!tObj.bordermax){tObj.bordermax=(valMax>valMax2)?valMax:valMax2;}if(valMax<tObj.bordermin){tObj.bordermin=valMax;}if(valMax2<tObj.bordermin){tObj.bordermin=valMax2;}if(valMax>tObj.bordermax){tObj.bordermax=valMax;}if(valMax2>tObj.bordermax){tObj.bordermax=valMax2;}}}return newzones;};TargetBorders.prototype.calcOlder=function(tObj,dm,dmsel,targetVal,mul){this.target=targetVal;this.okBorder=this.target;this.okBorder2=this.target;this.badBorder=this.target;this.badBorder2=this.target;var measureIdOK=tObj.measureOK;var measureIdBad=tObj.measureBad;
if(measureIdOK!=null&&measureIdOK!=""&&typeof(measureIdOK)!="undefined"||measureIdBad!=null&&measureIdBad!=""&&typeof(measureIdBad)!="undefined"){if(!(measureIdBad!=null&&measureIdBad!=""&&typeof(measureIdBad)!="undefined")){if(tObj.valBadPercent){this.badBorder*=(1+tObj.valBad/100);this.badBorder2*=(1-tObj.valBad/100);}else{this.badBorder+=tObj.valBad;this.badBorder2-=tObj.valBad;}this.okBorder=tObj.valOK;this.okBorder2=this.badBorder;this.badBorder2=this.okBorder;}else{if(!(measureIdOK!=null&&measureIdOK!=""&&typeof(measureIdOK)!="undefined")){if(tObj.valOKPercent){this.okBorder*=(1+tObj.valOK/100);this.okBorder2*=(1-tObj.valOK/100);}else{this.okBorder+=tObj.valOK;this.okBorder2-=tObj.valOK;}this.badBorder=tObj.valBad;this.badBorder2=this.okBorder;this.okBorder2=this.badBorder;}else{this.okBorder=tObj.valOK;this.okBorder2=tObj.valBad;this.badBorder=tObj.valBad;this.badBorder2=tObj.valOK;}}}else{if(tObj.valOKPercent){this.okBorder*=(1+tObj.valOK/100);this.okBorder2*=(1-tObj.valOK/100);
}else{this.okBorder+=tObj.valOK;this.okBorder2-=tObj.valOK;}if(tObj.valBadPercent){this.badBorder*=(1+tObj.valBad/100);this.badBorder2*=(1-tObj.valBad/100);}else{this.badBorder+=tObj.valBad;this.badBorder2-=tObj.valBad;}}};Target.prototype.convertToZones=function(dm,dmsel,targetVal,explIds,tiAx,values){this.zones=[];if(this.type==0){this.zones.push({min:Number.NEGATIVE_INFINITY,max:this.valBad,color:this.colorBad});this.zones.push({min:this.valBad,max:this.valOK,color:this.colorOK});this.zones.push({min:this.valOK,max:Number.POSITIVE_INFINITY,color:this.colorGood});}else{if(this.type==1){this.zones.push({min:Number.NEGATIVE_INFINITY,max:this.valOk,color:this.colorGood});this.zones.push({min:this.valOk,max:this.valBad,color:this.colorOK});this.zones.push({min:this.valBad,max:Number.POSITIVE_INFINITY,color:this.colorBar});}}};Target.prototype.getZonesForModel=function(dm,dmsel,targetVal,explIds,tiAx,values){var bor=new TargetBorders();var tgt=targetVal;var mul=1;if((this.measureTargetName==undefined)&&(targetVal==null)){mul=this.getTargetAllocatedPercent(dm,dmsel,explIds);
var d=new Date();tgt=this.getTargetForDate(d);}if(!this.useTarget){if(this.zones==null){this.convertToZones();}var zones=new Zones(null);for(var i=0;i<this.zones.length;i++){var curzone=this.zones[i];zones.zones.push(new Zone(curzone.min,curzone.max,curzone.color,curzone.type));}var inc=(zones.zones[zones.zones.length-1].low-zones.zones[0].high)*0.1;if(inc==0){inc=zones.zones[0].high*0.1;}zones.zones[0].low=zones.zones[0].high-inc;zones.zones[zones.zones.length-1].high=zones.zones[zones.zones.length-1].low+inc;}else{var newzones=bor.calc(this,dm,dmsel,tgt,mul,tiAx,values);var zones=new Zones(bor.target);for(var i=0;i<newzones.length;i++){var curzone=newzones[i];zones.zones.push(new Zone(curzone.min,curzone.max,curzone.color,curzone.type));}var inc=(this.bordermax-this.bordermin)*0.1;if(inc==0){inc=zones.zones[0].high*0.1;}zones.zones[0].low=this.bordermin-inc;zones.zones[zones.zones.length-1].high=this.bordermax+inc;}return zones;};Target.prototype.getTargetResultForModel=function(dm,dmsel,val,targetVal,tiAx,values){var zones=this.getZonesForModel(dm,dmsel,targetVal,1,tiAx,values);
var tcolor=zones.getColorForVal(val);return zones.type;};Target.prototype.allocate=function(dimTgt){this.allocations[dimTgt.dimId]=dimTgt;this.allocdims.push(dimTgt.dimId);};if(!Array.isArray){Array.isArray=function(obj){return Object.prototype.toString.call(obj)==="[object Array]";};}Target.prototype.getTargetColorForVal=function(dm,dmsel,values,tiAx,val,tgtPos){var targetColor=null;var tVal=null;var axisIds=[];if(this.measureTargetName){if(!Array.isArray(tiAx)){tVal=tiAx;}else{if(tiAx[0]!=null&&tiAx[0]=="NaN"){var tgtMPos=null;for(var iM=0;iM<dmsel.measuresToKeep.length;iM++){if(dmsel.measuresToKeep[iM].id==this.measureTargetName){tgtMPos=values.axis[dmsel.measureAxis][iM].pos;break;}}tkeyf=tgtMPos;tVal=values.values[tkeyf];}else{var tgtMPos=null;axisIds=null;if(tgtPos!=undefined){tgtMPos=tgtPos;}else{for(var iM=0;iM<dmsel.measuresToKeep.length;iM++){if(dmsel.measuresToKeep[iM].id==this.measureTargetName){tgtMPos=values.axis[dmsel.measureAxis][iM].pos;break;}}}var tkeyf="";var key="";
for(var i=0;i<tiAx.length;i++){if(tiAx[i]!=null&&values.axis[i]&&values.axis[i].length!=0){if(dmsel.measureAxis==i){key=tgtMPos;}else{key=values.axis[i][tiAx[i]].pos;}if(i==0){tkeyf=key;}else{tkeyf+="-"+key;}}}tVal=values.values[tkeyf];}}}else{for(var i=0;i<tiAx.length;i++){if(tiAx[i]!=null&&values.axis[i]&&values.axis[i].length!=0){axisIds[i]=values.axis[i][tiAx[i]].pos;}}}var zones=null;zones=this.getZonesForModel(dm,dmsel,tVal,axisIds,tiAx,values);targetColor=zones.getColorForVal(val);this.zoneVal=(typeof(tVal)!="undefined")?zones.target:null;return targetColor;};Target.prototype.setThresholdsWithMeasuresNew=function(targetName,dmsel,tiAx,values){return this.getMeasureVal(targetName,values,tiAx,dmsel);};Target.prototype.getMeasureVal=function(measureName,values,tiAx,dmsel){var measPos=null;for(var iMeasure=0;iMeasure<dmsel.measuresToKeep.length;iMeasure++){if(dmsel.measuresToKeep[iMeasure].id==measureName){measPos=values.axis[dmsel.measureAxis][iMeasure].pos;break;}}var measKeyf="";var measKey="";
for(var i=0;i<tiAx.length;i++){if(tiAx[i]!=null&&values.axis[i]&&values.axis[i].length!=0){if(dmsel.measureAxis==i){measKey=measPos;}else{measKey=values.axis[i][tiAx[i]].pos;}if(i==0){measKeyf=measKey;}else{measKeyf+="-"+measKey;}}}return values.values[measKeyf];};Measure=function(idxCol,id,agg,format,name){this.idxCol=idxCol;this.id=id;this.agg=agg;this.targets={};this.format=format;if(name){this.name=name;}else{this.name=id;}this.hidden=false;};Measure.prototype.toJSON=function(){return this.id;};Measure.prototype.addTarget=function(name,tgt){this.targets[name]=tgt;};MeasureDim=function(id,assocDim){this.idxCol=-1;this.id=id;this.name=id;this.agg=-1;this.assocM=[assocDim];this.formula=function(m,line,rcube,phase){return m[0].getVal(line,rcube,phase);};};MeasureDim.prototype=new Measure;var HIERARCHY_NORMAL=0;var HIERARCHY_EXPLICIT_CONTINUOUS=1;var HIERARCHY_FORMULA=2;var HIERARCHY_DIMENSION=3;var HIERARCHY_EXTERNAL=4;DimHierarchy=function(id){this.id=id;this.name=id;this.levels=new Array();
};LevelGroupPrep=function(){this.groups=new Array();this.groupsByName={};};DimLevel=function(depth,id,groupformula,format,fMin,fMax){this.id=id;this.name=id;this.depth=depth;this.groupformula=groupformula;this.groups=new Array();this.groupsByName={};this.format=format;this.fMin=fMin;this.fMax=fMax;this.prepared=false;this.consecgroup=false;this.prepGrp={};};DimLevel.prototype.prepare=function(dim,transf){var doPrepare=(this.prepared==false);var prepGrp=null;if(transf){if(this.prepared==false){this.prepare(dim);}doPrepare=(this.prepGrp[transf]==null);if(doPrepare){prepGrp=new LevelGroupPrep();this.prepGrp[transf]=prepGrp;for(var i=0;i<this.groups.length;++i){var grpName=this.groups[i].id;var grp=new DimGroup(grpName,[]);prepGrp.groups.push(grp);prepGrp.groupsByName[grpName]=grp;}}}if(doPrepare){if(this.groupformula){var fEval;if(this.groupformula.indexOf("return")>-1){fEval="__c = function() {}; __c.prototype.run = function(t) { "+this.groupformula+"; }; new __c()";}else{fEval="__c = function() {}; __c.prototype.run = function(t) { return "+this.groupformula+"; }; new __c()";
}var func=eval(fEval);if(transf||!dim.order||dim.members.length<=INCOPTIMORDER||!this.consecgroup){for(var i=0;i<dim.members.length;i++){if(dim.members[i]==null){g=this.groupsByName._;if(g==undefined){g=new DimGroup("",[i]);this.groupsByName._=g;this.groups.push(g);}else{g.members.push(i);}continue;}var mbr=dim.members[i];var g=undefined;if(transf){mbr=transf(mbr);var val=func.run(mbr);var prepGrp=this.prepGrp[transf];g=prepGrp.groupsByName[val];if(g==undefined){continue;}else{g.members.push(i);}}else{var val=func.run(mbr);g=this.groupsByName[val];if(g==undefined){g=new DimGroup(val,[i]);this.groupsByName[val]=g;this.groups.push(g);}else{g.members.push(i);}}}}else{var prevGrp=null;var prevI=0;var bNewG=true;var i=0;var tblCal=[];while(i<dim.members.length){if(dim.members[i]==null){i++;continue;}var val=tblCal[i];if(val==undefined){val=func.run(dim.members[i]);}var g=this.groupsByName[val];if(g==undefined){if(prevGrp!=null){tblCal[i]=val;var lastI=i;i=prevI;for(;i<=lastI;i++){val=tblCal[i];
if(val==undefined){val=func.run(dim.members[i]);}g=this.groupsByName[val];if(g!=undefined&&g==prevGrp){prevGrp.members.push(i);bNewG=false;}else{if(g==undefined){g=new DimGroup(val,[i]);this.groupsByName[val]=g;this.groups.push(g);bNewG=true;break;}else{g.members.push(i);bNewG=false;}}}if(i==lastI+1){i--;}}else{g=new DimGroup(val,[i]);this.groupsByName[val]=g;this.groups.push(g);bNewG=true;}}else{if(g==prevGrp){for(var j=prevI;j<=i;j++){g.members.push(j);}bNewG=false;}else{g.members.push(i);bNewG=false;}}prevGrp=g;prevI=i+(bNewG?1:0);if((i+INCOPTIMORDER)>=dim.members.length){++i;}else{i+=INCOPTIMORDER;}}}}else{if(dim.continuous){for(var iGrp=0;iGrp<this.groups.length;iGrp++){var group=this.groups[iGrp];group.members=new Array();for(var iMbr=0;iMbr<dim.members.length;iMbr++){var member=dim.members[iMbr];if(member>=group.minfval&&member<group.maxfval){group.members.push(member);}}}}}this.prepared=true;}};DimLevel.prototype.createGroupMap=function(){this.groupByMember=new Array();var i=0;while(i<this.groups.length){this.groupByMember[this.groups[i].name]=i;
++i;}};DimLevel.prototype.createGroupMapId=function(){this.groupByMemberId=new Array();var i=0;while(i<this.groups.length){this.groupByMemberId[this.groups[i].id]=i;++i;}};DimLevel.prototype.getMemberPosByName=function(mName){if(!this.groupByMember){this.createGroupMap();}return this.groupByMember[mName];};DimLevel.prototype.getMemberPosById=function(mId){if(!this.groupByMemberId){this.createGroupMapId();}return this.groupByMemberId[mId];};DimLevel.prototype.getGroupForValue=function(value){for(var iG=0;iG<this.groups.length;++iG){if(this.groups[iG].isValueIn(value)){return iG;}}return 0;};DimLevel.prototype.getGroupIdForMemberId=function(mbrId){for(var iG=0;iG<this.groups.length;++iG){if(this.groups[iG].isIdIn(mbrId)){return iG;}}return 0;};DimLevel.prototype.getGroupForMemberId=function(mbrId){for(var iG=0;iG<this.groups.length;++iG){if(this.groups[iG].isIdIn(mbrId)){return this.groups[iG];}}return null;};DimLevel.prototype.evalGroupFormula=function(t){var grp;if(this.groupformula.indexOf("return")>-1){var fEval="__c = function() {}; __c.prototype.run = function(t) { "+this.groupformula+"; }; new __c()";
var func=eval(fEval);grp=func.run(t);}else{grp=eval(this.groupformula);}return grp;};DimGroup=function(id,members,caption){this.id=id;this.name=id;this.members=members;this.caption=caption;};DimGroup.prototype.isIdIn=function(mid){for(var i=0;i<this.members.length;++i){if(this.members[i]==mid){return true;}}return false;};DimGroupContinuous=function(id,minf,maxf){this.continuous=true;this.id=id;this.name=id;this.minf=minf;this.maxf=maxf;if(this.minf==""){this.minfval=Number.MIN_VALUE;}else{this.minfval=eval(minf);}if(this.maxf==""){this.maxfval=Number.MAX_VALUE;}else{this.maxfval=eval(maxf);}this.members=new Array();};DimGroupContinuous.prototype.isValueIn=function(val){if((val>=this.minfval)&&(val<this.maxfval)){return true;}return false;};Dimension=function(idxCol,id,name){this.idxCol=idxCol;this.id=id;if(name){this.name=name;}else{this.name=id;}this.members=new Array();this.hierarchies=new Array();this.format=null;this.navigable=true;this.continuous=false;this.order=true;this.prev=null;
};Dimension.prototype.toJSON=function(){return this.id;};Dimension.prototype.addMember=function(name){if(this.continuous){if(this.order&&this.prev!=null&&name<this.prev){this.order=false;}this.prev=name;}this.members.push(name);};Dimension.prototype.addMembers=function(mbrs){this.prev=null;this.members=this.members.concat(mbrs);};Dimension.prototype.sortContinuousMembers=function(){if(this.continuous){var tzv=0;this.order=true;for(var iMbr=0;iMbr<this.members.length;iMbr++){if(tzv){this.members[iMbr]=this.members[iMbr]+tzv;}if(this.order){if(this.prev!=null&&this.members[iMbr]<this.prev){this.order=false;if(!tzv){break;}}this.prev=this.members[iMbr];}}}};Dimension.prototype.addCaptions=function(caps){if(this.captions==null){this.captions=caps;}else{this.captions=this.captions.concat(caps);}};Dimension.prototype.getMemberPosById=function(mId){for(var i=0;i<this.members.length;++i){if(this.members[i]==mId){return i;}}return -1;};Dimension.prototype.setFormat=function(format){this.format=format;
};Dimension.prototype.addHierarchy=function(h){h.dim=this;this.hierarchies.push(h);};Dimension.prototype.addSort=function(type,reverse){this.sort=null;this.sortType=type;this.sortReverse=reverse;switch(type){case S_ALPHA:if(reverse){this.sort=ssortAlphaR;}else{this.sort=ssortAlpha;}break;case S_NUMERIC:if(reverse){this.sort=ssortnumR;}else{this.sort=ssortnum;}break;}};Dimension.prototype.getHierarchyLevelPos=function(hierarchyId,levelId){var hPos=-1;var lPos=-1;if(hierarchyId!=null){for(var iH=0;iH<this.hierarchies.length;iH++){if(this.hierarchies[iH].id==hierarchyId){hPos=iH;if(levelId!=null&&levelId!="root"){for(var iL=0;iL<this.hierarchies[iH].levels.length;iL++){if(this.hierarchies[iH].levels[iL].id==levelId){lPos=iL;return[hPos,lPos];}}}}}}return[hPos,lPos];};Column=function(){this.data=new Array();};Column.prototype.getColArray=function(){return this.data;};Array_merge=function(aSrc,aDst){var prepared=[];var iTbl=aSrc;if(aSrc.length>aDst.length){iTbl=aDst;aDst=aSrc;}var oTbl=[];for(var iT=0;
iT<iTbl.length;++iT){prepared[iTbl[iT]]=true;oTbl.push(iTbl[iT]);}for(var iT=0;iT<aDst.length;++iT){if(!prepared[aDst[iT]]){oTbl.push(aDst[iT]);}}return oTbl;};DimExplorer=function(dim,hPos,lPos,enabled,format,transf){this.dim=dim;this.enabled=enabled;if(hPos==null){hPos=-1;}if(lPos==null){lPos=-1;}this.hPos=hPos;this.lPos=lPos;this.complexGroup=false;this.format=format;this.transf=transf;this.prepare();};DimExplorer.prototype.toJSON=function(){return{dim:this.dim,enabled:this.enabled,hPos:this.hPos,lPos:this.lPos,format:this.getFormat()};};DimExplorer.prototype.getFormat=function(){if(this.hPos<0){if(this.format){return this.format;}else{return this.dim.format;}}else{if(this.lPos<0){if(this.format){return this.format;}else{return this.dim.format;}}else{var level=this.hierarchy.levels[this.lPos];return level.format;}}};DimExplorer.prototype.prepare=function(){this.valid=true;if((this.hPos<0)||(this.lPos<0)){this.members=this.dim.members;this.captions=this.dim.captions;if(this.format==null){this.format=this.dim.format;
}}else{this.hierarchy=this.dim.hierarchies[this.hPos];this.members=new Array();this.captions=new Array();this.mbrs2GrpMbrs={};var mbrs2GrpMbrsTest={};var lvl=this.hierarchy.levels[this.lPos];if(lvl==null){this.valid=false;return;}lvl.prepare(this.dim,this.transf);var i=0;this.mbrCnt={};var grps=lvl.groups;if(this.transf){grps=lvl.prepGrp[this.transf].groups;}while(i<grps.length){var grp=grps[i];this.members.push(grp.id);this.captions.push(grp.caption);if(grp.continuous){this.hierarchy.continuousGroup=true;}else{var tmembers;if(this.dim.continuous&&lvl.groupformula){tmembers=grp.members;}else{tmembers=this.getIdsForGroup(i);}this.mbrCnt[grp.id]=tmembers.length;var j=0;while(j<tmembers.length){var member=tmembers[j];var member2Groups=this.mbrs2GrpMbrs[member];if(member2Groups==null){member2Groups=new Array();mbrs2GrpMbrsTest[member]={};this.mbrs2GrpMbrs[member]=member2Groups;}if(!mbrs2GrpMbrsTest[member][i]){mbrs2GrpMbrsTest[member][i]=true;member2Groups.push(i);if(member2Groups.length>1){this.complexGroup=true;
}}++j;}}++i;}}};DimExplorer.prototype.getIdsForGroup=function(id){var iLevelDepth=this.lPos;var groupMembers=this.hierarchy.levels[this.lPos].groups[id].members;while(iLevelDepth>0){--iLevelDepth;var level=this.hierarchy.levels[iLevelDepth];var tmembers=new Array();var i=0;while(i<groupMembers.length){tmembers=Array_merge(level.groups[groupMembers[i]].members,tmembers);++i;}groupMembers=tmembers;}return groupMembers;};DimExplorer.prototype.useHierarchy=function(){if((this.hPos>=0)&&(this.lPos>=0)){return true;}return false;};ValueSorter=function(sortAxis,sortMeasure,sortFunc,sortMeasureName){this.sortAxis=sortAxis;this.sortMeasure=sortMeasure;this.sortMeasureName=sortMeasureName;this.sortFunc=sortFunc;this.valSortArray=new Array();this.elemPos=new Array();};ValueSorter.prototype.toJSON=function(){return{sortAxis:this.sortAxis,sortMeasure:this.sortMeasureName,reverse:this.sortFunc==sortCubeTop};};ValueSorter.prototype.init=function(){this.valSortArray=new Array();this.elemPos=new Array();
};ValueSorter.prototype.addElement=function(line,val){if(this.sortAxis>line.length){return;}var elem=line[this.sortAxis];var pos=this.elemPos["_"+elem];if(pos==null){pos=this.valSortArray.length;this.elemPos["_"+elem]=pos;this.valSortArray.push(new CubeStore(elem,val));}else{if(this.valSortArray[pos].val==null){this.valSortArray[pos].setVal(val);}else{this.valSortArray[pos].val.aggVal(val);}}};ValueSorter.prototype.filter=function(arrayFilter,axisMapping){var arr=new Array();for(var iE=0;iE<arrayFilter.length;++iE){var id=arrayFilter[iE].name;var curPos=id;if(id>=this.valSortArray.length){curPos=this.valSortArray.length-1;}var mbr=this.valSortArray[curPos];while(mbr.name>id){curPos--;if(curPos<0){break;}mbr=this.valSortArray[curPos];}if(mbr.name==id){arr.push(new CubeStore(axisMapping[id],mbr.val));}else{arr.push(new CubeStore(axisMapping[id],null));}}this.valSortArray=arr;};ValueSorter.prototype.reorderAxis=function(cubres){var axis=cubres.axis[this.sortAxis];var newAxis=new Array();var iAx=0;
while(iAx<this.valSortArray.length){if(axis[this.valSortArray[iAx].name]!=undefined){newAxis.push(axis[this.valSortArray[iAx].name]);}++iAx;}if(axis.needOther){newAxis.needOther=axis.needOther;}cubres.axis[this.sortAxis]=newAxis;};ValueFilter=function(filterAxis,filterMeasure,funcName,maxFilter,needOther,filterMeasureName){this.filterAxis=filterAxis;this.filterMeasure=filterMeasure;this.filterMeasureName=filterMeasureName;this.maxFilterVal=maxFilter;this.needOther=needOther;this.funcName=funcName;this.filterFunc=funcNameArray[funcName];this.valFilterArray=new Array();this.elemPos=new Array();};ValueFilter.prototype.toJSON=function(){return{filterAxis:this.filterAxis,filterMeasure:this.filterMeasureName,maxFilterVal:this.maxFilterVal,needOther:this.needOther,funcName:this.funcName};};ValueFilter.prototype.init=function(){this.valFilterArray=new Array();this.elemPos=new Array();};ValueFilter.prototype.addElement=function(line,val){var elem=line[this.filterAxis];var pos=this.elemPos["_"+elem];
if(pos==null){pos=this.valFilterArray.length;this.elemPos["_"+elem]=pos;this.valFilterArray.push(new CubeStore(elem,val));}else{if(this.valFilterArray[pos].val==null){this.valFilterArray[pos].setVal(val);}else{this.valFilterArray[pos].val.aggVal(val);}}};FilterRule=function(sName){this.name=sName;this.filters=new Array();this.dimList=new Array();this.dimsToFilterSize=0;};FilterRule.prototype.addFilter=function(filter){this.filters.push(filter);this.dimList.push(filter.dim.id);this.dimsToFilterSize=this.filters.length;};FilterRule.prototype.updateSize=function(){this.dimsToFilterSize=this.filters.length;};FilterRule.prototype.isOut=function(dm,i){if(this.dimsToFilterSize==0){return false;}var iF=0;var bfiltered=true;while(iF<this.dimsToFilterSize){var fsel=this.filters[iF];if(!fsel.isOut(dm.columns[fsel.dim.idxCol].data[i])){bfiltered=false;break;}++iF;}return bfiltered;};FilterRule.prototype.replaceFilter=function(newFilter){for(var i=0;i<this.filters.length;i++){if(newFilter.dim.id==this.filters[i].dim.id){this.filters[i]=newFilter;
return true;}}return false;};FilterRule.prototype.clone=function(){var newFR=new FilterRule(this.name);for(var i=0;i<this.filters.length;i++){var filter=this.filters[i].clone();newFR.addFilter(filter);}return newFR;};FilterRule.prototype.toJSON=function(){return{name:this.name,filters:this.filters,dimList:this.dimList};};DataModelSelection=function(){this.axis=[];this.measureAxis=0;this.dimsToExplore=[];this.dimsToFilter=[];this.filterByDimName=[];this.filterRules=[];this.measuresToKeep=[];this.measuresToKeepHidden=[];this.measuresToKeepHiddenLabel=[];this.targetsForMeasure=[];this.aggsForMeasure=[];this.paramForMeasure=[];this.fmtsForMeasure=[];this.complexGroup=false;this.updated=true;this.valueFilters=[];this.valueFiltersPerMeasure=[];this.valueSorters=[];this.valueSortersPerMeasure=[];this.axisSort=[];this.sortOrder=[];this.availableDim=[];this.dimensionsToExcludeForDisplay=[];this.dimensionsToExcludeForNavigation=[];this.overallAxis=[];this.axisMemberSeparators=[];this.forceAxisList=[];
this.forceCrossAxisList=[];this.deleteOverAllChilds=true;this.pivot=-1;this.retainNull=false;this.fullMeasureSort=-1;this.fullMeasureSortReverse=false;this.fullMeasureSortPreserveTotal=false;this.fullMeasureFilter=-1;this.fullMeasureFilterType=-1;this.fullMeasureFilterTopBottomValue=1;this.fullMeasureFilterTopBottomShowOthers=false;this.fullMeasureFilterRangeMinValue="";this.fullMeasureFilterRangeMaxValue="";this.drillPaths=[];this.imageKey=null;this.transformFilters=[];this.chartMeasures=[];this.dimsToDisplayFilter=[];};DataModelSelection.prototype.clear=function(){DataModelSelection.apply(this);};DataModelSelection.prototype.copyTo=function(dmsel2){for(var iAxis in this.axis){if(this.axis[iAxis]!=null){dmsel2.axis[iAxis]=[];for(var m=0;m<this.axis[iAxis].length;++m){dmsel2.axis[iAxis].push(this.axis[iAxis][m]);}}else{dmsel2.axis[iAxis]=this.axis[iAxis];}}dmsel2.measureAxis=this.measureAxis;for(var iDex=0;iDex<this.dimsToExplore.length;++iDex){var oDex=this.dimsToExplore[iDex];var dimEx=new DimExplorer(oDex.dim,oDex.hPos,oDex.lPos,oDex.enabled,oDex.format);
dmsel2.dimsToExplore[iDex]=dimEx;}for(var iDtf=0;iDtf<this.dimsToFilter.length;++iDtf){var oFilter=this.dimsToFilter[iDtf];var oFilterClone=oFilter.clone();dmsel2.dimsToFilter[iDtf]=oFilterClone;dmsel2.filterByDimName[oFilter.dim.id]=oFilterClone;}for(var iFr=0;iFr<this.filterRules.length;++iFr){var fRule=this.filterRules[iFr];var nFRule=new FilterRule(fRule.name);for(var iDtf=0;iDtf<this.fRule.filters.length;++iDtf){var oFilter=this.fRule.filters[iDtf];var oFilterClone=oFilter.clone();nFRule.filters[iDtf]=oFilterClone;}dmsel2.filterRules[iFr]=nFRule;}dmsel2.measuresToKeep=arrayClone(this.measuresToKeep);dmsel2.measuresToKeepHidden=arrayClone(this.measuresToKeepHidden);dmsel2.measuresToKeepHiddenLabel=arrayClone(this.measuresToKeepHiddenLabel);dmsel2.targetsForMeasure=arrayClone(this.targetsForMeasure);dmsel2.aggsForMeasure=arrayClone(this.aggsForMeasure);dmsel2.fmtsForMeasure=arrayClone(this.fmtsForMeasure);dmsel2.chartMeasures=arrayClone(this.chartMeasures);dmsel2.complexGroup=this.complexGroup;
dmsel2.updated=this.updated;for(var i=0;i<this.axisSort.length;i++){var as=this.axisSort[i];var asClone=new AxisSort(as.axisId,as.type,as.reverse,as.measure,as.measureName,as.onCaption);dmsel2.addAxisSort(asClone);}for(var i=0;i<this.valueSorters.length;i++){var vs=this.valueSorters[i];var asClone=new AxisSort(vs.sortAxis,S_MEASURE,(vs.sortFunc==sortCubeTop)?true:false,vs.sortMeasure,vs.sortMeasureName,false);dmsel2.addAxisSort(asClone);}for(var i=0;i<this.valueFilters.length;i++){var vf=this.valueFilters[i];var vfClone=new ValueFilter(vf.filterAxis,vf.filterMeasure,vf.funcName,vf.maxFilterVal,vf.needOther,vf.filterMeasureName);dmsel2.addValueFilter(vfClone);}for(var i=0;i<this.overallAxis.length;i++){var overall=this.overallAxis[i];if(overall){dmsel2.addOverall(i,overall.pos,overall.txt,overall.agg);}}dmsel2.sortOrder=arrayClone(this.sortOrder);dmsel2.availableDim=objectClone(this.availableDim);dmsel2.dimensionsToExcludeForDisplay=objectClone(this.dimensionsToExcludeForDisplay);dmsel2.dimensionsToExcludeForNavigation=objectClone(this.dimensionsToExcludeForNavigation);
dmsel2.axisMemberSeparators=arrayClone(this.axisMemberSeparators);dmsel2.forceAxisList=arrayClone(this.forceAxisList);dmsel2.forceCrossAxisList=arrayClone(this.forceCrossAxisList);dmsel2.deleteOverAllChilds=this.deleteOverAllChilds;dmsel2.pivot=this.pivot;dmsel2.retainNull=this.retainNull;dmsel2.fullMeasureSort=this.fullMeasureSort;dmsel2.fullMeasureSortReverse=this.fullMeasureSortReverse;dmsel2.fullMeasureSortPreserveTotal=this.fullMeasureSortPreserveTotal;dmsel2.drillPaths=arrayClone(this.drillPaths);dmsel2.imageKey=this.imageKey;for(var iDtf=0;iDtf<this.transformFilters.length;++iDtf){var oFilter=this.transformFilters[iDtf];var oFilterClone=oFilter.clone();dmsel2.transformFilters[iDtf]=oFilterClone;}};DataModelSelection.prototype.copy=function(){var dmsel2=new DataModelSelection();this.copyTo(dmsel2);return dmsel2;};function arrayClone(array){var ret=[];for(var i=0;i<array.length;i++){ret[i]=array[i];}return ret;}function objectClone(map){var ret;if(map.length!=undefined){ret={};}else{ret=[];
}for(var i in map){ret[i]=map[i];}return ret;}DataModelSelection.prototype.specificClone=function(){var obj=new DataModelSelection();for(var i in this){if(i=="dimsToExplore"){for(var iDex=0;iDex<this.dimsToExplore.length;++iDex){var oDex=this.dimsToExplore[iDex];var dimEx=new DimExplorer(oDex.dim,oDex.hPos,oDex.lPos,oDex.enabled,oDex.format);obj.dimsToExplore[iDex]=dimEx;}}else{if(i=="filterRules"){for(var iFr=0;iFr<this.filterRules.length;++iFr){var fRule=this.filterRules[iFr];var nFRule=new FilterRule(fRule.name);for(var iDtf=0;iDtf<this.fRule.filters.length;++iDtf){var oFilter=fRule.filters[iDtf];var oFilterClone=oFilter.clone();nFRule.filters[iDtf]=oFilterClone;}obj.filterRules[iFr]=nFRule;}}else{if(i=="dimsToFilter"){for(var iDtf=0;iDtf<this.dimsToFilter.length;++iDtf){var oFilter=this.dimsToFilter[iDtf];var oFilterClone=oFilter.clone();obj.dimsToFilter[iDtf]=oFilterClone;obj.filterByDimName[oFilter.dim.id]=oFilterClone;}}else{if(i=="transformFilters"){for(var iDtf=0;iDtf<this.transformFilters.length;
++iDtf){var oFilter=this.transformFilters[iDtf];var oFilterClone=oFilter.clone();obj.transformFilters[iDtf]=oFilterClone;}}else{if(i=="filterByDimName"){}else{if(i=="axis"){for(var iAxis in this.axis){if(this.axis[iAxis]!=null){obj.axis[iAxis]=[];for(var m=0;m<this.axis[iAxis].length;++m){obj.axis[iAxis].push(this.axis[iAxis][m]);}}else{obj.axis[iAxis]=this.axis[iAxis];}}}else{if(i=="overallAxis"){for(var key in this.overallAxis){obj.overallAxis[key]=this.overallAxis[key];}}else{obj[i]=this[i];}}}}}}}}return obj;};DataModelSelection.prototype.importAxisParameters=function(srcDmsel,srcAxId,dstAxId){for(var i=0;i<srcDmsel.axisSort.length;i++){if(srcDmsel.axisSort[i].axisId==srcAxId){var as=srcDmsel.axisSort[i];var asClone=new AxisSort(dstAxId,as.type,as.reverse,as.measure,as.measureName,as.onCaption);this.addAxisSort(asClone);}}for(var i=0;i<srcDmsel.valueSorters.length;i++){if(srcDmsel.valueSorters[i].sortAxis==srcAxId){var vs=srcDmsel.valueSorters[i];var asClone=new AxisSort(dstAxId,S_MEASURE,(vs.sortFunc==sortCubeTop)?true:false,vs.sortMeasure,vs.sortMeasureName,false);
this.addAxisSort(asClone);}}for(var i=0;i<srcDmsel.valueFilters.length;i++){if(srcDmsel.valueFilters[i].filterAxis==srcAxId){var vf=srcDmsel.valueFilters[i];var vfClone=new ValueFilter(dstAxId,vf.filterMeasure,vf.funcName,vf.maxFilterVal,vf.needOther,vf.filterMeasureName);this.addValueFilter(vfClone);}}var overall=srcDmsel.overallAxis[srcAxId];if(overall){this.addOverall(dstAxId,overall.pos,overall.txt,overall.agg);}this.setAxisMemberSeparator(dstAxId,srcDmsel.axisMemberSeparators[srcAxId]);};DataModelSelection.prototype.findMeasure=function(mName){if(this.dm.objName[mName]){return this.dm.objName[mName];}for(var i=0;i<this.measuresToKeep.length;i++){if(this.measuresToKeep[i].id==mName){return this.measuresToKeep[i];}}for(var i=0;this.chartMeasures&&i<this.chartMeasures.length;i++){if(this.chartMeasures[i].id==mName){return this.chartMeasures[i];}}return null;};DataModelSelection.prototype.isComplex=function(){for(var i=0;i<this.dimsToExplore.length;++i){var dimEx=this.dimsToExplore[i];
if(dimEx.complexGroup){return true;}}if(this.fks&&this.fks.complex){return true;}return this.complexGroup;};DataModelSelectionFromJSON=function(sJSON,dm){var obj=sJSON;obj.__proto__=DataModelSelection.prototype;var ref=new DataModelSelection();ref.attachedDM(dm);for(var key in ref){if(obj[key]==null||obj[key]==undefined){obj[key]=ref[key];}}for(var i=0;i<obj.dimsToExplore.length;i++){obj.dimsToExplore[i].__proto__=DimExplorer.prototype;obj.dimsToExplore[i].dim=dm.objName[obj.dimsToExplore[i].dim];if(obj.dimsToExplore[i].format!=null){if(!dm.formatList[obj.dimsToExplore[i].format.id]){dm.addFormatRepoToDM();}if(dm.formatList[obj.dimsToExplore[i].format.id]){obj.dimsToExplore[i].format=dm.formatList[obj.dimsToExplore[i].format.id];obj.dimsToExplore[i].format.__proto__=Format.prototype;}else{obj.dimsToExplore[i].format=null;}}obj.dimsToExplore[i].prepare();}obj.filterByDimName=new Array();for(var i=0;i<obj.dimsToFilter.length;i++){if(typeof(obj.dimsToFilter[i].min)!="undefined"){obj.dimsToFilter[i].__proto__=FilterSelectionContinuous.prototype;
}else{if(typeof(obj.dimsToFilter[i].grps)!="undefined"){obj.dimsToFilter[i].__proto__=FilterSelectionMultiContinuous.prototype;}else{obj.dimsToFilter[i].__proto__=FilterSelection.prototype;}}obj.dimsToFilter[i].dim=dm.objName[obj.dimsToFilter[i].dim];obj.filterByDimName[obj.dimsToFilter[i].dim.id]=obj.dimsToFilter[i];}if(obj.filterRules){for(var i=0;i<obj.filterRules.length;i++){obj.filterRules[i].__proto__=FilterRule.prototype;}}for(var i=0;typeof(obj.chartMeasures)!="undefined"&&i<obj.chartMeasures.length;i++){var objChartMeas=obj.chartMeasures[i];objChartMeas.mustExpand=true;}var chartMeasures=null;if(typeof(obj.chartMeasures)!="undefined"){chartMeasures=obj.chartMeasures;}for(var i=0;i<obj.measuresToKeep.length;i++){var measure=dm.objName[obj.measuresToKeep[i]];if(!measure&&chartMeasures){for(var j=0;j<chartMeasures.length;j++){if(chartMeasures[j].id==obj.measuresToKeep[i]){if(chartMeasures[j].mustExpand){measure=null;}else{measure=chartMeasures[j];}if(chartMeasures[j].format&&!dm.formatList[chartMeasures[j].format.id]){dm.addFormatRepoToDM();
}break;}}}if(measure){obj.measuresToKeep[i]=measure;}if(obj.fmtsForMeasure[i]&&!dm.formatList[obj.fmtsForMeasure[i].id]){dm.addFormatRepoToDM();}}obj.expandChartMeasures(dm);var measuresToKeepPos={};for(var i=0;i<obj.measuresToKeep.length;i++){measuresToKeepPos[obj.measuresToKeep[i].id]=i;}obj.valueFiltersPerMeasure=new Array();for(var i=0;i<obj.valueFilters.length;i++){obj.valueFilters[i].__proto__=ValueFilter.prototype;obj.valueFilters[i].filterFunc=funcNameArray[obj.valueFilters[i].funcName];var filterMeasureName=obj.valueFilters[i].filterMeasure;var measurePos=measuresToKeepPos[filterMeasureName];var measure=obj.measuresToKeep[measurePos];obj.valueFilters[i].filterMeasure=measure.idxCol;obj.valueFilters[i].filterMeasureName=measure.id;if(!obj.valueFiltersPerMeasure[obj.valueFilters[i].filterMeasure]){obj.valueFiltersPerMeasure[obj.valueFilters[i].filterMeasure]=new Array();}obj.valueFiltersPerMeasure[obj.valueFilters[i].filterMeasure].push(obj.valueFilters[i]);}for(var i=0;i<obj.axisSort.length;
i++){var axSort=obj.axisSort[i];axSort.__proto__=AxisSort.prototype;}obj.valueSorters=new Array();for(var i=0;i<obj.sortOrder.length;i++){var axSort=obj.sortOrder[i];axSort.__proto__=AxisSort.prototype;if(axSort.type==S_MEASURE){var vs=new ValueSorter(axSort.axisId,axSort.measure,axSort.reverse?sortCubeTop:sortCubeBottom,axSort.measureName);axSort.vs=vs;obj.addValueSorter(vs);}}for(var i=0;i<obj.valueFilters.length;i++){obj.updateValueSorters(obj.valueFilters[i]);}for(var i=0;i<obj.valueSorters.length;i++){obj.updateValueFilters(obj.valueSorters[i]);}for(var i=0;i<obj.fmtsForMeasure.length;i++){if(obj.fmtsForMeasure[i]!=null){var formatId=obj.fmtsForMeasure[i].id;var format=dm.formatList[formatId];obj.fmtsForMeasure[i]=format;}}for(var i=0;obj.ddVars&&i<obj.ddVars.length;i++){var key=obj.ddVars[i].name;if(typeof(dm.variables[key])=="undefined"||dm.variables[key]==null){dm.variables[key]=new DDVariable();if(typeof(__v[key])=="undefined"||__v[key]==null){__v[key]=dm.variables[key];}}if(typeof(dm.variables[key])!="function"){for(var j in obj.ddVars[i]){dm.variables[key][j]=obj.ddVars[i][j];
}}}return obj;};DataModelSelection.prototype.expandChartMeasures=function(dm){if(!this.chartMeasures){return;}var chartMeasuresById={};for(var j=0;j<this.chartMeasures.length;j++){if(this.chartMeasures[j].mustExpand){var measure=this.expandDerivedCalculation(this.chartMeasures[j].id,this.chartMeasures[j].formula,dm.formatList[this.chartMeasures[j].format.id],this.chartMeasures,this.chartMeasures[j].assocM);if(measure){this.chartMeasures[j]=measure;}}chartMeasuresById[this.chartMeasures[j].id]=this.chartMeasures[j];}for(var i=0;i<this.measuresToKeep.length;i++){var measId=typeof(this.measuresToKeep[i])=="string"?this.measuresToKeep[i]:this.measuresToKeep[i].id;if(chartMeasuresById[measId]){this.measuresToKeep[i]=chartMeasuresById[measId];}}};DataModelSelection.prototype.getFilterRulesByName=function(ruleName){for(var i=0;i<this.filterRules.length;i++){if(this.filterRules[i].name==ruleName){return this.filterRules[i];}}return null;};DataModelSelection.prototype.toJSON=function(){var ddVars=new Array();
for(key in this.dm.variables){if(this.dm.variables[key]!=null&&typeof(this.dm.variables[key])!="function"){ddVars.push(this.dm.variables[key]);}}var dimsToFilterForJSON=this.prepareFilterRules();var chartMeasures=[];for(var i=0;i<this.chartMeasures.length;i++){chartMeasures.push(new ChartMeasureForJSON(this.chartMeasures[i]));}return{axis:this.axis,complexGroup:this.complexGroup,measureAxis:this.measureAxis,dimsToExplore:this.dimsToExplore,dimsToFilter:dimsToFilterForJSON,measuresToKeep:this.measuresToKeep,targetsForMeasure:this.targetsForMeasure,aggsForMeasure:this.aggsForMeasure,fmtsForMeasure:this.fmtsForMeasure,valueFilters:this.valueFilters,valueSorters:this.valueSorters,axisSort:this.axisSort,sortOrder:this.sortOrder,ddVars:ddVars,pivot:this.pivot,overallAxis:this.overallAxis,axisMemberSeparators:this.axisMemberSeparators,retainNull:this.retainNull,hasOverall:this.hasOverall,fullMeasureSort:this.fullMeasureSort,fullMeasureSortReverse:this.fullMeasureSortReverse,fullMeasureSortPreserveTotal:this.fullMeasureSortPreserveTotal,measuresToKeepHidden:this.measuresToKeepHidden,measuresToKeepHiddenLabel:this.measuresToKeepHiddenLabel,flatCube:this.flatCube,pageCube:this.pageCube,pageStartRow:this.pageStartRow,pageSize:this.pageSize,realLineCount:this.realLineCount,imageKey:this.imageKey,forceAxisList:this.forceAxisList,forceCrossAxisList:this.forceCrossAxisList,filterRules:this.filterRules,chartMeasures:chartMeasures,fullMeasureFilter:this.fullMeasureFilter,fullMeasureFilterType:this.fullMeasureFilterType,fullMeasureFilterTopBottomValue:this.fullMeasureFilterTopBottomValue,fullMeasureFilterTopShowOthers:this.fullMeasureFilterTopShowOthers,fullMeasureFilterRangeMinValue:this.fullMeasureFilterRangeMinValue,fullMeasureFilterRangeMaxValue:this.fullMeasureFilterRangeMaxValue,dimsToDisplayFilter:this.dimsToDisplayFilter};
};DataModelSelection.prototype.prepareFilterRules=function(){var dimsToFilterForJSON=new Array();for(var i=0;i<this.dimsToFilter.length;i++){var filter=this.dimsToFilter[i];var bHasTransformer=false;for(var iF=0;iF<this.transformFilters.length;iF++){var tFilter=this.transformFilters[iF];if(filter.dim.id==tFilter.dim.id){tFilter.selection=this;var f=tFilter.clone();f.minFormula=null;f.maxFormula=null;dimsToFilterForJSON.push(f);bHasTransformer=true;break;}}if(!bHasTransformer){var filterJSON=filter.clone();if(filterJSON.evalMinMax){filterJSON.evalMinMax();}dimsToFilterForJSON.push(filterJSON);}}for(var i=0;i<this.filterRules.length;i++){this.filterRules[i].filters=new Array();var dimList=this.filterRules[i].dimList;for(var j=0;j<dimList.length;j++){var dimId=dimList[j];for(var k=0;k<dimsToFilterForJSON.length;k++){if(dimsToFilterForJSON[k].dim.id==dimId){this.filterRules[i].filters.push(dimsToFilterForJSON[k]);dimsToFilterForJSON.splice(k,1);k--;break;}}}this.filterRules[i].updateSize();
}return dimsToFilterForJSON;};var funcNameArray=new Array();funcNameArray.top=sortCubeTop;funcNameArray.bottom=sortCubeBottom;funcNameArray.range=isInRange;DataModelSelection.prototype.addValueFilter=function(valFilter){this.valueFilters.push(valFilter);if(!this.valueFiltersPerMeasure[valFilter.filterMeasure]){this.valueFiltersPerMeasure[valFilter.filterMeasure]=new Array();}this.updateValueSorters(valFilter);this.valueFiltersPerMeasure[valFilter.filterMeasure].push(valFilter);};DataModelSelection.prototype.updateValueFilters=function(valSorter){for(var iF=0;iF<this.valueFilters.length;++iF){var filter=this.valueFilters[iF];if(filter.filterAxis==valSorter.sortAxis){if(filter.filterMeasure==valSorter.sortMeasure){valSorter.linked=filter;}else{filter.looseLink=valSorter;}}}};DataModelSelection.prototype.addValueSorter=function(valSorter){this.valueSorters.push(valSorter);if(!this.valueSortersPerMeasure[valSorter.sortMeasure]){this.valueSortersPerMeasure[valSorter.sortMeasure]=new Array();
}this.updateValueFilters(valSorter);this.valueSortersPerMeasure[valSorter.sortMeasure].push(valSorter);};DataModelSelection.prototype.updateValueSorters=function(valFilter){for(var iS=0;iS<this.valueSorters.length;++iS){var sorter=this.valueSorters[iS];if(sorter.sortAxis==valFilter.filterAxis){if(sorter.sortMeasure==valFilter.filterMeasure){sorter.linked=valFilter;}else{valFilter.looseLink=sorter;}}}};DataModelSelection.prototype.removeValueSorterForAxis=function(axisId){for(var i=0;i<this.valueSorters.length;++i){if(this.valueSorters[i].sortAxis==axisId){var vsA=this.valueSorters.splice(i,1);if(!vsA||vsA.length<1){break;}var vs=vsA[0];var sts=this.valueSortersPerMeasure[vs.sortMeasure];if(sts&&(sts.length>0)){for(var j=0;j<sts.length;++j){if(sts[j].sortAxis==axisId){if(sts.length==1){delete this.valueSortersPerMeasure[vs.sortMeasure];}else{sts.splice(j,1);}break;}}}break;}}for(var iF=0;iF<this.valueFilters.length;++iF){var filter=this.valueFilters[iF];if(filter.filterAxis==axisId){if(filter.looseLink){delete filter.looseLink;
}}}};DataModelSelection.prototype.removeValueFilterForAxis=function(axisId){for(var i=0;i<this.valueFilters.length;++i){if(this.valueFilters[i].filterAxis==axisId){var vfA=this.valueFilters.splice(i,1);if(!vfA||vfA.length<1){break;}var vf=vfA[0];var fts=this.valueFiltersPerMeasure[vf.filterMeasure];if(fts&&(fts.length>0)){for(var j=0;j<fts.length;++j){if(fts[j].filterAxis==axisId){if(fts.length==1){delete this.valueFiltersPerMeasure[vf.filterMeasure];}else{fts.splice(j,1);}break;}}}break;}}for(var iS=0;iS<this.valueSorters.length;++iS){var sorter=this.valueSorters[iS];if(sorter.sortAxis==axisId){if(sorter.linked){delete sorter.linked;}}}};DataModelSelection.prototype.attachedDM=function(dm){this.dm=dm;this.availableDim=dm.dimensionsId2Pos;this.refreshed();};DataModelSelection.prototype.isUpdated=function(){return this.updated;};DataModelSelection.prototype.refreshed=function(){this.updated=false;};DataModelSelection.prototype.addFilter=function(filter){filter.mode=UNION_MODE;this.dimsToFilter.push(filter);
};DataModelSelection.prototype.setFilter=function(filter){if(this.availableDim[filter.dim.id]==null||filter.mode==UNION_MODE){return false;}this.updated=true;var existFilter=this.filterByDimName[filter.dim.id];if(existFilter!=null){this.filterByDimName[filter.dim.id]=filter;for(var i=0;i<this.dimsToFilter.length;i++){if(this.dimsToFilter[i].dim.id==filter.dim.id){this.dimsToFilter[i]=filter;}}}else{this.filterByDimName[filter.dim.id]=filter;this.dimsToFilter.push(filter);}return true;};DataModelSelection.prototype.setOrFilter=function(rule,filter){if(this.availableDim[filter.dim.id]==null){return false;}this.updated=true;var fRule=this.getFilterRulesByName(rule);if(fRule==null){fRule=new FilterRule(rule);this.filterRules.push(fRule);}fRule.addFilter(filter);return true;};DataModelSelection.prototype.getFilterByDimension=function(dim){if(this.availableDim[dim.id]==null){return null;}return this.filterByDimName[dim.id];};DataModelSelection.prototype.removeFilterByDimension=function(dim){if(this.availableDim[dim.id]==null){return false;
}var existFilter=this.filterByDimName[dim.id];if(existFilter!=null){this.updated=true;this.filterByDimName[dim.id]=null;var i=0;while(i<this.dimsToFilter.length){if(this.dimsToFilter[i].dim==dim){this.dimsToFilter.splice(i,1);return true;}++i;}}return false;};DataModelSelection.prototype.addTransformFilter=function(filter){this.transformFilters.push(filter);};DataModelSelection.prototype.setMeasureAxis=function(axis){this.measureAxis=axis;};DataModelSelection.prototype.addBrowse=function(axis,dim,hierarchy,level,format){var dimEx=new DimExplorer(dim,hierarchy,level,true,format);if(!this.axis[axis]){this.axis[axis]=new Array();if(typeof(this.axisMemberSeparators[axis])=="undefined"){this.setAxisMemberSeparator(axis,"-");}}this.axis[axis].push(this.dimsToExplore.length);this.dimsToExplore.push(dimEx);if(dimEx.complexGroup){this.complexGroup=true;}};DataModelSelection.prototype.addMeasure=function(measure,target,agg,fmt,hidden,hiddenLabel){var bHidden=false;if(typeof(hidden)!="undefined"){bHidden=hidden;
}this.measuresToKeep.push(measure);this.measuresToKeepHidden.push(bHidden);if(typeof(hiddenLabel)!="undefined"){this.measuresToKeepHiddenLabel.push(hiddenLabel);}else{this.measuresToKeepHiddenLabel.push(false);}this.targetsForMeasure.push(target);if(typeof agg=="number"){if(agg==-1){this.aggsForMeasure.push(-1);}else{if(agg>0){this.aggsForMeasure.push(agg-1);}else{this.aggsForMeasure.push(measure.agg);}}}else{if(typeof agg=="function"){this.aggsForMeasure.push(agg);}else{this.aggsForMeasure.push(measure.agg);}}this.fmtsForMeasure.push(fmt);};DataModelSelection.prototype.addMeasureWithParam=function(measure,assocM){this.addMeasure(measure,null,assocM.agg);this.paramForMeasure.push(assocM.param);};DataModelSelection.prototype.setMeasure=function(measureIndex,measure,target,agg,fmt,hidden,hiddenLabel){var bHidden=false;if(typeof(hidden)!="undefined"){bHidden=hidden;}if(measureIndex<0||measureIndex>this.measuresToKeep.length){measureIndex=this.measuresToKeep.length;}this.measuresToKeep[measureIndex]=measure;
this.measuresToKeepHidden[measureIndex]=bHidden;if(typeof(hiddenLabel)!="undefined"){this.measuresToKeepHiddenLabel[measureIndex]=hiddenLabel;}else{this.measuresToKeepHiddenLabel[measureIndex]=false;}this.targetsForMeasure[measureIndex]=target;if(typeof agg=="number"){if(agg==-1){this.aggsForMeasure[measureIndex]=-1;}else{if(agg>0){this.aggsForMeasure[measureIndex]=agg-1;}else{this.aggsForMeasure[measureIndex]=measure.agg;}}}else{if(typeof agg=="function"){this.aggsForMeasure[measureIndex]=agg;}else{this.aggsForMeasure[measureIndex]=measure.agg;}}this.fmtsForMeasure[measureIndex]=fmt;};DataModelSelection.prototype.getMeasureFormat=function(pos){var fmt=this.fmtsForMeasure[pos];if(!fmt&&this.measuresToKeep[pos]){fmt=this.measuresToKeep[pos].format;}return fmt;};DataModelSelection.prototype.removeAxisSort=function(axSort){var i=0;var j=0;while(i<this.sortOrder.length){if(this.sortOrder[i]!==axSort){this.sortOrder[j++]=this.sortOrder[i];}i++;}this.sortOrder.length=j;if(axSort.type==S_MEASURE){this.removeValueSorterForAxis(axSort.vs.sortAxis);
}else{i=0;j=0;while(i<this.axisSort.length){if(this.axisSort[i]!==axSort){this.axisSort[j++]=this.axisSort[i];}i++;}this.axisSort.length=j;}};DataModelSelection.prototype.getAxisSortByAxisId=function(axId){for(var i=0;i<this.sortOrder.length;i++){if(this.sortOrder[i].axisId==axId){return this.sortOrder[i];}}return null;};DataModelSelection.prototype.addAxisSort=function(axSort){this.sortOrder.push(axSort);if(axSort.type==S_MEASURE){var vs=new ValueSorter(axSort.axisId,axSort.measure,axSort.reverse?sortCubeTop:sortCubeBottom,axSort.measureName);this.addValueSorter(vs);axSort.vs=vs;}else{this.axisSort.push(axSort);}};DataModelSelection.prototype.sortAxisSorts=function(){var sortF=function(as1,as2){return as1.axisId-as2.axisId;};this.sortOrder.sort(sortF);this.axisSort.sort(sortF);};DataModelSelection.prototype.prepare=function(){for(var iM=0;iM<this.measuresToKeep.length;++iM){var meas=this.measuresToKeep[iM];if(meas.idxCol<0){for(var aM=0;aM<meas.assocM.length;++aM){if(meas.assocM[aM].prepare){meas.assocM[aM].prepare(this);
}}}}this.expandAgg();};DataModelSelection.prototype.prepareFilters=function(){for(var iM=0;iM<this.measuresToKeep.length;++iM){var meas=this.measuresToKeep[iM];if(meas.idxCol<0){for(var aM=0;aM<meas.assocM.length;++aM){meas.assocM[aM].prepareFilters(this);}}}for(var iF=0;iF<this.dimsToFilter.length;iF++){var filter=this.dimsToFilter[iF];filter.evaluate(this);}};OverAllAxis=function(axis,pos,txt,agg){this.axis=axis;this.pos=pos;this.txt=txt;this.agg=agg;};OverAllAxis.prototype.getTxt=function(){if(this.txt&&this.txt.length>0){return this.txt;}else{return getLocMessage("OverAll");}};DataModelSelection.prototype.addOverall=function(axis,pos,txt,agg){if(pos==null||typeof(pos)=="undefined"){this.overallAxis[axis]=new OverAllAxis(axis,-1,"",-1);}else{this.overallAxis[axis]=new OverAllAxis(axis,pos,txt,agg);}this.hasOverall=true;};DataModelSelection.prototype.removeOverall=function(axis){this.overallAxis[axis]=null;for(var i=0;i<this.overallAxis.length;i++){if(this.overallAxis[i]){this.hasOverall=true;
return;}}this.hasOverall=false;};DataModelSelection.prototype.getOverall=function(axis){return this.overallAxis[axis];};DataModelSelection.prototype.setAxisMemberSeparator=function(axis,sep){this.axisMemberSeparators[axis]=sep;};DataModelSelection.prototype.forceCrossAxisMembers=function(mbrs){this.forceCrossAxisList.push(mbrs);};DataModelSelection.prototype.forceCrossAllMemberList=function(axis,mbList1){this.forceAxisList[axis]=mbList1;};DataModelSelection.prototype.hasAxisOverall=function(axis){return(this.overallAxis[axis]!=null);};DataModelSelection.prototype.switchAxisProp=function(axis1,axis2){this.switchAxisSort(axis1,axis2);this.switchOverAll(axis1,axis2);};DataModelSelection.prototype.switchAxisSort=function(axis1,axis2){for(var i=0;i<this.axisSort.length;i++){if(this.axisSort[i].axisId==axis1){this.axisSort[i].axisId=axis2;}else{if(this.axisSort[i].axisId==axis2){this.axisSort[i].axisId=axis1;}}}for(var i=0;i<this.valueSorters.length;i++){if(this.valueSorters[i].sortAxis==axis1){this.valueSorters[i].sortAxis=axis2;
}else{if(this.valueSorters[i].sortAxis==axis2){this.valueSorters[i].sortAxis=axis1;}}}};DataModelSelection.prototype.switchOverAll=function(axis1,axis2){var overAllAxis1=this.overallAxis[axis1];var overAllAxis2=this.overallAxis[axis2];var newOverAllAxis1=null;var newOverAllAxis2=null;if(overAllAxis2!=null){newOverAllAxis1=new OverAllAxis(overAllAxis2.axis,overAllAxis2.pos,overAllAxis2.txt,overAllAxis2.agg);}if(newOverAllAxis2!=null){newOverAllAxis2=new OverAllAxis(overAllAxis1.axis,overAllAxis1.pos,overAllAxis1.txt,overAllAxis1.agg);}this.overallAxis[axis1]=newOverAllAxis1;this.overallAxis[axis2]=newOverAllAxis2;};DataModelSelection.prototype.getDimExplorerByDimId=function(dimId){for(var iN=0;iN<this.dimsToExplore.length;++iN){var dimEx=this.dimsToExplore[iN];if(dimEx.dim.id==dimId){return dimEx;}}return null;};function aggIntToFunc(agg){if(agg==AGG_SUM){return A_SUM;}else{if(agg==AGG_AVG){return A_AVG;}else{if(agg==AGG_MIN){return A_MIN;}else{if(agg==AGG_MAX){return A_MAX;}else{if(agg==AGG_RSM){return A_RSUM;
}else{if(agg==AGG_ARSUM){return A_ARSUM;}else{if(agg==AGG_OR){return A_OR;}else{if(agg==AGG_MEDIAN){return A_MEDIAN;}else{if(agg==AGG_DCOUNT){return A_DCOUNT;}else{if(agg==AGG_DMEMBER){return A_DMEMBER;}else{if(typeof agg=="function"){return agg;}else{return A_SUM;}}}}}}}}}}}}function aggFuncToInt(func){if(func==A_SUM){return AGG_SUM;}else{if(func==A_AVG){return AGG_AVG;}else{if(func==A_MIN){return AGG_MIN;}else{if(func==A_MAX){return AGG_MAX;}else{if(func==A_RSUM){return AGG_RSM;}else{if(func==A_ARSUM){return AGG_ARSUM;}else{if(func==A_OR){return AGG_OR;}else{if(func==A_MEDIAN){return AGG_MEDIAN;}else{if(func==A_DCOUNT){return AGG_DCOUNT;}else{if(func==A_DMEMBER){return AGG_DMEMBER;}else{return NO_AGG;}}}}}}}}}}}DataModelSelection.prototype.expandAgg=function(){var i=0;this.expAggsForMeasure=[];while(i<this.aggsForMeasure.length){var agg=this.aggsForMeasure[i];this.expAggsForMeasure[i]=aggIntToFunc(agg);++i;}};DataModelSelection.prototype.replaceDimExplorer=function(axis,newDimEx){if(this.axis[axis]&&this.axis[axis][0]!==undefined){var i=this.axis[axis][0];
this.dimsToExplore[i].dim=newDimEx.dim;this.dimsToExplore[i].hPos=newDimEx.hPos;this.dimsToExplore[i].lPos=newDimEx.lPos;this.dimsToExplore[i].enabled=newDimEx.enabled;this.dimsToExplore[i].format=newDimEx.format;this.dimsToExplore[i].prepare();this.updated=true;}};DataModelSelection.prototype.replaceDimExplorerSimple=function(oldDimEx,newDimEx){for(var i=0;i<this.dimsToExplore.length;i++){if(this.dimsToExplore[i].dim.name==oldDimEx.dim.name){this.dimsToExplore[i].dim=newDimEx.dim;this.dimsToExplore[i].hPos=newDimEx.hPos;this.dimsToExplore[i].lPos=newDimEx.lPos;this.dimsToExplore[i].enabled=newDimEx.enabled;this.dimsToExplore[i].format=newDimEx.format;this.dimsToExplore[i].prepare();this.updated=true;}}};DataModelSelection.prototype.addDrillPath=function(axisId,drillPath){this.drillPaths[axisId]=drillPath;};DataModelSelection.prototype.clearAllAxisParameters=function(){this.axisSort.length=0;this.valueSorters.length=0;this.valueFilters.length=0;this.valueSortersPerMeasure.length=0;this.valueFiltersPerMeasure.length=0;
this.sortOrder.length=0;this.dimsToExplore.length=0;this.axis.length=0;this.overallAxis.length=0;this.hasOverall=false;};DataModelSelection.prototype.getLastAxisId=function(){return Math.max(this.axis.length-1,this.measureAxis);};DataModelSelection.prototype.removeAxis=function(axis){var dmselClone=this.copy();this.clearAllAxisParameters();var iDst=0;var countAx=Math.max(dmselClone.getLastAxisId(),axis)+1;for(var iSrc=0;iSrc<countAx;iSrc++){if(iSrc==dmselClone.pivot){iDst=iSrc;}if(iSrc==axis){continue;}this.importAxis(dmselClone,iSrc,iDst);iDst++;}return true;};DataModelSelection.prototype.removeBrowse=function(axis,dimIndex,removeEmptyAxis){var dmselClone=this.copy();this.clearAllAxisParameters();var iDst=0;var countAx=Math.max(dmselClone.getLastAxisId(),axis)+1;for(var iSrc=0;iSrc<countAx;iSrc++){if(iSrc==dmselClone.pivot){iDst=iSrc;}if(iSrc==axis){var keepAxis=(removeEmptyAxis?false:true);for(var j=0;dmselClone.axis[iSrc]&&j<dmselClone.axis[iSrc].length;j++){if(j!=dimIndex){keepAxis=true;
var dimEx=dmselClone.dimsToExplore[dmselClone.axis[iSrc][j]];if(dimEx){this.addBrowse(axis,dimEx.dim,dimEx.hPos,dimEx.lPos,dimEx.format);}}}if(!keepAxis){continue;}else{this.importAxisParameters(dmselClone,iSrc,iDst);}}else{this.importAxis(dmselClone,iSrc,iDst);}iDst++;}return true;};DataModelSelection.prototype.insertBrowse=function(axis,dim,hPos,lPos,format,dimIndex){var dmselClone=this.copy();this.clearAllAxisParameters();var iDst=0;var countAx=Math.max(dmselClone.getLastAxisId(),axis)+1;for(var iSrc=0;iSrc<countAx;iSrc++){if(iSrc==dmselClone.pivot){iDst=iSrc;}if(iSrc==axis){var bAdded=false;for(var j=0;dmselClone.axis[iSrc]&&j<dmselClone.axis[iSrc].length;j++){if(j==dimIndex){this.addBrowse(axis,dim,hPos,lPos,format);bAdded=true;}var dimEx=dmselClone.dimsToExplore[dmselClone.axis[iSrc][j]];if(dimEx){this.addBrowse(axis,dimEx.dim,dimEx.hPos,dimEx.lPos,dimEx.format);}}if(!bAdded){this.addBrowse(axis,dim,hPos,lPos,format);}this.importAxisParameters(dmselClone,iSrc,iDst);}else{this.importAxis(dmselClone,iSrc,iDst);
}iDst++;}return true;};DataModelSelection.prototype.moveAxis=function(srcAxisId,dstAxisId,copyFlag){if(srcAxisId==dstAxisId){return false;}var dmselClone=this.copy();this.clearAllAxisParameters();var iDst=0;var countAx=Math.max(dmselClone.getLastAxisId(),Math.max(srcAxisId,dstAxisId))+1;for(var iSrc=0;iSrc<=countAx;iSrc++){if(iSrc==dmselClone.pivot){iDst=iSrc;}if(!copyFlag&&iSrc==srcAxisId){continue;}if(iDst==dstAxisId){this.importAxis(dmselClone,srcAxisId,dstAxisId);iDst++;}if(iSrc<=dmselClone.getLastAxisId()){this.importAxis(dmselClone,iSrc,iDst);iDst++;}}return true;};DataModelSelection.prototype.insertNewAxis=function(axis,dim,hierarchy,level,format){var dmselClone=this.copy();this.clearAllAxisParameters();var iDst=0;var countAx=Math.max(dmselClone.getLastAxisId(),axis)+1;for(var iSrc=0;iSrc<=countAx+1;iSrc++){if(iSrc==dmselClone.pivot){iDst=iSrc;}if(iSrc==axis){this.addBrowse(iDst,dim,hierarchy,level,format);iDst++;}this.importAxis(dmselClone,iSrc,iDst);iDst++;}return true;};DataModelSelection.prototype.overwriteAxis=function(axis,dim,hierarchy,level,format,keepAxisParameters){var dmselClone=this.copy();
this.clearAllAxisParameters();var iDst=0;var countAx=Math.max(dmselClone.getLastAxisId(),axis)+1;var keepAxisParams=(keepAxisParameters?true:false);for(var iSrc=0;iSrc<=countAx+1;iSrc++){if(iSrc==dmselClone.pivot){iDst=iSrc;}if(iSrc==axis){this.addBrowse(axis,dim,hierarchy,level,format);if(keepAxisParams){this.importAxisParameters(dmselClone,iSrc,iDst);}}else{this.importAxis(dmselClone,iSrc,iDst);}iDst++;}return true;};DataModelSelection.prototype.remapAxisNewPivot=function(newPivot){if(this.pivot>0&&this.pivot!=newPivot){var oldPivot=this.pivot;var pivotShift=newPivot-oldPivot;var dmselClone=this.copy();this.clearAllAxisParameters();this.pivot=newPivot;if(this.measureAxis>=oldPivot){this.measureAxis+=pivotShift;}else{if(this.measureAxis>=newPivot){this.measureAxis=newPivot-1;}else{if(this.measureAxis>=newPivot*2){this.measureAxis=newPivot*2-1;}}}for(var i=0;i<Math.min(oldPivot,newPivot);i++){this.importAxis(dmselClone,i,i);}for(var i=oldPivot;i<=dmselClone.getLastAxisId();i++){this.importAxis(dmselClone,i,i+pivotShift);
}return true;}return false;};DataModelSelection.prototype.insertMeasure=function(index,measure,agg,fmt){if(index<0){return false;}arrayInsertItem(this.measuresToKeep,index,measure);arrayInsertItem(this.measuresToKeepHidden,index,false);arrayInsertItem(this.measuresToKeepHiddenLabel,index,false);arrayInsertItem(this.targetsForMeasure,index,null);var realAgg=agg;if(typeof agg=="number"){if(agg==-1){realAgg=agg;}else{if(agg>0){realAgg=agg-1;}else{realAgg=measure.agg;}}}else{if(typeof agg=="function"){realAgg=agg;}else{realAgg=measure.agg;}}arrayInsertItem(this.aggsForMeasure,index,realAgg);arrayInsertItem(this.fmtsForMeasure,index,fmt);return true;};DataModelSelection.prototype.moveMeasure=function(fromIndex,toIndex){if(fromIndex<0||fromIndex>=this.measuresToKeep.length||toIndex<0){return false;}arrayMoveItem(this.measuresToKeep,fromIndex,toIndex);arrayMoveItem(this.measuresToKeepHidden,fromIndex,toIndex);arrayMoveItem(this.measuresToKeepHiddenLabel,fromIndex,toIndex);arrayMoveItem(this.targetsForMeasure,fromIndex,toIndex);
arrayMoveItem(this.aggsForMeasure,fromIndex,toIndex);arrayMoveItem(this.fmtsForMeasure,fromIndex,toIndex);return true;};DataModelSelection.prototype.removeMeasure=function(index){if(index<0||index>=this.measuresToKeep.length){return false;}arrayRemoveItem(this.measuresToKeep,index);arrayRemoveItem(this.measuresToKeepHidden,index);arrayRemoveItem(this.measuresToKeepHiddenLabel,index);arrayRemoveItem(this.targetsForMeasure,index);arrayRemoveItem(this.aggsForMeasure,index);arrayRemoveItem(this.fmtsForMeasure,index);return true;};DataModelSelection.prototype.deleteChartMeasure=function(index){if(index<0||index>=this.chartMeasures.length){return false;}arrayRemoveItem(this.chartMeasures,index);return true;};DataModelSelection.prototype.changeAgg=function(index,agg){if(index<0||index>=this.measuresToKeep.length){return false;}if(this.aggsForMeasure[index]!=agg){this.aggsForMeasure[index]=agg;return true;}return false;};DataModelSelection.prototype.setMeasureTarget=function(index,targetId){if(index<0||index>=this.measuresToKeep.length){return false;
}if(this.targetsForMeasure[index]!=targetId){var meas=this.measuresToKeep[index];var oldTargetName=this.targetsForMeasure[index];this.targetsForMeasure[index]=targetId;if(oldTargetName){var measureTargetName=meas.targets[oldTargetName].measureTargetName;if(measureTargetName){var ind=this.indexOfMeasure(measureTargetName);if(ind>-1&&this.measuresToKeepHidden[ind]){this.removeMeasure(ind);if(ind<index){index--;}}}}if(targetId){var measureTargetName=meas.targets[targetId].measureTargetName;if(measureTargetName){var ind=this.indexOfMeasure(measureTargetName);if(ind<0){var newTargetMeasure=this.dm.getMeasureById(measureTargetName);if(newTargetMeasure&&this.insertMeasure(this.measuresToKeep.length,newTargetMeasure)){ind=this.indexOfMeasure(measureTargetName);if(ind>-1){this.measuresToKeepHidden[ind]=true;}}else{this.targetsForMeasure[index]=null;}}}}return true;}return false;};DataModelSelection.prototype.indexOfMeasure=function(measureId){for(var i=0;i<this.measuresToKeep.length;i++){if(this.measuresToKeep[i].id==measureId){return i;
}}return -1;};DataModelSelection.prototype.getPosByMeasures=function(){var ret={};for(var i=0;i<this.measuresToKeep.length;i++){ret[this.measuresToKeep[i].id]=i;}return ret;};DataModelSelection.prototype.importAxis=function(srcDmsel,srcAxId,dstAxId){var bChanged=false;if(srcDmsel.axis[srcAxId]){for(var j=0;j<srcDmsel.axis[srcAxId].length;j++){var dimEx=srcDmsel.dimsToExplore[srcDmsel.axis[srcAxId][j]];if(dimEx){this.addBrowse(dstAxId,dimEx.dim,dimEx.hPos,dimEx.lPos,dimEx.format);}}this.importAxisParameters(srcDmsel,srcAxId,dstAxId);bChanged=true;}if(srcDmsel.measureAxis==srcAxId&&srcAxId!=dstAxId){this.measureAxis=dstAxId;bChanged=true;}return bChanged;};DataModelSelection.prototype.setGlobal=function(g){_global=g;_global.__selection=this;};DataModelSelection.prototype.delGlobal=function(){if(typeof(_global)!="undefined"){if(typeof(_global.selection)!="undefined"){delete _global.__selection;}delete _global;}};DrillPath=function(name){this.name=name;this.dimsExplorer=new Array();this.dPos=0;
};DrillPath.prototype.addDim=function(dim,hierarchy,level,format){var dimEx=new DimExplorer(dim,hierarchy,level,true,format);this.dimsExplorer.push(dimEx);};DrillPath.prototype.equals=function(drillPath){if(drillPath!=null&&this.name==drillPath.name&&this.dimsExplorer.length==drillPath.dimsExplorer.length){for(var i=0;i<this.dimsExplorer.length;i++){var dimEx1=this.dimsExplorer[i];var dimEx2=drillPath.dimsExplorer[i];if(dimEx1.dim.id!=dimEx2.dim.id||dimEx1.hPos!=dimEx2.hPos||dimEx1.lPos!=dimEx2.lPos){return false;}}}else{return false;}return true;};DataModel=function(){this.columns=new Array();this.dimensions=new Array();this.measures=new Array();this.dimensionsId2Pos=new Array();this.variables={};this.derivedID=-1;};DataModel.prototype.initCol=function(size){var i=0;while(i<size){this.columns.push(new Column());++i;}};DataModel.prototype.addLine=function(data){var i=0;var dl=data.length;var cols=this.columns;while(i<dl){if(cols.length<=i){cols.push(new Column());}cols[i].data.push(data[i]);
++i;}var cl=this.columns.length;while(i<cl){cols[i].data.push(null);++i;}};DataModel.prototype.a=DataModel.prototype.addLine;DataModel.prototype.addDim=function(idxCol,id,name){var dim=new Dimension(idxCol,id,name);this.dimensionsId2Pos[dim.id]=this.dimensions.length;this.dimensions.push(dim);return dim;};DataModel.prototype.getDimensionById=function(id){var pos=this.dimensionsId2Pos[id];if(pos==null){return null;}return this.dimensions[pos];};DataModel.prototype.getMeasureById=function(id){for(var i=0;i<this.measures.length;i++){if(this.measures[i].id==id){return this.measures[i];}}return null;};DataModel.prototype.addMeasure=function(idxCol,id,agg,format,name){var meas=new Measure(idxCol,id,agg,format,name);this.measures.push(meas);return meas;};DataModel.prototype.registerDDVar=function(name,def,min,max,inc,values,displayName,format){if(typeof(__v[name])=="undefined"){var variable=new DDVariable(name,def,min,max,inc,values,displayName,format);this.variables[name]=variable;__v[name]=variable;
if(typeof(ddCtrl)!="undefined"&&ddCtrl!=null&&typeof(ddCtrl.fireVariableChangeListener)=="function"){ddCtrl.fireVariableChangeListener(name,def);}}else{this.variables[name]=__v[name];}};DataModel.prototype.setDDVar=function(name,val){try{__v[name].cur=val;this.variables[name]=__v[name];}catch(e){}};DataModel.prototype.getDDVar=function(name){try{return this.variables[name];}catch(e){return undefined;}};AssocExplorer=function(dim,levelup,nav,transf,transfoId){this.dim=dim;this.levelup=levelup;this.navigation=nav;this.transf=transf;this.transfoId=transfoId;};AssocExplorer.prototype.getKey=function(){var key=this.dim.id+"_"+this.levelup+"_"+this.navigation;if(this.transf){key+="_"+hashCode(this.transf+"");}return key;};AssocExplorer.prototype.toJSON=function(){return{dim:this.dim,levelup:this.levelup,navigation:this.navigation,transfoId:this.transfoId};};AssocMeasures=function(measure,agg,filter,explorers,param){this.measure=measure;this.agg=agg;this.filter=filter;if((explorers!=null)&&(explorers.length>0)){this.explorers=explorers;
}else{this.explorers=null;}this.param=param;};AssocMeasures.prototype.getCVal=function(col,i){if(this.measure.idxCol<0){}else{return col[this.measure.idxCol].data[i];}};AssocMeasures.prototype.prepareFilters=function(selection){if(!this.filter){return;}for(var iF=0;iF<this.filter.length;++iF){this.filter[iF].evaluate(selection);}};AssocMeasures.prototype.getKey=function(){var key=this.measure.id+"_";if(this.agg.prototype&&this.agg.prototype.getKey){key+=this.agg.prototype.getKey()+"_";}else{key+=this.agg+"_";}for(var i=0;i<this.filter.length;i++){key+=this.filter[i].getKey()+"_";}return key;};AssocMeasures.prototype.toJSON=function(){return{measure:this.measure,agg:aggFuncToInt(this.agg),filter:this.filter,explorers:this.explorers};};AssocDimensions=function(dimension,agg,filter,explorers){this.dimension=dimension;this.agg=agg;this.filter=filter;if((explorers!=null)&&(explorers.length>0)){this.explorers=explorers;}else{this.explorers=null;}};AssocDimensions.prototype=new AssocMeasures;AssocDimensions.prototype.getKey=function(){var key=this.dimension.id+"_";
for(var i=0;i<this.filter.length;i++){key+=this.filter[i].getKey()+"_";}return key;};AssocDimensions.prototype.getCVal=function(col,i){var mbridx=col[this.dimension.idxCol].data[i];if(this.agg==A_DMEMBER){return this.getValStrFromIdx(mbridx);}else{return mbridx;}};AssocDimensions.prototype.getValStrFromIdx=function(mbridx){if(this.dimEx){var vGrp=this.dimEx.mbrs2GrpMbrs[mbridx];var grpId=0;if(vGrp){grpId=vGrp[0];}return this.lvl.groups[grpId].id;}if(this.filterGrp){return this.filterGrp;}return this.dimension.members[mbridx];};AssocDimensions.prototype.prepare=function(sel){if(this.agg==A_DMEMBER){this.dimEx=null;var dm=sel.dm;for(var iex=sel.dimsToExplore.length-1;iex>=0;--iex){if(sel.dimsToExplore[iex].dim.id==this.dimension.id){this.dimEx=sel.dimsToExplore[iex];break;}}if(this.dimEx!=null){if(this.dimEx.hierarchy&&this.dimEx.hPos>=0&&this.dimEx.lPos>=0){this.lvl=this.dimEx.hierarchy.levels[this.dimEx.lPos];}else{this.dimEx=null;}}if(this.dimEx==null){for(var ifs=0;ifs<sel.dimsToFilter.length;
++ifs){if(sel.dimsToFilter[ifs].dim.id==this.dimension.id){if(sel.dimsToFilter[ifs].hierarchy>=0&&sel.dimsToFilter[ifs].level>=0&&sel.dimsToFilter[ifs].selectedMembers.length==1){this.filterGrp=sel.dimsToFilter[ifs].selectedMembers[0];}break;}}}}};AssocDimensions.prototype.toJSON=function(){return{dimension:this.dimension,agg:aggFuncToInt(this.agg),filter:this.filter,explorers:this.explorers};};AssocConditionalDimensions=function(dimension,agg,measure,magg,func,filter){this.measure=measure;this.magg=magg;this.dimension=dimension;this.agg=agg;this.func=func;this.filter=filter;};AssocConditionalDimensions.prototype=new AssocMeasures;AssocConditionalDimensions.prototype.getCVal=function(col,i){return new ConditionObj(col[this.dimension.idxCol].data[i],col[this.measure.idxCol].data[i],this.magg,this.func);};DataModel.prototype.addDerivedMeasure=function(name,aM,formula,fmt,displayName,agg){var meas=new Measure(this.derivedID--,name,agg,fmt,displayName);meas.assocM=aM;meas.formula=formula;this.measures.push(meas);
return meas;};DataModel.prototype.createDerivedMeasure=function(name,aM,formula,fmt,displayName,agg){var meas=new Measure(this.derivedID--,name,agg,fmt,displayName);meas.assocM=aM;meas.formula=formula;return meas;};var colors=["#0000ff","#00ff00","#ff0000","#00ffff","#ff00ff","#ffff00"];FilterKeySet=function(dmKey){this.dmKey=dmKey;this.keySet={};this.gKeyToMbr={};this.complex=false;};FilterKeySet.prototype.generate=function(dm,dataSize,selection){var dimsToFilter2=selection.prepareFilterRules();var i=0;while(i<dataSize){var bkeep=false;if(dimsToFilter2.length){var iF=0;var bfiltered=false;while(iF<dimsToFilter2.length){var id=dm.columns[dimsToFilter2[iF].dim.idxCol].data[i];if(id>=0){if(dimsToFilter2[iF].isOut(id)){bfiltered=true;break;}bkeep=true;}++iF;}if(bfiltered){++i;continue;}}var curKey=null;if(bkeep){curKey=this.buildKey(dm,i);this.keySet[curKey]=true;}var b1def=false;var gKey=new Array(selection.dimsToExplore.length);var keyToMbr=this.gKeyToMbr;if(selection.dimsToExplore.length>1){this.complex=true;
}for(var iN=0;iN<selection.dimsToExplore.length;++iN){var dimEx=selection.dimsToExplore[iN];if(!dimEx.enabled||!dimEx.valid){continue;}var mbrId=dm.columns[dimEx.dim.idxCol].data[i];if(mbrId>=0){b1def=true;}gKey[iN]=mbrId;}if(b1def){if(curKey==null){curKey=this.buildKey(dm,i);}if(!keyToMbr[curKey]){keyToMbr[curKey]={};keyToMbr[curKey][gKey]=true;}else{if(!keyToMbr[curKey][gKey]){keyToMbr[curKey][gKey]=true;this.complex=true;}}}++i;}};FilterKeySet.prototype.buildKey=function(dm,i){var j=0;var key="";while(j<this.dmKey.length){if(key.length>0){key+="-";}key+=dm.columns[this.dmKey[j]].data[i];++j;}return key;};FilterKeySet.prototype.isMatch=function(dm,i){return this.keySet[this.buildKey(dm,i)];};DataModel.prototype.getDataFromSelection=function(selection,ctxObj){if((selection.dimsToExplore.length<=0)&&(selection.measuresToKeep.length<=0)){return null;}selection.prepareFilters();if(this.onServer&&ddCtrl&&(typeof(ddCtrl.getPreviewRowLimit)=="function"||selection.previewRowLimit)){var previewRowLimit=ddCtrl.getPreviewRowLimit();
if(selection.previewRowLimit){previewRowLimit=selection.previewRowLimit;}if(previewRowLimit>0){var pageCube=selection.pageCube;var pageStartRow=selection.pageStartRow;var pageSize=selection.pageSize;selection.pageCube=true;selection.pageStartRow=0;selection.pageSize=previewRowLimit;}}var curSel=JSON.stringify(selection);curSel=encodeURIComponent(curSel);if(ctxObj!=null&&ctxObj.lastSel&&ctxObj.lastSel==curSel){return ctxObj.lastCube;}if(this.onServer&&previewRowLimit>0){selection.pageCube=pageCube;selection.pageStartRow=pageStartRow;selection.pageSize=pageSize;}var retCube=null;var errObj=null;try{if(this.onServer){var params="method=getCubeResult&cubeid="+this.cubeId;if(this.user&&this.authToken){params+="&user="+encodeURIComponent(this.user);params+="&authToken="+encodeURIComponent(this.authToken);}params+="&sel=";var jsonStr=evalJSON(this.serverURL,params+curSel);eval("retCube = "+jsonStr);if(retCube){retCube=_castResultCube(retCube,this);}}else{var sel=selection;if(typeof(this.transfoSelFunc)=="function"){try{sel=selection.specificClone();
this.transfoSelFunc(sel);}catch(e){}}sel.prepare();if(this.keyColsIndex){sel.fks=new FilterKeySet(this.keyColsIndex);var dataSize=0;for(var j=0;j<this.columns.length;j++){if(dataSize<this.columns[j].data.length){dataSize=this.columns[j].data.length;}}sel.fks.generate(this,dataSize,selection);}if(selection.isComplex()){retCube=this.getDataFromSelectionComplexGroup(sel);}else{retCube=this.getDataFromSelectionSimple(sel);}}}catch(e){errObj=e;retCube=null;}if(retCube!=null){retCube.ts=new Date().getTime();retCube.axisIds=null;}if(ctxObj!=null){ctxObj.lastCube=retCube;ctxObj.lastSel=curSel;}if(errObj!=null){throw errObj;}return retCube;};DataModel.prototype.getDataFromSelectionAsync=function(selection,ctxObj,callback){if((selection.dimsToExplore.length<=0)&&(selection.measuresToKeep.length<=0)){return null;}if(this.onServer){selection.prepareFilters();if(ddCtrl&&(typeof(ddCtrl.getPreviewRowLimit)=="function"||selection.previewRowLimit)){var previewRowLimit=ddCtrl.getPreviewRowLimit();if(selection.previewRowLimit){previewRowLimit=selection.previewRowLimit;
}if(previewRowLimit>0){var pageCube=selection.pageCube;var pageStartRow=selection.pageStartRow;var pageSize=selection.pageSize;selection.pageCube=true;selection.pageStartRow=0;selection.pageSize=previewRowLimit;}}var curSel=JSON.stringify(selection);curSel=encodeURIComponent(curSel);if(ctxObj!=null&&ctxObj.lastSel&&ctxObj.lastSel==curSel){if(ctxObj.lastCube!=null||ctxObj.lastXhrCB==null){callback(ctxObj.lastCube);}return;}if(previewRowLimit>0){selection.pageCube=pageCube;selection.pageStartRow=pageStartRow;selection.pageSize=pageSize;}ctxObj.lastSel=curSel;ctxObj.lastCube=null;var params="method=getCubeResult&cubeid="+this.cubeId;if(this.user&&this.authToken){params+="&user="+encodeURIComponent(this.user);params+="&authToken="+encodeURIComponent(this.authToken);}params+="&sel=";var thisDM=this;var xhrCB=function(jsonStr,errObj){if(ctxObj!=null&&ctxObj.lastXhrCB!=xhrCB){return;}var retCube;try{eval("retCube = "+jsonStr);if(retCube){retCube=_castResultCube(retCube,thisDM);}}catch(e){if(errObj==null){errObj=e;
}retCube=null;}if(retCube!=null){retCube.ts=new Date().getTime();}if(ctxObj!=null){ctxObj.lastCube=retCube;ctxObj.lastSel=curSel;}callback(retCube,errObj);thisDM=null;if(ctxObj!=null&&ctxObj.lastXhrCB==xhrCB){ctxObj.lastXhrCB=null;}};if(ctxObj!=null){ctxObj.lastXhrCB=xhrCB;}evalJSON(this.serverURL,params+curSel,xhrCB);}else{callback(this.getDataFromSelection(selection,ctxObj));}};function castObject(untypedObj,classProto){for(var prop in classProto){if(typeof(classProto[prop])=="function"&&!untypedObj[prop]){untypedObj[prop]=classProto[prop];}}}function _castResultCube(retCube,dm){castObject(retCube,ResultCube.prototype);if(dm.formatList){for(var key in retCube.format){retCube.format[key]=dm.formatList[retCube.format[key].id];}}if(retCube.version&&retCube.version>1){for(var i=0;i<retCube.axis.length;i++){for(var j=0;j<retCube.axis[i].length;j++){var av=retCube.axis[i][j];av.pos=av.p;av.id=av.i;av.formated=typeof(av.f)!="undefined"?av.f:av.id;av.cs=typeof(av.e)!="undefined"?av.e:null;av.sppos=typeof(av.s)!="undefined"?av.s:0;
av.atend=typeof(av.a)!="undefined"?av.a:false;av.total=typeof(av.t)!="undefined"?av.t:false;av.hidden=typeof(av.h)!="undefined"?av.h:false;if(typeof(av.o)!="undefined"){av.targetPos=av.o;}if(typeof(av.m)!="undefined"){av.measureIdx=av.m;}av.other=typeof(av.r)!="undefined"?av.r:false;}}}return retCube;}DataModel.prototype.getDataFromSelectionSimple=function(selection){var dataSize=0;for(var j=0;j<this.columns.length;j++){if(dataSize<this.columns[j].data.length){dataSize=this.columns[j].data.length;}}var selectionList=this.getDependentSelection(selection);for(var cubeId=0;cubeId<selectionList.length;++cubeId){var mcube=new MidCube();mcube.generateSimple(this,dataSize,selectionList[cubeId]);mcube.consumed={};mcube.selection=selection;selectionList[cubeId].genCube=mcube;for(var asM=0;asM<selectionList[cubeId].forAssoc.length;++asM){selectionList[cubeId].forAssoc[asM].cube=mcube;}}var mcube=new MidCube();mcube.generateSimple(this,dataSize,selection);for(var cubeId=0;cubeId<selectionList.length;
++cubeId){var allowInject=true;if(selectionList[cubeId].forAssoc){var iAssoc=0;while(iAssoc<selectionList[cubeId].forAssoc.length){var assocM=selectionList[cubeId].forAssoc[iAssoc];if(assocM.explorers){var iExp=0;while(iExp<assocM.explorers.length){if(assocM.explorers[iExp].levelup>0){allowInject=false;break;}++iExp;}if(!allowInject){break;}}++iAssoc;}}if(allowInject){var icube=selectionList[cubeId].genCube;var iNup=1;while(iNup<icube.curNupletId){var nupf=icube.nupletListName[iNup];if(nupf!=null&&!icube.consumed[iNup]){mcube.injectNuplet(this,selection,-1,nupf,false);}++iNup;}}}return this.cubeExpand(selection,mcube.curNupletId,mcube.nupletListName,mcube.data);};CubeStore=function(name,val){this.name=name;this.setVal(val);};CubeStore.prototype.setVal=function(val){if(val==null){this.val=null;}else{this.val=val.clone();}};function HoldM(){this.assocM=[];}HoldM.prototype.convert=function(line){var lC=line.length-1;if(!line[lC]){return null;}var dMeas=line[lC].clone();for(var iAM=0;iAM<this.assocM.length;
++iAM){var am=this.assocM[iAM];var dupLine=line.slice(0,lC);for(var iaXK=0;iaXK<am.ignoredax.length;++iaXK){dupLine[am.ignoredax[iaXK]]=null;}var key=dupLine.toString();if(am.usedNup[key]){dMeas.aggs[am.assocM]=null;}else{am.usedNup[key]=true;}}return dMeas;};function HoldAM(iaM){this.assocM=iaM;this.ignoredax=[];this.usedNup=[];}function buildAxisNup(selection,axisId,cols){var nup="";var axisElems=selection.axis[axisId];if(axisElems){var axElemId=0;while(axElemId<axisElems.length){dim=axisElems[axElemId];if(axElemId>0){nup+="-";}nup+=cols[dim];++axElemId;}}return nup;}function buildAxisMbr(selection,axisId,cols){var sep,axisElems,axElemId,rname,bSameFRNameAsName,frname,dim,mbr,smbr,mbrCaption,f,formated;sep="-";if(selection.axisMemberSeparators[axisId]){sep=selection.axisMemberSeparators[axisId];}axisElems=selection.axis[axisId];if(axisElems){axElemId=0;rname="";bSameFRNameAsName=true;frname=rname;while(axElemId<axisElems.length){dim=axisElems[axElemId];mbr=selection.dimsToExplore[dim].members[cols[dim]];
smbr=""+mbr;if(smbr===mbr){smbr=mbr;}rname=(axElemId>0)?rname+sep+smbr:smbr;mbrCaption=null;if(selection.dimsToExplore[dim].captions&&selection.dimsToExplore[dim].captions[cols[dim]]){mbrCaption=""+selection.dimsToExplore[dim].captions[cols[dim]];}f=selection.dimsToExplore[dim].getFormat();if(mbrCaption!=null){frname=(axElemId>0)?frname+sep+mbrCaption:mbrCaption;bSameFRNameAsName=false;}else{if(f){formated=formatNum(mbr,f);frname=(axElemId>0)?frname+sep+formated:formated;bSameFRNameAsName=false;}else{if(!bSameFRNameAsName){frname=(axElemId>0)?frname+sep+smbr:smbr;}else{frname=rname;}}}++axElemId;}var av=new AxisValue(rname,frname);av.cs=cols[dim];return av;}return null;}function initCubRes(selection,cubRes,forceRef){var i=0,j;var temp;cubRes.measureAxis=selection.measureAxis;while((i<selection.axis.length)||(i<=selection.measureAxis)){if(selection.axis[i]!=undefined){if(selection.forceAxisList[i]!==undefined){forceRef[i]=[];j=0;while(j<selection.forceAxisList[i].length){forceRef[i][j]={};
forceRef[i][j].name=selection.forceAxisList[i][j];forceRef[i][j].create={};++j;}}j=0;if(selection.axis[i].length==1){var f=selection.dimsToExplore[selection.axis[i][j]].getFormat();if(f){cubRes.axisformat[i]=f;}cubRes.headers[i]=selection.dimsToExplore[selection.axis[i][j]].dim.name;}else{for(j=0;j<selection.axis[i].length;j++){if(j>0){temp+="-"+selection.dimsToExplore[selection.axis[i][j]].dim.name;}else{temp=selection.dimsToExplore[selection.axis[i][j]].dim.name;}}cubRes.headers[i]=temp;}}else{cubRes.headers[i]=Properties[getLocale()]["Measures"];}cubRes.axis[i]=[];cubRes.axisIds[i]={};++i;}if(selection.measuresToKeep.length==0){cubRes.measureStartCol=-1;}else{cubRes.measureStartCol=i;cubRes.headers[i]="value";}i=0;while(i<selection.valueFilters.length){selection.valueFilters[i].init();++i;}i=0;while(i<selection.valueSorters.length){selection.valueSorters[i].init();++i;}if(selection.hasOverall){for(var key in selection.overallAxis){if(selection.hasAxisOverall(key)&&selection.overallAxis[key].pos==1){var axisId=parseInt(key);
if(axisId>=0&&axisId<cubRes.axis.length){var av=new AxisValue("OverAll",selection.overallAxis[key].getTxt());av.sppos=1;av.total=true;cubRes.axis[axisId].push(av);av.pos=0;}}}}}DataModel.prototype.cubeExpand=function(selection,curNupletId,nupletListName,data){_global={};selection.setGlobal(_global);var cubRes=new ResultCube(),i=0,j,forceRef=[];initCubRes(selection,cubRes,forceRef);var mapTargetMeasure={};for(i=0;i<selection.targetsForMeasure.length;++i){var tn=selection.targetsForMeasure[i];if(tn!=null){var tm=selection.measuresToKeep[i].targets[tn];var tmn=tm.measureTargetName;if(tmn!=null){for(var iTM=0;iTM<selection.measuresToKeep.length;++iTM){if(selection.measuresToKeep[iTM].id==tmn){mapTargetMeasure[iTM]=i;break;}}}}}var curAxisVal={};i=0;var storeCLine={};var nupletId=1;while(nupletId<curNupletId){var curLine=[];var cols=nupletListName[nupletId].split("-");var mrname="";var mfrname="";var lastCS=null;var axisId=0;while(axisId<selection.axis.length){var axVal=buildAxisMbr(selection,axisId,cols);
if(axVal){if(selection.measureAxis!=axisId){if(forceRef[axisId]!==undefined){var colT=null;if(axisId>0){colT=cols.slice(0,axisId-1);}if(axisId<cols.length){colT.concat(cols.slice(axisId,cols.length));}var nupletT=colT.join("-");var tJ=0;while(tJ<forceRef[axisId].length){if(forceRef[axisId][tJ].name===axVal.id){forceRef[axisId][tJ].create[nupletT]=null;}else{if(forceRef[axisId][tJ].create[nupletT]===undefined){forceRef[axisId][tJ].create[nupletT]=curLine;}}++tJ;}}var pos=cubRes.axisIds[axisId][axVal.id];if(pos==undefined||(typeof pos!="number")){pos=cubRes.axis[axisId].push(axVal);pos--;axVal.pos=pos;cubRes.axisIds[axisId][axVal.id]=pos;}curLine.push(pos);}else{mrname=axVal.id;mfrname=axVal.formated;lastCS=axVal.cs;curLine.push(null);}}else{curLine.push(null);}++axisId;}var iMeasure=0;var axisId=selection.measureAxis;var sep="-";if(selection.axisMemberSeparators[axisId]){sep=selection.axisMemberSeparators[axisId];}var mapM=[];curAxisVal={};while(iMeasure<selection.measuresToKeep.length){var val=data[nupletId][iMeasure];
var dupLine=curLine;if(iMeasure!=selection.measuresToKeep.length-1){dupLine=curLine.slice(0);}var measId=selection.measuresToKeep[iMeasure].id;var measName=selection.measuresToKeep[iMeasure].name;var rname=null;var frname=null;if(!selection.measuresToKeepHiddenLabel[iMeasure]){rname=(mrname.length>0)?mrname+sep+measId:measId;frname=rname;if(mfrname!=mrname||measId!=measName){frname=(mfrname.length>0)?mfrname+sep+measName:measName;}}else{rname=mrname;frname=mfrname;}var pos=cubRes.axisIds[axisId][rname];if(pos==undefined){var av=new AxisValue(rname,frname);pos=cubRes.axis[axisId].push(av);pos--;av.pos=pos;var irootM=mapTargetMeasure[iMeasure];if(irootM!=null){var avRootM=curAxisVal[irootM];if(avRootM!=null){avRootM.o=pos;}}else{if(selection.targetsForMeasure[iMeasure]!=null){curAxisVal[iMeasure]=av;}}av.m=iMeasure;av.cs=lastCS;if(selection.measuresToKeepHidden[iMeasure]){av.hidden=true;}cubRes.axisIds[axisId][rname]=pos;}dupLine[axisId]=pos;var valFilter=selection.valueFiltersPerMeasure[selection.measuresToKeep[iMeasure].idxCol];
if(valFilter){var fId=0;while(fId<valFilter.length){valFilter[fId].addElement(dupLine,val);++fId;}}if(val==null&&!selection.retainNull){++iMeasure;continue;}if(val.isNull(dupLine,cubRes,0)&&!val.nbvar&&!selection.retainNull){++iMeasure;continue;}if(selection.forceCrossAxisList.length>0){storeCLine[dupLine.join("-")]=true;}cubRes.addLine(dupLine);cubRes.addMeasureFormat(dupLine[axisId],selection.getMeasureFormat(iMeasure));var valSorter=selection.valueSortersPerMeasure[selection.measuresToKeep[iMeasure].idxCol];if(valSorter){var fId=0;while(fId<valSorter.length){if(!valSorter[fId].linked){valSorter[fId].addElement(dupLine,val);}++fId;}}dupLine.push(val);++iMeasure;}if(selection.measuresToKeep.length==0){if(selection.forceCrossAxisList.length>0){storeCLine[curLine.join("-")]=true;}curLine.push(new A_SUM(1));cubRes.addLine(curLine);}++nupletId;}i=0;while(i<forceRef.length){if(forceRef[i]!==undefined){var tJ=0;while(tJ<forceRef[i].length){if(forceRef[i][tJ].id===undefined){var av=new AxisValue(forceRef[i][tJ].name,forceRef[i][tJ].name,forceRef[i][tJ].name);
pos=cubRes.axis[i].push(av);pos--;av.pos=pos;forceRef[i][tJ].id=pos;cubRes.axisIds[i][forceRef[i][tJ].name]=pos;}var nup;for(nup in forceRef[i][tJ].create){if(forceRef[i][tJ].create[nup]){var curLine=forceRef[i][tJ].create[nup].slice(0,forceRef[i][tJ].create[nup].length-2);curLine[i]=forceRef[i][tJ].id;curLine.push(new A_SUM(null));cubRes.addLine(curLine);}}++tJ;}}++i;}i=0;while(i<selection.forceCrossAxisList.length){curLine=[];if(selection.forceCrossAxisList[i].length==selection.axis.length+1){axisId=0;var myVal=selection.forceCrossAxisList[i][selection.axis.length];if(myVal!=null||selection.retainNull){var aggF=new A_SUM(myVal);while(axisId<selection.axis.length){var axMbrId=selection.forceCrossAxisList[i][axisId];var pos=cubRes.axisIds[axisId][axMbrId];if(pos===undefined){var axMbrFormated=axMbrId;if(cubRes.axisformat[axisId]){axMbrFormated=formatNum(axMbrId,cubRes.axisformat[axisId]);}var av=new AxisValue(axMbrId,axMbrFormated,axMbrId);pos=cubRes.axis[axisId].push(av);pos--;av.pos=pos;
if(selection.axis[axisId]){var curDimIdx=selection.axis[axisId][0];if(selection.axisSort[curDimIdx]&&selection.axisSort[curDimIdx].type==S_CUSTOM){var dim=selection.dimsToExplore[curDimIdx].dim;var mbrIdx=dim.getMemberPosById(axMbrId);if(mbrIdx!==undefined&&mbrIdx>-1){av.cs=mbrIdx;}else{av.cs=pos;}}else{av.cs=pos;}}else{av.cs=pos;}cubRes.axisIds[axisId][av.id]=pos;}else{if(axisId==selection.measureAxis){if(selection.measuresToKeep[pos].idxCol<0){aggF=new A_MV(function(){return myVal;});}}}curLine.push(pos);++axisId;}if(storeCLine[curLine.join("-")]===undefined){curLine.push(aggF);cubRes.addLine(curLine);}}}++i;}if(selection.fullMeasureFilterType!=FILTER_NONE){doFullMeasureFilter(selection,cubRes);}else{i=0;while(i<selection.valueFilters.length){var valFilter=selection.valueFilters[i];var isFiltered=false;var valFilterArr=new Array();var arrayFilter=new Array();if(valFilter.funcName=="range"){var range=prepareRange(valFilter.maxFilterVal);var fElem=0;while(fElem<valFilter.valFilterArray.length){var cstore=valFilter.valFilterArray[fElem];
if(valFilter.filterFunc(cstore.val,range)){valFilterArr.push(cstore);arrayFilter[cstore.name]=1;}fElem++;}if(valFilterArr.length<valFilter.valFilterArray.length){isFiltered=true;}}else{if(valFilter.valFilterArray.length>valFilter.maxFilterVal){valFilter.valFilterArray.sort(valFilter.filterFunc);var j=0;while(j<valFilter.maxFilterVal){valFilterArr.push(valFilter.valFilterArray[j]);arrayFilter[valFilter.valFilterArray[j].name]=1;++j;}isFiltered=true;}}if(isFiltered){valFilter.valFilterArray=valFilterArr;cubRes.commitFilter(valFilter.filterAxis,arrayFilter,valFilter.needOther,selection);var axis=cubRes.axis[valFilter.filterAxis];var mapNewAxisPos=[];for(var iAx=0;iAx<axis.length;++iAx){mapNewAxisPos[axis[iAx].oldPos]=iAx;}if(valFilter.looseLink){var sorter=valFilter.looseLink;sorter.filter(valFilterArr,mapNewAxisPos);}for(var iAx=0;iAx<valFilterArr.length;++iAx){valFilterArr[iAx].name=mapNewAxisPos[valFilterArr[iAx].name];}}++i;}}if(selection.pivot<0){i=0;while(i<selection.axisSort.length){var s=selection.axisSort[i];
if(s.type!=S_MEASURE){cubRes.sortAxis(s.axisId,s.type,s.reverse,s.onCaption);}++i;}i=0;while(i<selection.valueSorters.length){var valSorter=selection.valueSorters[i];if(valSorter.linked){valSorter.valSortArray=valSorter.linked.valFilterArray;}valSorter.valSortArray.sort(valSorter.sortFunc);valSorter.reorderAxis(cubRes);++i;}}i=0;while(i<cubRes.axis.length){if(typeof cubRes.axis[i].needOther!="undefined"){var av=new AxisValue(msg_other[getLocale()],msg_other[getLocale()]);av.pos=cubRes.axis[i].needOther;av.other=true;av.sppos=-1;cubRes.axis[i].push(av);}++i;}if(selection.hasOverall){if(selection.pivot<0){doTotalExploded(selection,cubRes);}else{if(selection.pivot>0){doTotal(selection,cubRes,0,selection.pivot);doTotal(selection,cubRes,selection.pivot,cubRes.axis.length);}else{doTotal(selection,cubRes,0,cubRes.axis.length);}}}cubRes.linesCnt=cubRes.lines.length;if(selection.pivot==0&&selection.fullMeasureSort>=0){cubRes.fullMeasureSort(selection.fullMeasureSort,!selection.fullMeasureSortReverse,selection.fullMeasureSortPreserveTotal);
cubRes.linesCnt=cubRes.lines.length;if(selection.measuresToKeep.length>0){cubRes.createIndex(false,false,selection.retainNull);}}else{if(selection.pivot>=0){cubRes.partition(selection.pivot,selection.retainNull,selection);pS=new PartitionSorter(cubRes,selection);pS.sort(cubRes);pS=null;cubRes.lines=null;if(selection.pivot==0){flattenLineAndHandleRSUM(selection,cubRes);if(selection.measuresToKeep.length>0){cubRes.createIndex(true,false,selection.retainNull);}cubRes.pTbl=null;}else{cubRes.evalIdx();}}else{if(selection.pivot<0){cubRes.needTotal(selection);cubRes.createIndex(false,true,selection.retainNull);handleRSUMGraph(selection,cubRes);cubRes.lines=null;}}}selection.delGlobal();if(typeof(_global)!="undefined"){delete _global;}return cubRes;};function doFullMeasureFilter(selection,cubRes){var mid=selection.fullMeasureFilter;var needOther=selection.fullMeasureFilterTopShowOthers;var otherLineByMid={};var templateOther=[];var i=0;if(needOther){while(i<cubRes.axis.length){if(i!=selection.measureAxis){var av=new AxisValue(msg_other[getLocale()],msg_other[getLocale()]);
av.other=true;av.pos=cubRes.axis[i].length;templateOther.push(av.pos);av.sppos=-1;cubRes.axis[i].push(av);}else{templateOther.push(-1);}++i;}templateOther.push(null);}if(selection.fullMeasureFilterType==FILTER_RANGE){var rng=[selection.fullMeasureFilterRangeMinValue,selection.fullMeasureFilterRangeMaxValue];rng=prepareRange(rng);var tmpLine=cubRes.lines;needOther=false;i=0;var cnup="";var filterKeep={};var ignoreList={};var cmid=-1;while(i<tmpLine.length){var other=false;var curLine=tmpLine[i];cnup=line2nup(selection.measureAxis,curLine);cmid=curLine[selection.measureAxis];if(ignoreList[cnup]){other=true;}if(!other){var posForNup=filterKeep[cnup];if(cmid==mid){var agg=curLine[cubRes.measureStartCol];if(agg!=null){if(!isInRange(agg,rng)){ignoreList[cnup]=true;if(posForNup!=null){delete filterKeep[cnup];}other=true;}}else{other=true;}}if(!other){if(posForNup==null){posForNup=[];filterKeep[cnup]=posForNup;}posForNup.push(i);}}if(needOther&&other){var curOther=otherLineByMid[cmid];if(curOther==null){curOther=templateOther.slice(0);
curOther[selection.measureAxis]=cmid;otherLineByMid[cmid]=curOther;}var agg=curOther[cubRes.getMeasureStartCol()];if(agg==null){curOther[cubRes.getMeasureStartCol()]=curLine[cubRes.getMeasureStartCol()];}else{var magg=curLine[cubRes.getMeasureStartCol()];if(magg!=null){agg.aggVal(magg,true);}}}++i;}var lines=[];for(var it in filterKeep){var keepGroup=filterKeep[it];for(var itLine=0;itLine<keepGroup.length;++itLine){lineId=keepGroup[itLine];lines.push(tmpLine[lineId]);}}for(var itLineOther in otherLineByMid){var oline=otherLineByMid[itLineOther];lines.push(oline);}cubRes.lines=lines;}else{initGlobalTopBottomSort(cubRes,mid,selection.measureAxis,cubRes.measureStartCol,selection.fullMeasureFilterType==FILTER_TOP);cubRes.lines.sort(globalTopBottomSort);var lines=[];var tmpLine=cubRes.lines;i=0;var nupKeep={};var cmid=-1;var nbVal=selection.fullMeasureFilterTopBottomValue;while(i<tmpLine.length){var curLine=tmpLine[i];cmid=curLine[selection.measureAxis];var cnup=line2nup(selection.measureAxis,curLine);
if(cmid==mid&&nbVal>0){nbVal--;nupKeep[cnup]=true;lines.push(curLine);}else{if(nupKeep[cnup]){lines.push(curLine);}else{if(needOther){var curOther=otherLineByMid[cmid];if(curOther==null){curOther=templateOther.slice(0);curOther[selection.measureAxis]=cmid;otherLineByMid[cmid]=curOther;}var agg=curOther[cubRes.measureStartCol];if(agg==null){curOther[cubRes.measureStartCol]=curLine[cubRes.measureStartCol];}else{var magg=curLine[cubRes.measureStartCol];if(magg!=null){agg.aggVal(magg,true);}}}}}++i;}for(itLineOther in otherLineByMid){var oline=otherLineByMid[itLineOther];lines.push(oline);}cubRes.lines=lines;}}function line2nup(mAxis,line){var nup="";for(var i=0;i<line.length-1;++i){if(i==mAxis){continue;}if(nup.length>0){nup=nup+"_"+line[i];}else{nup=""+line[i];}}return nup;}_tmpSort={};_tmpSort.mid=0;_tmpSort.posM=0;_tmpSort.posV=0;_tmpSort.infVal=-1;_tmpSort.supVal=1;_tmpSort.phase=1;_tmpSort.rCube=null;function initGlobalTopBottomSort(rcRcube,iMid,iPosM,iPosV,bTop){_tmpSort.mid=iMid;_tmpSort.posM=iPosM;
_tmpSort.posV=iPosV;_tmpSort.rCube=rcRcube;if(!bTop){_tmpSort.infVal=1;_tmpSort.supVal=-1;}else{_tmpSort.infVal=-1;_tmpSort.supVal=1;}}function globalTopBottomSort(a,b){var mid=_tmpSort.mid;var posM=_tmpSort.posM;var posV=_tmpSort.posV;var infVal=_tmpSort.infVal;var supVal=_tmpSort.supVal;var phase=_tmpSort.phase;var rCube=_tmpSort.rCube;if(a[posM]==mid){if(b[posM]==mid){var vA=a[posV];var vB=b[posV];if(vA==null||vA.isNull(a,rCube,phase)){if(vB==null||vB.isNull(b,rCube,phase)){return 0;}else{return 1;}}else{if(vB==null||vB.isNull(b,rCube,phase)){return -1;}var dA=vA.getVal(a,rCube,phase);var dB=vB.getVal(b,rCube,phase);if(dA>dB){return infVal;}if(dA<dB){return supVal;}}}else{return -1;}}else{if(b[posM]==mid){return 1;}}return 0;}function processLine(oProc,overAllByAxis,cubRes){var val=null;var mapOverall=overAllByAxis[oProc.k];if(mapOverall){var key=buildKeyFromLine(oProc.l,oProc.k);var agg=mapOverall[key];if(agg!=null){val=agg.getVal(oProc.l,cubRes,1);}}oProc.l.push(val);}function buildKeyFromLine(lineTmp,upTo){var key="";
var iK=0;var endL=lineTmp.length+1;if(upTo){endL=upTo;}while(iK<lineTmp.length){if(key.length>0){key+="-";}else{if(lineTmp[iK]==null){++iK;continue;}}if(iK<endL){key+=lineTmp[iK];}else{key+=-1;}++iK;}return key;}function flattenLineAndHandleRSUM(selection,cubRes){var needRSum={};var mapRSum={};var posRSum=[];var overAllByAxisAgg={};var overAllByAxis={};var iMes=0;while(iMes<selection.aggsForMeasure.length){if(selection.aggsForMeasure[iMes]==AGG_RSM){needRSum[iMes]=true;mapRSum[iMes]=null;posRSum.push(iMes);}++iMes;}if(posRSum.length>0){for(var iAxOv in selection.overallAxis){if(selection.overallAxis[iAxOv].agg>=0){overAllByAxisAgg[iAxOv]=aggIntToFunc(selection.overallAxis[iAxOv].agg);}else{overAllByAxisAgg[iAxOv]=A_RSUM_LAST;}}}cubRes.lines=new Array();var storedLine=[];var iAx=0;while(iAx<cubRes.pTbl.rowAxis.length){var lineTmp=cubRes.pTbl.rowAxis[iAx];var iMeasurePos=selection.measureAxis;var keyM=lineTmp[iMeasurePos];var isOverall=false;var key=buildKeyFromLine(lineTmp);var val=cubRes.pTbl.idxT[key].getVal(lineTmp,cubRes,1);
var processNow=true;if(needRSum[keyM]){var tgtVal=val;if(mapRSum[keyM]){tgtVal+=mapRSum[keyM];}var iK2=0;while(iK2<lineTmp.length){if(overAllByAxisAgg[iK2]){var av=cubRes.axis[iK2][lineTmp[iK2]];if(av.total){isOverall=true;storedLine.push({l:lineTmp,k:iK2});processNow=false;break;}else{if(!isOverall){var pkey=buildKeyFromLine(lineTmp,iK2);var mapOverall=overAllByAxis[iK2];if(!mapOverall){mapOverall={};overAllByAxis[iK2]=mapOverall;}var curAgg=mapOverall[pkey];if(!curAgg){mapOverall[pkey]=new overAllByAxisAgg[iK2](tgtVal);}else{curAgg.aggValDbl(tgtVal);}}}}++iK2;}if(!isOverall){mapRSum[keyM]=tgtVal;val=tgtVal;}}if(processNow){lineTmp.push(val);}cubRes.lines.push(lineTmp);++iAx;}for(var iSL=0;iSL<storedLine.length;++iSL){processLine(storedLine[iSL],overAllByAxis,cubRes);}cubRes.linesCnt=cubRes.lines.length;}NUplet=function(size){this.idx=new Array(size);this.hashCache=-1;};NUplet.prototype.set=function(pos,val){this.idx[pos]=val;this.hashCache=-1;};NUplet.prototype.hashCode=function(){if(this.hashCache==-1){var i,l=this.idx.length;
if(l<=0){this.hashCache=0;}else{this.hashCache=1;for(i=0;i<l;++i){this.hashCache=((this.hashCache<<5)-this.hashCache)+this.idx[i];this.hashCache|=0;}}}return this.hashCache;};function handleRSUMGraph(selection,cubRes){var posRSum=[];var mAxis=cubRes.axis[cubRes.measureAxis];for(var iAxMbr=0;iAxMbr<mAxis.length;++iAxMbr){if(selection.aggsForMeasure[mAxis[iAxMbr].m]==AGG_RSM){var mPos=mAxis[iAxMbr].pos;posRSum.push(mPos);}}if(posRSum.length>0){var overallExist={};var catchOverall={};var listOverall=cubRes.totalStorage;if(listOverall){for(var iT=0;iT<listOverall.length;++iT){var ts=listOverall[iT];overallExist[ts.getNup().hashCode()]=true;var cNup=ts.getCatchNup().hashCode();var list=catchOverall[cNup];if(list==null){list=[];catchOverall[cNup]=list;}if(selection.overallAxis[ts.axisId].agg>=0){ts.agg=new (aggIntToFunc(selection.overallAxis[ts.axisId].agg))();}else{ts.agg=new A_RSUM_LAST();}list.push(ts);}}var axKey=[];var iAx=0;while(iAx<cubRes.axis.length){axKey.push(0);++iAx;}var nup=new NUplet(axKey.length);
var hasNext=true;var accuRSum=[];var isFirst=true;while(hasNext){var curAx=0;while(curAx<cubRes.axis.length){if(curAx==cubRes.measureAxis){curAx++;}else{if(axKey[curAx]>=cubRes.axis[curAx].length-1){axKey[curAx]=0;curAx++;}else{if(isFirst){isFirst=false;break;}axKey[curAx]=axKey[curAx]+1;break;}}}if(curAx>cubRes.axis.length-1){break;}var iM=0;while(iM<posRSum.length){axKey[cubRes.measureAxis]=posRSum[iM];var iK=0;var key="";while(iK<axKey.length){nup.set(iK,axKey[iK]);if(iK!=0){key+="-";}if(axKey[iK]<cubRes.axis[iK].length){key+=cubRes.axis[iK][axKey[iK]].pos;}++iK;}var num=cubRes.values[key];if(num!=null){if(!overallExist[nup.hashCode()]){var curA=accuRSum[iM];if(curA==null){curA=num;}else{curA+=num;cubRes.values[key]=curA;}accuRSum[iM]=curA;var i=cubRes.axis.length-1;for(;i>=0;--i){if(selection.overallAxis[i]){nup.set(i,-1);var list=catchOverall[nup.hashCode()];if(list){for(var j=0;j<list.length;++j){list[j].agg.aggValDbl(curA,nup,0);}}}}}}++iM;}}if(listOverall!=null){for(var iT=0;iT<listOverall.length;
++iT){var ts=listOverall[iT];cubRes.values[ts.getKey(cubRes)]=ts.agg.getVal(ts.line,cubRes,1);}}}}function doTotalExploded(selection,cubRes){var startI=cubRes.lines.length;for(var key in selection.overallAxis){var overallAxis=selection.overallAxis[key];if(!selection.hasAxisOverall(key)||(selection.hasAxisOverall(key)&&overallAxis.pos!=-1&&overallAxis.pos!=1)){continue;}var axisId=parseInt(key);if(axisId<0||axisId>=cubRes.axis.length||!cubRes.axis[axisId]){continue;}var len=cubRes.lines.length;var tmpMap=[];i=0;var pos;if(overallAxis.pos==-1){var av=new AxisValue("OverAll",overallAxis.getTxt());av.sppos=-1;av.total=true;if(axisId==cubRes.measureAxis){cubRes.format.push(cubRes.format[0]);}pos=cubRes.axis[axisId].push(av);pos--;av.pos=pos;}else{pos=0;}var mapMeasAssoc=[];for(var idM=0;idM<selection.measuresToKeep.length;++idM){var m=selection.measuresToKeep[idM];if(m.idxCol<0){var iaM=0;while(iaM<m.assocM.length){if(m.assocM[iaM].removeExpl){var hm=new HoldAM(iaM);var itAx=0;while(itAx<selection.axis.length){var ax=selection.axis[itAx];
if(ax){var itDimOnAx=0;var bRemove=true;while(itDimOnAx<ax.length){if(!m.assocM[iaM].removeExpl[ax[itDimOnAx]]){bRemove=false;}++itDimOnAx;}if(bRemove){hm.ignoredax.push(itAx);}}++itAx;}if(mapMeasAssoc[idM]==null){mapMeasAssoc[idM]=new HoldM();}mapMeasAssoc[idM].assocM.push(hm);}iaM++;}}}while(i<len){var pM=cubRes.lines[i].length-1;var dupLine=cubRes.lines[i].slice(0,pM);dupLine[axisId]=pos;var key=dupLine.toString();if(!tmpMap[key]){if(cubRes.lines[i][pM]){var m=null;if(typeof overallAxis.agg!="undefined"&&overallAxis.agg!=null&&overallAxis.agg>=0){var d=cubRes.lines[i][pM].getVal(cubRes.lines[i],null,1);if(d!=null&&!isNaN(d)){m=new (aggIntToFunc(overallAxis.agg))(d);}}else{m=cubRes.lines[i][pM].clone();if(m.setTotal){m.setTotal();}m.aggsProtected=null;}if(m!=null){dupLine.push(m);cubRes.addLine(dupLine);tmpMap[key]=m;var lineTrans=mapMeasAssoc[cubRes.lines[i][selection.measureAxis]];if(lineTrans){lineTrans.convert(dupLine);}}}}else{var lineTrans=mapMeasAssoc[cubRes.lines[i][selection.measureAxis]];
if(typeof overallAxis.agg!="undefined"&&overallAxis.agg!=null&&overallAxis.agg>=0){var d;if(lineTrans){d=lineTrans.convert(cubRes.lines[i]).getVal(cubRes.lines[i],null,1);}else{d=cubRes.lines[i][pM].getVal(cubRes.lines[i],null,1);}if(d!=null&&!isNaN(d)){tmpMap[key].aggValDbl(d);}}else{if(lineTrans){tmpMap[key].aggVal(lineTrans.convert(cubRes.lines[i]));}else{tmpMap[key].aggVal(cubRes.lines[i][pM]);}}}++i;}}if(selection.deleteOverAllChilds){var maxOverallBeforePivot=-1;var maxOverallAfterPivot=-1;for(var key in selection.overallAxis){var overallAxis=selection.overallAxis[key];if(!selection.hasAxisOverall(key)||(selection.hasAxisOverall(key)&&overallAxis.pos!=-1&&overallAxis.pos!=1)){continue;}var axisId=parseInt(key);if(axisId<0||axisId>=cubRes.axis.length||!cubRes.axis[axisId]){continue;}if(axisId>=selection.pivot){maxOverallAfterPivot=Math.max(maxOverallAfterPivot,axisId);}else{maxOverallBeforePivot=Math.max(maxOverallBeforePivot,axisId);}}var toDelete=[];var bDelete=false;for(var key in selection.overallAxis){var overallAxis=selection.overallAxis[key];
if(!selection.hasAxisOverall(key)||(selection.hasAxisOverall(key)&&overallAxis.pos!=-1&&overallAxis.pos!=1)){continue;}var axisId=parseInt(key);if(axisId<0||axisId>=cubRes.axis.length||!cubRes.axis[axisId]){continue;}if(((axisId<selection.pivot)&&(axisId<maxOverallBeforePivot))||((axisId>=selection.pivot)&&(axisId<maxOverallAfterPivot))){var axMO=maxOverallBeforePivot;if((axisId>=selection.pivot)&&(axisId<maxOverallAfterPivot)){axMO=maxOverallAfterPivot;}var valMO=0;var pos=0;if(overallAxis.pos==-1){valMO=cubRes.axis[axMO].length-1;pos=cubRes.axis[axisId].length-1;}i=startI;var len=cubRes.lines.length;while(i<len){if((cubRes.lines[i][axisId]==pos)&&(cubRes.lines[i][axMO]!=valMO)){toDelete[i]=true;bDelete=true;}++i;}}}if(bDelete){var nlines=[];var len=cubRes.lines.length;i=0;while(i<len){if(!toDelete[i]){nlines.push(cubRes.lines[i]);}++i;}cubRes.lines=nlines;}}}function doTotal(selection,cubRes,axBgn,axEnd){var aOverallPos=[];var bFirstO=false;var lastOverallPos=-1;for(var iAxO=axBgn;iAxO<axEnd;
++iAxO){var oAxPos=0;var tPos=-1;if(!cubRes.axis[iAxO]||cubRes.axis[iAxO].length==0){continue;}if(iAxO==cubRes.measureAxis){if(selection.aggsForMeasure.length<1||!cubRes.axis[iAxO]){continue;}var chkAgg=selection.aggsForMeasure[0];var iMAgg=1;var bCompat=true;while(iMAgg<selection.aggsForMeasure.length){if(chkAgg!=selection.aggsForMeasure[iMAgg]){bCompat=false;break;}++iMAgg;}if(!bCompat){continue;}}if(selection.hasAxisOverall(iAxO)){oAxPos=selection.overallAxis[iAxO].pos;lastOverallPos=oAxPos;bFirstO=true;tPos=0;}if(bFirstO){if(oAxPos<=0){var overallValue=Properties[getLocale()]["OverAll"];if(selection.hasAxisOverall(iAxO)){overallValue=selection.overallAxis[iAxO].getTxt();}var av=new AxisValue("OverAll",overallValue);if(oAxPos==0){av.formated="";}av.sppos=lastOverallPos;av.total=true;if(iAxO==cubRes.measureAxis){cubRes.format.push(cubRes.format[0]);}tPos=cubRes.axis[iAxO].push(av);tPos--;av.pos=tPos;}}aOverallPos[iAxO]=tPos;}var len=cubRes.lines.length;for(var key in selection.overallAxis){var overallAxis=selection.overallAxis[key];
if(!selection.hasAxisOverall(key)){continue;}var axisId=parseInt(key);if((axisId<axBgn)||(axisId>=axEnd)||!cubRes.axis[axisId]){continue;}var tmpMap=[];var i=0;var mapMeasAssoc=[];for(var idM=0;idM<selection.measuresToKeep.length;++idM){var m=selection.measuresToKeep[idM];if(m.idxCol<0){var iaM=0;while(iaM<m.assocM.length){if(m.assocM[iaM].removeExpl){var hm=new HoldAM(iaM);var itAx=0;while(itAx<selection.axis.length){var ax=selection.axis[itAx];if(ax){var itDimOnAx=0;var bRemove=true;while(itDimOnAx<ax.length){if(!m.assocM[iaM].removeExpl[ax[itDimOnAx]]){bRemove=false;}++itDimOnAx;}if(bRemove){hm.ignoredax.push(itAx);}}++itAx;}if(mapMeasAssoc[idM]==null){mapMeasAssoc[idM]=new HoldM();}mapMeasAssoc[idM].assocM.push(hm);}iaM++;}}}while(i<len){var pM=cubRes.lines[i].length-1;var dupLine=cubRes.lines[i].slice(0,pM);var iAxDup=axisId;while(iAxDup<axEnd){if(aOverallPos[iAxDup]!=undefined){dupLine[iAxDup]=aOverallPos[iAxDup];}++iAxDup;}var key=dupLine.toString();if(!tmpMap[key]){if(cubRes.lines[i][pM]){var m=null;
if(typeof overallAxis.agg!="undefined"&&overallAxis.agg!=null&&overallAxis.agg>=0){var d=cubRes.lines[i][pM].getVal(cubRes.lines[i],null,1);if(d!=null&&!isNaN(d)){m=new (aggIntToFunc(overallAxis.agg))(d);}}else{m=cubRes.lines[i][pM].clone();if(m.setTotal){m.setTotal();}m.aggsProtected=null;}if(m!=null){dupLine.push(m);cubRes.addLine(dupLine);tmpMap[key]=m;var lineTrans=mapMeasAssoc[cubRes.lines[i][selection.measureAxis]];if(lineTrans){lineTrans.convert(dupLine);}}}}else{var lineTrans=mapMeasAssoc[cubRes.lines[i][selection.measureAxis]];if(typeof overallAxis.agg!="undefined"&&overallAxis.agg!=null&&overallAxis.agg>=0){var d;if(lineTrans){d=lineTrans.convert(cubRes.lines[i]).getVal(cubRes.lines[i],null,1);}else{d=cubRes.lines[i][pM].getVal(cubRes.lines[i],null,1);}if(d!=null&&!isNaN(d)){tmpMap[key].aggValDbl(d);}}else{if(lineTrans){tmpMap[key].aggVal(lineTrans.convert(cubRes.lines[i]));}else{tmpMap[key].aggVal(cubRes.lines[i][pM]);}}}++i;}}}function PreparedSort(axis,id,sortf,onCaption){this.axis=axis;
this.id=id;this.sortf=sortf;this.onCaption=onCaption;}function PartitionSorter(cubRes,sel){var axisSortReady=[];this.sel=sel;var i=0;while(i<sel.valueSorters.length){var valSorter=sel.valueSorters[i];if(valSorter.linked){valSorter.valSortArray=valSorter.linked.valFilterArray;}++i;}this.arrSortRow=[];this.arrSortCol=[];i=0;while(i<sel.sortOrder.length){var s=sel.sortOrder[i];axisSortReady[s.axisId]=true;if(s.type!=S_MEASURE){var ordTbl=null;var sfunc=ssortAlpha;switch(s.type){case S_ALPHA:if(s.reverse){sfunc=ssortAlphaR;}else{sfunc=ssortAlpha;}break;case S_NUMERIC:if(s.reverse){sfunc=ssortnumR;}else{sfunc=ssortnum;}break;case S_CUSTOM:if(cubRes.axis.length>s.axisId){if(s.reverse){sfunc=ssortmeasR;}else{sfunc=ssortmeas;}ordTbl=[];var iAxM=0;var ax=cubRes.axis[s.axisId];while(iAxM<ax.length){ordTbl[iAxM]=ax[iAxM].cs;++iAxM;}break;}else{return;}}var prS=null;if(s.axisId<sel.pivot){prS=new PreparedSort(cubRes.axis[s.axisId],s.axisId,sfunc,s.onCaption);this.arrSortCol.push(prS);}else{prS=new PreparedSort(cubRes.axis[s.axisId],s.axisId-sel.pivot,sfunc,s.onCaption);
this.arrSortRow.push(prS);}if(ordTbl){prS.ordTbl=ordTbl;}}else{var valSorter=sel.sortOrder[i].vs;valSorter.valSortArray.sort(valSorter.sortFunc);var ordTbl=[];var iO=0;while(iO<valSorter.valSortArray.length){ordTbl[valSorter.valSortArray[iO].name]=iO;++iO;}var prS=null;var axisId=valSorter.sortAxis;if(axisId<sel.pivot){prS=new PreparedSort(cubRes.axis[axisId],axisId,ssortmeas,false);this.arrSortCol.push(prS);}else{prS=new PreparedSort(cubRes.axis[axisId],axisId-sel.pivot,ssortmeas,false);this.arrSortRow.push(prS);}prS.ordTbl=ordTbl;}++i;}for(var key in sel.overallAxis){var axId=parseInt(key);if(axId>=0&&axId<cubRes.axis.length){if(!axisSortReady[key]&&sel.hasAxisOverall(key)&&sel.overallAxis[key].pos==1){if(axId<sel.pivot){prS=new PreparedSort(cubRes.axis[axId],axId,null,false);this.arrSortCol.push(prS);}else{prS=new PreparedSort(cubRes.axis[axId],axId-sel.pivot,null,false);this.arrSortRow.push(prS);}}}}if(sel.measuresToKeep.length>0){if(sel.measureAxis<sel.pivot||sel.pivot==0){prS=new PreparedSort(cubRes.axis[sel.measureAxis],sel.measureAxis,null,false);
this.arrSortCol.push(prS);}else{prS=new PreparedSort(cubRes.axis[sel.measureAxis],sel.measureAxis-sel.pivot,null,false);this.arrSortRow.push(prS);}}}PartitionSorter.prototype.sort=function(cubRes){if(this.arrSortCol.length>0){cubRes.pTbl.colAxis.sort(partitionSortCol);}if(this.arrSortRow.length>0){cubRes.pTbl.rowAxis.sort(partitionSortRow);}};MidCube=function(){this.data=new Array();this.nupletListName=new Array();this.nupletListId=new Array();this.curNupletId=1;this.mapRSUM=[];};MidCube.prototype.generateSimple=function(dm,dataSize,selection){var dimsToFilter2=selection.prepareFilterRules();var filterRulesSize=selection.filterRules.length;this.curNupletId=1;var i=0;while(i<dataSize){var assKey=null;if(dimsToFilter2.length){var iF=0;var bfiltered=false;var bmatch=false;while(iF<dimsToFilter2.length){var id=dm.columns[dimsToFilter2[iF].dim.idxCol].data[i];if(id==-1){bmatch=true;}else{if(dimsToFilter2[iF].isOut(id)){bfiltered=true;break;}}++iF;}if(bfiltered){++i;continue;}if(bmatch&&selection.fks){assKey=selection.fks.buildKey(dm,i);
if(!selection.fks.keySet[assKey]){++i;continue;}}}if(filterRulesSize>0){var iF=0;var bfiltered=false;while(iF<filterRulesSize){var fRule=selection.filterRules[iF];if(fRule.isOut(dm,i)){bfiltered=true;break;}++iF;}if(bfiltered){++i;continue;}}var nuplet="";var iN=0;var validNuplet=true;for(iN=0;iN<selection.dimsToExplore.length;++iN){var dimEx=selection.dimsToExplore[iN];if(!dimEx.enabled||!dimEx.valid){continue;}if(nuplet.length!=0){nuplet+="-";}var mbrId=dm.columns[dimEx.dim.idxCol].data[i];if(mbrId<0){var keyToMbr=selection.fks.gKeyToMbr;if(assKey==null){assKey=selection.fks.buildKey(dm,i);}var mbrs=keyToMbr[assKey];if(mbrs==null){validNuplet=false;break;}for(var mbrR in mbrs){mbrId=mbrR;}}if(dimEx.useHierarchy()){if(dimEx.hierarchy.continuousGroup&&!dimEx.hierarchy.levels[dimEx.lPos].groupformula){nuplet+=dimEx.hierarchy.levels[dimEx.lPos].getGroupForValue(dimEx.dim.members[mbrId]);}else{var grp=dimEx.mbrs2GrpMbrs[mbrId];if(grp){nuplet+=grp[0];}else{validNuplet=false;break;}}}else{if(dimEx.transf){mbr=dimEx.transf(dimEx.dim.members[mbrId]);
var mbrList=getMemberPos(dimEx.dim,-1,-1,[mbr]);if(mbrList[0]==undefined){validNuplet=false;break;}mbrId=mbrList[0];}nuplet+=mbrId;}}if(validNuplet){this.injectNuplet(dm,selection,i,nuplet,false);}++i;}var multiDimContinuous=false;var dimCol=new Array();var cpt=0;for(var diToEx=0;diToEx<selection.dimsToExplore.length;++diToEx){var dimEx=selection.dimsToExplore[diToEx];var dim=dimEx.dim;if(dim.forceMembers){if(dim.continuous&&dim.time){if(cpt==0){dimCol.push(dim.idxCol);cpt++;}else{var newMDim=true;for(var id=0;id<dimCol.length;id++){if(dim.idxCol==dimCol[0]){cpt++;newMDim=false;}}if(newMDim){dimCol.push(dim.idxCol);}}}}}if(cpt>1&&this.curNupletId>1){multiDimContinuous=true;}for(var di=0;di<selection.dimsToExplore.length;di++){var dimEx=selection.dimsToExplore[di];var dim=dimEx.dim;if(dim.forceMembers){if(!dimEx.enabled||!dimEx.valid){continue;}for(var iM=0;iM<dim.members.length;iM++){var member=dim.members[iM];var posInMember=dim.getMemberPosById(member);if(posInMember==null){break;}var isFilter=false;
for(var fId=0;fId<dimsToFilter2.length;fId++){if(dimsToFilter2[fId].dim.name==dim.name){if(dimsToFilter2[fId].isOut(posInMember)){isFilter=true;}}}if(isFilter){continue;}if(this.curNupletId==1){var nuplet="";var npl=new Array();var nplGrpArray=new Array();var nplArrayComplement=new Array();var nplArray=new Array();for(var dimID=0;dimID<selection.dimsToExplore.length;dimID++){npl[dimID]=0;}for(var dimTE=0;dimTE<selection.dimsToExplore.length;dimTE++){npl[dimTE]=0;var dimE=selection.dimsToExplore[dimTE];var isInFilter=false;for(var dimTF=0;dimTF<dimsToFilter2.length;dimTF++){var posInMF="";var hPos="";var d=dimsToFilter2[dimTF].dim;var df=dimsToFilter2[dimTF];if(d.name==dimE.dim.name){var grpMembers=null;isInFilter=true;if(df.hierarchy==-1||df.level==-1){if(df.min!=undefined){posInMF=d.getMemberPosById(df.min);grpMembers=new Array();grpMembers.push(posInMF);}else{var memb=d.members[df.origIds[0]];posInMF=d.getMemberPosById(memb);grpMembers=df.origIds;}}else{grpMembers=d.hierarchies[df.hierarchy].levels[df.level].groups[df.origIds[0]].members;
posInMF=grpMembers[0];}if(dimE.useHierarchy()){var arrGrp=dimE.mbrs2GrpMbrs[posInMF];if(arrGrp){if(arrGrp.length>1){var grp=new Array();grp.push(dimTE);grp.push(arrGrp);nplGrpArray.push(grp);}var iG=0;while(iG<arrGrp.length){npl[dimTE]=arrGrp[iG];if(nplArrayComplement.length>0){for(var id=0;id<nplArrayComplement.length;id++){nplArrayComplement[id][dimTE]=arrGrp[iG];}}if(dimTE==selection.dimsToExplore.length-1){npl[dimTE]=arrGrp[iG];var nplClone=new Array();for(var j=0;j<npl.length;j++){nplClone[j]=npl[j];}nplArray.push(nplClone);}++iG;}}else{break;}}else{if(grpMembers.length>1){var grp=new Array();grp.push(dimTE);grp.push(grpMembers);nplGrpArray.push(grp);}for(var i=0;i<grpMembers.length;i++){hPos="";var tmpNup=nuplet;if(dimE.transf){mbr=dimE.transf(grpMembers[i]);var mbrList=getMemberPos(dimE.dim,-1,-1,[mbr]);if(mbrList[0]==undefined){break;}grpMembers[i]=mbrList[0];}hPos+=grpMembers[i];npl[dimTE]=hPos;if(nplArrayComplement.length>0){for(var id=0;id<nplArrayComplement.length;id++){nplArrayComplement[id][dimTE]=hPos;
}}if(dimTE==selection.dimsToExplore.length-1){var nplClone=new Array();for(var j=0;j<npl.length;j++){nplClone[j]=npl[j];}nplArray.push(nplClone);}}npl[dimTE]=hPos;}}}if(!isInFilter){if(dimE.useHierarchy()){var d=selection.dimsToExplore[dimTE].dim;for(var id=0;id<d.members.length;id++){var member=d.members[id];var posInMember=d.getMemberPosById(member);var vGrp=dimE.mbrs2GrpMbrs[posInMember];if(vGrp!=null){var ntemp=new Array();for(var j=0;j<npl.length;j++){ntemp[j]=npl[j];}ntemp[dimTE]=vGrp[0];nplArrayComplement.push(ntemp);}}}}}if(nplArrayComplement.length>0){for(var id=0;id<nplArrayComplement.length;id++){nplArray.push(nplArrayComplement[id]);}}if(nplArray.length==0){nplArray.push(npl);}if(nplGrpArray.length>0){var newNup=new Array();for(var idgrp=0;idgrp<nplGrpArray.length;idgrp++){for(var id=0;id<nplArray.length;id++){for(var idg=0;idg<nplGrpArray[idgrp][1].length;idg++){var nplClone=new Array();for(var j=0;j<nplArray[id].length;j++){nplClone[j]=nplArray[id][j];}var grp=nplGrpArray[idgrp][1];
nplClone[nplGrpArray[idgrp][0]]=grp[idg];newNup.push(nplClone);}}}for(var id=0;id<newNup.length;id++){nplArray.push(newNup[id]);}}for(var nplID=0;nplID<nplArray.length;nplID++){var nuplet="";for(var j=0;j<selection.dimsToExplore.length;j++){var npltmp=nplArray[nplID];if(nuplet.length==0){nuplet+=npltmp[j];}else{nuplet+="-"+npltmp[j];}}if(!this.nupletListId[nuplet]){this.injectNuplet(dm,selection,posInMember,nuplet,true);}}}else{var hierachyPos="";if(dimEx.useHierarchy()){if(dimEx.hierarchy.continuousGroup&&!dimEx.hierarchy.levels[dimEx.lPos].groupformula){hierachyPos+=dimEx.hierarchy.levels[dimEx.lPos].getGroupForValue(posInMember);}else{var grp=dimEx.mbrs2GrpMbrs[posInMember];if(grp){hierachyPos+=grp[0];}else{break;}}}else{if(dimEx.transf){mbr=dimEx.transf(posInMember);var mbrList=getMemberPos(dimEx.dim,-1,-1,[mbr]);if(mbrList[0]==undefined){break;}posInMember=mbrList[0];}hierachyPos+=posInMember;}if(multiDimContinuous&&dim.continuous&&dim.time){var nupId=1;while(nupId<this.curNupletId){var nuplet=truncNup(this.nupletListName[nupId],di,hierachyPos);
for(var otherDimId=0;otherDimId<selection.dimsToExplore.length;otherDimId++){var dimExplorer=selection.dimsToExplore[otherDimId];if(otherDimId!=di&&dimExplorer.dim.continuous&&dim.time&&dim.idxCol==dimExplorer.dim.idxCol){var dimtemp=dimExplorer.dim;if(!dimtemp.members[member]){var posInMemberTemp=dimtemp.getMemberPosById(member);if(posInMemberTemp==null){continue;}var hierachyPosOtherDim="";if(dimExplorer.useHierarchy()){var vGrp=dimExplorer.mbrs2GrpMbrs[posInMemberTemp];if(vGrp!=null){hierachyPosOtherDim+=vGrp[0];}else{break;}}else{if(dimExplorer.transf){mbr=dimExplorer.transf(posInMemberTemp);var mbrList=getMemberPos(dimExplorer.dim,-1,-1,[mbr]);if(mbrList[0]==undefined){break;}posInMemberTemp=mbrList[0];}hierachyPosOtherDim=posInMemberTemp;}nuplet=truncNup(nuplet,otherDimId,hierachyPosOtherDim);}}}if(!this.nupletListId[nuplet]){this.injectNuplet(dm,selection,posInMember,nuplet,true);}nupId++;}}else{var nupId=1;while(nupId<this.nupletListName.length){var nuplet=truncNup(this.nupletListName[nupId],di,hierachyPos);
if(!this.nupletListId[nuplet]){this.injectNuplet(dm,selection,posInMember,nuplet,true);}++nupId;}}}}}}};function truncNup(nup,dimPos,pos){var result="";var rN=nup.split("-");rN[dimPos]=pos;var splitLength=rN.length;for(var i=0;i<splitLength-1;i++){result+=rN[i]+"-";}result+=rN[splitLength-1];return result;}MidCube.prototype.injectNuplet=function(dm,selection,i,nuplet,forceInjection){var idx=this.nupletListId[nuplet];if(idx==undefined){this.nupletListId[nuplet]=this.curNupletId;this.nupletListName[this.curNupletId]=nuplet;this.data[this.curNupletId]=new Array();idx=this.curNupletId;++this.curNupletId;}var iMeasure=0;while(iMeasure<selection.measuresToKeep.length){var curMeasure=selection.measuresToKeep[iMeasure];if(curMeasure.idxCol<0||curMeasure instanceof MeasureDim){if(!this.data[idx][iMeasure]){this.data[idx][iMeasure]=new A_MV(curMeasure.formula,curMeasure.assocM.length,selection,this,iMeasure,nuplet,dm);}for(var iA=0;iA<curMeasure.assocM.length;++iA){var cube=curMeasure.assocM[iA].cube;
if(cube&&curMeasure.assocM[iA].explorers){if(!this.data[idx][iMeasure].isSet(iA)){var setNull=false;var elem=nuplet.split("-");var nupletDst="";for(var iEl=0;iEl<elem.length;++iEl){if(curMeasure.assocM[iA].removeExpl[iEl]){continue;}if(nupletDst.length>0){nupletDst+="-";}if(curMeasure.assocM[iA].changedNupletPos[iEl]!=null){var newId=curMeasure.assocM[iA].changedNupletPos[iEl][elem[iEl]];if(newId!=null){nupletDst+=newId;}else{setNull=true;this.data[idx][iMeasure].aggValDblU(iA,null,curMeasure.assocM[iA],-1);break;}}else{nupletDst+=elem[iEl];}}if(!setNull){var dstNupPos=cube.nupletListId[nupletDst];if(dstNupPos){cube.consumed[dstNupPos]=true;var val=cube.data[dstNupPos][curMeasure.assocM[iA].measurePosInCube];if(val){this.data[idx][iMeasure].aggProtect(iA);var agg=curMeasure.assocM[iA].agg;if(agg==A_DCOUNT||agg==A_CDCOUNT||agg==A_DMEMBER){agg=A_SUM;}this.data[idx][iMeasure].aggValDblU(iA,val.getVal(nuplet,cube,0),curMeasure.assocM[iA],-1);this.data[idx][iMeasure].setExpInfo(iA,dstNupPos);
}}}}continue;}if(curMeasure.assocM[iA].filter){var iF=0;var bfiltered=false;while(iF<curMeasure.assocM[iA].filter.length){if(curMeasure.assocM[iA].filter[iF].isOut(dm.columns[curMeasure.assocM[iA].filter[iF].dim.idxCol].data[i])){bfiltered=true;break;}++iF;}if(bfiltered){continue;}}var val=null;if(!forceInjection){val=curMeasure.assocM[iA].getCVal(dm.columns,i);if(val!=null){this.data[idx][iMeasure].aggValDblU(iA,val,curMeasure.assocM[iA],i);}else{if(curMeasure.assocM[iA].agg.name=="A_ARSUM"){this.data[idx][iMeasure].aggValDblU(iA,val,curMeasure.assocM[iA],i);}}}else{val=null;if(curMeasure.assocM[iA].agg==A_DMEMBER){val=curMeasure.assocM[iA].getValStrFromIdx(i);this.data[idx][iMeasure].aggValDblU(iA,val,curMeasure.assocM[iA],i);}}}}else{if(!forceInjection){val=dm.columns[curMeasure.idxCol].data[i];}else{val=null;}if(val!=null){if(!this.data[idx][iMeasure]){var param=null;if(selection.paramForMeasure.length>iMeasure){param=selection.paramForMeasure[iMeasure];}this.data[idx][iMeasure]=new selection.expAggsForMeasure[iMeasure](val,this,iMeasure,nuplet,dm,param,i);
}else{this.data[idx][iMeasure].aggValDbl(val,nuplet,i);}}else{if(selection.retainNull){if(!this.data[idx][iMeasure]){var param=null;if(selection.paramForMeasure.length>iMeasure){param=selection.paramForMeasure[iMeasure];}this.data[idx][iMeasure]=new selection.expAggsForMeasure[iMeasure](val,this,iMeasure,nuplet,dm,param,i);}}}}++iMeasure;}};function fillGroupDown(availableGroup,g,grpId,h,curLvl,tgtLvl){if(curLvl<tgtLvl){return;}if(curLvl==tgtLvl){availableGroup[grpId]=true;}else{var nextLvl=curLvl-1;var l=h.levels[nextLvl];var gMember=g.members;for(var iG=0;iG<gMember.length;++iG){var groupId=gMember[iG];var nextGrp=l.groups[groupId];fillGroupDown(availableGroup,nextGrp,groupId,h,nextLvl,tgtLvl);}}}function fillGroupUp(availableGroup,grpId,h,curLvl,tgtLvl){if(curLvl>tgtLvl){return;}if(curLvl==tgtLvl){availableGroup[grpId]=true;}else{var nextLvl=curLvl+1;var l=h.levels[nextLvl];var groups=l.groups;for(var iG=0;iG<groups.length;++iG){var group=groups[iG];if(group.isIdIn(grpId)){fillGroupUp(availableGroup,iG,h,nextLvl,tgtLvl);
}}}}function getExplorerLimitGroup(selection){var dimexLimitGroup={};var aDimExp=selection.dimsToExplore;for(var iExp=0;iExp<aDimExp.length;++iExp){var dimEx=aDimExp[iExp];if(!dimEx.complexGroup){continue;}var exHPos=dimEx.hPos;var exLPos=dimEx.lPos;var d=dimEx.dim;var fb=selection.getFilterByDimension(d);if(fb!=null){var fHPos=fb.hierarchy;if(fHPos==exHPos){var fLPos=fb.level;if(fLPos>=0){var h=d.hierarchies[fHPos];var l=h.levels[fLPos];var availableGroup={};if(fLPos>=exLPos){var fGroups=fb.origIds;for(var iFGidx=0;iFGidx<fGroups.length;++iFGidx){var grpId=fGroups[iFGidx];var fg=l.groups[grpId];fillGroupDown(availableGroup,fg,grpId,h,fLPos,exLPos);}}else{var fGroups=fb.origIds;for(var iFGidx=0;iFGidx<fGroups.length;++iFGidx){var grpId=fGroups[iFGidx];fillGroupUp(availableGroup,grpId,h,fLPos,exLPos);}}dimexLimitGroup[iExp]=availableGroup;}}}}return dimexLimitGroup;}MidCube.prototype.generate=function(dm,dataSize,selection){var dimsToFilter2=selection.prepareFilterRules();var filterRulesSize=selection.filterRules.length;
this.curNupletId=1;var i=0;var dimexLimitGroup=getExplorerLimitGroup(selection);while(i<dataSize){var assKey=null;if(dimsToFilter2.length){var iF=0;var bfiltered=false;var bmatch=false;while(iF<dimsToFilter2.length){var id=dm.columns[dimsToFilter2[iF].dim.idxCol].data[i];if(id==-1){bmatch=true;}else{if(dimsToFilter2[iF].isOut(id)){bfiltered=true;break;}}++iF;}if(bfiltered){++i;continue;}if(bmatch&&selection.fks){assKey=selection.fks.buildKey(dm,i);if(!selection.fks.keySet[assKey]){++i;continue;}}}if(filterRulesSize>0){var iF=0;var bfiltered=false;while(iF<filterRulesSize){var fRule=selection.filterRules[iF];if(fRule.isOut(dm,i)){bfiltered=true;break;}++iF;}if(bfiltered){++i;continue;}}var array=[];var iN=0;var validNuplet=true;var curNup=[];for(iN=0;iN<selection.dimsToExplore.length;++iN){curNup.push(-1);}array.push(curNup);for(iN=0;iN<selection.dimsToExplore.length;++iN){var dimEx=selection.dimsToExplore[iN];if(!dimEx.enabled||!dimEx.valid){continue;}var nuplArray=new Array();var idx=0;
while(idx<array.length){var curNup=array[idx];var mbrId1=curNup[iN];if(mbrId1<0){mbrId1=dm.columns[dimEx.dim.idxCol].data[i];}var mbrLst=[];if(mbrId1<0){var keyToMbr=selection.fks.gKeyToMbr;if(assKey==null){assKey=selection.fks.buildKey(dm,i);}var mbrs=keyToMbr[assKey];if(mbrs==null){validNuplet=false;break;}for(var mbrR in mbrs){mbrLst.push(mbrR);}}else{mbrLst.push(mbrId1);}var savNup=curNup.slice();for(var iLst=0;iLst<mbrLst.length;++iLst){curNup=savNup.slice();if(mbrId1<0){var nupStr=mbrLst[iLst];var nupTgt=nupStr.split(",");for(var iC=0;iC<nupTgt.length;++iC){if(nupTgt[iC]>=0){curNup[iC]=nupTgt[iC];}}}else{curNup[iN]=mbrId1;}mbrId=curNup[iN];if(mbrId<0){continue;}if(dimEx.useHierarchy()){if(dimEx.hierarchy.continuousGroup&&!dimEx.hierarchy.levels[dimEx.lPos].groupformula){curNup[iN]=dimEx.hierarchy.levels[dimEx.lPos].getGroupForValue(dimEx.dim.members[mbrId]);nuplArray.push(curNup);}else{var arrGrp=dimEx.mbrs2GrpMbrs[mbrId];if(arrGrp){var iG=0;var validGroups=dimexLimitGroup[iN];while(iG<arrGrp.length){var grpId=arrGrp[iG];
if(validGroups==null||validGroups[grpId]){if(iG>0){curNup=curNup.slice(0,curNup.length);}curNup[iN]=grpId;nuplArray.push(curNup);}++iG;}}else{validNuplet=false;break;}}}else{if(dimEx.transf){mbr=dimEx.transf(dimEx.dim.members[mbrId]);var mbrList=getMemberPos(dimEx.dim,-1,-1,[mbr]);if(mbrList[0]==undefined){validNuplet=false;break;}mbrId=mbrList[0];}curNup[iN]=mbrId;nuplArray.push(curNup);}if(!validNuplet){break;}}if(!validNuplet){break;}++idx;}if(!validNuplet){break;}array=nuplArray;}if(validNuplet){var iNupl=0;while(iNupl<array.length){var nuplet=array[iNupl];this.injectNuplet(dm,selection,i,nuplet.join("-"),false);++iNupl;}}++i;}var multiDimContinuous=false;var dimCol=new Array();var cpt=0;for(var diToEx=0;diToEx<selection.dimsToExplore.length;++diToEx){var dimEx=selection.dimsToExplore[diToEx];var dim=dimEx.dim;if(dim.forceMembers){if(dim.continuous&&dim.time){if(cpt==0){dimCol.push(dim.idxCol);cpt++;}else{var newMDim=true;for(var id=0;id<dimCol.length;id++){if(dim.idxCol==dimCol[0]){cpt++;
newMDim=false;}}if(newMDim){dimCol.push(dim.idxCol);}}}}}if(cpt>1&&this.curNupletId>1){multiDimContinuous=true;}var di=0;while(di<selection.dimsToExplore.length){var dimEx=selection.dimsToExplore[di];var dim=dimEx.dim;if(dim.forceMembers){if(!dimEx.enabled||!dimEx.valid){continue;}for(var iM=0;iM<dim.members.length;iM++){var member=dim.members[iM];var posInMember=dim.getMemberPosById(member);if(posInMember==null){break;}var isFilter=false;for(var fId=0;fId<dimsToFilter2.length;fId++){if(dimsToFilter2[fId].dim.name==dim.name){if(dimsToFilter2[fId].isOut(posInMember)){isFilter=true;}}}if(isFilter){continue;}if(this.curNupletId==1){var nuplet="";var npl=new Array();var nplArrayComplement=new Array();var nplGrpArray=new Array();var nplArray=new Array();for(var dimID=0;dimID<selection.dimsToExplore.length;dimID++){npl[dimID]=0;}for(var dimTE=0;dimTE<selection.dimsToExplore.length;dimTE++){npl[dimTE]=0;var dimE=selection.dimsToExplore[dimTE];var isInFilter=false;for(var dimTF=0;dimTF<dimsToFilter2.length;
dimTF++){var posInMF="";var hPos="";var d=dimsToFilter2[dimTF].dim;var df=dimsToFilter2[dimTF];if(d.name==dimE.dim.name){isInFilter=true;var grpMembers=null;if(df.hierarchy==-1||df.level==-1){if(df.min!=undefined){posInMF=d.getMemberPosById(df.min);grpMembers=new Array();grpMembers.push(posInMF);}else{var memb=d.members[df.origIds[0]];posInMF=d.getMemberPosById(memb);grpMembers=df.origIds;}}else{grpMembers=d.hierarchies[df.hierarchy].levels[df.level].groups[df.origIds[0]].members;posInMF=grpMembers[0];}if(dimE.useHierarchy()){var arrGrp=dimE.mbrs2GrpMbrs[posInMF];if(arrGrp){if(arrGrp.length>1){var grp=new Array();grp.push(dimTE);grp.push(arrGrp);nplGrpArray.push(grp);}var iG=0;while(iG<arrGrp.length){npl[dimTE]=arrGrp[iG];if(nplArrayComplement.length>0){for(var id=0;id<nplArrayComplement.length;id++){nplArrayComplement[id][dimTE]=arrGrp[iG];}}if(dimTE==selection.dimsToExplore.length-1){npl[dimTE]=arrGrp[iG];var nplClone=new Array();for(var j=0;j<npl.length;j++){nplClone[j]=npl[j];}nplArray.push(nplClone);
}++iG;}}else{break;}}else{if(grpMembers.length>1){var grp=new Array();grp.push(dimTE);grp.push(grpMembers);nplGrpArray.push(grp);}for(var i=0;i<grpMembers.length;i++){hPos="";var tmpNup=nuplet;if(dimE.transf){mbr=dimE.transf(grpMembers[i]);var mbrList=getMemberPos(dimE.dim,-1,-1,[mbr]);if(mbrList[0]==undefined){break;}grpMembers[i]=mbrList[0];}hPos+=grpMembers[i];npl[dimTE]=hPos;if(nplArrayComplement.length>0){for(var id=0;id<nplArrayComplement.length;id++){nplArrayComplement[id][dimTE]=hPos;}}if(dimTE==selection.dimsToExplore.length-1){var nplClone=new Array();for(var j=0;j<npl.length;j++){nplClone[j]=npl[j];}nplArray.push(nplClone);}}npl[dimTE]=hPos;}}}if(!isInFilter){if(dimE.useHierarchy()){var d=selection.dimsToExplore[dimTE].dim;for(var id=0;id<d.members.length;id++){var member=d.members[id];var posInMember=d.getMemberPosById(member);var vGrp=dimE.mbrs2GrpMbrs[posInMember];if(vGrp!=null){var ntemp=new Array();for(var j=0;j<npl.length;j++){ntemp[j]=npl[j];}ntemp[dimTE]=vGrp[0];nplArrayComplement.push(ntemp);
}}}}}if(nplArrayComplement.length>0){for(var id=0;id<nplArrayComplement.length;id++){nplArray.push(nplArrayComplement[id]);}}if(nplArray.length==0){nplArray.push(npl);}if(nplGrpArray.length>0){var newNup=new Array();for(var idgrp=0;idgrp<nplGrpArray.length;idgrp++){for(var id=0;id<nplArray.length;id++){for(var idg=0;idg<nplGrpArray[idgrp][1].length;idg++){var nplClone=new Array();for(var j=0;j<nplArray[id].length;j++){nplClone[j]=nplArray[id][j];}var grp=nplGrpArray[idgrp][1];nplClone[nplGrpArray[idgrp][0]]=grp[idg];newNup.push(nplClone);}}}for(var id=0;id<newNup.length;id++){nplArray.push(newNup[id]);}}for(var nplID=0;nplID<nplArray.length;nplID++){var nuplet="";for(var j=0;j<selection.dimsToExplore.length;j++){var npltmp=nplArray[nplID];if(nuplet.length==0){nuplet+=npltmp[j];}else{nuplet+="-"+npltmp[j];}}if(!this.nupletListId[nuplet]){this.injectNuplet(dm,selection,posInMember,nuplet,true);}}}else{var nplGrpArray=new Array();var hierachyPos="";if(dimEx.useHierarchy()){var arrGrp=dimEx.mbrs2GrpMbrs[posInMember];
if(arrGrp){var grp=new Array();grp.push(di);grp.push(arrGrp);nplGrpArray.push(grp);}else{break;}}else{if(dimEx.transf){mbr=dimEx.transf(posInMember);var mbrList=getMemberPos(dimEx.dim,-1,-1,[mbr]);if(mbrList[0]==undefined){break;}posInMember=mbrList[0];}var grp=new Array();grp.push(di);var grpMembers=new Array();grpMembers.push(posInMember);grp.push(grpMembers);nplGrpArray.push(grp);}if(multiDimContinuous&&dim.continuous&&dim.time){for(var idgrp=0;idgrp<nplGrpArray.length;idgrp++){var nupId=1;while(nupId<this.curNupletId){var obj=nplGrpArray[idgrp];var groupM=obj[1];for(var idg=0;idg<groupM.length;idg++){var nuplet=truncNup(this.nupletListName[nupId],obj[0],groupM[idg]);for(var otherDimId=0;otherDimId<selection.dimsToExplore.length;otherDimId++){var dimExplorer=selection.dimsToExplore[otherDimId];if(otherDimId!=di&&dimExplorer.dim.continuous&&dim.time&&dim.idxCol==dimExplorer.dim.idxCol){var dimtemp=dimExplorer.dim;if(!dimtemp.members[member]){var posInMemberTemp=dimtemp.getMemberPosById(member);
if(posInMemberTemp==null){continue;}var hierachyPosOtherDim="";if(dimExplorer.useHierarchy()){var vGrp=dimExplorer.mbrs2GrpMbrs[posInMemberTemp];if(vGrp!=null){hierachyPosOtherDim+=vGrp[0];}else{break;}}else{if(dimExplorer.transf){mbr=dimExplorer.transf(posInMemberTemp);var mbrList=getMemberPos(dimExplorer.dim,-1,-1,[mbr]);if(mbrList[0]==undefined){break;}posInMemberTemp=mbrList[0];}hierachyPosOtherDim=posInMemberTemp;}nuplet=truncNup(nuplet,otherDimId,hierachyPosOtherDim);}}}if(!this.nupletListId[nuplet]){this.injectNuplet(dm,selection,posInMemberTemp,nuplet,true);}}nupId++;}}}else{for(var idgrp=0;idgrp<nplGrpArray.length;idgrp++){for(var nupId=1;nupId<this.curNupletId;nupId++){var obj=nplGrpArray[idgrp];var groupM=obj[1];for(var idg=0;idg<groupM.length;idg++){var nuplet=truncNup(this.nupletListName[nupId],obj[0],groupM[idg]);if(!this.nupletListId[nuplet]){this.injectNuplet(dm,selection,posInMember,nuplet,true);}}}}}}}}++di;}};MidCube.prototype.prepareAxis=function(selection){this.axis=[];
this.axisIds=[];this.axisNup=[];var i=0;while((i<selection.axis.length)||(i<=selection.measureAxis)){this.axis[i]=[];this.axisIds[i]={};this.axisNup[i]={};++i;}var nupletId=1;while(nupletId<this.curNupletId){var cols=this.nupletListName[nupletId].split("-");var axisId=0;while(axisId<selection.axis.length){var axNup=buildAxisNup(selection,axisId,cols);if(axNup.length>0){var axVal=this.axisNup[axisId][axNup];if(axVal==null){axVal=buildAxisMbr(selection,axisId,cols);if(axVal){if(selection.measureAxis!=axisId){var pos=this.axisIds[axisId][axVal.id];if(pos==undefined||(typeof pos!="number")){pos=this.axis[axisId].push(axVal);pos--;axVal.pos=pos;this.axisIds[axisId][axVal.id]=pos;}}}this.axisNup[axisId][axNup]=axVal;}}++axisId;}++nupletId;}};DepCubeHolder=function(meas,sel){this.masterMeas=meas;this.sel=sel;};DataModel.prototype.getDependentSelection=function(selection){var selectionList=[];var dxByIdCol=[];for(var iN=0;iN<selection.dimsToExplore.length;++iN){var dimEx=selection.dimsToExplore[iN];
if(!dimEx.enabled||!dimEx.valid){continue;}dxByIdCol[dimEx.dim.idxCol]=dimEx;}var ctxtByName=[];var iMeasure=0;while(iMeasure<selection.measuresToKeep.length){var curMeasure=selection.measuresToKeep[iMeasure];if(curMeasure.idxCol<0){for(var iA=0;iA<curMeasure.assocM.length;++iA){var assocObj=curMeasure.assocM[iA];if(assocObj.explorers){var iEx=0;var ctxtStack=[];var explStack=[];var tempExpl=[];var removeExpl={};var transfExpl={};assocObj.removeExpl=[];while(iEx<assocObj.explorers.length){var expl=assocObj.explorers[iEx];tempExpl[expl.dim.id]=expl;var dimEx=dxByIdCol[expl.dim.idxCol];explStack.push(expl);if(dimEx!=null){if(expl.levelup>0){var dx=new DimExplorer(dimEx.dim,dimEx.hPos,dimEx.lPos+expl.levelup,true,dimEx.format);dx.up=expl.levelup;ctxtStack.push(dx);}else{if(expl.transf){transfExpl[dimEx.dim.idxCol]=expl.transf;}else{removeExpl[dimEx.dim.idxCol]=true;}}}else{if(expl.transf){transfExpl[expl.dim.idxCol]=expl.transf;}}++iEx;}ctxtStack.sort(sortDimExpl);var ctxtName=assocObj.getKey();
iEx=0;var ignoredDimId={};while(iEx<ctxtStack.length){var dimEx=ctxtStack[iEx];ignoredDimId[dimEx.dim.idxCol]=iEx;++iEx;}explStack.sort(sortDimExpl);var iExpl=0;while(iExpl<explStack.length){var expl=explStack[iExpl];ctxtName+="_"+expl.getKey();++iExpl;}if(ctxtByName[ctxtName]==null){var nsel=new DataModelSelection();ctxtByName[ctxtName]=new DepCubeHolder(assocObj,nsel);for(var iN=0;iN<selection.dimsToExplore.length;++iN){var dimEx=selection.dimsToExplore[iN];if(transfExpl[dimEx.dim.idxCol]){var ndimEx=new DimExplorer(dimEx.dim,dimEx.hPos,dimEx.lPos,dimEx.enabled,dimEx.format,transfExpl[dimEx.dim.idxCol]);nsel.dimsToExplore.push(ndimEx);}else{if(!removeExpl[dimEx.dim.idxCol]){if(ignoredDimId[dimEx.dim.idxCol]!=null){nsel.dimsToExplore.push(ctxtStack[ignoredDimId[dimEx.dim.idxCol]]);}else{nsel.dimsToExplore.push(dimEx);}}else{assocObj.removeExpl[iN]=true;}}}for(var iN=0;iN<selection.dimsToFilter.length;++iN){var dimFilter=selection.dimsToFilter[iN].clone();if(transfExpl[dimFilter.dim.idxCol]){dimFilter.transf=transfExpl[dimFilter.dim.idxCol];
}if(tempExpl[dimFilter.dim.id]==null||tempExpl[dimFilter.dim.id].navigation){nsel.dimsToFilter.push(dimFilter);}}for(var iN=0;iN<selection.filterRules.length;++iN){var filterRule=selection.filterRules[iN];var newFR=new FilterRule(filterRule.name);for(var iF=0;iF<filterRule.filters.length;iF++){var dimFilter=filterRule.filters[iF].clone();if(tempExpl[dimFilter.dim.id]==null||tempExpl[dimFilter.dim.id].navigation){newFR.addFilter(dimFilter);}}nsel.filterRules.push(newFR);}var filters=assocObj.filter;for(var iN=0;iN<filters.length;++iN){nsel.dimsToFilter.push(filters[iN]);}nsel.forAssoc=[];assocObj.changedNupletPos=[];for(var iN=0;iN<nsel.dimsToExplore.length;++iN){var dimEx=nsel.dimsToExplore[iN];if(ignoredDimId[dimEx.dim.idxCol]!=null){assocObj.changedNupletPos[iN]=dimEx.getAssocMembers();}}assocObj.measurePosInCube=nsel.measuresToKeep.length;assocObj.cube=null;if(!assocObj.dimension){nsel.addMeasureWithParam(assocObj.measure,assocObj);}else{var assocDimension=assocObj;var measureDim=new MeasureDim(assocDimension.dimension.id+"_dcount",assocDimension);
nsel.addMeasure(measureDim,null,assocObj.agg);}nsel.forAssoc.push(assocObj);nsel.prepare();selectionList.push(nsel);}else{var dCube=ctxtByName[ctxtName];assocObj.changedNupletPos=dCube.masterMeas.changedNupletPos;assocObj.measurePosInCube=dCube.masterMeas.measurePosInCube;assocObj.removeExpl=dCube.masterMeas.removeExpl;dCube.sel.forAssoc.push(assocObj);}}}}++iMeasure;}return selectionList;};DimExplorer.prototype.recurseAssocMembers=function(assocTable,cur,iG,lvl,mbrs){var nbMbrs=mbrs.length;if(cur==this.up){for(var iM=0;iM<nbMbrs;++iM){assocTable[mbrs[iM]]=iG;}}else{var groups=this.hierarchy.levels[lvl].groups;for(var iM=0;iM<nbMbrs;++iM){this.recurseAssocMembers(assocTable,cur+1,iG,lvl-1,groups[mbrs[iM]].members);}}};DimExplorer.prototype.getAssocMembers=function(){var assocTable=[];if(this.hierarchy&&this.lPos>=0&&this.lPos<this.hierarchy.levels.length){if(this.dim.continuous){if(this.lPos-this.up>=0){var groups=this.hierarchy.levels[this.lPos-this.up].groups;var nbGroups=groups.length;
for(var iG=0;iG<nbGroups;++iG){var mbrs=groups[iG].members;if(mbrs.length>0){var mbr=mbrs[0];var grpId=this.hierarchy.levels[this.lPos].getGroupIdForMemberId(mbr);assocTable[iG]=grpId;}}}else{var nbMbrs=this.dim.members.length;for(var iM=0;iM<nbMbrs;++iM){var grpId=this.hierarchy.levels[this.lPos].getGroupIdForMemberId(iM);assocTable[iM]=grpId;}}}else{var groups=this.hierarchy.levels[this.lPos].groups;var nbGroups=groups.length;for(var iG=0;iG<nbGroups;++iG){var mbrs=groups[iG].members;this.recurseAssocMembers(assocTable,1,iG,this.lPos-1,mbrs);}}}return assocTable;};DataModel.prototype.getDataFromSelectionComplexGroup=function(selection){var dataSize=0;for(var j=0;j<this.columns.length;j++){if(dataSize<this.columns[j].data.length){dataSize=this.columns[j].data.length;}}var selectionList=this.getDependentSelection(selection);for(var cubeId=0;cubeId<selectionList.length;++cubeId){var mcube=new MidCube();mcube.generate(this,dataSize,selectionList[cubeId]);mcube.consumed={};mcube.selection=selection;
selectionList[cubeId].genCube=mcube;for(var asM=0;asM<selectionList[cubeId].forAssoc.length;++asM){selectionList[cubeId].forAssoc[asM].cube=mcube;}}var mcube=new MidCube();mcube.generate(this,dataSize,selection);for(var cubeId=0;cubeId<selectionList.length;++cubeId){var icube=selectionList[cubeId].genCube;var iNup=1;while(iNup<icube.curNupletId){if(!icube.consumed[iNup]){mcube.injectNuplet(this,selection,-1,icube.nupletListName[iNup],false);}++iNup;}}return this.cubeExpand(selection,mcube.curNupletId,mcube.nupletListName,mcube.data);};NavFilter=function(axis,values,remove){this.axis=axis;this.values=values;this.remove=remove;};ValueText=function(txt,duration,filter){this.txt=txt;this.duration=duration;this.filter=filter;};function sortAlpha(a,b){if(a==null||a.id==""){if(b==null||b.id==""){return 0;}return 1;}if(b==null||b.id==""){return -1;}if(a.id==b.id){return 0;}return a.id>b.id?1:-1;}function sortAlphaR(a,b){if(a==null||a.id==""){if(b==null||b.id==""){return 0;}return 1;}if(b==null||b.id==""){return -1;
}if(a.id==b.id){return 0;}return a.id>b.id?-1:1;}function sortAlphaCaption(a,b){if(a==null||a.formated==""){if(b==null||b.formated==""){return 0;}return 1;}if(b==null||b.formated==""){return -1;}if(a.formated==b.formated){return 0;}return a.formated>b.formated?1:-1;}function sortAlphaRCaption(a,b){if(a==null||a.formated==""){if(b==null||b.formated==""){return 0;}return 1;}if(b==null||b.formated==""){return -1;}if(a.formated==b.formated){return 0;}return a.formated>b.formated?-1:1;}function sortnum(a,b){if(a==null||a.id==null||isNaN(a.id)){if(b==null||b.id==null||isNaN(b.id)){return 0;}return 1;}if(b==null||b.id==null||isNaN(b.id)){return -1;}return a.id-b.id;}function sortnumR(a,b){if(b==null||b.id==null||isNaN(b.id)){if(a==null||a.id==null||isNaN(a.id)){return 0;}return -1;}if(a==null||a.id==null||isNaN(a.id)){return 1;}return b.id-a.id;}function sortCustom(a,b){if(a==null){if(b==null){return 0;}return -b.cs;}if(b==null){return a.cs;}return a.cs-b.cs;}function sortCustomR(a,b){if(a==null){if(b==null){return 0;
}return b.cs;}if(b==null){return -a.cs;}return b.cs-a.cs;}function valIsNullOrNaN(val){return val==null||val.isNull()||isNaN(val.getVal());}function sortCubeTop(a,b){if(valIsNullOrNaN(a.val)){if(valIsNullOrNaN(b.val)){return 0;}return 1;}if(valIsNullOrNaN(b.val)){return -1;}return b.val.getVal()-a.val.getVal();}function sortCubeBottom(a,b){if(valIsNullOrNaN(a.val)){if(valIsNullOrNaN(b.val)){return 0;}return 1;}if(valIsNullOrNaN(b.val)){return -1;}return a.val.getVal()-b.val.getVal();}function prepareRange(range){var rng=[];if(typeof range[0]=="string"){rng[0]=getDDVar(range[0]);}else{rng[0]=range[0];}if(typeof range[1]=="string"){rng[1]=getDDVar(range[1]);}else{rng[1]=range[1];}return rng;}function isInRange(val,range){if(valIsNullOrNaN(val)){return false;}if((range[0]!=null)&&(val.getVal()<range[0])){return false;}if((range[1]!=null)&&(val.getVal()>range[1])){return false;}return true;}function ssortAlpha(a,b){var aNullOrEmpty=(a==null||a=="");var bNullOrEmpty=(b==null||b=="");if(aNullOrEmpty&&bNullOrEmpty){return 0;
}else{if(aNullOrEmpty){return 1;}else{if(bNullOrEmpty){return -1;}else{if(a==b){return 0;}else{return a>b?1:-1;}}}}}function ssortAlphaR(a,b){var aNullOrEmpty=(a==null||a=="");var bNullOrEmpty=(b==null||b=="");if(aNullOrEmpty&&bNullOrEmpty){return 0;}else{if(aNullOrEmpty){return 1;}else{if(bNullOrEmpty){return -1;}else{if(a==b){return 0;}else{return a>b?-1:1;}}}}}function ssortnum(a,b){var aNullOrNaN=(a==null||isNaN(a));var bNullOrNaN=(b==null||isNaN(b));if(aNullOrNaN&&bNullOrNaN){return 0;}else{if(aNullOrNaN){return 1;}else{if(bNullOrNaN){return -1;}else{return a-b;}}}}function ssortnumR(a,b){var aNullOrNaN=(a==null||isNaN(a));var bNullOrNaN=(b==null||isNaN(b));if(aNullOrNaN&&bNullOrNaN){return 0;}else{if(aNullOrNaN){return 1;}else{if(bNullOrNaN){return -1;}else{return b-a;}}}}function ssortmeas(a,b,ordTbl){var iA=ordTbl[a];var iB=ordTbl[b];return ssortnum(iA,iB);}function ssortmeasR(a,b,ordTbl){var iA=ordTbl[a];var iB=ordTbl[b];return ssortnumR(iA,iB);}function partitionSortCol(a,b){return partitionSortGen(pS.arrSortCol,a,b);
}function partitionSortRow(a,b){return partitionSortGen(pS.arrSortRow,a,b);}function partitionSortGen(arrSort,a,b){var i=0;while(i<arrSort.length){var p=arrSort[i];if(!p.axis){++i;continue;}if(p.sortf==null){if(a[p.id]>b[p.id]){return 1;}if(a[p.id]<b[p.id]){return -1;}++i;continue;}if(p.axis[a[p.id]].sppos){if(p.axis[b[p.id]].sppos){if(p.axis[b[p.id]].sppos!=p.axis[a[p.id]].sppos){if(p.axis[b[p.id]].sppos==-1){return -1;}return 1;}++i;continue;}return p.axis[a[p.id]].sppos*(-1);}if(p.axis[b[p.id]].sppos){return p.axis[b[p.id]].sppos;}var r=0;if(p.ordTbl!=undefined){r=p.sortf(a[p.id],b[p.id],p.ordTbl);}else{if(p.onCaption){r=p.sortf(p.axis[a[p.id]].formated,p.axis[b[p.id]].formated,p.ordTbl);}else{r=p.sortf(p.axis[a[p.id]].id,p.axis[b[p.id]].id,p.ordTbl);}}if(r!=0){return r;}++i;}return 0;}function sortDimExpl(a,b){return a.dim.idxCol-b.dim.idxCol;}DataModelSelection.prototype.addDerivedTransfoMeasure=function(derivedName,mName,agg,dimName,transfoId,transfoFunc){var srcMeas=this.findMeasure(mName);
if(!srcMeas){return null;}var aExpl=new AssocExplorer(this.dm.objName[dimName],-1,true,transfoFunc,transfoId);var measAgg=srcMeas.agg;var iMeas=this.indexOfMeasure(srcMeas.id);if(iMeas>-1){measAgg=this.aggsForMeasure[iMeas];}var aggFunc=aggIntToFunc(measAgg);if(aggFunc==A_RSUM){aggFunc=A_SUM;}var aM=[new AssocMeasures(srcMeas,aggFunc,[],[aExpl])];var meas=this.expandDerivedCalculation(derivedName,"'"+encodeMeasureName(mName)+"'",srcMeas.format,null,aM);if(meas){this.addMeasure(meas,null,0,meas.format,false,false);this.chartMeasures.push(meas);}return meas;};function encodeMeasureName(mName){return mName.replace(/\\/g,"\\\\").replace(/\'/g,"\\'");}function decodeMeasureName(mName){return mName.replace(/\\\'/g,"'").replace(/\\\\/g,"\\");}function FormulaTokenizer(formula,dmsel){this.formula=formula;this.dmsel=dmsel;this.start=0;this.oBrack=this.formula.indexOf("'",this.start);this.aggTokens={"(sum)":AGG_SUM,"(avg)":AGG_AVG,"(min)":AGG_MIN,"(max)":AGG_MAX,"(or)":AGG_OR,"(med)":AGG_MEDIAN,"(dcount)":AGG_DCOUNT,"(dmember)":AGG_DMEMBER};
this.aggNames={};for(var i in this.aggTokens){this.aggNames[this.aggTokens[i]]=i;}}FormulaTokenizer.prototype.nextToken=function(){var ret=null;if(this.start<this.oBrack){ret=this.formula.substring(this.start,this.oBrack);this.start=this.oBrack;}else{if(this.oBrack>=0){var cBrack=-1;var cSearch=this.oBrack+1;while(cBrack<0){cBrack=this.formula.indexOf("'",cSearch);if(cBrack==-1){cBrack=this.formula.length-1;break;}if(this.formula.charAt(cBrack-1)=="\\"){cSearch=cBrack+1;cBrack=-1;}}var mNameEnc=this.formula.substring(this.oBrack+1,cBrack);var mName=decodeMeasureName(mNameEnc);var oObj=this.dmsel.findMeasure(mName);var forcedAgg=null;if(!oObj){for(var tt in this.aggTokens){var ind2=mName.lastIndexOf(tt);if(ind2>-1&&ind2==mName.length-tt.length){mName=mName.substring(0,ind2);forcedAgg=this.aggTokens[tt];break;}}oObj=this.dmsel.findMeasure(mName);}if(oObj){ret={obj:oObj,forcedAgg:forcedAgg};}else{ret=this.formula.substring(this.oBrack,cBrack+1);}this.start=cBrack+1;this.oBrack=this.formula.indexOf("'",this.start);
}else{if(this.start<=this.formula.length){ret=this.formula.substring(this.start);this.start=this.formula.length+1;}}}return ret;};DataModelSelection.prototype.formulaUIzer=function(srvFormula,srvAssocM){var uiFormula="";var tokenizer=new FormulaTokenizer(srvFormula,this);var iAM=0;var t;while(t=tokenizer.nextToken()){if(typeof(t)=="string"){uiFormula+=t;}else{if(typeof(t)=="object"){var oObj=t.obj;var forcedAgg=t.forcedAgg;uiFormula+="'"+encodeMeasureName(oObj.id);if(forcedAgg==null&&iAM<srvAssocM.length&&srvAssocM[iAM].agg!=NO_AGG){forcedAgg=aggFuncToInt(srvAssocM[iAM].agg);}if(forcedAgg!=null){uiFormula+=tokenizer.aggNames[forcedAgg];}uiFormula+="'";iAM++;}}}return uiFormula;};DataModelSelection.prototype.expandDerivedCalculation=function(derivedName,formula,format,chartMeasures,curAssocMs){if(curAssocMs){var assocs=curAssocMs;for(var iAObj=0;assocs&&iAObj<assocs.length;iAObj++){var aObj=assocs[iAObj];for(var iAExpl=0;aObj.explorers&&iAExpl<aObj.explorers.length;iAExpl++){var aExpl=aObj.explorers[iAExpl];
if(aExpl.__proto__!=AssocExplorer.prototype){aExpl.__proto__=AssocExplorer.prototype;aExpl.dim=this.dm.objName[aExpl.dim];if(aExpl.transfoId&&(typeof(aExpl.transf)=="undefined"||!aExpl.transf)){ddCtrl.loadTransfoRepo();var jsFuncRef=ddCtrl.transfoRepo[aExpl.transfoId];if(jsFuncRef){aExpl.transf=new Function("value",jsFuncRef["function"]);}}}}}}var aM=[];var fFormula="";var srvFormula="";var dFunc={};var srvAM=[];var tokenizer=new FormulaTokenizer(formula,this);var t;while(t=tokenizer.nextToken()){if(typeof(t)=="string"){srvFormula+=t;fFormula+=t;}else{if(typeof(t)=="object"){var oObj=t.obj;var forcedAgg=t.forcedAgg;var mName=oObj.id;var mNameEnc=encodeMeasureName(mName);srvFormula+="'"+mNameEnc+"'";if(oObj&&typeof(oObj.agg)!="undefined"){var oMeas=oObj;if(oMeas.mustExpand){oMeas=this.expandDerivedCalculation(oMeas.id,oMeas.formula,this.dm.formatList[oMeas.format.id],chartMeasures,oMeas.assocM);chartMeasures[i]=oMeas;}if(oMeas.agg==NO_AGG){dFunc[mName]=oMeas.formula;fFormula+="dFunc['"+mNameEnc+"'].call(this, [";
for(var i=0;i<oMeas.assocM.length;++i){if(i>0){fFormula+=",";}fFormula+="m["+aM.length+"]";var newAssocObj=null;if(oMeas.assocM[i].dimension){newAssocObj=new AssocDimensions(oMeas.assocM[i].dimension,oMeas.assocM[i].agg,cloneArray(oMeas.assocM[i].filter),cloneArray(oMeas.assocM[i].explorers));}else{newAssocObj=new AssocMeasures(oMeas.assocM[i].measure,oMeas.assocM[i].agg,cloneArray(oMeas.assocM[i].filter),cloneArray(oMeas.assocM[i].explorers));}if(curAssocMs&&curAssocMs.length>srvAM.length){newAssocObj.explorers=cloneArray(curAssocMs[srvAM.length].explorers);}aM.push(newAssocObj);}fFormula+="], line, rcube, phase)";var assocM2=new AssocMeasures(oMeas,NO_AGG,[],[]);if(curAssocMs&&curAssocMs.length>srvAM.length){assocM2.explorers=cloneArray(curAssocMs[srvAM.length].explorers);}srvAM.push(assocM2);}else{fFormula+="m["+aM.length+"].getVal(line, rcube, phase)";var measAgg=oMeas.agg;if(forcedAgg!=null&&forcedAgg<100){measAgg=forcedAgg;}else{if(curAssocMs&&curAssocMs.length>srvAM.length){measAgg=curAssocMs[srvAM.length].agg;
}else{var iMeas=this.indexOfMeasure(oMeas.id);if(iMeas>-1){measAgg=this.aggsForMeasure[iMeas];}}}var aggFunc=aggIntToFunc(measAgg);if(aggFunc==A_RSUM){aggFunc=A_SUM;}var assocM2=new AssocMeasures(oMeas,aggFunc,[],[]);if(curAssocMs&&curAssocMs.length>srvAM.length){assocM2.explorers=cloneArray(curAssocMs[srvAM.length].explorers);}aM.push(assocM2);srvAM.push(assocM2);}}else{if(oObj&&typeof(oObj.agg)=="undefined"){var oDim=oObj;fFormula+="m["+aM.length+"].getVal(line, rcube, phase)";var aggFunc=forcedAgg==AGG_DMEMBER?A_DMEMBER:A_DCOUNT;var assocM2=new AssocDimensions(oDim,aggFunc,[],[]);if(curAssocMs&&curAssocMs.length>srvAM.length){assocM2.explorers=cloneArray(curAssocMs[srvAM.length].explorers);}aM.push(assocM2);srvAM.push(assocM2);}}}}}var meas=this.dm.createDerivedMeasure(derivedName,aM,formulaToFunc(dFunc,fFormula),format,derivedName,NO_AGG);if(meas){meas.srvFormula=srvFormula;meas.srvAssocM=srvAM;}return meas;};DataModelSelection.prototype.addDerivedCalculation=function(derivedName,formula,format){var meas=this.expandDerivedCalculation(derivedName,formula,format);
if(meas){this.addMeasure(meas,null,0,format,false,false);this.chartMeasures.push(meas);}return meas;};DataModelSelection.prototype.editDerivedCalculation=function(srcMeas,derivedName,formula,format){srcMeas.id=derivedName;for(var im=0;im<this.chartMeasures.length;im++){var chartMeas=this.chartMeasures[im];if(canEditChartMeasure(chartMeas)){if(chartMeas==srcMeas){chartMeas.srvFormula=formula;chartMeas.format=format;}chartMeas.mustExpand=true;chartMeas.assocM=null;chartMeas.srvAssocM=null;chartMeas.formula=chartMeas.srvFormula;}}this.expandChartMeasures(this.dm);for(var im=0;im<this.chartMeasures.length;im++){var chartMeas=this.chartMeasures[im];if(chartMeas.id==derivedName){return chartMeas;}}return null;};function canEditChartMeasure(cm){if(cm.srvFormula.indexOf("@NoEdit")>-1){return false;}if(cm&&cm.srvAssocM){for(var iam=0;iam<cm.srvAssocM.length;iam++){if((cm.srvAssocM[iam].explorers&&cm.srvAssocM[iam].explorers.length>0)||(cm.srvAssocM[iam].filter&&cm.srvAssocM[iam].filter.length>0)){return false;
}}}return true;}function formulaToFunc(dFunc,formula){var strFunc="formFunc = function(m, line, rcube, phase) {";if(formula.indexOf("return")==-1){var lines=formula.split(";");var maxLine=lines.length-1;while(maxLine>=0){if(trim(lines[maxLine]).length>0){break;}maxLine--;}var iLine=0;while(iLine<=maxLine){if(iLine==maxLine){strFunc+="return ";}strFunc+=lines[iLine]+";";++iLine;}}else{strFunc+=formula;}strFunc+="}";return eval(strFunc);}function ChartMeasureForJSON(measure){this.measure=measure;}ChartMeasureForJSON.prototype.toJSON=function(){return{idxCol:this.measure.idxCol,id:this.measure.id,agg:this.measure.agg,targets:this.measure.targets,format:this.measure.format,name:this.measure.name,hidden:this.measure.hidden,formula:this.measure.srvFormula,assocM:this.measure.srvAssocM};};DataModel.prototype.addFormatRepoToDM=function(){if(this.allFormats){return;}if(typeof ddCtrl!="undefined"){var formatRepo=ddCtrl.loadFormatRepo();if(formatRepo){for(var formatId in formatRepo){this.formatList[formatId]=formatRepo[formatId];
}this.allFormats=true;}}};function replaceTokens(dmsel,newText,oldText,bNoEval){if(newText==null||newText==""){return oldText;}var hasRepl=newText.indexOf("${")>-1;if(!hasRepl){return newText;}newText=replaceAll(newText,"${Value}",oldText);newText=replaceAll(newText,"${Filter","${filter");if(dmsel!=null){for(var i=0;i<dmsel.dm.dimensions.length;i++){var dim=dmsel.dm.dimensions[i];var filterString="";var hierarchyString="";var levelString="";var filter=dmsel.filterByDimName[dim.id];if(filter){var filterString=filter.getFilterString();if(filter.getHierarchyName()!=null){hierarchyString=filter.getHierarchyName();}if(filter.getLevelName()!=null){levelString=filter.getLevelName();}}newText=replaceAll(newText,"${filter."+dim.id+"}",filterString);newText=replaceAll(newText,"${filter."+dim.id+".hierarchy}",hierarchyString);newText=replaceAll(newText,"${filter."+dim.id+".level}",levelString);newText=replaceAll(newText,"${filter."+dim.id+".dimension}",dim.name);}for(var varName in dmsel.dm.variables){var ddvar=dmsel.dm.variables[varName];
newText=replaceAll(newText,"${variable."+varName+"}",ddvar.getFormatedValue());}}else{if(ddCtrl){for(var panelId in ddCtrl.dimPanelList){var dimSelPanel=dimPanelList[panelId];var dimId=dimSelPanel.id;var filterString="";var hierarchyString="";var levelString="";if(dimSelPanel.hasFilter()){filterString=dimSelPanel.getSelectedElementsAsString(dimId);if(dimSelPanel.getSelectedHierarchyName()!=null){hierarchyString=dimSelPanel.getSelectedHierarchyName();}if(dimSelPanel.getSelectedLevelName()!=null){levelString=dimSelPanel.getSelectedLevelName();}}newText=replaceAll(newText,"${filter."+dimId+"}",filterString);newText=replaceAll(newText,"${filter."+dimId+".hierarchy}",hierarchyString);newText=replaceAll(newText,"${filter."+dimId+".level}",levelString);newText=replaceAll(newText,"${filter."+dimId+".dimension}",dimSelPanel.name);}for(var varName in __v){var ddvar=__v[varName];newText=replaceAll(newText,"${variable."+varName+"}",ddvar.getFormatedValue());}}}if(!bNoEval&&newText.indexOf("${js}")>-1){try{return""+eval(newText);
}catch(e){return newText;}}return newText;}function buildKey(line,sel,dimId){if(line==null){return"";}var key="";for(var axisExp=0;axisExp<line.length;++axisExp){if(axisExp==sel.measureAxis){continue;}if((typeof line[axisExp]!="number")||line[axisExp]==-1){continue;}var iDim=0;if(dimId&&sel&&sel.axis.length>axisExp){var excludeKey=false;for(var axI=0;axI<sel.axis[axisExp].length;++axI){var dimExp=sel.axis[axisExp][axI];if(sel.dimsToExplore.length>dimExp&&sel.dimsToExplore[dimExp].dim.id==dimId){excludeKey=true;break;}}if(excludeKey){continue;}}if(key.length>0){key+="-";}key+=line[axisExp];}return key;}DataModelSelection.prototype.addDisplayFilter=function(filter){this.dimsToDisplayFilter.push(filter);};DataModelSelection.prototype.hasDisplayFilters=function(){return(this.dimsToDisplayFilter&&this.dimsToDisplayFilter.length>0);};var INTER_MODE=0;var UNION_MODE=1;var REVERSE_MODE=2;FilterSelection=function(dim,hierarchy,level,origIds,members,jsFunc,mode,displayValue){this.dim=dim;this.setHierarchyLevel(hierarchy,level);
this.origIds=origIds;this.fsize=0;this.selectedMembers=members;this.jsFunc=jsFunc;if(typeof(mode)=="undefined"){this.mode=INTER_MODE;}else{this.mode=mode;}this.displayValue=displayValue;this.transf=null;this.evaluate();};FilterSelection.prototype.setHierarchyLevel=function(h,l){if(typeof(h)=="string"&&typeof(l)=="string"){if((h=="")||(l=="")){this.hierarchy=-1;this.level=-1;}else{var iH=0;while(iH<this.dim.hierarchies.length&&this.hierarchy==null){if(this.dim.hierarchies[iH].id==h){this.hierarchy=iH;if(l=="root"){this.level=-1;}else{var iL=0;while(iL<this.dim.hierarchies[iH].levels.length&&this.level==null){if(this.dim.hierarchies[iH].levels[iL].id==l){this.level=iL;}iL++;}}}iH++;}}}else{this.hierarchy=h;this.level=l;}};FilterSelection.prototype.getHierarchyId=function(){if(this.hierarchy>-1&&this.dim.hierarchies[this.hierarchy]){return this.dim.hierarchies[this.hierarchy].id;}return null;};FilterSelection.prototype.getHierarchyName=function(){if(this.hierarchy>-1&&this.dim.hierarchies[this.hierarchy]){return this.dim.hierarchies[this.hierarchy].name;
}return null;};FilterSelection.prototype.getLevelId=function(){if(this.hierarchy>-1&&this.dim.hierarchies[this.hierarchy]&&this.level>-1&&this.dim.hierarchies[this.hierarchy].levels[this.level]){return this.dim.hierarchies[this.hierarchy].levels[this.level].id;}return null;};FilterSelection.prototype.getLevelName=function(){if(this.hierarchy>-1&&this.dim.hierarchies[this.hierarchy]&&this.level>-1&&this.dim.hierarchies[this.hierarchy].levels[this.level]){return this.dim.hierarchies[this.hierarchy].levels[this.level].name;}return null;};FilterSelection.prototype.getKey=function(){return this.dim.id+"_"+this.hierarchy+"_"+this.level+"_"+this.selectedMembers+"_"+this.mode;};FilterSelection.prototype.toJSON=function(){var obj={dim:this.dim,hierarchy:this.hierarchy,level:this.level,origIds:this.origIds,selectedMembers:this.selectedMembers,mode:this.mode};if(this.displayValue){obj.displayValue=this.displayValue;}return obj;};FilterSelection.prototype.transform=function(dim){if(dim==this.dim){return this;
}var hierarchy=this.hierarchy;var level=-1;var ids=[];var memberNames=[];if(this.hierarchy>=0){level=this.level;}else{var i=0;while(i<this.origIds.length){var mbrName=this.dim.members[this.origIds[i]];ids.push(dim.indexedMembers[mbrName]);memberNames.push(mbrName);++i;}}return new FilterSelection(dim,hierarchy,level,ids,memberNames);};FilterSelection.prototype.clone=function(){var _origIds=new Array();if(this.origIds){for(var i=0;i<this.origIds.length;i++){_origIds[i]=this.origIds[i];}}var _selectedMembers=new Array();if(this.selectedMembers){for(var i=0;i<this.selectedMembers.length;i++){_selectedMembers[i]=this.selectedMembers[i];}}var filter2=new FilterSelection(this.dim,this.hierarchy,this.level,_origIds,_selectedMembers);filter2.mode=this.mode;filter2.displayValue=this.displayValue;filter2.transf=this.transf;filter2.evaluate(this.selection);return filter2;};FilterSelection.prototype.evaluate=function(selection){this.selection=selection;if(typeof(this.jsFunc)!="undefined"&&this.jsFunc!=null){this.origIds=new Array();
if(this.hierarchy>=0&&this.level>=0){var level=this.dim.hierarchies[this.hierarchy].levels[this.level];level.prepare(this.dim);for(var i=0;i<level.groups.length;i++){var grpName=level.groups[i].name;var isIn=this.jsFunc(grpName);if(isIn){this.origIds.push(i);this.selectedMembers.push(grpName);}}}else{for(var i=0;i<this.dim.members.length;i++){var isIn=this.jsFunc(this.dim.members[i]);if(isIn){this.origIds.push(i);this.selectedMembers.push(this.dim.members[i]);}}}}if(typeof this.hierarchy!="undefined"){this.recalcIds();}};FilterSelection.prototype.recalcIds=function(){this.ids={};if(this.origIds==null){return;}if(this.origIds.length==0&&this.selectedMembers!=null){this.fsize=this.selectedMembers.length;if(!this.dim.membersOnServer){this.origIds=getMemberPos(this.dim,this.hierarchy,this.level,this.selectedMembers);}}if(this.origIds.length>0){if((this.hierarchy==-1)||(this.level==-1)){for(var iT=0;iT<this.origIds.length;++iT){this.ids[this.origIds[iT]]=true;}this.fsize=this.origIds.length;
}else{var h=this.dim.hierarchies[this.hierarchy];var level=h.levels[this.level];level.prepare(this.dim);this.fsize=0;if(!level.groupsOnServer){var groupIter=0;while(groupIter<this.origIds.length){var group=level.groups[this.origIds[groupIter]];if(group!=null){var groupMembers=group.members;if(level.groupformula==undefined){var iLevelDepth=this.level;while(iLevelDepth>0){--iLevelDepth;var tlevel=h.levels[iLevelDepth];var members=new Array();var i=0;while(i<groupMembers.length){members=Array_merge(tlevel.groups[groupMembers[i]].members,members);++i;}groupMembers=members;}}if(groupMembers){for(var iT=0;iT<groupMembers.length;++iT){this.ids[groupMembers[iT]]=true;}this.fsize+=groupMembers.length;}}++groupIter;}}}}};SelRange=function(min,max){this.min=min;this.max=max;};function toFunc(str){if(str.indexOf("{")){return -1;}if(str.indexOf("return")==-1){var lines=str.split(";");var maxLine=lines.length-1;while(maxLine>=0){if(trim(lines[maxLine]).length>0){break;}maxLine--;}var strFunc="myfunc = function(s, mF, MF) {";
var iLine=0;while(iLine<=maxLine){if(iLine==maxLine){strFunc+="return ";}strFunc+=lines[iLine]+";";++iLine;}strFunc+="}";}return eval(strFunc);}FilterSelection.prototype.evalMinMax=function(){if(this.transf&&this.origIds!=null&&this.origIds.length>0){this.rangeAr=[];if(this.hierarchy!=-1&&this.level!=-1){var lvl=this.dim.hierarchies[this.hierarchy].levels[this.level];var fMin=toFunc(lvl.fMin);if(fMin!=-1){var fMax=toFunc(lvl.fMax);}var mF=this.dim.min;var MF=this.dim.max;var curId=0;while(curId<this.origIds.length){var s=lvl.groups[this.origIds[curId]].id;if(fMin==-1){this.rangeAr.push(new SelRange(eval(lvl.fMin),eval(lvl.fMax)));}else{this.rangeAr.push(new SelRange(fMin(s,mF,MF),fMax(s,mF,MF)));}++curId;}}else{var curId=0;while(curId<this.origIds.length){var min=this.dim.members[this.origIds[curId]];this.rangeAr.push(new SelRange(min,min+1));++curId;}}}else{this.rangeAr=null;}};FilterSelection.prototype.isOut=function(d){if(this.origIds==null){return false;}if(this.transf){if(this.rangeAr!=null){var isOut=true;
var curR=0;var val=this.transf(this.dim.members[d]);while(curR<this.rangeAr.length){if(val>=this.rangeAr[curR].min&&val<this.rangeAr[curR].max){isOut=false;break;}++curR;}if(this.mode==REVERSE_MODE){return !isOut;}else{return isOut;}}}var isIn=this.ids[d];if(!isIn&&this.dim.includeEmptyInFilter){if((this.hierarchy==-1)||(this.level==-1)){var mbr=this.dim.members[d];if(mbr!=null&&mbr==null||mbr==""){return false;}}else{var h=this.dim.hierarchies[this.hierarchy];var level=h.levels[this.level];var g=lvl.groups[d];if(g!=null&&(g.id==null||g.name=="")){return false;}}}if(this.mode==REVERSE_MODE){return isIn;}else{return !isIn;}};FilterSelection.prototype.init=function(filter,transformed){this.hierarchy=filter.hierarchy;if((typeof(filter.min)!="undefined")&&(transformed!=true)){this.init=FilterSelectionContinuous.prototype.init;this.recalcIds=FilterSelectionContinuous.prototype.recalcIds;this.toJSON=FilterSelectionContinuous.prototype.toJSON;this.isOut=FilterSelectionContinuous.prototype.isOut;
this.evaluate=FilterSelectionContinuous.prototype.evaluate;this.getKey=FilterSelectionContinuous.prototype.getKey;this.getFilterString=FilterSelectionContinuous.prototype.getFilterString;this.clone=FilterSelectionContinuous.prototype.clone;this.init(filter,true);}else{this.level=filter.level;this.min=undefined;this.max=undefined;this.jsFunc=undefined;this.origIds=new Array();if(filter.origIds){for(var i=0;i<filter.origIds.length;i++){this.origIds[i]=filter.origIds[i];}}this.selectedMembers=new Array();if(filter.selectedMembers){for(var i=0;i<filter.selectedMembers.length;i++){this.selectedMembers[i]=filter.selectedMembers[i];}}}};FilterSelection.prototype.equals=function(filter){if(filter==null){return false;}if(this.dim!=filter.dim){return false;}if(this.mode!=filter.mode){return false;}if(this.hierarchy!=filter.hierarchy){return false;}if(this.level!=filter.level){return false;}if(this.ids&&filter.ids){if(this.fsize!=filter.fsize){return false;}for(var i in this.ids){if(!filter.ids[i]){return false;
}}}else{if((!this.ids&&filter.ids)||(this.ids&&!filter.ids)){return false;}}if(this.origIds&&filter.origIds){if(this.origIds.length!=filter.origIds.length){return false;}for(var i=0;i<this.origIds.length;i++){if(this.origIds[i]!=filter.origIds[i]){return false;}}}else{if((!this.origIds&&filter.origIds)||(this.origIds&&!filter.origIds)){return false;}}if(this.selectedMembers&&filter.selectedMembers){if(this.selectedMembers.length!=filter.selectedMembers.length){return false;}for(var i=0;i<this.selectedMembers.length;i++){if(this.selectedMembers[i]!=filter.selectedMembers[i]){return false;}}}else{if((!this.selectedMembers&&filter.selectedMembers)||(this.selectedMembers&&!filter.selectedMembers)){return false;}}if(this.min!=filter.min||this.max!=filter.max){return false;}return true;};FilterSelection.prototype.getFilterString=function(){var filterString="";if(this.origIds.length>0){for(var i=0;i<this.origIds.length;i++){if(this.hierarchy>-1&&this.level>-1){var level=this.dim.hierarchies[this.hierarchy].levels[this.level];
level.prepare(this.dim);var group=level.groups[this.origIds[i]];if(group!=null){var memberFormated=group.id;if(level.format){memberFormated=formatNum(group.id,level.format);}else{if(typeof(group.caption)!="undefined"&&group.caption!=""){memberFormated=group.caption;}}if(filterString==""){filterString=memberFormated;}else{filterString+=","+memberFormated;}}}else{var member=this.dim.members[this.origIds[i]];if(member!=null){var memberFormated=member;if(this.dim.format){memberFormated=formatNum(member,this.dim.format);}else{if(this.dim.captions&&this.dim.captions[member]){memberFormated=this.dim.captions[member];}}if(filterString==""){filterString=memberFormated;}else{filterString+=","+memberFormated;}}}}}else{if(this.selectedMembers.length>0){var format=null;if(this.hierarchy>-1&&this.level>-1){var level=this.dim.hierarchies[this.hierarchy].levels[this.level];format=level.format;}else{format=this.dim.format;}for(var i=0;i<this.selectedMembers.length;i++){var member=this.selectedMembers[i];
if(format){member=formatNum(member,format);}if(filterString==""){filterString=member;}else{filterString+=","+member;}}}}return filterString;};FilterSelection.prototype.getFilteredMembers=function(){var mbrs=[];if(this.selectedMembers&&this.selectedMembers.length>0){mbrs=this.selectedMembers;}else{if(this.origIds&&this.origIds.length>0){if(this.hierarchy==-1||this.level==-1){for(var i=0;i<this.origIds.length;i++){mbrs.push(this.dim.members[this.origIds[i]]);}}else{var l=this.dim.hierarchies[this.hierarchy].levels[this.level];for(var i=0;i<this.origIds.length;i++){mbrs.push(l.groups[this.origIds[i]]);}}}}return mbrs;};FilterSelectionContinuous=function(dim,hierarchy,level,min,max,member,mode,displayValue){FilterSelection.call(this,dim,hierarchy,level);this.min=min;this.max=max;if(min!=null&&typeof(min)=="function"){try{this.min=this.min();}catch(e){this.min=this.dim.min;}this.minFormula=min;}else{this.minFormula=null;}if(max!=null&&typeof(max)=="function"){try{this.max=this.max();}catch(e){this.max=this.dim.max;
}this.maxFormula=max;}else{this.maxFormula=null;}this.member=member;if(typeof(mode)=="undefined"){this.mode=INTER_MODE;}else{this.mode=mode;}this.displayValue=displayValue;};FilterSelectionContinuous.prototype=new FilterSelection();FilterSelectionContinuous.prototype.clone=function(){var filter2=new FilterSelectionContinuous(this.dim,this.hierarchy,this.level,this.min,this.max,this.member);filter2.minFormula=this.minFormula;filter2.maxFormula=this.maxFormula;filter2.transf=this.transf;filter2.mode=this.mode;filter2.displayValue=this.displayValue;filter2.evaluate(this.selection);return filter2;};FilterSelectionContinuous.prototype.init=function(filter,transformed){this.hierarchy=filter.hierarchy;this.level=filter.level;if((typeof(filter.min)!="undefined")||transformed){this.min=filter.min;this.max=filter.max;if(typeof(filter.min)=="function"){this.minFormula=this.min;}else{this.minFormula=null;}if(typeof(filter.max)=="function"){this.maxFormula=this.max;}else{this.maxFormula=null;}this.member=filter.member;
this.selectedMembers=undefined;this.origIds=undefined;this.ids=undefined;this.jsFunc=undefined;}else{this.init=FilterSelection.prototype.init;this.recalcIds=FilterSelection.prototype.recalcIds;this.toJSON=FilterSelection.prototype.toJSON;this.isOut=FilterSelection.prototype.isOut;this.evaluate=FilterSelection.prototype.evaluate;this.getKey=FilterSelection.prototype.getKey;this.getFilterString=FilterSelection.prototype.getFilterString;this.clone=FilterSelection.prototype.clone;this.init(filter,true);}};FilterSelectionContinuous.prototype.getKey=function(){return this.dim.id+"_"+this.hierarchy+"_"+this.level+"_"+this.min+"_"+this.max+"_"+this.mode;};FilterSelectionContinuous.prototype.recalcIds=function(){};FilterSelectionContinuous.prototype.evaluate=function(selection){this.selection=selection;if(this.minFormula){try{this.min=this.minFormula();}catch(e){this.min=this.dim.min;}}if(this.maxFormula){try{this.max=this.maxFormula();}catch(e){this.max=this.dim.max;}}};FilterSelectionContinuous.prototype.toJSON=function(){var obj={dim:this.dim,hierarchy:this.hierarchy,level:this.level,min:this.min,max:this.max,mode:this.mode};
if(this.displayValue){obj.displayValue=this.displayValue;}return obj;};FilterSelectionContinuous.prototype.isOut=function(d){if(!isNumeric(d)){return true;}var v=this.dim.members[d];if(this.transf){v=this.transf(v);}if(v!=null){var isOut=!(v>=this.min&&v<this.max);var level=null;if(this.hierarchy&&this.level>=0){var hierarchy=this.dim.hierarchies[this.hierarchy];if(hierarchy!=null){level=hierarchy.levels[this.level];}}if(isOut&&level!=null&&!level.groupformula&&level.getMemberPosById(this.member)==0){var findGroup=false;for(var i=0;i<level.groups.length;i++){var group=level.groups[i];if(v>=group.minfval&&v<group.maxfval){findGroup=true;break;}}if(!findGroup){isOut=false;}}if(this.mode==REVERSE_MODE){return !isOut;}else{return isOut;}}else{if(this.dim.includeEmptyInFilter||this.mode==REVERSE_MODE){return false;}}return true;};FilterSelectionContinuous.prototype.getFilterString=function(){return formatNum(this.min,this.dim.format)+" - "+formatNum(this.max,this.dim.format);};FilterSelectionMultiContinuous=function(dim,hierarchy,level,gidxs,members,mode,displayValue){FilterSelection.call(this,dim,hierarchy,level);
this.grps=gidxs;this.selectedMembers=members;if(typeof(mode)=="undefined"){this.mode=INTER_MODE;}else{this.mode=mode;}this.displayValue=displayValue;this.recalcIds();};FilterSelectionMultiContinuous.prototype=new FilterSelection();FilterSelectionMultiContinuous.prototype.clone=function(){var nF=new FilterSelectionMultiContinuous(this.dim,this.hierarchy,this.level,this.grps,this.selectedMembers);nF.transf=this.transf;nF.mode=this.mode;nF.displayValue=this.displayValue;return nF;};FilterSelectionMultiContinuous.prototype.getKey=function(){return this.dim.id+"_"+this.hierarchy+"_"+this.level+"_"+this.grps.length+"_"+this.mode;};FilterSelectionMultiContinuous.prototype.init=function(filter,transformed){this.hierarchy=filter.hierarchy;this.level=filter.level;if((typeof(filter.grps)!="undefined")||transformed){this.grps=filter.grps;this.selectedMembers=undefined;this.origIds=undefined;this.ids=undefined;this.jsFunc=undefined;}else{this.init=FilterSelectionContinuous.prototype.init;this.recalcIds=FilterSelectionContinuous.prototype.recalcIds;
this.toJSON=FilterSelectionContinuous.prototype.toJSON;this.isOut=FilterSelectionContinuous.prototype.isOut;this.evaluate=FilterSelectionContinuous.prototype.evaluate;this.getKey=FilterSelectionContinuous.prototype.getKey;this.getFilterString=FilterSelectionContinuous.prototype.getFilterString;this.clone=FilterSelectionContinuous.prototype.clone;this.init(filter,true);}};FilterSelectionMultiContinuous.prototype.recalcIds=function(){this.mins=[];this.maxs=[];if(this.grps){var iG=0;while(iG<this.grps.length){var g=this.dim.hierarchies[this.hierarchy].levels[this.level].groups[this.grps[iG]];this.mins[iG]=g.minfval;this.maxs[iG]=g.maxfval;++iG;}}};FilterSelectionMultiContinuous.prototype.equals=function(filter){if(filter==null){return false;}if(this.hierarchy!=filter.hierarchy){return false;}if(this.level!=filter.level){return false;}if(this.mode!=filter.mode){return false;}if(this.grps&&filter.grps&&this.grps.length==filter.grps.length){for(var i=0;i<this.grps.length;i++){if(this.grps[i]!=filter.grps[i]){return false;
}}}else{if((!this.grps&&filter.grps)||(this.grps&&!filter.grps)){return false;}}if(this.selectedMembers&&filter.selectedMembers&&this.selectedMembers.length==filter.selectedMembers.length){for(var i=0;i<this.selectedMembers.length;i++){if(this.selectedMembers[i]!=filter.selectedMembers[i]){return false;}}}else{if((!this.selectedMembers&&filter.selectedMembers)||(this.selectedMembers&&!filter.selectedMembers)){return false;}}if(this.mins&&filter.mins&&this.mins.length==filter.mins.length){for(var i=0;i<this.mins.length;i++){if(this.mins[i]!=filter.mins[i]){return false;}}}else{if((!this.mins&&filter.mins)||(this.mins&&!filter.mins)){return false;}}if(this.maxs&&filter.maxs&&this.maxs.length==filter.maxs.length){for(var i=0;i<this.maxs.length;i++){if(this.maxs[i]!=filter.maxs[i]){return false;}}}else{if((!this.maxs&&filter.maxs)||(this.maxs&&!filter.maxs)){return false;}}};FilterSelectionMultiContinuous.prototype.evaluate=function(){};FilterSelectionMultiContinuous.prototype.toJSON=function(){var obj={dim:this.dim,hierarchy:this.hierarchy,level:this.level,grps:this.grps,selectedMembers:this.selectedMembers,mode:this.mode};
if(this.displayValue){obj.displayValue=this.displayValue;}return obj;};FilterSelectionMultiContinuous.prototype.isOut=function(d){if(!isNumeric(d)){return true;}var v=this.dim.members[d];if(this.transf){v=this.transf(v);}if(v!=null){if(this.mode==REVERSE_MODE){var iM=0;while(iM<this.mins.length){var isIn=(v>=this.mins[iM])&&(v<this.maxs[iM]);if(isIn){return true;}++iM;}return false;}else{var iM=0;while(iM<this.mins.length){var isIn=(v>=this.mins[iM])&&(v<this.maxs[iM]);if(isIn){return false;}++iM;}return true;}}else{if(this.dim.includeEmptyInFilter||this.mode==REVERSE_MODE){return false;}}return true;};FilterSelectionMultiContinuous.prototype.getFilterString=function(){var filterString="";var iG=0;while(iG<this.grps.length){this.dim.hierarchies[this.hierarchy].levels[this.level].prepare(this.dim);var g=this.dim.hierarchies[this.hierarchy].levels[this.level].groups[this.grps[iG]];if(filterString==""){filterString=g.name;}else{filterString+=","+g.name;}++iG;}return filterString;};function getMemberPos(dim,h,l,membersId){var hierarchy=null;
var level=null;if(typeof(h)=="string"&&typeof(l)=="string"){if((h=="")||(l=="")){h=-1;l=-1;}else{var iH=0;while(iH<dim.hierarchies.length&&hierarchy==null){if(dim.hierarchies[iH].id==h){hierarchy=dim.hierarchies[iH];var iL=0;while(iL<dim.hierarchies[iH].levels.length&&level==null){if(dim.hierarchies[iH].levels[iL].id==l){level=dim.hierarchies[iH].levels[iL];}iL++;}}iH++;}}}else{if(h!=-1&&l!=-1){hierarchy=dim.hierarchies[h];level=hierarchy.levels[l];}}var arrayPos=new Array();if(!dim.membersOnServer){if(hierarchy==null||level==null){if(!dim.indexedMembers){dim.indexedMembers=[];for(var im=0;im<dim.members.length;++im){dim.indexedMembers[dim.members[im]]=im;}}if(dim.continuous){for(var im=0;im<membersId.length;++im){var mbr=membersId[im];if((mbr!=null)&&(typeof mbr!="number")){mbr=parseInt(mbr);}arrayPos.push(dim.indexedMembers[mbr]);}}else{for(var im=0;im<membersId.length;++im){var mbrPos=dim.indexedMembers[membersId[im]];if(typeof(mbrPos)!="undefined"){arrayPos.push(dim.indexedMembers[membersId[im]]);
}}}}else{level.prepare(dim);if(hierarchy){var i=0;while(i<membersId.length){var val=level.getMemberPosById(membersId[i]);if(typeof(val)!="undefined"){arrayPos.push(val);}++i;}}else{if(dim.continuous){var rootMembersPos=new Array();var iMbr=0;while(iMbr<dim.members.length){var t=dim.members[iMbr];var grp=level.evalGroupFormula(t);for(var i=0;i<membersId.length;i++){var grpPos=level.getMemberPosById(membersId[i]);var group=level.groups[grpPos];if(group.name==grp){rootMembersPos.push(iMbr);break;}}iMbr++;}return rootMembersPos;}else{var rootMembersPos=new Array();var rootMembersPosTest=new Array();hierarchy=this.hierarchiesList[h];var level=hierarchy.levels[l];level.prepare(dim);var i=0;while(i<membersId.length){var pos=level.getMemberPosById(membersId[i]);var group=level.groups[pos];var grpMembers=group.members;var iMbr=0;while(iMbr<grpMembers.length){if(!rootMembersPosTest[grpMembers[iMbr]]){rootMembersPosTest[grpMembers[iMbr]]=true;rootMembersPos.push(grpMembers[iMbr]);}iMbr++;}++i;}return rootMembersPos;
}}}}return arrayPos;}function getFilterContinuous(dmsel,dim,h,l,minF,maxF,val){var s=val;var filter=dmsel.getFilterByDimension(dim);var MF=0;var mF=0;if(filter){mF=filter.min;MF=filter.max;}min=eval(minF);max=eval(maxF);if(isNaN(min)||isNaN(max)){return new FilterSelection(dim,h,l,getMemberPos(dim,h,l,[val]),[val]);}else{return new FilterSelectionContinuous(dim,h,l,min,max,s);}}function getFilter(dim,h,l,membersId){var hierarchy=-1;var level=-1;if(dim.hierarchies.length>0){if(typeof(h)!="undefined"){if(typeof(h)=="number"){hierarchy=h;}else{if(typeof(h)=="string"){for(var i=0;i<dim.hierarchies.length;i++){if(dim.hierarchies[i].id==h||dim.hierarchies[i].name==h){hierarchy=i;break;}}}}}if(typeof(l)!="undefined"){if(typeof(l)=="number"){level=l;}else{if(typeof(l)=="string"){if(hierarchy==-1){hierarchy=0;}var hierObj=dim.hierarchies[hierarchy];if(hierObj!=null){for(var i=0;i<hierObj.levels.length;i++){if(hierObj.levels[i].id==l||hierObj.levels[i].name==l){level=i;break;}}}}}}}return new FilterSelection(dim,hierarchy,level,getMemberPos(dim,hierarchy,level,membersId),membersId);
}function getRootMembersByGroup(dim,h,l,groupIds){if(l==-1){return groupIds;}var retMembers=new Array();for(var i=0;i<groupIds.length;i++){var group=dim.hierarchies[h].levels[l].groups[groupIds[i]];if(group!=null){var childMembers=group.members;if(l==0){retMembers=Array_merge(retMembers,childMembers);}else{retMembers=Array_merge(retMembers,getRootMembersByGroup(dim,h,l-1,childMembers));}}}return retMembers;}function mergeFilters(filter1,filter2){if(filter1.equals(filter2)){return filter1;}if(filter1.dim.id!=filter2.dim.id){return null;}if(filter1.origIds!=undefined&&filter2.origIds!=undefined){var memberIds=[];for(var idx in filter2.ids){idx=parseInt(idx);if(filter1.ids[idx]){memberIds.push(idx);}}return new FilterSelection(filter1.dim,filter1.hierarchy,-1,memberIds);}else{if(filter1.origIds!==undefined||filter2.origIds!==undefined){var filter=new FilterSelection(filter1.dim,filter1.hierarchy,-1,[]);if(filter1.origIds!==undefined){var memberIds=[];for(var idx in filter1.ids){idx=parseInt(idx);
if(!filter2.isOut(idx)){memberIds.push(idx);}}}else{var memberIds=[];for(var idx in filter2.ids){if(!filter1.isOut(idx)){memberIds.push(idx);}}}return new FilterSelection(filter1.dim,filter1.hierarchy,-1,memberIds);}else{return null;}}}function getHierarchyLevelPos(dim,hierarchyId,levelId){var hPos=-1;var lPos=-1;if(hierarchyId!=null){for(var iH=0;iH<dim.hierarchies.length;iH++){if(dim.hierarchies[iH].id==hierarchyId){hPos=iH;if(levelId!=null&&levelId!="root"){for(var iL=0;iL<dim.hierarchies[iH].levels.length;iL++){if(dim.hierarchies[iH].levels[iL].id==levelId){lPos=iL;break;}}}}}}return[hPos,lPos];}function getHierarchyLevelIds(dim,hPos,lPos){var hierarchyId=null;var levelId=null;if(dim.hierarchies[hPos]){hierarchyId=dim.hierarchies[hPos].id;if(dim.hierarchies[hPos].levels[lPos]){levelId=dim.hierarchies[hPos].levels[lPos].id;}}return[hierarchyId,levelId];}function opOrigIds(member,origIds){for(var i=0;i<origIds.length;i++){if(member==origIds[i]){return true;}}return false;}function opIsNotNull(member){return member!=null;
}function opIsNull(member){return member==null;}function opEqual(member,filterValue){return member==filterValue;}function opNotEqual(member,filterValue){return member!=filterValue;}function opContains(member,filterValue){return member.match(filterValue)!=null;}function opNotContains(member,filterValue){return member.match(filterValue)==null;}function opMatchRegExp(member,filterValue){return member.match(filterValue)!=null;}function opSup(member,filterValue){return member>filterValue;}function opInf(member,filterValue){return member<filterValue;}function opSupEqual(member,filterValue){return member>=filterValue;}function opInfEqual(member,filterValue){return member<=filterValue;}function opStartsWith(member,filterValue){return member.indexOf(filterValue)==0;}function opEndsWith(member,filterValue){return((member.indexOf(filterValue)+filterValue.length)==member.length);}function opIsIn(member,filterValue){return filterValue.match(member)!=null;}function opIsNotIn(member,filterValue){return filterValue.match(member)==null;
}FilterDisplay=function(dim,members){this.dim=dim;this.members=members;};ScaleProperties=function(){this.minset=false;this.maxset=false;this.min=null;this.max=null;this.minMeasure=null;this.maxMeasure=null;this.textorientation=0;this.format=null;this.centerOnZero=false;};ScaleProperties.prototype.getRange=function(){return this.max-this.min;};ScaleProperties.prototype.reset=function(){if(!this.minset){this.min=null;}if(!this.maxset){this.max=null;}};ScaleProperties.prototype.setMinMaxWithMeasuresPerfChart=function(dmsel,resultCube){var measureIdMax=this.maxMeasure;if(measureIdMax!=null&&measureIdMax!=""&&typeof(measureIdMax)!="undefined"){for(var i=0;i<dmsel.measuresToKeep.length;i++){var meas=resultCube.axis[0][i];if(meas.id==measureIdMax){var key=meas.pos;var valMax=resultCube.values[key];this.setMax(valMax);break;}}}var measureIdMin=this.minMeasure;if(measureIdMin!=null&&measureIdMin!=""&&typeof(measureIdMin)!="undefined"){for(var i=0;i<dmsel.measuresToKeep.length;i++){var meas=resultCube.axis[0][i];
if(meas.id==measureIdMin){var key=meas.pos;var valMin=resultCube.values[key];this.setMin(valMin);break;}}}};ScaleProperties.prototype.setMin=function(min){this.minset=true;this.min=min;};ScaleProperties.prototype.setMinMeasure=function(minMeasureId){this.minset=true;this.minMeasure=minMeasureId;};ScaleProperties.prototype.setMinAuto=function(min){if(!this.minset){if(this.max==null||min<this.max){this.min=min;}else{this.min=this.max-1;}}};ScaleProperties.prototype.setMax=function(max){this.maxset=true;this.max=max;};ScaleProperties.prototype.setMaxMeasure=function(maxMeasureId){this.maxset=true;this.maxMeasure=maxMeasureId;};ScaleProperties.prototype.setMaxAuto=function(max){if(!this.maxset){if(this.min==null||max>this.min){this.max=max;}else{this.max=this.min+1;}}};ScaleProperties.prototype.setMinMax=function(min,max){this.setMin(min);this.setMax(max);};ScaleProperties.prototype.setTextOrientation=function(angle){this.textorientation=angle;};ScaleProperties.prototype.setFormat=function(format){this.format=format;
};ScaleProperties.prototype.setCenterOnZero=function(bCenterOnZero){this.centerOnZero=bCenterOnZero;};MinMaxProperties=function(){this.min=null;this.max=null;};MinMaxProperties.prototype.addVal=function(val){if(this.max===null){this.max=val;}else{if(val>this.max){this.max=val;}}if(!this.min===null){this.min=val;}else{if(val<this.min){this.min=val;}}};MinMaxProperties.prototype.getRange=function(){return this.max-this.min;};SpacingProperties=function(val){this.orig=val;this.computed=val;};AxisSpacingProperties=function(){this.spArray=new Object();};AxisSpacingProperties.prototype.addAxis=function(axisId,spacing){this.spArray[axisId]=new SpacingProperties(spacing);};AxisSpacingProperties.prototype.getValue=function(axisId){var val=0;var sp=this.spArray[axisId];if(sp){val=sp.computed;}return val;};AxisSpacingProperties.prototype.getOrigValue=function(axisId){var val=0;var sp=this.spArray[axisId];if(sp){val=sp.orig;}return val*getSpaceUnit();};AxisSpacingProperties.prototype.setComputedValue=function(axisId,val){var sp=this.spArray[axisId];
if(sp){sp.computed=val;}};AxisSpacingProperties.prototype.reset=function(){for(ax in this.spArray){if(typeof this.spArray[ax]!="function"){this.spArray[ax].computed=this.spArray[ax].orig*getSpaceUnit();}}};AxisSpacingProperties.prototype.clone=function(){var cln=new AxisSpacingProperties();for(ax in this.spArray){if(typeof this.spArray[ax]!="function"){cln.spArray[ax]=new SpacingProperties(this.spArray[ax].orig);}}return cln;};var AXL_HIDE=0;var AXL_AUTO=1;var AXL_OUTSIDE=2;var AXL_INSIDE=3;AxisLabel=function(pos,textLabel,changecol,axisName){this.position=pos;this.textLabel=textLabel;this.changecolor=changecol;this.axisName=axisName;};var NONE=0;var URL=1;var DRILL=2;var FILTER=3;var JAVASCRIPT=4;var SYNCHRONIZEDDRILL=5;var CHANGEDIMENSION=6;var SYNCHRONIZECHANGEDIMENSION=7;var BLANK="_blank";var PARENT="_parent";var SELF="_self";var TOP="_top";OnClickProperties=function(action,axis,url){this.action=action;if(this.action==URL&&arguments.length==3){this.url=axis;this.axis=0;}else{if(this.action==JAVASCRIPT&&arguments.length==2){this.url=axis;
this.axis=0;}else{this.axis=axis;this.url=url;}}};AxisSelection=function(iAx){this.iAx=iAx;};DimSelection=function(){this.dimname="";this.dimkey="";};SelectionInfo=function(dmsel,values){if(dmsel){this.dm=dmsel.dm;this.dmsel=dmsel;}this.values=values;this.key="";this.axis=new Array();this.forcedMbrs=new Array();this.dimselect=new Array();this.forceVal=null;this.percentVal=null;};SelectionInfo.prototype.addAxis=function(id,iAx){this.axis[id]=new AxisSelection(iAx);};SelectionInfo.prototype.getValue=function(){return this.values.values[this.key];};SelectionInfo.prototype.forceMember=function(id,str){this.forcedMbrs[id]=str;};SelectionInfo.prototype.setPercentValue=function(percentValue){this.percentVal=percentValue;};SelectionInfo.prototype.clone=function(){var cln=new SelectionInfo();cln.dm=this.dm;cln.dmsel=this.dmsel;cln.values=this.values;cln.axis=this.axis.slice(0);return cln;};var S_ALPHA=0;var S_NUMERIC=1;var S_MEASURE=2;var S_CUSTOM=3;AxisSort=function(axisId,type,reverse,measure,measureName,onCaption){this.axisId=axisId;
this.type=type;this.reverse=reverse;this.measure=measure;this.measureName=measureName;this.onCaption=onCaption;};AxisSort.prototype.toJSON=function(){return{axisId:this.axisId,type:this.type,reverse:this.reverse,measure:this.measure,measureName:this.measureName,onCaption:this.onCaption};};PDFProperties=function(dm,dmsel,colors){this.dmsel=dmsel;this.dm=dm;this.colors=colors;this.scalex=new ScaleProperties();this.scaley=new ScaleProperties();this.scalez=new ScaleProperties();};Alerter=function(min,max,value,color,isIcon,fillColor){this.min=min;this.max=max;this.value=value;this.color=color;this.isIcon=isIcon;this.fillColor=fillColor;};Alerter.prototype.isInRange=function(val){if((this.min!="i")&&(val<this.min)){return false;}if((this.max!="i")&&(val>this.max)){return false;}return true;};Alerter.prototype.toJSON=function(){return{min:this.min,max:this.max,value:this.value,color:this.color,isIcon:this.isIcon};};Format=function(type,value,decimal,forceDecimal,leadingZero,thousandSeparator,decimalSeparator,zeroColor,positiveColor,negativeColor,unit,unitBackPosition,negativeDeco,prefixingPositive,kU,mU,gU,zeroIcon,positiveIcon,negativeIcon,nanReplacement,multiplier){this.id=null;
this.type=type;this.value=value;this.decimal=decimal;this.forceDecimal=forceDecimal;this.leadingZero=leadingZero;this.thousandSeparator=thousandSeparator;this.decimalSeparator=decimalSeparator;this.zeroColor=zeroColor;this.positiveColor=positiveColor;this.negativeColor=negativeColor;this.unit=unit;this.unitBackPosition=unitBackPosition;this.negativeDeco=negativeDeco;this.prefixingPositive=prefixingPositive;this.kU=kU;this.mU=mU;this.gU=gU;this.zeroIcon=zeroIcon;this.positiveIcon=positiveIcon;this.negativeIcon=negativeIcon;this.alerters=[];this.nanReplacement=nanReplacement;this.multiplier=multiplier;};Format.prototype.setDecimal=function(decimal,forceDecimal){this.decimal=decimal;this.forceDecimal=forceDecimal;};Format.prototype.setSeparator=function(thousandSeparator,decimalSeparator){this.thousandSeparator=thousandSeparator;this.decimalSeparator=decimalSeparator;};Format.prototype.setColors=function(zeroColor,positiveColor,negativeColor){this.zeroColor=zeroColor;this.positiveColor=positiveColor;
this.negativeColor=negativeColor;};Format.prototype.setUnits=function(unit,unitBackPosition){this.unit=unit;this.unitBackPosition=unitBackPosition;};Format.prototype.setAspects=function(leadingZero,negativeDeco,prefixingPositive){this.leadingZero=leadingZero;this.negativeDeco=negativeDeco;this.prefixingPositive=prefixingPositive;};Format.prototype.setAbbrev=function(kU,mU,gU){this.kU=kU;this.mU=mU;this.gU=gU;};Format.prototype.setIcons=function(zeroIcon,positiveIcon,negativeIcon){this.zeroIcon=zeroIcon;this.positiveIcon=positiveIcon;this.negativeIcon=negativeIcon;};Format.prototype.toJSON=function(){return{id:this.id};};Format.prototype.addAlerter=function(min,max,value,color,icon,def,fillColor){if(!this.alerters){this.alerters=[];}var al=new Alerter(min,max,value,color,icon,fillColor);if(def||!this.defaultalerter){this.defaultalerter=al;}this.alerters.push(al);};Format.prototype.getAlerter=function(val){if(val==null||typeof val=="undefined"||isNaN(val)){return this.defaultalerter;}var i=0;
while(i<this.alerters.length){if(this.alerters[i].isInRange(val)){return this.alerters[i];}++i;}return this.defaultalerter;};Format.prototype.setNanReplacement=function(nanReplacement){this.nanReplacement=nanReplacement;};TooltipProperties=function(){this.tooltipPrototype="";};TooltipProperties.prototype.setTooltipPrototype=function(proto){this.tooltipPrototype=proto;};TooltipProperties.prototype.getTooltip=function(selInfo){var caption=this.tooltipPrototype;var measure;var member="";var measureKey="";if(selInfo.values.axis[0].length!=0){key0=selInfo.values.axis[0][selInfo.axis[0].iAx].id;}var key1=selInfo.values.axis[1][selInfo.axis[1].iAx].id;var key2=null;if(selInfo.values.axis[2]){key2=selInfo.values.axis[2][selInfo.axis[2].iAx].id;}if(key0==null){key0="";}var keyf=key0;if(key1!=null){keyf+="-"+key1;}if(key2!=null){keyf+="-"+key2;}var measureName=selInfo.values.axis[selInfo.values.measureAxis][selInfo.axis[selInfo.values.measureAxis].iAx].id;if(key0==measureName){if(key1!=null){member=key1;
}if(key2!=null){member=member+"-"+key2;}}else{if(key1==measureName){if(key0!=null){member=key0;}if(key2!=null){member=member+"-"+key2;}}else{if(key1==measureName){if(key0!=null){member=key0;}if(key1!=null){member=member+"-"+key1;}}}}caption=replaceAll(caption,"${MeasureNameKey}",measureName);caption=replaceAll(caption,"${MemberKey}",member);var val=selInfo.values.values[keyf];caption=replaceAll(caption,"${AbsoluteValueKey}",val);return caption;};TooltipProperties.prototype.exist=function(value,array){for(var i=0;i<array.length;i++){if(value==array[i]){return true;}}return false;};LineStore=function(){this.selInfoArray=[];this.pointArray=[];this.txtArray=[];this.idArray=[];this.color="#0000FF";};LineStore.prototype.addElement=function(selInfo,x,y,txt,id,color,scale){this.selInfoArray.push(selInfo);if(y==null){this.pointArray.push(null);}else{this.pointArray.push(new Point(x,y));}this.txtArray.push(txt);this.idArray.push(id);this.color=color;this.scale=scale;};AspectModifier=function(){this.borderSize=null;
this.borderSizeP=-1;this.borderColor=null;this.borderColorP=-1;this.fillColor=null;this.fillColorP=-1;this.fillPattern=null;this.fillPatternP=-1;this.textColor=null;this.textColorP=-1;this.fontSize=null;this.fontSizeP=-1;this.fontFamily=null;this.fontFamilyP=-1;this.fontStyle=null;this.fontStyleP=-1;this.fontWeight=null;this.fontWeightP=-1;};AspectModifier.prototype.merge=function(modifier){if(!modifier){return;}this.mergeProp(modifier,"borderSize");this.mergeProp(modifier,"borderColor");this.mergeProp(modifier,"fillColor");this.mergeProp(modifier,"fillPattern");this.mergeProp(modifier,"textColor");this.mergeProp(modifier,"fontSize");this.mergeProp(modifier,"fontFamily");this.mergeProp(modifier,"fontStyle");this.mergeProp(modifier,"fontWeight");};AspectModifier.prototype.getFillColor=function(curColor){if((this.fillColor!=null)||(this.fillPattern!=null)){var colComp=curColor.split(":");var fillColPat=colComp[0];var fillPattern=null;var fillColor=fillColPat;if(fillColPat.charAt(0)==="!"){var patternComp=fillColPat.split("#");
fillPattern=patternComp[0];filColor="#"+patterComp[1];}if(this.fillPattern){fillPattern=this.fillPattern;}if(this.fillColor){fillColor=this.fillColor;}var color="";if(fillPattern){color="!"+fillPattern;}color+=fillColor;if(colComp.length>1){color+=":"+colComp[1];}return color;}return curColor;};AspectModifier.prototype.mergeProp=function(modifier,prop){if(this[prop]==null){if(modifier[prop]){this[prop]=modifier[prop];if(modifier[prop+"P"]){this[prop+"P"]=modifier[prop+"P"];}}}else{if(modifier[prop]){var curPrio=this[prop+"P"];if(curPrio==-1){this[prop]=modifier[prop];if(modifier[prop+"P"]){this[prop+"P"]=modifier[prop+"P"];}}else{if(modifier[prop+"P"]&&modifier[prop+"P"]>curPrio){this[prop]=modifier[prop];this[prop+"P"]=modifier[prop+"P"];}}}}};var INTERACT_BAR="interactBar";var COMBO_SPACE=4;var INTERACT_BAR_HEIGHT=22;var INTERACT_BAR_TOP=4;var INTERACT_BAR_LEFT=4;var comboWidth=100;if(typeof(ddCtrl.dmList)=="undefined"){ddCtrl.dmList=[];ddCtrl.dmSelList=[];ddCtrl.svgdocList=[];ddCtrl.chartList=[];
ddCtrl.dimPanelList={};ddCtrl.panelOrderedKey=[];ddCtrl.slicers={};ddCtrl.dmByPage={};ddCtrl.pageID="1";ddCtrl.drillObjectList={};ddCtrl.autoCommit=true;ddCtrl.ddVars={};}var dmList=ddCtrl.dmList;var dmSelList=ddCtrl.dmSelList;var svgdocList=ddCtrl.svgdocList;var chartList=ddCtrl.chartList;var dimPanelList=ddCtrl.dimPanelList;var panelOrderedKey=ddCtrl.panelOrderedKey;var slicers=ddCtrl.slicers;var dmByPage=ddCtrl.dmByPage;var drillObjectList=ddCtrl.drillObjectList;var autoCommit=ddCtrl.autoCommit;var ddVars=ddCtrl.ddVars;UIUpdater=function(){};UIUpdater.prototype.onChange=function(objPanelDim){ddCtrl.refreshAllDocuments();};var updater=new UIUpdater();ddCtrl.refreshAllDocuments=function(){if(!ddCtrl.autoCommit){return;}var i=0;while(i<svgdocList.length){var svgDoc=svgdocList[i];var dmSel=dmSelList[i];if(typeof(svgDoc.refreshDM)=="function"&&typeof(ddCtrl.isPageVisible)=="undefined"||ddCtrl.isPageVisible(dmSel.pageId,svgDoc.frameId)){try{svgDoc.refreshDM();}catch(e){}}++i;}};ddCtrl.refreshChart=function(frameId){var svgDoc=null;
var dmSel=null;for(var i=0;i<svgdocList.length;i++){if(svgdocList[i].frameId==frameId){svgDoc=svgdocList[i];dmSel=dmSelList[i];break;}}if(svgDoc){try{dmSel.updated=true;svgDoc.refreshDM();}catch(e){}}};ddCtrl.beginSelection=function(){ddCtrl.autoCommit=false;};ddCtrl.commitSelection=function(){ddCtrl.autoCommit=true;refreshAllDocuments();if(typeof(ddHistory)!="undefined"){ddHistory.saveHistoryState(null,null);}};ddCtrl.getDMIndex=function(svgdoc){for(var i=0;i<svgdocList.length;i++){if(svgdocList[i]==svgdoc){return i;}}};ddCtrl.unregisterDM=function(frameId){for(var i=0;i<svgdocList.length;i++){if(svgdocList[i].frameId==frameId){svgdocList.splice(i,1);dmSelList.splice(i,1);dmList.splice(i,1);chartList.splice(i,1);break;}}};ddCtrl.registerDM=function(svgdoc,dm,dmSel,chart){svgdocList.push(svgdoc);dmList.push(dm);var pageId=svgdoc.pageId;if(typeof(pageId)=="undefined"||pageId==null){pageId=ddCtrl.pageID;}dmSel.pageId=pageId;dmSel.frameId=svgdoc.frameId;dmSel.flowId=chart.flowId;dmSel.title=chart.title;
chart.frameId=svgdoc.frameId;dmSelList.push(dmSel);if(chart){chartList.push(chart);ddCtrl.createBreadCrumb(svgdoc,chart,dmSel,true);}createCombo(INTERACT_BAR,dm,dmSel,chart.title,chart.flowId,svgdoc.frameId,pageId);if(ddCtrl.filtersForFlowInWindow){var filters=ddCtrl.filtersForFlowInWindow[svgdoc.frameId];if(filters){for(var dimId in filters){var filterOperand=filters[dimId];var dim=dm.getDimensionById(filterOperand.dimId);if(dim){var filter=getFilter(dim,filterOperand.h,filterOperand.l,[filterOperand.member]);if(filter){dmSel.setFilter(filter);if(ddCtrl.drillObjectList[svgdoc.frameId]){for(var drillId in ddCtrl.drillObjectList[svgdoc.frameId]){var drillObject=ddCtrl.drillObjectList[svgdoc.frameId][drillId];if(drillObject.drillOnFilter){drillObject.onDimensionFilter(filter.dim.id,filter.getHierarchyId(),filter.getLevelId(),filter.selectedMembers);}}}}}}delete ddCtrl.filtersForFlowInWindow[svgdoc.frameId];}else{if(ddCtrl.widgetsByPage){var widgetId=svgdoc.frameId.replace("frame_","");var widget=ddCtrl.getWidget(widgetId);
if(widget!=null&&widget.portletContainerId){var bFind=false;while(widget.portletContainerId&&!bFind){widget=ddCtrl.getWidget(widget.portletContainerId);if(widget==null){break;}if(ddCtrl.filtersForFlowInWindow["frame_"+widget.portletId]){bFind=true;}}if(bFind){var filters=ddCtrl.filtersForFlowInWindow["frame_"+widget.portletId];for(var dimId in filters){var filterOperand=filters[dimId];var dim=dm.getDimensionById(filterOperand.dimId);if(dim){var filter=getFilter(dim,filterOperand.h,filterOperand.l,[filterOperand.member]);if(filter){dmSel.setFilter(filter);if(ddCtrl.drillObjectList[svgdoc.frameId]){for(var drillId in ddCtrl.drillObjectList[svgdoc.frameId]){var drillObject=ddCtrl.drillObjectList[svgdoc.frameId][drillId];if(drillObject.drillOnFilter){drillObject.onDimensionFilter(filter.dim.id,filter.getHierarchyId(),filter.getLevelId(),filter.selectedMembers);}}}}}}}}}}}};ddCtrl.createBreadCrumb=function(svgdoc,chart,dmSel,bFindSamePreDrill){if(chart.clickAction){if(chart.clickAction.action==DRILL||chart.clickAction.action==SYNCHRONIZEDDRILL||chart.clickAction.action==CHANGEDIMENSION||chart.clickAction.action==SYNCHRONIZECHANGEDIMENSION){var bSync=(chart.clickAction.action==SYNCHRONIZEDDRILL||chart.clickAction.action==SYNCHRONIZECHANGEDIMENSION)?true:false;
var aaxis=dmSel.axis[chart.clickAction.axis];if(aaxis==null){chart.clickAction.action=null;}else{var dimEx=dmSel.dimsToExplore[aaxis[0]];if((dimEx.hierarchy&&dimEx.lPos>-1)||dmSel.drillPaths[chart.clickAction.axis]){var drillId=null;if(dmSel.drillPaths[chart.clickAction.axis]){drillId=dmSel.drillPaths[chart.clickAction.axis].dimsExplorer[0].dim.id+"_"+dmSel.drillPaths[chart.clickAction.axis].name;}else{if(dimEx.hierarchy){drillId=dimEx.dim.id+"_"+dimEx.hierarchy.id;}}if(typeof(drillObjectList[svgdoc.frameId])=="undefined"){drillObjectList[svgdoc.frameId]={};var drillObject=null;if(dmSel.drillPaths[chart.clickAction.axis]&&(chart.clickAction.action==CHANGEDIMENSION||chart.clickAction.action==SYNCHRONIZECHANGEDIMENSION)){drillObject=new ChangeDimObject(drillId,svgdoc,chart,dmSel,chart.clickAction.axis,dimEx,dmSel.drillPaths[chart.clickAction.axis],bSync);}else{drillObject=new DrillObject(drillId,svgdoc,chart,dmSel,chart.clickAction.axis,dimEx,dmSel.drillPaths[chart.clickAction.axis],bSync,chart.drillOnFilter,chart.drillOnSrcDims);
}drillObjectList[svgdoc.frameId][drillId]=drillObject;drillObject.createBreadCrumb(true);if(bFindSamePreDrill&&bSync){var obj=findSamePreDrill(drillObject);if(obj){drillObject.drillTo(obj.getBreadPath());}}}}}}if((typeof(chart.clickAction.action)=="undefined")||(chart.clickAction.action==null)){var i;var remove=true;for(i in chart.clickAction){var clickAction=chart.clickAction[i];if(clickAction&&(clickAction.action==DRILL||clickAction.action==SYNCHRONIZEDDRILL||clickAction.action==CHANGEDIMENSION||clickAction.action==SYNCHRONIZECHANGEDIMENSION)){var bSync=(clickAction.action==SYNCHRONIZEDDRILL||clickAction.action==SYNCHRONIZECHANGEDIMENSION)?true:false;if(typeof(dmSel.axis[clickAction.axis])!="undefined"){var index=dmSel.axis[clickAction.axis][0];var dimEx=dmSel.dimsToExplore[index];if((dimEx.hierarchy&&dimEx.lPos>-1)||dmSel.drillPaths[clickAction.axis]){if(typeof(drillObjectList[svgdoc.frameId])=="undefined"){drillObjectList[svgdoc.frameId]={};}var drillId=null;if(dmSel.drillPaths[clickAction.axis]){drillId=dmSel.drillPaths[clickAction.axis].dimsExplorer[0].dim.id+"_"+dmSel.drillPaths[clickAction.axis].name;
}else{if(dimEx.hierarchy){drillId=dimEx.dim.id+"_"+dimEx.hierarchy.id;}}if(typeof(drillObjectList[svgdoc.frameId][drillId])=="undefined"){var drillObject=null;if(dmSel.drillPaths[clickAction.axis]&&(clickAction.action==CHANGEDIMENSION||clickAction.action==SYNCHRONIZECHANGEDIMENSION)){drillObject=new ChangeDimObject(drillId,svgdoc,chart,dmSel,clickAction.axis,dimEx,dmSel.drillPaths[clickAction.axis],bSync);}else{drillObject=new DrillObject(drillId,svgdoc,chart,dmSel,clickAction.axis,dimEx,dmSel.drillPaths[clickAction.axis],bSync,chart.drillOnFilter,chart.drillOnSrcDims);}drillObjectList[svgdoc.frameId][drillId]=drillObject;drillObject.createBreadCrumb(remove);remove=false;if(bFindSamePreDrill&&bSync){var obj=findSamePreDrill(drillObject);if(obj){drillObject.drillTo(obj.getBreadPath());}}}}}}}}if(chart.drillOnEmptyZone){drillId="drillOnEmptyZone";if(typeof(drillObjectList[svgdoc.frameId])=="undefined"){drillObjectList[svgdoc.frameId]={};}var drillObject=new DrillOnEmptyZone(drillId,svgdoc,chart,dmSel,true);
drillObjectList[svgdoc.frameId][drillId]=drillObject;drillObject.createBreadCrumb(true);}}else{if(chart.drillOnEmptyZone){var drillId="drillOnEmptyZone";if(typeof(drillObjectList[svgdoc.frameId])=="undefined"){drillObjectList[svgdoc.frameId]={};}var drillObject=new DrillOnEmptyZone(drillId,svgdoc,chart,dmSel,true);drillObjectList[svgdoc.frameId][drillId]=drillObject;drillObject.createBreadCrumb(true);}}};function findSamePreDrill(drillObject){for(var frameId in drillObjectList){for(var drillId in drillObjectList[frameId]){var obj=drillObjectList[frameId][drillId];if(obj.frameId!=drillObject.frameId&&obj.getBreadPath().elements.length>0&&drillObject.isSameDrill(obj)){return obj;}}}return null;}ddCtrl.getVariable=function(name){return getDDVar(name);};ddCtrl.changeVariable=function(name,value){if(!name){if(this.throwSDKErrors){throw"Invalid parameters";}else{return;}}var variable=__v[name];if(variable&&variable.cur!=value){variable.cur=value;__v[name]=variable;var i=0;while(i<dmList.length){var dm=dmList[i];
if(dm.variables[name]){dm.variables[name]=variable;var dmSel=dmSelList[i];updateDDVar(dmSel,name);dmSel.updated=true;}i++;}if(typeof(updateVariablesOnCurrentPage)=="function"){updateVariablesOnCurrentPage();}if(ddHistory){ddHistory.saveHistoryState(null,null);}refreshAllDocuments();if(typeof(ddCtrl.fireVariableChangeListener)=="function"){ddCtrl.fireVariableChangeListener(name,value);}}};ddCtrl.setDDVar=ddCtrl.changeVariable;function updateDDVar(dmSel,varName){var ddvarformula="getDDVar('"+varName+"')";for(var iF=0;iF<dmSel.dimsToFilter.length;iF++){var filter=dmSel.dimsToFilter[iF];if((filter.minFormula&&filter.minFormula.toString().indexOf(ddvarformula)>-1)||(filter.maxFormula&&filter.maxFormula.toString().indexOf(ddvarformula)>-1)){var dimPanel=dimPanelList[filter.dim.id+filter.dim.continuous];if(dimPanel){var f=filter.clone();dimPanel.setRange(f.min,f.max,f.dim.format,false);dimPanel.dimSelChangeHandler();for(var slicerId in ddCtrl.slicers){var slicer=ddCtrl.slicers[slicerId];if(slicer.dimId==filter.dim.id&&slicer.pageId==ddCtrl.pageID){slicer.dmSel.setFilter(f);
}}}}}}ddCtrl.getChart=function(frameId){for(var i=0;i<chartList.length;i++){var chart=chartList[i];if(chart&&typeof(chart.frameId)!="undefined"&&(chart.frameId==frameId||chart.frameId==("frame_"+frameId))){return chart;}}return null;};ddCtrl.getSVGDoc=function(frameId){for(var i=0;i<svgdocList.length;i++){var svgdoc=svgdocList[i];if(svgdoc&&typeof(svgdoc.frameId)!="undefined"&&svgdoc.frameId==frameId){return svgdocList[i];}}return null;};ddCtrl.getDMSel=function(frameId){for(var i=0;i<dmSelList.length;i++){var dmsel=dmSelList[i];if(dmsel&&typeof(dmsel.frameId)!="undefined"&&dmsel.frameId==frameId){return dmSelList[i];}}return null;};ddCtrl.getDataModel=function(cubeId){for(var i=0;i<dmList.length;i++){var dm=dmList[i];if(dm.cubeId==cubeId){return dm;}}return null;};ddCtrl.getDataModelById=function(dmId){for(var i=0;i<dmList.length;i++){var dm=dmList[i];var s=dm.cubeId.split("_");if(s.length==3&&s[0]==dmId){return dm;}}return null;};ddCtrl.getDataModelSelectionByFlow=function(flowId){for(var i=0;
i<dmSelList.length;i++){var dmSel=dmSelList[i];if(dmSel.flowId==flowId&&dmSel.pageId==ddCtrl.pageID){return dmSel;}}for(var i=0;i<dmSelList.length;i++){var dmSel=dmSelList[i];if(dmSel.flowId==flowId&&(dmSel.pageId=="foreground_foreground"||dmSel.pageId=="foreground.foreground")){return dmSel;}}for(var i=0;i<dmSelList.length;i++){var dmSel=dmSelList[i];if(dmSel.flowId==flowId){return dmSel;}}return null;};ddCtrl.getDataModelByFlow=function(flowId){for(var i=0;i<dmSelList.length;i++){var dmSel=dmSelList[i];if(dmSel.flowId==flowId&&dmSel.pageId==ddCtrl.pageID){return dmSel.dm;}}for(var i=0;i<dmSelList.length;i++){var dmSel=dmSelList[i];if(dmSel.flowId==flowId&&(dmSel.pageId=="foreground_foreground"||dmSel.pageId=="foreground.foreground")){return dmSel.dm;}}for(var i=0;i<dmSelList.length;i++){var dmSel=dmSelList[i];if(dmSel.flowId==flowId){return dmSel.dm;}}return null;};ddCtrl.getChartHandle=function(flowId){for(id in ddCtrl.charts){var chart=ddCtrl.charts[id];if(chart.flowId==flowId&&chart.pageId==ddCtrl.pageID){return chart;
}}for(id in ddCtrl.charts){var chart=ddCtrl.charts[id];if(chart.flowId==flowId&&(chart.pageId=="foreground_foreground"||chart.pageId=="foreground.foreground")){return chart;}}for(id in ddCtrl.charts){var chart=ddCtrl.charts[id];if(chart.flowId==flowId){return chart;}}return null;};ddCtrl.getDimensionsVisible=function(){var mapDimVisible=new Object();for(var frameId in ddCtrl.charts){var chartHandle=ddCtrl.charts[frameId];if((ddCtrl.isPageVisible===undefined||ddCtrl.isPageVisible(chartHandle.pageId,frameId))&&(ddCtrl.widgetIsHidden===undefined||!ddCtrl.widgetIsHidden(chartHandle.portletId))){var dmSel=ddCtrl.getDMSel(frameId);if(dmSel){var doc=document.getElementById(frameId);var chart=ddCtrl.getChart(frameId);for(var i=0;i<dmSel.dm.dimensions.length;i++){var dim=dmSel.dm.dimensions[i];var hidden=false;if(dim.archived){hidden=true;}else{if(typeof(getComboAttribute)=="function"){var comboDisplay=getComboAttribute(dim.id,"display","default");if(comboDisplay=="default"){hidden=(dmSel.dimensionsToExcludeForDisplay[dim.id])?true:false;
}else{hidden=(comboDisplay=="true")?false:true;}}else{hidden=(dmSel.dimensionsToExcludeForDisplay[dim.id])?true:false;}}if(!hidden){mapDimVisible[dim.id]=true;}}}}}return mapDimVisible;};ddCtrl.getResultCubeValue=function(flowId,measure,axisMembers,bFormated){if(!flowId){if(this.throwSDKErrors){throw"Invalid parameters";}else{return;}}var val=null;var chartHandle=ddCtrl.getChartHandle(flowId);if(chartHandle){var chart=ddCtrl.getChart(chartHandle.id);var rs=chart.lastCube;val=rs.getValue(measure,axisMembers,bFormated);}else{if(this.throwSDKErrors){throw"Chart "+flowId+" not found on page.";}}return val;};ddCtrl.getResultCubeRowSet=function(flowId,queryObject,bFormated){if(!flowId){if(this.throwSDKErrors){throw"Invalid parameters";}else{return;}}var val=null;var chartHandle=ddCtrl.getChartHandle(flowId);if(chartHandle){var chart=ddCtrl.getChart(chartHandle.id);var rs=chart.lastCube;val=rs.getRowSet(queryObject,bFormated);}else{if(this.throwSDKErrors){throw"Chart "+flowId+" not found on page.";
}}return val;};ddCtrl.switch_page=function(page){if(ddCtrl.switchPage){ddCtrl.switchPage(page);}};ddCtrl.changePage=ddCtrl.switch_page;FilterOperand=function(dim,member,h,l,memberFormated,bAddFilter,bExcludeFilter){this.dimId=dim;this.member=member;this.h=h;this.l=l;this.memberFormated=memberFormated;this.bAddFilter=bAddFilter;this.bExcludeFilter=bExcludeFilter;};FilterOperand.prototype.toString=function(){if(typeof(this.member)=="object"&&typeof(this.member.length)!="undefined"){var s="";for(var i=0;i<this.member.length;i++){s+=this.member[i];if((i+1)<this.member.length){s+=",";}}return s;}else{return this.member;}};FilterOperand.prototype.equals=function(filterOperand){if(this.dimId!=filterOperand.dimId){return false;}if(this.h!=filterOperand.h){return false;}if(this.l!=filterOperand.l){return false;}if(this.bExcludeFilter!=filterOperand.bExcludeFilter){return false;}if(typeof(this.member)!=typeof(filterOperand.member)){return false;}if(typeof(this.member)=="string"&&this.member!=filterOperand.member){return false;
}if(typeof(this.member)=="object"&&typeof(filterOperand.member)=="object"&&typeof(this.member.length)!="undefined"&&typeof(filterOperand.member.length)!="undefined"){if(this.member.length!=filterOperand.member.length){return false;}else{for(var i=0;i<this.member.length;i++){if(this.member[i]!=filterOperand.member[i]){return false;}}}}return true;};FilterOperandContinuous=function(dim,min,max,bExcludeFilter){this.dimId=dim;this.min=min;this.max=max;this.bExcludeFilter=bExcludeFilter;};FilterOperandContinuous.prototype.toString=function(){return this.min+"-"+this.max;};FilterOperandContinuous.prototype.equals=function(filterOperand){if(this.min!=filterOperand.min){return false;}if(this.max!=filterOperand.max){return false;}if(this.h!=filterOperand.h){return false;}if(this.l!=filterOperand.l){return false;}if(this.bExcludeFilter!=filterOperand.bExcludeFilter){return false;}return true;};ddCtrl.registerDimsToFilter=function(dmsel,axisId,mbr,mbrF,bAddFilter){if(dmsel.axis[axisId]){var dimEx=dmsel.dimsToExplore[dmsel.axis[axisId][0]];
if(!ddCtrl.dimsToFilter){ddCtrl.dimsToFilter=new Object();}var hlIds=getHierarchyLevelIds(dimEx.dim,dimEx.hPos,dimEx.lPos);var filter=new FilterOperand(dimEx.dimId,mbr,hlIds[0],hlIds[1],mbrF,bAddFilter);ddCtrl.dimsToFilter[dimEx.dim.id]=filter;}};ddCtrl.filter=function(dimOrFilterOp,member){if((typeof(dimOrFilterOp)=="string"&&dimOrFilterOp=="")||dimOrFilterOp==null){if(this.throwSDKErrors){throw"Invalid parameters";}else{return;}}if(arguments.length>1&&typeof(member)=="undefined"){if(this.throwSDKErrors){throw"Invalid parameters";}else{return;}}var dimension=dimOrFilterOp;var h=null;var l=null;var memberFormated=null;var bAddFilter=false;var bExcludeFilter=false;if(typeof(dimOrFilterOp)=="object"&&typeof(dimOrFilterOp.member)!="undefined"){dimension=dimOrFilterOp.dimId;h=dimOrFilterOp.h;l=dimOrFilterOp.l;member=dimOrFilterOp.member;memberFormated=dimOrFilterOp.memberFormated;bAddFilter=dimOrFilterOp.bAddFilter;bExcludeFilter=dimOrFilterOp.bExcludeFilter;}else{if(typeof(member)=="object"&&typeof(member.member)!="undefined"){h=member.h;
l=member.l;member=member.member;memberFormated=member.memberFormated;bAddFilter=member.bAddFilter;bExcludeFilter=member.bExcludeFilter;}else{if(typeof(ddCtrl.dimsToFilter)!="undefined"&&ddCtrl.dimsToFilter[dimension]&&ddCtrl.dimsToFilter[dimension]!=null){var filter=ddCtrl.dimsToFilter[dimension];h=filter.h;l=filter.l;if(filter.memberFormated!==undefined&&filter.memberFormated!=null&&(memberFormated===undefined||memberFormated==null)){memberFormated=filter.memberFormated;}bAddFilter=filter.bAddFilter;bExcludeFilter=filter.bExcludeFilter;ddCtrl.dimsToFilter[dimension]=null;}}}var bFindDim=false;var panel=dimPanelList[dimension+"false"];if(!panel){panel=dimPanelList[dimension+"true"];}if(panel){var members=[];if(typeof(member)=="object"&&typeof(member.length)!="undefined"){members=member;}else{if(typeof(member)=="string"){members=member.split(",");}else{members.push(member);}}var membersFormated=null;if(memberFormated){if(typeof(memberFormated)=="object"&&typeof(memberFormated.length)!="undefined"){membersFormated=memberFormated;
}else{if(typeof(memberFormated)=="string"){membersFormated=memberFormated.split(",");}else{membersFormated.push(memberFormated);}}}if(bAddFilter){panel.addMembers(h,l,members,membersFormated,bExcludeFilter);}else{panel.selectMembers(h,l,members,membersFormated,false,bExcludeFilter);}}else{ddCtrl.urlParams[dimension]=member;ddCtrl.urlParams["H"+dimension]=h;ddCtrl.urlParams["L"+dimension]=l;}};ddCtrl.filterAndChangePage=function(page,dimOrFilterOp,member){if(ddHistory){ddCtrl.ddHistory.bSaveHistoryState=false;}if(arguments.length>2&&typeof(member)!="undefined"){ddCtrl.filter(dimOrFilterOp,member);}else{ddCtrl.filter(dimOrFilterOp);}if(ddCtrl.changePage){if(ddHistory){ddCtrl.ddHistory.bSaveHistoryState=true;}ddCtrl.changePage(page);}};ddCtrl.switch_page_filter=function(page,dimension,member){ddCtrl.filterAndChangePage(page,dimension,member);};ddCtrl.addFilter=function(dimEx,member,memberFormated){var panel=dimPanelList[dimEx.dim.id+dimEx.dim.continuous];if(panel){if(dimEx.hierarchy&&dimEx.hierarchy.levels[dimEx.lPos]){var hName=dimEx.hierarchy.id;
var lName=dimEx.hierarchy.levels[dimEx.lPos].id;panel.addMember(hName,lName,member,memberFormated);}else{panel.addMember(dimEx.hPos,dimEx.lPos,member,memberFormated);}}};ddCtrl.setFilter=function(dimEx,member,memberFormated){log("this function is deprecated, use ddCtrl.filter");};ddCtrl.setFilterMembers=function(dimEx,members,membersFormated){log("this function is deprecated, use ddCtrl.filter");};ddCtrl.setFilterRange=function(dimId,min,max){var panel=dimPanelList[dimId+"true"];if(panel){panel.setFilterRange(min,max);panel.dimSelChangeHandler();if(panel.updateOnChange&&panel.updaterFunc!=null){panel.updaterFunc.onChange();}}};ddCtrl.setFilterMinMax=function(dimId,min,max){var panel=dimPanelList[dimId+"true"];if(panel){panel.setFilterMinMax(min,max);}else{ddCtrl.urlParams[dimId+"_min"]=min;ddCtrl.urlParams[dimId+"_max"]=max;}};ddCtrl.getDimPanel=function(dimName,continuous){if(!dimName){return null;}if(typeof(continuous)=="undefined"||(continuous!==true&&continuous!==false)){if(dimPanelList[dimName+"false"]){return dimPanelList[dimName+"false"];
}else{if(dimPanelList[dimName+"true"]){return dimPanelList[dimName+"true"];}}}else{if(dimPanelList[dimName+continuous]){return dimPanelList[dimName+continuous];}}return null;};ddCtrl.isDimensionVisible=function(dimName,continuous){if(!dimName){if(this.throwSDKErrors){throw"Invalid parameters";}else{return false;}}var dimSelPanel=this.getDimPanel(dimName,continuous);if(!dimSelPanel||dimSelPanel.hidden){return false;}return true;};ddCtrl.isDimensionFiltered=function(dimName,continuous){if(!dimName){if(this.throwSDKErrors){throw"Invalid parameters";}else{return false;}}var dimSelPanel=this.getDimPanel(dimName,continuous);if(dimSelPanel){return dimSelPanel.hasFilter();}return false;};ddCtrl.setDimensionNavigation=function(dimId,flowId,navigation){var dmsel=ddCtrl.getDataModelSelectionByFlow(flowId);if(dmsel!=null){dmsel.dimensionsToExcludeForNavigation[dimId]=!navigation;}};ddCtrl.getDimensionFilter=function(dimName,continuous){if(!dimName){if(this.throwSDKErrors){throw"Invalid parameters";
}else{return[0];}}var dimSelPanel=this.getDimPanel(dimName,continuous);if(dimSelPanel){return dimSelPanel.getSelectedElements();}return[0];};ddCtrl.getDimensionFilterString=function(dimName,continuous){if(!dimName){if(this.throwSDKErrors){throw"Invalid parameters";}else{return[0];}}var dimSelPanel=this.getDimPanel(dimName,continuous);if(dimSelPanel){return dimSelPanel.getSelectedElementsAsString();}return"";};ddCtrl.replaceTokensFlow=function(frameId,text){for(var i=0;i<dmSelList.length;i++){var dmSel=dmSelList[i];if(dmSel.frameId==frameId){return replaceTokens(dmSel,text,text);}}return null;};ddCtrl.removeAllFilters=function(){if(ddCtrl.ddHistory){ddCtrl.ddHistory.bSaveHistoryState=false;}var isAutoCommit=ddCtrl.autoCommit;if(isAutoCommit){ddCtrl.beginSelection();}for(var panelId in dimPanelList){var panel=dimPanelList[panelId];panel.selectMember(-1,-1,"All");panel.dimSelChangeHandler();}if(ddCtrl.ddHistory){ddCtrl.ddHistory.bSaveHistoryState=true;ddCtrl.ddHistory.saveHistoryState(null,null);
}if(isAutoCommit){ddCtrl.commitSelection();}};ddCtrl.removeFilters=function(dimName,continuous){if(!dimName){if(this.throwSDKErrors){throw"Invalid parameters";}else{return;}}var dimSelPanel=this.getDimPanel(dimName,continuous);if(dimSelPanel){dimSelPanel.selectMember(-1,-1,"All");}};ddCtrl.throwSDKErrors=false;ddCtrl.drill=function(docId,id,member,memberFormated,bSync){if(!docId||!id){return;}docId=this.findDrillFrameId(docId);if(!docId||!drillObjectList[docId]){return;}var drillObj=drillObjectList[docId][id];if(!drillObj){return;}ddCtrl.drillUpdateOnFilter=false;if(bSync){ddCtrl.beginSelection();var initLevel=drillObj.initLevel;for(var frameId in drillObjectList){for(drillId in drillObjectList[frameId]){var curDrillObj=drillObjectList[frameId][drillId];if(curDrillObj.synchronised&&curDrillObj.isSameDrill(drillObj)){curDrillObj.drill(member,memberFormated);}}}ddCtrl.commitSelection();}else{drillObj.drill(member,memberFormated);}ddCtrl.drillUpdateOnFilter=true;};ddCtrl.drillDown=function(docId,dimId,hierId,member,memberFormated,bSync){if(!docId||!dimId){if(this.throwSDKErrors){throw"Invalid parameters";
}else{return;}}ddCtrl.drillUpdateOnFilter=false;var drillId=this.getDrillId(docId,dimId,hierId);if(drillId){var drillObj=this.getDrillObject(docId,dimId);this.drill(docId,drillId,member,memberFormated,drillObj.synchronised);}ddCtrl.drillUpdateOnFilter=true;};ddCtrl.rewind=function(docId,id,member,dimPos,bSync){if(!docId||!id){return;}docId=this.findDrillFrameId(docId);if(!docId||!drillObjectList[docId]){return;}var drillObj=drillObjectList[docId][id];ddCtrl.drillUpdateOnFilter=false;ddCtrl.beginSelection();if(bSync){for(var frameId in drillObjectList){for(drillId in drillObjectList[frameId]){var curDrillObj=drillObjectList[frameId][drillId];if(curDrillObj.synchronised&&curDrillObj.isSameDrill(drillObj)){curDrillObj.rewind(member,dimPos);}}}}else{drillObj.rewind(member,dimPos);}ddCtrl.commitSelection();ddCtrl.drillUpdateOnFilter=true;};ddCtrl.findDrillFrameId=function(docId){if(docId){if(drillObjectList[docId]){return docId;}if(docId.indexOf("frame_")<0&&drillObjectList["frame_"+docId]){return"frame_"+docId;
}}return null;};ddCtrl.removeDrillObject=function(docId,dimIdOrDrillId,hierId){if(!docId||!dimIdOrDrillId){return false;}docId=this.findDrillFrameId(docId);if(!docId||!drillObjectList[docId]){return false;}var drillId=this.getDrillId(docId,dimIdOrDrillId,hierId);if(drillId){var drillObj=drillObjectList[docId][drillId];if(drillObj){var drillObj=drillObjectList[docId][drillId];for(var i=0;i<this.dimensionFilterListeners.length;i++){var listener=this.dimensionFilterListeners[i];if(listener==drillObj){this.dimensionFilterListeners.splice(i,1);--i;}}delete drillObjectList[docId][drillId];var bcParent=document.getElementById(drillObj.frameId+"_breadcrumb");if(bcParent){var bcObj=document.getElementById(drillObj.frameId+"_"+drillObj.id);if(bcObj){bcParent.removeChild(bcObj);if(bcParent.childNodes.length==1){bcParent.removeChild(bcParent.childNodes[0]);}}}return true;}}return false;};ddCtrl.getDrillObject=function(docId,dimIdOrDrillId,hierId){docId=this.findDrillFrameId(docId);if(!docId||!drillObjectList[docId]){return null;
}var drillId=this.getDrillId(docId,dimIdOrDrillId,hierId);if(drillId){return drillObjectList[docId][drillId];}return null;};ddCtrl.getDrillId=function(docId,dimIdOrDrillId,hierId){docId=this.findDrillFrameId(docId);if(!docId||!drillObjectList[docId]){return null;}else{if(drillObjectList[docId][dimIdOrDrillId]&&dimIdOrDrillId.indexOf("_")>-1){return dimIdOrDrillId;}else{if(dimIdOrDrillId&&hierId){if(drillObjectList[docId][dimIdOrDrillId+"_"+hierId]){return dimIdOrDrillId+"_"+hierId;}}else{if(dimIdOrDrillId&&!hierId){for(drillId in drillObjectList[docId]){var curDrillObj=drillObjectList[docId][drillId];if(curDrillObj.getDimId()==dimIdOrDrillId){return drillId;}}}}}}return null;};ddCtrl.resetChart=function(docId,id,bSync){if(!docId||!id){return;}docId=this.findDrillFrameId(docId);if(!docId){return;}var drillObj=drillObjectList[docId][id];if(!drillObj){return;}ddCtrl.drillUpdateOnFilter=false;ddCtrl.beginSelection();for(drillId in drillObjectList[docId]){var curDrillObj=drillObjectList[docId][drillId];
curDrillObj.resetChart(true);}if(bSync){for(var frameId in drillObjectList){if(frameId!=docId){for(drillId in drillObjectList[frameId]){var curDrillObj=drillObjectList[frameId][drillId];if(curDrillObj.synchronised&&curDrillObj.isSameDrill(drillObj)){curDrillObj.resetChart(true);}}}}}ddCtrl.commitSelection();ddCtrl.drillUpdateOnFilter=true;};ddCtrl.resetDrill=function(docId,dimId,arg1,arg2){if(!docId||!dimId){if(this.throwSDKErrors){throw"Invalid parameters";}else{return;}}var hierId=(typeof(arg2)!="undefined")?arg1:null;var bSync=(typeof(arg2)!="undefined")?arg2:((typeof(arg1)!="undefined")?arg1:false);var drillId=this.getDrillId(docId,dimId,hierId);if(drillId){var drillObj=this.getDrillObject(docId,dimId);this.resetChart(docId,drillId,drillObj.synchronised);}};ddCtrl.getBreadPath=function(docId,dimId,hierId){if(!docId||!dimId){if(this.throwSDKErrors){throw"Invalid parameters";}else{return null;}}var drillObj=this.getDrillObject(docId,dimId,hierId);if(drillObj){return drillObj.getBreadPath();
}return null;};ddCtrl.drillTo=function(docId,dimId,breadPath){if(!docId||!dimId){if(this.throwSDKErrors){throw"Invalid parameters";}else{return null;}}var drillObj=this.getDrillObject(docId,dimId);if(drillObj){drillObj.drillTo(breadPath);drillObj.doc.refreshDM();}};ddCtrl.drillUp=function(docId,dimId){if(!docId||!dimId){if(this.throwSDKErrors){throw"Invalid parameters";}else{return null;}}var drillObj=this.getDrillObject(docId,dimId);if(drillObj){}return null;};ddCtrl.getCurrentDrill=function(docId,dimId,hierId){var drillId=this.getDrillId(docId,dimId,hierId);if(drillId){var drillObj=this.getDrillObject(docId,dimId);if(drillObj){var dimId=drillObj.getCurrentDimId();var hierarchyId=drillObj.getCurrentHierarchyId();var levelId=drillObj.getCurrentLevelId();return[dimId,hierarchyId,levelId];}}};ddCtrl.getDataModelDate=function(dmId,bFormat){var dm=ddCtrl.getDataModelById(dmId);if(dm!=null){var cubeId=dm.cubeId;var s=dm.cubeId.split("_");var ts=s[2];ts=parseInt(ts);if(bFormat){return formatNum(ts/1000,new Format(1,"dd/MM/yyyy HH:mm:ss"));
}else{return ts;}}return null;};ddCtrl.getFlowDate=function(flowId,bFormat){var dm=ddCtrl.getDataModelByFlow(flowId);if(dm!=null){var s=dm.cubeId.split("_");if(s.length==3){var ts=s[2];ts=parseInt(ts);if(bFormat){return formatNum(ts/1000,new Format(1,"dd/MM/yyyy HH:mm:ss"));}else{return ts;}}}return null;};ddCtrl.getLastDimensionDate=function(dmId,dimId,bFormat){var dm=ddCtrl.getDataModelById(dmId);if(dm!=null){var dim=dm.getDimensionById(dimId);if(dim&&dim.time){var max=dim.max;if(bFormat){return formatNum(max,new Format(1,"dd/MM/yyyy HH:mm:ss"));}else{return max;}}}};ddCtrl.getFirstDimensionDate=function(dmId,dimId,bFormat){var dm=ddCtrl.getDataModelById(dmId);if(dm!=null){var dim=dm.getDimensionById(dimId);if(dim&&dim.time){var min=dim.min;if(bFormat){return formatNum(min,new Format(1,"dd/MM/yyyy HH:mm:ss"));}else{return min;}}}};var dimSelChanged={};function createCombo(idContainer,dm,dmSel,flowName,flowId,frameId,pageId){if(ddCtrl.urlParams&&ddCtrl.urlParams.forceShowCombos=="true"){dmSel.dimensionsToExcludeForDisplay=new Array();
}var container=document.getElementById(idContainer);if(typeof(pageId)=="undefined"){pageId=ddCtrl.pageID;}if(ddCtrl.urlParams){for(var varName in dm.variables){if(typeof(ddCtrl.urlParams[varName])!="undefined"&&ddCtrl.urlParams[varName]!=null){var variable=dm.variables[varName];try{var varValue=parseFloat(ddCtrl.urlParams[varName]);variable.cur=varValue;}catch(e){}}}}var i=0;while(i<dm.dimensions.length){var dim=dm.dimensions[i];var hidden=false;if(dim.archived){hidden=true;}else{if(typeof(getComboAttribute)=="function"){var comboDisplay=getComboAttribute(dim.id,"display","default");if(comboDisplay=="default"){hidden=(dmSel.dimensionsToExcludeForDisplay[dim.id])?true:false;}else{hidden=(comboDisplay=="true")?false:true;}}else{hidden=(dmSel.dimensionsToExcludeForDisplay[dim.id])?true:false;}}if(ddCtrl.urlParams&&ddCtrl.urlParams.forceShowCombos=="true"){hidden=false;}var panel=dimPanelList[dim.id+dim.continuous];if(panel==null){var dimEx=null;for(var j=0;j<dmSel.dimsToExplore.length;j++){if(dmSel.dimsToExplore[j].dim.id==dim.id){dimEx=dmSel.dimsToExplore[j];
break;}}panel=new DimSelPanel(container,dim.id,dim.name,dim.id+dim.continuous);createDimSelPanelUI(container,panel);if(dim.displayRootLevel==false){var filter=dmSel.getFilterByDimension(dim);if(filter==null){panel.hideRoot=true;}else{if(filter.hierarchy!=-1){panel.hideRoot=true;}}}panel.setCurPage(pageId);panel.addDim(dm,dim,pageId,hidden,false,frameId);dimPanelList[dim.id+dim.continuous]=panel;panel.cubeList=new Array();panel.cubeList.push(dm.cubeId);panel.mapCube=new Array();panel.mapCube[dm.cubeId]=dm;panel.cubeId=dm.cubeId;panel.updaterFunc=updater;if(ddCtrl.ddHistory){panel.addChangeListener(ddCtrl.ddHistory);}panelOrderedKey.push(dim.id+dim.continuous);}else{if(panel.cubeList&&panel.mapCube[dm.cubeId]==null){panel.mapCube[dm.cubeId]=dm;panel.cubeList.push(dm.cubeId);}panel.addDim(dm,dim,pageId,hidden,false,frameId);}var chartHandle=charts[frameId];if(chartHandle!=null){if(typeof(panel.hiddenByPageId[frameId])=="undefined"||panel.hiddenByPageId[frameId]){panel.hiddenByPageId[frameId]=hidden;
}}var comboHasChanged=false;var filterFromURL=null;if(ddCtrl.urlParams){if(typeof(ddCtrl.urlParams[dim.id])!="undefined"&&ddCtrl.urlParams[dim.id]!=null){filterFromURL=new FilterOperand(dim.id,(ddCtrl.urlParams[dim.id]+"").split(","),ddCtrl.urlParams["H"+dim.id],ddCtrl.urlParams["L"+dim.id]);}else{if(typeof(ddCtrl.urlParams[dim.name])!="undefined"&&ddCtrl.urlParams[dim.name]!=null){filterFromURL=new FilterOperand(dim.id,(ddCtrl.urlParams[dim.name]+"").split(","),ddCtrl.urlParams["H"+dim.name],ddCtrl.urlParams["L"+dim.name]);}else{if(typeof(ddCtrl.urlParams[dim.id+"_min"])!="undefined"&&ddCtrl.urlParams[dim.id+"_min"]!=null&&typeof(ddCtrl.urlParams[dim.id+"_max"])!="undefined"&&ddCtrl.urlParams[dim.id+"_max"]!=null){var min=parseInt(ddCtrl.urlParams[dim.id+"_min"]);var max=parseInt(ddCtrl.urlParams[dim.id+"_max"]);filterFromURL=new FilterOperandContinuous(dim.id,min,max);}else{if(typeof(ddCtrl.urlParams[dim.name+"_min"])!="undefined"&&ddCtrl.urlParams[dim.name+"_min"]!=null&&typeof(ddCtrl.urlParams[dim.name+"_max"])!="undefined"&&ddCtrl.urlParams[dim.name+"_max"]!=null){var min=parseInt(ddCtrl.urlParams[dim.name+"_min"]);
var max=parseInt(ddCtrl.urlParams[dim.name+"_max"]);filterFromURL=new FilterOperandContinuous(dim.id,min,max);}}}}}if(filterFromURL!=null){panel.initCombo();if(filterFromURL.min!=null&&typeof(filterFromURL.min)!="undefined"&&!isNaN(filterFromURL.min)&&filterFromURL.max!=null&&typeof(filterFromURL.max)!="undefined"&&!isNaN(filterFromURL.max)){panel.setRange(filterFromURL.min,filterFromURL.max,dim.format,true);}else{panel.selectMembers(filterFromURL.h,filterFromURL.l,filterFromURL.member,null,false,false);}comboHasChanged=true;}else{var filter=cloneFilter(dmSel.getFilterByDimension(dim));if(filter&&!dmSel.dimensionsToExcludeForNavigation[dim.id]&&(!panel.filter||CONCURRENT_FILTER_MODE!=2)){addFilterIndicator(panel);panel.initCombo();panel.initPanel(filter,dmSel);comboHasChanged=true;}else{if(dmSel.dimensionsToExcludeForNavigation[dim.id]){panel.initCombo();comboHasChanged=false;}else{comboHasChanged=panel.initCombo(dimEx);}}}if(comboHasChanged){dimSelChanged[panel.id]=panel;}++i;}if(typeof(registerDataModel)=="function"){registerDataModel(dm,dmSel,flowName,flowId,pageId);
}var chartHandle=charts[frameId];if(chartHandle&&chartHandle.callChangeHandler){if(commitFilters){commitFilters();}if(initSlicers){initSlicers(ddCtrl.pageID);}}buildCombos();}function createDimSelPanelUI(parent,panel){var HTMLElementTitle=document.createElement("div");HTMLElementTitle.className="selHierTitleDiv";HTMLElementTitle.setAttribute("id","dim"+panel.domId);HTMLElementTitle.setAttribute("style","position:absolute;top:0px;left:0px");HTMLElementTitle.onclick=function(){panel.show();};if(!isTouchDevice()){HTMLElementTitle.onmouseover=function(){comboMouseOver(panel);};HTMLElementTitle.onmouseout=function(){comboMouseOut(panel);};}var tbl=document.createElement("table");tbl.cellSpacing=0;tbl.cellPadding=0;tbl.className="selHierTitle";tbl.style.background="url("+imgFolder+"16-gradientcombo.png)";var tbody=document.createElement("tbody");var tr=document.createElement("tr");var td=document.createElement("td");td.className="selHierTitleTD";td.title=panel.name;var span=document.createElement("span");
span.id="dimName"+panel.domId;span.className="selHierTitleSpan";span.title=panel.name;var txt=document.createTextNode(panel.name);span.appendChild(txt);td.appendChild(span);tr.appendChild(td);td=document.createElement("td");td.setAttribute("id","dimImg"+panel.domId);td.className="selHierUnfoldImg";tr.appendChild(td);tbody.appendChild(tr);tbl.appendChild(tbody);HTMLElementTitle.appendChild(tbl);if(parent){parent.appendChild(HTMLElementTitle);}}function comboMouseOver(panel){changeStyle(panel,"selHierTitleSpanWhite");highlightCharts(panel);}function comboMouseOut(panel){changeStyle(panel,"selHierTitleSpan");unHighlightCharts(panel);}function changeStyle(panel,styleName){var divButton=document.getElementById("dim"+panel.domId);if(divButton){if(divButton.className.indexOf("selHierTitleDivWhite")>1){var d=document.getElementById("dimSel"+panel.domId);if(d==null||d.style.display=="none"){divButton.className="selHierTitleDiv";}}else{divButton.className=divButton.className+" "+divButton.className+"White";
}}var span=document.getElementById("dimName"+panel.domId);if(span){span.className=styleName;}}function highlightCharts(panel){for(var iDM=0;iDM<dmSelList.length;iDM++){var curDMSel=dmSelList[iDM];var curDM=dmList[iDM];var dim=curDM.getDimensionById(panel.id);if(dim!=null&&!curDMSel.dimensionsToExcludeForNavigation[dim.id]){var doc=svgdocList[iDM];var frameId=doc.frameId;if(frameId){var portletId=frameId.substr(6,frameId.length);var portlet=document.getElementById(portletId);if(portlet){var styleName=portlet.className;if(isIE6()||isIE7()||isIE8()){styleName=styleName+" highlightOldBrowsers";}else{styleName=styleName+" highlight";}portlet.className=styleName;}}}}}function unHighlightCharts(panel){for(var iDM=0;iDM<dmSelList.length;iDM++){var curDMSel=dmSelList[iDM];var curDM=dmList[iDM];var dim=curDM.getDimensionById(panel.id);if(dim!=null){var doc=svgdocList[iDM];var frameId=doc.frameId;if(frameId){var portletId=frameId.substr(6,frameId.length);var portlet=document.getElementById(portletId);
if(portlet){var stylesName=portlet.className.split(/\s+/);var newStylesName=new Array();for(var i=0;i<stylesName.length;i++){var name=stylesName[i];if(name!=""&&!name.match("highlight")){newStylesName.push(name);}}portlet.className=newStylesName.join(" ");}}}}}function hideDimSelPanelUI(panel){var HTMLElementTitle=document.getElementById("dim"+panel.domId);HTMLElementTitle.style.display="none";panel.hide();}function setPosToDimSelPanelUI(panel,x,y){var HTMLElementTitle=document.getElementById("dim"+panel.domId);setStyle(HTMLElementTitle,"position:absolute;top:"+y+"px;left:"+x+"px");panel.setPos(x,y);}function addFilterIndicator(panel){var span=document.getElementById("dimName"+panel.domId);if(span){span.parentNode.className="selHierTitleTDSelected";}}function removeFilterIndicator(panel){var span=document.getElementById("dimName"+panel.domId);if(span){span.parentNode.className="selHierTitleTD";}}function buildCombos(){var interactDiv=document.getElementById(INTERACT_BAR);if(interactDiv==null){return;
}var nbCombos=0;var width;if(window.innerWidth){width=window.innerWidth;}else{width=document.body.clientWidth;}width-=INTERACT_BAR_LEFT;width-=20;var nbCombosByLine=width/(comboWidth+COMBO_SPACE);if(nbCombosByLine==0){nbCombosByLine=1;}var interactBarOffsetTop=getOffsetTop();if(typeof(sortCombos)=="function"){panelOrderedKey.sort(sortCombos);}else{panelOrderedKey.sort();}var nbLines=1;var panI=0;var iter=0;var pos=0;var dimsVisible=getDimensionsVisible();while(panI<panelOrderedKey.length){var panel=dimPanelList[panelOrderedKey[panI]];if(dimsVisible[panel.id]){panel.hidden=false;nbCombos++;nbCombosByLine=Math.floor(nbCombosByLine);if(iter>=nbCombosByLine){nbLines++;iter=0;}var y=interactBarOffsetTop+((nbLines-1)*INTERACT_BAR_HEIGHT)+INTERACT_BAR_TOP;var x=INTERACT_BAR_LEFT+iter*(comboWidth+COMBO_SPACE);setPosToDimSelPanelUI(panel,x,y);iter++;}else{panel.hidden=true;hideDimSelPanelUI(panel);}++panI;}var height;var sizeChanged=false;if(nbCombos>(nbCombosByLine*nbLines)){nbLines++;height=INTERACT_BAR_TOP+INTERACT_BAR_HEIGHT*nbLines;
}else{if(nbCombos>0){if(nbCombosByLine>nbCombos){height=INTERACT_BAR_TOP+INTERACT_BAR_HEIGHT;}else{var pos=nbCombos/Math.round(nbCombosByLine);pos=Math.ceil(pos);height=INTERACT_BAR_TOP+pos*INTERACT_BAR_HEIGHT;}}else{height=0;}}interactDiv.style.height=height+"px";drawCollapseIcon();if(ddCtrl.isNewDashboard){hideAllDimSelPanels();ddCtrl.resizeComboPanel(height);}else{if(ddCtrl.isDashboard){if(typeof(resizeDashboard)=="function"){resizeDashboard();}}}}function getOffsetTop(){if(ddCtrl.isNewDashboard){var bannerElt=document.getElementById("banner");if(bannerElt){return banner.offsetHeight;}}else{var interactDiv=document.getElementById(INTERACT_BAR);if(interactDiv){return interactDiv.offsetTop;}}return 0;}function drawCollapseIcon(){var interactDiv=document.getElementById(INTERACT_BAR);var collapseIcon=document.getElementById("collapseIcon");if(!collapseIcon){collapseIcon=document.createElement("div");collapseIcon.id="collapseIcon";collapseIcon.title=Properties[getLocale()]["CollapseFiltersBox"];
collapseIcon.onclick=function(){var bAllHidden=true;for(var panelId in ddCtrl.dimPanelList){var dimPanel=ddCtrl.dimPanelList[panelId];if(!dimPanel.hidden){if(!dimPanel.panelUI.isHidden()){bAllHidden=false;break;}}}if(bAllHidden){showAllDimSelPanels();}else{hideAllDimSelPanels();}};interactDiv.appendChild(collapseIcon);}var top=getOffsetTop()+INTERACT_BAR_TOP;var width;if(window.innerWidth){width=window.innerWidth;}else{width=document.body.clientWidth;}var left=width-20;setStyle(collapseIcon,"position: absolute; top: "+top+"px; left: "+left+"px;");}function hideAllDimSelPanels(){for(var dimPanelId in ddCtrl.dimPanelList){var dimPanel=ddCtrl.dimPanelList[dimPanelId];if(!dimPanel.hidden){dimPanel.hide();}}}function showAllDimSelPanels(){for(var dimPanelId in ddCtrl.dimPanelList){var dimPanel=ddCtrl.dimPanelList[dimPanelId];if(!dimPanel.hidden){dimPanel.show();}}}comboListener=new Array();var comboPage=40;function comboChangeHandler(obj){var execArray=comboListener[obj.id];doChangeHandler(execArray,obj.id);
}function doChangeHandler(execArray,id){if(execArray!=null){var i=0;while(i<execArray.length){execArray[i].onChange(id);++i;}}}Combo=function(parent,gclass,id,funcname){if(arguments.length==0){return;}var obj=this;this.loadMore=false;this.maxDisp=comboPage;this.curDisp=0;this.id=id;this.curPos=1;this.members=new Array();this.membersVal=new Array();this.membersDisplay=new Array();this.HTMLElement=document.createElement("select");if(isIE()){this.HTMLElement.style.setAttribute("cssText","width:100%");}this.HTMLElement.setAttribute("id",id);this.HTMLElement.className=gclass;this.HTMLElement.onchange=function(){obj.callChange();};this.currentSelection=null;this.multiSelect=true;parent.appendChild(this.HTMLElement);this.parent=parent;};Combo.prototype.getClass=function(){return"Combo";};Combo.prototype.getParent=function(){return this.parent;};Combo.prototype.addChangeListener=function(obj){var array=comboListener[this.id];if(array==null){array=new Array();comboListener[this.id]=array;}array.push(obj);
};Combo.prototype.removeChangeListeners=function(){comboListener[this.id]=new Array();};Combo.prototype.callChange=function(){doChangeHandler(comboListener[this.id],this.id);};Combo.prototype.hasMember=function(name){return this.members[name];};Combo.prototype.setMultiSize=function(size){this.HTMLElement.setAttribute("multiple","true");this.HTMLElement.setAttribute("size",size);this.multiSelect=true;};Combo.prototype.setMultiSelect=function(bMulti){if(!bMulti){this.HTMLElement.removeAttribute("multiple");}else{this.HTMLElement.setAttribute("multiple","true");}this.multiSelect=bMulti;};Combo.prototype.setEnabled=function(bEnabled){if(bEnabled){this.HTMLElement.style.display="block";}else{this.HTMLElement.style.display="none";}};Combo.prototype.removeAllElements=function(){this.loadMore=false;this.maxDisp=comboPage;this.curDisp=0;this.curPos=1;this.members=new Array();this.membersVal=new Array();this.membersDisplay=new Array();while(this.HTMLElement.childNodes.length>=1){this.HTMLElement.removeChild(this.HTMLElement.firstChild);
}};Combo.prototype.removeLastElement=function(){var index=this.HTMLElement.childNodes.length-1;var lastChild=this.HTMLElement.childNodes[index];this.HTMLElement.removeChild(lastChild);};Combo.prototype.addElements=function(elemArray,format){var i=0;this.format=format;if(this.membersVal.length<=1){while(i<elemArray.length){if((this.membersVal.length==0)||(elemArray[i]!="All")){if(!this.members[elemArray[i]]){this.members[elemArray[i]]=this.curPos;this.membersVal.push(elemArray[i]);var caption=elemArray[i];if(format){caption=formatNum(elemArray[i],format);}this.membersDisplay.push(caption);++this.curPos;}}++i;}this.displayReq();}else{while(i<elemArray.length){this.addElementFormat(elemArray[i],false);++i;}}};Combo.prototype.addElementFormat=function(value,selected){if(this.hasMember(value)){return;}this.members[value]=this.curPos;this.membersVal.push(value);var valF=formatNum(value,this.format);this.membersDisplay.push(valF);++this.curPos;if(this.curDisp<this.maxDisp){++this.curDisp;this._addElement(valF,selected);
}else{if(!this.loadMore){this.loadMore=true;this._addElement(Properties[getLocale()]["LoadMore"],false);}}};Combo.prototype.addElement=function(value,formatedVal,selected){if(this.hasMember(value)){return;}this.members[value]=this.curPos;this.membersVal.push(value);this.membersDisplay.push(formatedVal);++this.curPos;if(this.curDisp<this.maxDisp){++this.curDisp;this._addElement(formatedVal,selected);}else{if(!this.loadMore){this.loadMore=true;this._addElement(Properties[getLocale()]["LoadMore"],false);}}};Combo.prototype._addElement=function(name,selected){var option=document.createElement("option");option.setAttribute("value",name);if(selected){option.setAttribute("selected","true");}var txt=document.createTextNode(name);option.appendChild(txt);this.HTMLElement.appendChild(option);};Combo.prototype.displayMore=function(){this.removeLastElement();this.maxDisp+=comboPage;this.displayReq();};Combo.prototype.displayReq=function(){var mSize=Math.min(this.maxDisp,this.membersVal.length);while(this.curDisp<mSize){var sel=false;
var valF=this.membersDisplay[this.curDisp]?this.membersDisplay[this.curDisp]:this.membersVal[this.curDisp];this._addElement(valF,sel);this.curDisp++;}if(this.maxDisp<this.membersVal.length){this.loadMore=true;this._addElement(Properties[getLocale()]["LoadMore"],false);}else{this.loadMore=false;}};Combo.prototype.isLoading=function(){if(this.HTMLElement.options[this.maxDisp]&&this.HTMLElement.options[this.maxDisp].selected){return true;}return false;};Combo.prototype.selectMember=function(id,dispatch){var m=this.members[id];if(m){while(!this.HTMLElement.options[m-1]||this.HTMLElement.options[m-1].value==(Properties[getLocale()]["LoadMore"])){this.displayMore();}this.setSelectedIndex(m-1,dispatch);}else{if(id=="All"){this.setSelectedIndex(-1,dispatch);}else{var val=null;for(value in this.membersDisplay){if(this.membersDisplay[value]==id){val=value;}}if(val!=null){var idx=val;this.setSelectedIndex(idx,dispatch);}else{this.addElementFormat(id,false);this.selectMember(id,dispatch);}}}};Combo.prototype.addMember=function(member,memberFormated,dispatch){var m=this.members[member];
if(m){while(!this.HTMLElement.options[m-1]){this.displayMore();}if(this.HTMLElement.selectedIndex<=0){this.HTMLElement.selectedIndex=m-1;}this.HTMLElement.options[m-1].selected=true;if(dispatch){this.callChange();}}};Combo.prototype.addMembers=function(members,dispatch){for(var i=0;i<members.length;i++){var mbr=members[i];var m=this.members[mbr];if(m){while(!this.HTMLElement.options[m-1]){this.displayMore();}if(this.HTMLElement.selectedIndex<=0){this.HTMLElement.selectedIndex=m-1;}this.HTMLElement.options[m-1].selected=true;}}if(dispatch){this.callChange();}};Combo.prototype.selectMembers=function(arrId,dispatch){var iM=0;var bFirst=true;while(iM<arrId.length){var m=this.members[arrId[iM]];if(m){while(!this.HTMLElement.options[m-1]||this.HTMLElement.options[m-1].value==(Properties[getLocale()]["LoadMore"])){this.displayMore();}if(bFirst){if(isIE6()){for(var i=0;i<this.HTMLElement.options.length;i++){var elt=this.HTMLElement.options[i];if((m-1!=i)&&elt.selected){elt.selected=false;}}var elt=this.HTMLElement.options[m-1];
elt.setAttribute("selected",true);}else{this.HTMLElement.selectedIndex=m-1;}bFirst=false;}else{this.HTMLElement.options[m-1].selected=true;}}else{var idx=null;for(value in this.membersDisplay){if(this.membersDisplay[value]==arrId[iM]){idx=value;}}if(idx!=null){if(bFirst){this.HTMLElement.selectedIndex=idx;bFirst=false;}this.HTMLElement.options[idx].selected=true;}else{this.addElementFormat(arrId[iM],true);if(bFirst){this.HTMLElement.selectedIndex=this.HTMLElement.options.length-1;bFirst=false;}}}++iM;}if(dispatch){this.callChange();}};Combo.prototype.setSelectedIndex=function(idx,dispatch){if(isIE6()){for(var i=0;i<this.HTMLElement.options.length;i++){var elt=this.HTMLElement.options[i];if((idx!=i)&&elt.selected){elt.selected=false;}}var elt=this.HTMLElement.options[idx];elt.setAttribute("selected",true);}else{this.HTMLElement.selectedIndex=idx;}if(dispatch){this.callChange();}};Combo.prototype.getSelectedIndex=function(){return this.HTMLElement.selectedIndex;};Combo.prototype.setSelectedIndexes=function(arIdx,shift){this.HTMLElement.selectedIndex=-1;
var rshift=0;if(shift!=null){rshift=shift;}for(var i=0;i<arIdx.length;i++){while((arIdx[i]+rshift)>(this.HTMLElement.options.length-1)||this.HTMLElement.options[arIdx[i]+rshift].value==(Properties[getLocale()]["LoadMore"])){this.displayMore();}this.HTMLElement.options[arIdx[i]+rshift].selected=true;}};Combo.prototype.getSelectedElements=function(){var selected=new Array();for(var i=0;i<this.HTMLElement.options.length;i++){if(this.HTMLElement.options[i].selected){selected.push(this.membersVal[i]);}}return selected;};Combo.prototype.getSelectedFormatedElements=function(){var selected=new Array();for(var i=0;i<this.HTMLElement.options.length;i++){if(this.HTMLElement.options[i].selected){selected.push(this.HTMLElement.options[i].value);}}return selected;};Combo.prototype.unselectElement=function(member){var pos=this.members[member];var index=pos-1;var elt=this.HTMLElement.options[index];this.HTMLElement.options[index].selected=false;this.callChange();};Combo.prototype.unselectAllElements=function(dispatch){for(var i=0;
i<this.HTMLElement.options.length;i++){this.HTMLElement.options[i].selected=false;}if(dispatch){this.callChange();}};comboListener=new Array();function comboChangeHandler2(obj){var execArray=comboListener[obj.id];doChangeHandler2(execArray,obj.id);}function doChangeHandler2(execArray,id){if(execArray!=null){var i=0;while(i<execArray.length){execArray[i].onChange(id);++i;}}}SearchComboUI=function(parent,id){var search=document.createElement("input");search.input="text";search.setAttribute("id","s"+id);search.className="s";search.autocomplete="off";search.value="";search.size="9";search.setAttribute("style","cursor: auto;");parent.appendChild(search);var elem=document.createElement("div");elem.setAttribute("id","selector"+id);elem.className="res";elem.setAttribute("style","cursor: auto;");parent.appendChild(elem);var sel=document.createElement("div");sel.setAttribute("id","selected"+id);sel.className="selSearch";parent.appendChild(sel);this.id=id;this.curPos=1;this.members=new Array();this.membersVal=new Array();
this.membersCaptions=new Array();this.membersDisplay=new Array();this.searchCombo=new SearchCombo(search.id,elem.id,sel.id);this.multiSelect=true;var obj=this;this.searchCombo.addSelectionListener(function(){comboChangeHandler2(obj);});this.parent=parent;};SearchComboUI.prototype.getClass=function(){return"SearchComboUI";};SearchComboUI.prototype.getParent=function(){return this.parent;};SearchComboUI.prototype.callChange=function(){doChangeHandler2(comboListener[this.id],this.id);};SearchComboUI.prototype.hasMember=function(name){return this.members[name];};SearchComboUI.prototype.setMultiSelect=function(bMulti){this.multiSelect=bMulti;this.searchCombo.multiSelect=this.multiSelect;};SearchComboUI.prototype.addElement=function(value,formatedVal,selected){if(this.hasMember(value)||typeof(value)=="undefined"){return;}this.members[value]=this.curPos;this.membersVal.push(value);if(value!="All"){if(value!=null){value+="";}if(formatedVal!=null){formatedVal+="";}var mbrObj=new SearchComboValName(value,formatedVal,this.curPos);
this.searchCombo.add(formatedVal,mbrObj);this.membersCaptions[value]=formatedVal;this.membersDisplay.push(formatedVal);if(selected){this.searchCombo.addSelected(mbrObj);}}this.curPos++;};SearchComboUI.prototype.addElementFormat=function(value,selected){if(this.hasMember(value)){return;}this.members[value]=this.curPos;this.membersVal.push(value);var valFormated=formatNum(value,this.format);if(value!="All"){value+="";valFormated+="";var mbrObj=new SearchComboValName(value,valFormated,this.curPos);this.searchCombo.add(valFormated,mbrObj);this.membersCaptions[value]=valFormated;this.membersDisplay.push(valFormated);if(selected){this.searchCombo.addSelected(mbrObj);}}this.curPos++;};SearchComboUI.prototype.addElements=function(elemArray,format,captionsArray){this.format=format;var i=0;if(this.membersVal.length<=1){while(i<elemArray.length){if((this.membersVal.length==0)||(elemArray[i]!="All")){this.members[elemArray[i]]=this.curPos;this.membersVal.push(elemArray[i]);var val=elemArray[i];var caption=elemArray[i];
if(captionsArray&&captionsArray.length>i){caption=captionsArray[i];this.membersCaptions[elemArray[i]]=caption;}else{if(format){caption=formatNum(elemArray[i],format);this.membersCaptions[elemArray[i]]=caption;val=val+"";}}this.membersDisplay.push(caption);this.searchCombo.add(caption,new SearchComboValName(val,caption,this.curPos));this.curPos++;}++i;}}if(this.searchCombo&&this.searchCombo.search){var iMbr=0;var mbr="";while(iMbr<this.membersVal.length&&(mbr==""||mbr=="All")){mbr=this.membersVal[iMbr];iMbr++;}if(typeof(mbr)=="string"){this.searchCombo.search.value=mbr.charAt(0);this.searchCombo.initAnalyzeTxt();}}};SearchComboUI.prototype.selectMember=function(id,dispatch,memberFormated){this.searchCombo.delSel();if(id!="All"){var m=this.members[id];if(m){var valueF=id;if(this.format){valueF=formatNum(id,this.format);}else{if(this.membersCaptions[id]){valueF=this.membersCaptions[id];}else{if(memberFormated){valueF=memberFormated;this.membersCaptions[id]=memberFormated;}}}this.searchCombo.addSelected(new SearchComboValName(id,valueF,m));
}else{var val=id;if(this.format){val=formatNum(val,this.format);}else{var bFind=false;for(value in this.membersCaptions){if(this.membersCaptions[value]==id){val=value;bFind=true;}}if(!bFind&&memberFormated){val=memberFormated;this.membersCaptions[id]=memberFormated;}}this.searchCombo.addSelected(new SearchComboValName(id,val,0));}}if(dispatch){this.callChange();}};SearchComboUI.prototype.selectMembers=function(arrId,dispatch,membersFormated){if(arrId!=null&&arrId.length==1&&arrId[0]=="All"){this.searchCombo.delAll();}else{this.searchCombo.delSel();var objList=new Array();var iM=0;while(iM<arrId.length){var m=this.members[arrId[iM]];if(m){var valueF=arrId[iM];if(this.format){valueF=formatNum(valueF,this.format);}else{if(this.membersCaptions[arrId[iM]]){valueF=this.membersCaptions[arrId[iM]];}else{if(membersFormated){valueF=membersFormated[iM];this.membersCaptions[arrId[iM]]=membersFormated[iM];}}}objList.push(new SearchComboValName(arrId[iM],valueF,m));}else{var val=arrId[iM];if(this.format){val=formatNum(val,this.format);
}else{var bFind=false;for(var value in this.membersCaptions){if(this.membersCaptions[value]==arrId[iM]){val=value;bFind=true;}}if(!bFind&&membersFormated){val=membersFormated[iM];this.membersCaptions[arrId[iM]]=membersFormated[iM];}}objList.push(new SearchComboValName(arrId[iM],val,iM));}iM++;}this.searchCombo.addSelectedList(objList);if(dispatch){this.callChange();}}};SearchComboUI.prototype.addMember=function(member,memberFormated,dispatch){var m=this.members[member];var valueF=member;if(m){if(this.format){valueF=formatNum(valueF,this.format);}else{if(this.membersCaptions[member]){valueF=this.membersCaptions[member];}else{if(memberFormated){valueF=memberFormated;this.membersCaptions[member]=memberFormated;}}}this.searchCombo.addSelected(new SearchComboValName(member,valueF,m));}else{if(this.format){valueF=formatNum(valueF,this.format);}else{var bFind=false;for(var value in this.membersCaptions){if(this.membersCaptions[value]==member){valueF=value;bFind=true;}}if(!bFind&&memberFormated){this.membersCaptions[member]=memberFormated;
valueF=memberFormated;}}this.searchCombo.addSelected(new SearchComboValName(member,valueF,0));}if(dispatch){this.callChange();}};SearchComboUI.prototype.addMembers=function(members,membersFormated,dispatch){for(var i=0;i<members.length;i++){var mbr=members[i];var mbrFormated=null;if(membersFormated){mbrFormated=membersFormated[i];}var m=this.members[mbr];var valueF=mbr;if(m){if(this.format){valueF=formatNum(valueF,this.format);}else{if(this.membersCaptions[mbr]){valueF=this.membersCaptions[mbr];}else{if(memberFormated){valueF=mbrFormated;this.membersCaptions[mbr]=mbrFormated;}}}this.searchCombo.addSelected(new SearchComboValName(mbr,valueF,m));}else{if(this.format){valueF=formatNum(valueF,this.format);}else{var bFind=false;for(var value in this.membersCaptions){if(this.membersCaptions[value]==mbr){valueF=value;bFind=true;}}if(!bFind&&memberFormated){this.membersCaptions[mbr]=mbrFormated;valueF=mbrFormated;}}this.searchCombo.addSelected(new SearchComboValName(mbr,valueF,0));}}if(dispatch){this.callChange();
}};SearchComboUI.prototype.setSelectedIndex=function(idx,dispatch){if(idx==0){this.curPos=1;this.searchCombo.delSel();this.searchCombo.clearTST();}else{}if(dispatch){this.callChange();}};SearchComboUI.prototype.getSelectedIndex=function(){var index=-1;if(this.searchCombo&&this.searchCombo.selected.length>0){index=this.searchCombo.selected[0].pos+1;}return index;};SearchComboUI.prototype.setSelectedIndexes=function(arIdx,shift){this.searchCombo.delSel();var objList=new Array();for(var i=0;i<arIdx.length;i++){var idx=arIdx[i]+shift;var name=this.membersVal[idx];var caption=name;if(this.format){caption=formatNum(name,this.format);}else{if(this.membersCaptions[name]){caption=this.membersCaptions[name];}}objList.push(new SearchComboValName(name,caption,idx));}this.searchCombo.addSelectedList(objList);};SearchComboUI.prototype.getSelectedElements=function(shift){var selected=new Array();var sel=this.searchCombo.selected;for(var i=0;i<sel.length;i++){selected.push(sel[i].id);}if(selected.length==0){selected[0]="All";
}return selected;};SearchComboUI.prototype.getSelectedFormatedElements=function(){var selected=new Array();var sel=this.searchCombo.selected;for(var i=0;i<sel.length;i++){var mbr=sel[i].txt;if(this.membersCaptions[mbr]){mbr=this.membersCaptions[mbr];}selected.push(mbr);}if(selected.length==0){selected[0]=Properties[getLocale()]["All"];}return selected;};SearchComboUI.prototype.unselectElement=function(member){var name=member;if(this.format){name=formatNum(member,this.format);}else{if(this.membersCaptions&&this.membersCaptions[name]){name=this.membersCaptions[name];}}this.searchCombo.remove(name);};SearchComboUI.prototype.unselectAllElements=function(dispatch){this.searchCombo.removeAll();if(dispatch){this.callChange();}};SearchComboUI.prototype.removeAllElements=function(){this.curPos=1;this.members=new Array();this.membersCaptions=new Array();this.membersVal=new Array();this.membersDisplay=new Array();this.searchCombo.delSel();this.searchCombo.clearTST();this.searchCombo.clearResult();
this.searchCombo.previewResMembers=new Array();};SearchComboUI.prototype.isLoading=function(){return false;};SearchComboUI.prototype.addChangeListener=function(obj){var array=comboListener[this.id];if(array==null){array=new Array();comboListener[this.id]=array;}array.push(obj);};SearchComboUI.prototype.removeChangeListeners=function(){comboListener[this.id]=new Array();};var SEARCH_STEP=300;var touchScroll;function SBkeyPress(htmlObj,e){var refObj=htmlObj.refObj;refObj.itKP(e);}function SBkeyUp(htmlObj,e){var refObj=htmlObj.refObj;refObj.isCtrlKey=false;}function SBitPos(htmlObj){var pos=htmlObj.pos;var rObj=htmlObj.refObj;rObj.hiLi(htmlObj);rObj.cPos=pos;}function SBselect(htmlObj){var pos=htmlObj.pos;var rObj=htmlObj.refObj;rObj.selectPos(pos);}function SearchBox(sid,resid){if(sid){this.lcl=getLocale();this.search=document.getElementById(sid);if(this.search){this.search.refObj=this;this.search.onkeydown=function(e){SBkeyPress(this,e);};this.search.onkeyup=function(e){SBkeyUp(this,e);};
}}if(resid){this.elem=document.getElementById(resid);if(this.elem){this.elem.refObj=this;}}this.extraothers="";this.lval="";this.lastSel=null;this.cPos=0;this.maxDisp=ddCtrl.LIMIT_RESULT_SEARCHBOX;this.result=null;this.tst=new TernarySearchTree();this.tmp=new TSTMatchPrefix(this.tst);this.tma=new TSTMatchAlmostPrefix(this.tst);this.useInstantSearch();this.listeners=[];this.analyzerH=null;this.multiSelect=true;this.isCtrlKey=false;this.touchMode=false;this.nullValue=undefined;this.nbPreviewRes=ddCtrl.LIMIT_RESULT_SEARCHBOX;this.previewResMembers=[];if(typeof(isTouchDevice)=="function"){this.touchMode=isTouchDevice();}this.resultListener=null;}SearchBox.prototype.setSearchId=function(searchId){this.lcl=getLocale();this.search=document.getElementById(searchId);if(this.search){this.search.refObj=this;this.search.onkeydown=function(e){SBkeyPress(this,e);};this.search.onkeyup=function(e){SBkeyUp(this,e);};}};SearchBox.prototype.setSort=function(sortKey,sortType,sortReverse){this.sort=true;this.sortKey=sortKey;
this.sortType=sortType;this.sortReverse=sortReverse;};SearchBox.prototype.addSelectionListener=function(callback){this.listeners.push(callback);};SearchBox.prototype.setResultListener=function(callback){this.resultListener=callback;};SearchBox.prototype.useInstantSearch=function(){var sbObj=this;setTimeout(function(){sbObj.analyzeTxt();sbObj=null;},SEARCH_STEP);};SearchBox.prototype.isWordBreaker=function(cKey){if((cKey==" ")||(cKey=="-")||(cKey=="_")||(cKey=="'")||(cKey=="/")||(cKey=="(")||(cKey==")")||(cKey==",")||(cKey==";")||(cKey==".")||(cKey=="&")||(cKey=="|")||(cKey=="+")){return true;}return false;};SearchBox.prototype.isAndWordBreaker=function(cKey){if((cKey=="+")||(cKey=="/")||(cKey=="&")){return true;}return false;};SearchBox.prototype.add=function(key,val){if(this.displayAll&&this.curPos==0){this.addResult(new SearchComboValName("All",getLocMessage("All"),this.curPos));this.curPos++;}if(this.nullValue!==undefined&&val.id==this.nullValue){if(this.previewResMembers.length==0){var resObj=new SearchComboValName(this.nullValue,Properties[getLocale()]["EmptyMember"],0);
this.previewResMembers.push(resObj);this.addResult(resObj);this.curPos++;}return;}if(!this.analyzerH){this.addToTST(key,val);}if(!this.curGprs){this.curGprs={};}if(this.previewResMembers.length<this.nbPreviewRes){if(this.displayGrps&&typeof(val.grp)=="undefined"){val.pos=this.curPos;this.previewResMembers.push(val);this.addResult(val);this.curPos++;}else{this.previewResMembers.push(val);if(this.displayGrps&&typeof(val.grp)!="undefined"&&typeof(this.addResultGroup)=="function"){if(typeof(this.curGprs[val.grp])=="undefined"){this.addResultGroup(val.grp,val.grp);this.curGprs[val.grp]=true;this.curPos++;}}val.pos=this.curPos;this.addResult(val);this.curPos++;}}else{if(!this.hasMoreResultPreview){this.hasMoreResultPreview=true;this.addMoreResult();}}};SearchBox.prototype.addToTST=function(keyP,val){var key=keyP+"";var rkey=normalizeName(key);this.tst.put(rkey,val);var iC=0;var iF=0;while(iC<rkey.length){if(this.isWordBreaker(rkey.charAt(iC))){if(iC-iF>1){var str=rkey.substring(iF,iC);this.tst.put(str,val);
}iF=iC+1;}++iC;}if(iC-iF>1){var str=rkey.substring(iF,iC);if(iF!=0||iC!=str.length){this.tst.put(str,val);}}};SearchBox.prototype.removeAnalyzerHandler=function(){this.analyzerH=null;};SearchBox.prototype.setAnalyzerHandler=function(handler){this.analyzerH=handler;};SearchBox.prototype.analyzeTxt=function(){if(this.search&&(this.lval!=this.search.value)){this.analyzeText();}this.useInstantSearch();};SearchBox.prototype.initAnalyzeTxt=function(){if(this.search){this.analyzeText();}this.useInstantSearch();};SearchBox.prototype.drawResult=function(){var i=0;var nodes=this.elem.childNodes;while(i<nodes.length){this.elem.removeChild(nodes[i]);}var ul=document.createElement("ul");ul.className="sbox";this.elem.appendChild(ul);var nr=0;if(this.nullValue!==undefined){var resObj=new SearchComboValName(this.nullValue,Properties[getLocale()]["EmptyMember"],nr);this.addResult(resObj);nr++;}if(this.result&&(this.result.length>0)){var displayRes=new Array();var iRes=0;var numOther=0;for(iRes=0;iRes<this.result.length;
iRes++){if(nr>=this.maxDisp){break;}var resSet=this.result[iRes];var lRes=0;var displayResLength=0;for(lRes=0;lRes<resSet.length;lRes++){if(nr>=this.maxDisp){break;}var resObj=resSet[lRes];var txt=resObj.txt;var id=resObj.key;if(!displayRes[id]){resObj.pos=nr;this.addResult(resObj);displayRes[id]=true;displayResLength++;++nr;}}if(lRes<displayResLength){numOther+=resSet.length-lRes;}}while(iRes<this.result.length){for(var i=0;i<this.result[iRes].length;i++){var id=this.result[iRes][i].key;if(!displayRes[id]){displayRes[id]=true;numOther++;}}++iRes;}if(numOther>0){var div=document.createElement("div");div.className="elOther";div.innerHTML=this.extraothers+numOther+Properties[this.lcl]["Others"];this.elem.appendChild(div);}}if(this.hasMoreResult){this.addMoreResult();}if(nr==0){var li=document.createElement("li");li.innerHTML=Properties[this.lcl]["NoResult"];ul.appendChild(li);this.elem.appendChild(ul);}};SearchBox.prototype.drawResultPreview=function(){var i=0;var nodes=this.elem.childNodes;
while(i<nodes.length){this.elem.removeChild(nodes[i]);}var ul=document.createElement("ul");ul.className="sbox";this.elem.appendChild(ul);var nr=0;for(var i=0;i<this.previewResMembers.length;i++){var resObj=this.previewResMembers[i];resObj.pos=nr;this.addResult(resObj);nr++;}if(this.hasMoreResult){this.addMoreResult();}};SearchBox.prototype.addResult=function(resObj){if(this.elem){var ul=this.elem.firstChild;if(!ul){ul=document.createElement("ul");ul.className="sbox";this.elem.appendChild(ul);}var li=document.createElement("li");li.refObj=this;li.obj=resObj;li.pos=resObj.pos;li.innerHTML=resObj.txt;if(!isTouchDevice()){li.onmouseover=function(){SBitPos(this);};li.onclick=function(){SBselect(this);};}else{li.ontouchstart=function(e){touchScroll=true;};li.ontouchmove=function(e){touchScroll=false;};li.ontouchend=function(e){if(touchScroll){SBselect(this);}};}ul.appendChild(li);}};SearchBox.prototype.addMoreResult=function(){if(this.elem){var li=document.createElement("li");li.innerHTML="...";
this.elem.firstChild.appendChild(li);}};SearchBox.prototype.analyzeText=function(){this.cPos=-1;this.lastSel=null;this.lval=this.search.value;var val=this.search.value;if(typeof(this.default_text)!="undefined"&&val==this.default_text){val="";}if(val.length>0){if(this.analyzerH){this.analyzerH.analyze(this);}else{var cval=normalizeName(this.search.value);this.result=this.searchMbr(cval,this.maxDisp);this.resultListener(this);}}else{if(this.elem){this.drawResultPreview();}else{this.result=null;this.resultListener(this);}}};SearchBox.prototype.analyzeText1=function(searchValue){this.cPos=-1;this.lastSel=null;this.lval=searchValue;if(searchValue.length>0){if(this.analyzerH){this.result=this.analyzerH.analyze(searchValue);}else{var cval=normalizeName(searchValue);this.result=this.searchMbr(cval,this.maxDisp);}}else{this.result=null;}return this.result;};SearchBox.prototype.addToScoreMap=function(hasMember,result,score){for(var r=0;r<result.length;r++){var mbrs=result[r];for(var i=0;i<mbrs.length;
i++){var mbr=mbrs[i];var memberScore=hasMember[mbr.key];if(memberScore==null){memberScore=new Object();memberScore.member=mbr;if(!score){memberScore.score=0;}else{memberScore.score=score;}hasMember[mbr.key]=memberScore;}memberScore.score++;}}};SearchBox.prototype.andScoreMap=function(initMember,andMember){for(var t in initMember){if(!andMember[t]){delete initMember[t];}}};SearchBox.prototype.mergeScoreMap=function(initMember,addMember){for(var t in addMember){if(initMember[t]){initMember[t].score+=addMember[t].score;}else{initMember[t]=addMember[t];}}};SearchBox.prototype.getNextWordBreakerPos=function(str,pos){while(pos<str.length){if(this.isWordBreaker(str.charAt(pos))){return pos;}++pos;}return -1;};SearchBox.prototype.searchMbr=function(str,limit){var hasMember={};var bIgnoreWordBreakers=false;if(typeof(str)!=undefined&&str!=""){if(str.length>1){bIgnoreWordBreakers=(str[0]=='"')&&(str[str.length-1]=='"');}if(bIgnoreWordBreakers){var exactSearchStr=str.substring(1,str.length-1);str=exactSearchStr;
}}var result=this.tmp.find(str);this.addToScoreMap(hasMember,result,10);if(!bIgnoreWordBreakers){var curStart=0;var curPos=0;while(curPos>=0){curPos=this.getNextWordBreakerPos(str,curStart);if(curPos<0){curPos=str.length;}if(curStart<curPos){var tmpMbr={};var strPart=str.substring(curStart,curPos);result=this.tmp.find(strPart);this.addToScoreMap(tmpMbr,result);curStart=curPos+1;while(curPos<str.length&&this.isAndWordBreaker(str.charAt(curPos))){curPos=this.getNextWordBreakerPos(str,curStart);if(curPos<0){curPos=str.length;}if(curStart<curPos){strPart=str.substring(curStart,curPos);result=this.tmp.find(strPart);var andMbr={};this.addToScoreMap(andMbr,result);this.andScoreMap(tmpMbr,andMbr);}curStart=curPos+1;if(curStart>str.length){break;}}this.mergeScoreMap(hasMember,tmpMbr);}else{curStart=curPos+1;}if(curStart>str.length){break;}}}var membersScores=[];for(var t in hasMember){membersScores.push(hasMember[t]);}membersScores.sort(function(a,b){return b.score-a.score;});var l=limit;if(membersScores.length<limit){l=membersScores.length;
this.hasMoreResult=false;}else{if(membersScores.length>limit){this.hasMoreResult=true;}}var repMembers=[];for(var i=0;i<l;i++){repMembers.push(membersScores[i].member);}this.result=[repMembers];this.sortResult();return this.result;};SearchBox.prototype.sortResult=function(){if(this.sort){if(this.sortKey=="id"){if(this.sortType==S_ALPHA){if(this.sortReverse){this.result[0].sort(function(a,b){if(a.id==b){return 0;}else{return a.id>b.id?-1:1;}});}else{this.result[0].sort(function(a,b){if(a.id==b.id){return 0;}else{return a.id>b.id?1:-1;}});}}else{if(this.sortType==S_NUMERIC){if(this.sortReverse){this.result[0].sort(function(a,b){return b.id-a.id;});}else{this.result[0].sort(function(a,b){return a.id-b.id;});}}}}else{if(this.sortKey=="txt"){if(this.sortType==S_ALPHA){if(this.sortReverse){this.result[0].sort(function(a,b){if(a.txt==b){return 0;}else{return a.txt>b.txt?-1:1;}});}else{this.result[0].sort(function(a,b){if(a.txt==b.txt){return 0;}else{return a.txt>b.txt?1:-1;}});}}else{if(this.sortType==S_NUMERIC){if(this.sortReverse){this.result[0].sort(function(a,b){return b.txt-a.txt;
});}else{this.result[0].sort(function(a,b){return a.txt-b.txt;});}}}}}}};SearchBox.prototype.clearResult=function(){this.result=null;this.cPos=-1;this.lastSel=null;if(this.elem){this.elem.innerHTML="";}};SearchBox.prototype.clearField=function(){this.result=null;this.cPos=-1;this.lastSel=null;if(this.elem){this.elem.innerHTML="";}if(this.search){this.search.value="";}};SearchBox.prototype.clearTST=function(){this.tst=new TernarySearchTree();this.tmp=new TSTMatchPrefix(this.tst);this.tma=new TSTMatchAlmostPrefix(this.tst);this.previewResMembers=[];this.curPos=0;};SearchBox.prototype.selectPrev=function(){if(this.cPos<=0){return;}this.cPos--;this.hiLiP(this.cPos);};SearchBox.prototype.selectNext=function(){if(this.cPos>=(this.maxDisp-1)){return;}this.cPos++;this.hiLiP(this.cPos);};SearchBox.prototype.replaceCurTxt=function(txt){this.search.value=txt;this.lval=txt;};SearchBox.prototype.getResult=function(pos){var iRes=0;var cpos=0;while(cpos<=pos){if(cpos+this.result[iRes].length<=pos){cpos+=this.result[iRes].length;
++iRes;}else{return this.result[iRes][pos-cpos];}}return this.result[0][0];};SearchBox.prototype.selectCurrent=function(){if(!isTouchDevice()){this.search.focus();}if(this.elem){var elems=this.elem.getElementsByTagName("li");var li=elems[this.cPos];if(li){var obj=li.obj;for(var i=0;i<this.listeners.length;++i){this.listeners[i](obj,this,false);}}}else{var obj=this.getResult(this.cPos);for(var i=0;i<this.listeners.length;++i){this.listeners[i](obj,this,false);}}};SearchBox.prototype.selectPos=function(pos){this.cPos=pos;this.selectCurrent();};function SBpDef(e){if(e.preventDefault){e.preventDefault();}else{e.returnValue=false;}}SearchBox.prototype.itKP=function(e){if(!e){var e=window.event;}var code=e.charCode?e.charCode:e.keyCode;if(!e.shiftKey&&!e.ctrlKey&&!e.altKey&&!e.metaKey){if(code==40){SBpDef(e);this.selectNext();}else{if(code==38){SBpDef(e);this.selectPrev();}else{if(code==13){SBpDef(e);this.selectCurrent();}}}}if(e.ctrlKey){this.isCtrlKey=true;}else{this.isCtrlKey=false;}};SearchBox.prototype.hiLiP=function(pos){if(this.elem){var elems=this.elem.getElementsByTagName("li");
if(elems[pos]){this.hiLi(elems[pos]);}}};SearchBox.prototype.hiLi=function(elem){if(this.lastSel){this.lastSel.className="";}elem.className="hi";this.lastSel=elem;};function SCmySel(obj,box,deleted){if(obj&&!deleted){if(!box.isCtrlKey&&!box.touchMode&&!box.multiSelect){box.selByName=[];box.selected=[];}box.addSelected(obj);}}function SCdelSel(htmlObj){var pos=htmlObj.pos;var rObj=htmlObj.refObj;rObj.removePos(pos);}function SCaddAll(e){var htmlObj=e.target;if(typeof htmlObj=="undefined"){htmlObj=e.srcElement;}var rObj=htmlObj.parentNode.parentNode.refObj;rObj.addAll();}function SCdelAll(htmlObj){var rObj=htmlObj.refObj;rObj.delAll();}function SCdrawRes(obj){obj.drawResult();}function SearchCombo(sid,resid,selid){SearchBox.call(this,sid,resid);this.selected=[];this.selByName=[];if(resid){this.sel=document.getElementById(selid);if(this.sel){this.sel.refObj=this;}}this.curPos=0;this.extraothers='<img src="'+imgFolder+'16-add.png" onclick="SCaddAll(event)" title="'+Properties[this.lcl]["AddAll"]+'"/>';
this.addSelectionListener(SCmySel);this.setResultListener(SCdrawRes);}SearchCombo.prototype=new SearchBox;SearchCombo.prototype.addSelectedPriv=function(obj){if((typeof this.selByName[obj.key]=="undefined")||(this.selByName[obj.key]==null)){this.selected.push(obj);this.selByName[obj.key]=true;}};SearchCombo.prototype.addSelected=function(obj){if(!this.multiSelect){this.selByName=[];this.selected=[];}this.addSelectedPriv(obj);this.drawSel();};SearchCombo.prototype.addSelectedList=function(objList){if(!this.multiSelect){this.selByName=[];this.selected=[];}for(var i=0;i<objList.length;i++){this.addSelectedPriv(objList[i]);}this.drawSel();};SearchCombo.prototype.removePos=function(pos){var obj=this.selected[pos];delete this.selByName[obj.key];this.selected.splice(pos,1);this.drawSel();for(var i=0;i<this.listeners.length;++i){this.listeners[i](obj,this,true);}};SearchCombo.prototype.remove=function(txt){var bFind=false;for(var i=0;i<this.selected.length;i++){if(this.selected[i].txt==txt){this.removePos(i);
break;}}if(!bFind){for(var i=0;i<this.selected.length;i++){if(this.selected[i].id==txt){this.removePos(i);break;}}}};SearchCombo.prototype.removeAll=function(){this.selected=new Array();this.selByName=new Array();this.drawSel();};SearchCombo.prototype.addAll=function(){var i=0;while(i<this.result.length){var j=0;while(j<this.result[i].length){this.addSelectedPriv(this.result[i][j]);++j;}++i;}this.clearResult();this.clearField();this.drawSel();for(var i=0;i<this.listeners.length;++i){this.listeners[i](null,this,false);}};SearchCombo.prototype.delAll=function(){this.selByName=[];this.selected=[];this.drawSel();for(var i=0;i<this.listeners.length;++i){this.listeners[i](null,this,false);}};SearchCombo.prototype.delSel=function(){this.selByName=[];this.selected=[];this.drawSel();};SearchCombo.prototype.drawSel=function(){if(!this.sel){return;}var i=0;var nodes=this.sel.childNodes;while(i<nodes.length){this.sel.removeChild(nodes[i]);}var ul=document.createElement("ul");ul.className="ssel";var i=0;
if(this.selected.length>=this.maxDisp){var li=document.createElement("li");var div=document.createElement("div");div.refObj=this;div.className="delall";if(!isTouchDevice()){div.onmouseup=function(){SCdelAll(this);};}else{div.ontouchend=function(){SCdelAll(this);};}div.innerHTML=Properties[this.lcl]["RemAll"];li.appendChild(div);ul.appendChild(li);}while(i<this.selected.length){var li=document.createElement("li");var div=document.createElement("div");div.pos=i;div.refObj=this;var spanTxt=document.createElement("span");var text=document.createTextNode(this.selected[i].txt);spanTxt.appendChild(text);div.appendChild(spanTxt);if(!isTouchDevice()){div.onmouseup=function(){SCdelSel(this);};}else{div.ontouchend=function(){SCdelSel(this);};}li.appendChild(div);ul.appendChild(li);++i;}this.sel.appendChild(ul);};function SearchComboChosen(parent,multiselect,defaultText,displayAll,displayGrps,forbidEmptySel){SearchBox.call(this);this.parent=parent;this.multiSelect=multiselect;this.selected=[];this.selByName=[];
this.addSelectionListener(SCmySel);this.setResultListener(SCdrawRes);if(defaultText){this.default_text=defaultText;}else{this.default_text="";}this.displayAll=displayAll;this.displayGrps=displayGrps;this.forbidEmptySel=forbidEmptySel;this.curPos=0;this.createUI();if(this.displayAll){this.addResult(new SearchComboValName("All",getLocMessage("All"),0));this.curPos++;}}SearchComboChosen.prototype=new SearchBox;SearchComboChosen.prototype.createUI=function(){var obj=this;this.results_showing=false;this.container=document.createElement("div");this.container.id=this.parent.id+"_chzn";setStyle(this.container,"width: 100%; cursor: pointer");if(!this.multiSelect){this.container.className="chzn-container chzn-container-single";this.container.innerHTML="<a id='"+this.parent.id+"_chzn_link' class='chzn-single chzn-default' tabindex='-1'><span>"+this.default_text+"</span><div><b></b></div></a><div id='"+this.parent.id+"_chzn_drop' class='chzn-drop' style='display:none;'><div id='"+this.parent.id+"_chzn_search' class='chzn-search'><input id='"+this.parent.id+"_chzn_search_field' type='text' autocomplete='off' /></div><ul id='"+this.parent.id+"_chzn_results' class='chzn-results'></ul></div>";
this.parent.appendChild(this.container);this.selected_item=document.getElementById(this.parent.id+"_chzn_link");this.selected_item.onclick=function(e){obj.show();e=e||window.event;if(e.stopPropagation){e.stopPropagation();}e.cancelBubble=true;};this.dropdown=document.getElementById(this.parent.id+"_chzn_drop");this.search_container=document.getElementById(this.parent.id+"_chzn_search");this.search=document.getElementById(this.parent.id+"_chzn_search_field");this.search.refObj=this;this.search.onkeydown=function(e){SBkeyPress(this,e);};this.search.onkeyup=function(e){SBkeyUp(this,e);};this.search.onclick=function(e){e=e||window.event;if(e.stopPropagation){e.stopPropagation();}e.cancelBubble=true;};this.results=document.getElementById(this.parent.id+"_chzn_results");this.elem=this.results;}else{var sText=this.default_text;this.container.className="chzn-container chzn-container-multi";this.container.innerHTML="<ul class='chzn-choices' id='"+this.parent.id+"_chzn_choices'><li id='"+this.parent.id+"_chzn_search' class='search-field'><input id='"+this.parent.id+"_chzn_search_field' type='text' value='"+sText+"' class='default' autocomplete='off' /></li></ul><div id='"+this.parent.id+"_chzn_drop' class='chzn-drop' style='display:none;'><ul id='"+this.parent.id+"_chzn_results' class='chzn-results'></ul></div>";
this.parent.appendChild(this.container);this.dropdown=document.getElementById(this.parent.id+"_chzn_drop");this.search_container=document.getElementById(this.parent.id+"_chzn_search");this.search=document.getElementById(this.parent.id+"_chzn_search_field");this.search_choices=document.getElementById(this.parent.id+"_chzn_choices");this.search_choices.onclick=function(e){obj.show();if(isFirefox()){setTimeout(function(o){return function(){o.search.focus();};}(obj),10);}else{obj.search.focus();}if(obj.search.value==obj.default_text){obj.search.value="";}e=e||window.event;if(e.stopPropagation){e.stopPropagation();}e.cancelBubble=true;};this.search.onmousedown=function(e){obj.show();if(isFirefox()){setTimeout(function(o){return function(){o.search.focus();};}(obj),10);}else{obj.search.focus();}if(obj.search.value==obj.default_text){obj.search.value="";}e=e||window.event;if(e.stopPropagation){e.stopPropagation();}e.cancelBubble=true;};this.search.refObj=this;this.search.onkeyup=function(e){SBkeyUp(this,e);
};this.search.onkeydown=function(e){SBkeyPress(this,e);if(!this.refObj.results_showing){obj.show();}};this.search.onclick=function(e){e=e||window.event;if(e.stopPropagation){e.stopPropagation();}e.cancelBubble=true;};this.results=document.getElementById(this.parent.id+"_chzn_results");this.elem=this.results;var obj=this;var func=function(e){obj.onKeyUp(e);};document.addEventListener("keyup",func,false);var funcResize=function(e){obj.updateSearchInputWidth();};ddCtrl.addEventListener("resize",funcResize,false);}};SearchComboChosen.prototype.onKeyUp=function(event){var event=event||window.event;if(event.key=="Control"&&this.needUpdate){this.needUpdate=false;if(this.results_showing){this.show();}this.update();}};SearchComboChosen.prototype.show=function(){var obj=this;if(!this.multiSelect){$(function(){var container=$("[id='"+obj.container.id+"']");var dropdown=$("[id='"+obj.parent.id+"_chzn_drop']");var search_container=$("[id='"+obj.parent.id+"_chzn_search']");var search_field=container.find("input").first();
var dd_top=container.height();var dd_width=container.width()-(dropdown.outerWidth()-dropdown.width());dropdown.css({width:dd_width+"px",top:dd_top+"px"});var sf_width=dd_width-(search_container.outerWidth()-search_container.width())-(search_field.outerWidth()-search_field.width());search_field.css({width:sf_width+"px"});});if(!this.results_showing){this.results_showing=true;addClass(this.container,"chzn-container-active");addClass(this.selected_item,"chzn-single-with-drop");var oTop=this.container.offsetHeight;this.dropdown.style.top=oTop+"px";this.dropdown.style.display="inherit";document.onclick=function(){obj.results_showing=true;obj.show();removeClass(obj.container,"chzn-container-active");};if(this.parentObj){this.parentObj.changeOverflow("visible");}}else{this.results_showing=false;this.dropdown.style.display="none";removeClass(this.selected_item,"chzn-single-with-drop");if(this.parentObj){this.parentObj.changeOverflow("hidden");}}}else{$(function(){var container=$("[id='"+obj.container.id+"']");
var dropdown=$("[id='"+obj.parent.id+"_chzn_drop']");var search_container=$("[id='"+obj.parent.id+"_chzn_search']");var search_field=container.find("input").first();var dd_top=container.height();var dd_width=container.width()-(dropdown.outerWidth()-dropdown.width());dropdown.css({width:(dd_width)+"px",top:dd_top+"px"});});if(!this.results_showing){this.results_showing=true;addClass(this.container,"chzn-container-active");var oTop=this.container.offsetHeight;this.dropdown.style.top=oTop+"px";this.dropdown.style.display="inherit";document.onclick=function(event){var event=event||window.event;if(!event.ctrlKey){obj.results_showing=true;obj.show();removeClass(obj.container,"chzn-container-active");if(obj.selected.length==0&&obj.search.value==""){obj.search.value=obj.default_text;}}};if(this.parentObj){this.parentObj.changeOverflow("visible");}}else{this.results_showing=false;this.dropdown.style.display="none";if(this.parentObj){this.parentObj.changeOverflow("hidden");}}}};SearchComboChosen.prototype.updateSearchInputWidth=function(){var obj=this;
$(function(){var container=$("[id='"+obj.container.id+"']");var search_container=$("[id='"+obj.parent.id+"_chzn_search']");var search_field=container.find("input").first();var dd_width=container.width()-(search_container.outerWidth()-search_container.width())-(search_field.outerWidth()-search_field.width());var width=0;var choices=document.getElementById(obj.parent.id+"_chzn_choices");for(var i=0;i<choices.childNodes.length;i++){var elt=choices.childNodes[i];if(elt.className=="search-choice"){width+=elt.offsetWidth+5;if(width>dd_width){width=elt.offsetWidth+5;}}}if(width>0){width+=10;}var sf_width=dd_width-width;if(sf_width<=10){sf_width=dd_width;}sf_width-=2;search_field.css({width:sf_width+"px"});});};SearchComboChosen.prototype.drawResult=function(){var obj=this;var resGprs=null;var i=0;var nodes=this.results.childNodes;while(i<nodes.length){this.results.removeChild(nodes[i]);}var nr=0;var pos=0;if(this.result&&(this.result.length>0)){var displayRes=new Array();var iRes=0;for(iRes=0;
iRes<this.result.length;iRes++){var resSet=this.result[iRes];var lRes=0;var displayResLength=0;for(lRes=0;lRes<resSet.length;lRes++){var resObj=resSet[lRes];var txt=resObj.txt;var id=resObj.key;var grp=resObj.grp;if(this.displayGrps&&typeof(grp)!="undefined"){if(resGprs!=null&&resGprs[grp]&&resGprs[grp].length>=this.maxDisp){continue;}}else{if(nr>=this.maxDisp){break;}}if(!displayRes[id]){if(this.displayGrps&&typeof(grp)!="undefined"){if(resGprs==null){resGprs={};}if(typeof(resGprs[grp])=="undefined"){resGprs[grp]=[];}resGprs[grp].push(resObj);}else{resObj.pos=pos;this.addResult(resObj);}displayRes[id]=true;displayResLength++;++pos;++nr;}}}}if(resGprs!=null){var pos=0;for(grp in resGprs){var grpName=grp+" ("+resGprs[grp].length+")";var expanded;if(resGprs[grp].length>5){expanded=false;grpName="+ "+grpName;}else{expanded=true;grpName="- "+grpName;}var grpElt=this.addResultGroup(grp,grpName);grpElt.expanded=expanded;grpElt.onclick=function(e){var display;if(this.expanded){grpName="+ "+this.grp+" ("+resGprs[this.grp].length+")";
display="none";}else{grpName="- "+this.grp+" ("+resGprs[this.grp].length+")";display="list-item";}this.innerHTML=grpName;for(var iMbr=0;iMbr<resGprs[this.grp].length;iMbr++){var resObj=resGprs[this.grp][iMbr];var id=obj.parent.id+"_result_"+resObj.key;var resElt=document.getElementById(id);setStyle(resElt,"display:"+display);}this.expanded=!this.expanded;e=e||window.event;if(e.stopPropagation){e.stopPropagation();}e.cancelBubble=true;};++pos;for(var iMbr=0;iMbr<resGprs[grp].length;iMbr++){var resObj=resGprs[grp][iMbr];resObj.pos=pos;var resElt=this.addResult(resObj);if(!expanded){setStyle(resElt,"display: none");}++pos;}}}if(this.hasMoreResult){var li=document.createElement("li");li.className="no-results";li.innerHTML="...";this.results.appendChild(li);}if(nr==0){var li=document.createElement("li");li.className="no-results";li.innerHTML=getLocMessage("NoResult")+' "'+this.search.value+'"';this.results.appendChild(li);}};SearchComboChosen.prototype.drawResultPreview=function(){var i=0;var nodes=this.results.childNodes;
while(i<nodes.length){this.results.removeChild(nodes[i]);}this.curPos=0;var curGprs={};if(this.displayAll){this.addResult(new SearchComboValName("All",getLocMessage("All"),this.curPos));this.curPos++;}for(var i=0;i<this.previewResMembers.length;i++){var resObj=this.previewResMembers[i];if(this.displayGrps&&typeof(resObj.grp)!="undefined"&&typeof(curGprs[resObj.grp])=="undefined"){this.addResultGroup(resObj.grp,resObj.grp);curGprs[resObj.grp]=true;this.curPos++;}resObj.pos=this.curPos;this.addResult(resObj);this.curPos++;}if(this.hasMoreResultPreview){this.addMoreResult();}};SearchComboChosen.prototype.addResult=function(resObj){if(this.results){var li=document.createElement("li");li.className="active-result";if(this.displayGrps&&typeof(resObj.grp)!="undefined"){li.className="active-result group-option";}if(this.displayAll&&resObj.id=="All"){addClass(li,"slicerComboFirstOption");}if(this.selByName[resObj.key]){addClass(li,"result-selected");}setStyle(li,"display: list-item");li.refObj=this;
li.obj=resObj;li.pos=resObj.pos;li.innerHTML=resObj.txt;li.id=this.parent.id+"_result_"+resObj.key;if(!isTouchDevice()){li.onmouseover=function(){SBitPos(this);};li.onclick=function(e){e=e||window.e;var bIsSelected=this.refObj.selByName[this.obj.key];if(e.ctrlKey){if(bIsSelected){this.refObj.removeSelectedPriv(this.obj);}else{this.refObj.addSelectedPriv(this.obj);}this.refObj.drawSel();this.refObj.needUpdate=true;}else{this.refObj.results_showing=false;SBselect(this);}};}else{li.ontouchend=function(){SBselect(this);};}this.results.appendChild(li);return li;}};SearchComboChosen.prototype.addResultGroup=function(grp,grpName){if(this.results){var li=document.createElement("li");li.className="group-result";li.id=this.parent.id+"_result_grp_"+grp;li.grp=grp;setStyle(li,"display: list-item");li.innerHTML=grpName;this.results.appendChild(li);return li;}};SearchComboChosen.prototype.addMoreResult=function(){var li=document.createElement("li");li.className="no-results";li.innerHTML="...";this.results.appendChild(li);
};SearchComboChosen.prototype.hiLi=function(elem){if(this.lastSel){var className=this.lastSel.className.replace("highlighted","");this.lastSel.className=className;}elem.className+=" highlighted";this.lastSel=elem;};SearchComboChosen.prototype.addSelectedPriv=function(obj){if(typeof(this.selByName[obj.key])=="undefined"||this.selByName[obj.key]==null){this.selected.push(obj);this.selByName[obj.key]=true;}};SearchComboChosen.prototype.removeSelectedPriv=function(obj){if(typeof(this.selByName[obj.key])!="undefined"&&this.selByName[obj.key]!=null){for(var i=0;i<this.selected.length;i++){if(this.selected[i].key==obj.key){this.selected.splice(i,1);break;}}delete this.selByName[obj.key];}};SearchComboChosen.prototype.addSelected=function(obj){if(!this.multiSelect){this.selByName=[];this.selected=[];}if(this.search){this.search.value="";}this.addSelectedPriv(obj);this.drawSel();};SearchComboChosen.prototype.addSelectedList=function(objList){if(!this.multiSelect){this.selByName=[];this.selected=[];
}if(this.search){this.search.value="";}for(var i=0;i<objList.length;i++){this.addSelectedPriv(objList[i]);}this.drawSel();};SearchComboChosen.prototype.removePos=function(pos){if(!this.multiSelect){this.selByName=[];this.selected=[];}else{var obj=this.selected[pos];delete this.selByName[obj.key];this.selected.splice(pos,1);}this.drawSel();for(var i=0;i<this.listeners.length;++i){this.listeners[i](obj,this,true);}};SearchComboChosen.prototype.remove=function(txt){var bFind=false;for(var i=0;i<this.selected.length;i++){if(this.selected[i].txt==txt){this.removePos(i);break;}}if(!bFind){for(var i=0;i<this.selected.length;i++){if(this.selected[i].id==txt){this.removePos(i);break;}}}if(!bFind){for(var i=0;i<this.selected.length;i++){if(this.selected[i].key==txt){this.removePos(i);break;}}}};SearchComboChosen.prototype.removeAll=function(){this.selected=new Array();this.selByName=new Array();this.drawSel();};SearchComboChosen.prototype.addAll=function(){var i=0;while(i<this.result.length){var j=0;
while(j<this.result[i].length){this.addSelectedPriv(this.result[i][j]);++j;}++i;}this.clearResult();this.clearField();this.drawSel();for(var i=0;i<this.listeners.length;++i){this.listeners[i](null,this,false);}};SearchComboChosen.prototype.delAll=function(){this.selByName=[];this.selected=[];this.drawSel();for(var i=0;i<this.listeners.length;++i){this.listeners[i](null,this,false);}};SearchComboChosen.prototype.delSel=function(){this.selByName=[];this.selected=[];this.drawSel();};SearchComboChosen.prototype.update=function(){for(var i=0;i<this.listeners.length;++i){this.listeners[i](null,this,false);}};SearchComboChosen.prototype.drawSel=function(){if(this.container.className.indexOf("chzn-container-active")==-1&&this.results_showing){this.container.className+=" chzn-container-active";}if(!this.multiSelect){var obj=this;if(this.selected.length>0){var selObj=this.selected[0];var selElt=this.elem.childNodes[selObj.pos];this.selected_item.firstChild.innerHTML=this.selected[0].txt;var elt=this.selected_item.childNodes[1];
if(elt&&elt.nodeName.toLowerCase()!="abbr"&&!this.forbidEmptySel){var abbr=document.createElement("abbr");abbr.className="search-choice-close";abbr.onclick=function(e){SCdelSel(selElt);e=e||window.event;if(e.stopPropagation){e.stopPropagation();}e.cancelBubble=true;};this.selected_item.insertBefore(abbr,this.selected_item.lastChild);}this.selected_item.className="chzn-single";this.dropdown.style.display="none";}else{var search_choice_close=null;for(var i=0;i<this.selected_item.childNodes.length;i++){var elt=this.selected_item.childNodes[i];if(elt.className=="search-choice-close"){search_choice_close=elt;break;}}if(search_choice_close!=null){this.selected_item.removeChild(search_choice_close);}this.selected_item.firstChild.innerHTML=this.default_text;this.selected_item.className="chzn-single chzn-default";this.search.value="";this.dropdown.style.display="none";}}else{var childsToRemove=[];for(var i=0;i<this.search_choices.childNodes.length;i++){var child=this.search_choices.childNodes[i];
if(child.className=="search-choice"){childsToRemove.push(child);}}for(var i=0;i<childsToRemove.length;i++){this.search_choices.removeChild(childsToRemove[i]);}for(var i=0;i<this.selected.length;i++){var selObj=this.selected[i];var li=document.createElement("li");li.className="search-choice";li.refObj=this;li.pos=i;var span=document.createElement("span");span.innerHTML=selObj.txt;var a=document.createElement("a");a.className="search-choice-close";a.selObj=selObj;var obj=this;a.onclick=function(e){e=e||window.event;if(e.ctrlKey){obj.removeSelectedPriv(this.selObj);obj.drawSel();obj.needUpdate=true;}else{SCdelSel(this.parentNode);}if(e.stopPropagation){e.stopPropagation();}e.cancelBubble=true;};li.appendChild(span);li.appendChild(a);this.search_choices.insertBefore(li,this.search_container);}this.updateSearchInputWidth();if(this.selected.length==0&&this.search.value==""){this.search.value=this.default_text;}if(this.selected.length>0&&this.search.value==this.default_text){this.search.value="";
}if(this.results_showing){var oTop=this.container.offsetHeight;this.dropdown.style.top=oTop+"px";this.dropdown.style.display="inherit";}}};var TST_PARENT=0;var TST_LOKID=1;var TST_EQKID=2;var TST_HIKID=3;function chcomp(a,b){return a-b;}function TSTNode(splitchar,parent){this.splitchar=splitchar;this.relatives=new Array(4);this.data;this.relatives[TST_PARENT]=parent;}function TernarySearchTree(){this.rootNode=null;this.numNodes;this.checkData;}TernarySearchTree.prototype.getRootNode=function(){return this.rootNode;};TernarySearchTree.prototype.put=function(key,value){var node=this.getOrCreateNode(key);if(node!=null){if(node.data==null){node.data=[];}node.data.push(value);}};TernarySearchTree.prototype.get=function(key){var node=this.getNode(key);if(node==null){return null;}return node.data;};TernarySearchTree.prototype.remove=function(key){this.deleteNode(this.getNode(key));};TernarySearchTree.prototype.getNode=function(key,startNode){if(typeof startNode=="undefined"){startNode=this.rootNode;
}if(key==null||startNode==null||key.length==0){return null;}var currentNode=startNode;var charIndex=0;while(true){if(currentNode==null){return null;}var charComp=chcomp(key.charCodeAt(charIndex),currentNode.splitchar);if(charComp==0){charIndex++;if(charIndex==key.length){return currentNode;}currentNode=currentNode.relatives[TST_EQKID];}else{if(charComp<0){currentNode=currentNode.relatives[TST_LOKID];}else{currentNode=currentNode.relatives[TST_HIKID];}}}};TernarySearchTree.prototype.getOrCreateNode=function(key){if((key==null)||(key.length==0)){return;}if(this.rootNode==null){this.rootNode=new TSTNode(key.charCodeAt(0),null);}var currentNode=this.rootNode;var charIndex=0;while(true){var charComp=chcomp(key.charCodeAt(charIndex),currentNode.splitchar);if(charComp==0){charIndex++;if(charIndex==key.length){return currentNode;}if(currentNode.relatives[TST_EQKID]==null){currentNode.relatives[TST_EQKID]=new TSTNode(key.charCodeAt(charIndex),currentNode);}currentNode=currentNode.relatives[TST_EQKID];
}else{if(charComp<0){if(currentNode.relatives[TST_LOKID]==null){currentNode.relatives[TST_LOKID]=new TSTNode(key.charCodeAt(charIndex),currentNode);}currentNode=currentNode.relatives[TST_LOKID];}else{if(currentNode.relatives[TST_HIKID]==null){currentNode.relatives[TST_HIKID]=new TSTNode(key.charCodeAt(charIndex),currentNode);}currentNode=currentNode.relatives[TST_HIKID];}}}return currentNode;};TernarySearchTree.prototype.deleteNode=function(nodeToDelete){if(nodeToDelete==null){return;}nodeToDelete.data=null;while(nodeToDelete!=null){nodeToDelete=this.deleteNodeRecursion(nodeToDelete);}};TernarySearchTree.prototype.deleteNodeRecursion=function(currentNode){if(currentNode==null){return null;}if(currentNode.relatives[TST_EQKID]!=null||currentNode.data!=null){return null;}var currentParent=currentNode.relatives[TST_PARENT];var lokidNull=currentNode.relatives[TST_LOKID]==null;var hikidNull=currentNode.relatives[TST_HIKID]==null;var childType;if(currentParent.relatives[TST_LOKID]==currentNode){childType=TST_LOKID;
}else{if(currentParent.relatives[TST_EQKID]==currentNode){childType=TST_EQKID;}else{if(currentParent.relatives[TST_HIKID]==currentNode){childType=TST_HIKID;}else{this.rootNode=null;return null;}}}if(lokidNull&&hikidNull){currentParent.relatives[childType]=null;return currentParent;}if(lokidNull){currentParent.relatives[childType]=currentNode.relatives[TST_HIKID];currentNode.relatives[TST_HIKID].relatives[TST_PARENT]=currentParent;return currentParent;}if(hikidNull){currentParent.relatives[childType]=currentNode.relatives[TST_LOKID];currentNode.relatives[TST_LOKID].relatives[TST_PARENT]=currentParent;return currentParent;}var deltaHi=currentNode.relatives[TST_HIKID].splitchar-currentNode.splitchar;var deltaLo=currentNode.splitchar-currentNode.relatives[TST_LOKID].splitchar;var movingKid;var targetNode;if(deltaHi==deltaLo){if(Math.random()<0.5){deltaHi++;}else{deltaLo++;}}if(deltaHi>deltaLo){movingKid=TST_HIKID;targetNode=currentNode.relatives[TST_LOKID];}else{movingKid=TST_LOKID;targetNode=currentNode.relatives[TST_HIKID];
}while(targetNode.relatives[movingKid]!=null){targetNode=targetNode.relatives[movingKid];}targetNode.relatives[movingKid]=currentNode.relatives[movingKid];currentParent.relatives[childType]=targetNode;targetNode.relatives[TST_PARENT]=currentParent;if(!lokidNull){currentNode.relatives[TST_LOKID]=null;}if(!hikidNull){currentNode.relatives[TST_HIKID]=null;}return currentParent;};TernarySearchTree.prototype.getKey=function(node){var str=node.splitchar;var currentNode,lastNode;currentNode=node.relatives[TST_PARENT];lastNode=node;while(currentNode!=null){if(currentNode.relatives[TST_EQKID]==lastNode){str+=currentNode.splitchar;}lastNode=currentNode;currentNode=currentNode.relatives[TST_PARENT];}var splitStr=str.split("");splitStr=splitStr.reverse();return splitStr.join("");};TernarySearchTree.prototype.numNodes=function(){return this.numNodes(this.rootNode);};TernarySearchTree.prototype.numNodes=function(startingNode){numNodes=0;checkData=false;this.recursiveNodeCalculator(startingNode);return numNodes;
};TernarySearchTree.prototype.numDataNodes=function(){return this.numDataNodes(this.rootNode);};TernarySearchTree.prototype.numDataNodes=function(startingNode){numNodes=0;checkData=true;this.recursiveNodeCalculator(startingNode);return numNodes;};TernarySearchTree.prototype.recursiveNodeCalculator=function(currentNode){if(currentNode==null){return;}this.recursiveNodeCalculator(currentNode.relatives[TST_LOKID]);this.recursiveNodeCalculator(currentNode.relatives[TST_EQKID]);this.recursiveNodeCalculator(currentNode.relatives[TST_HIKID]);if(checkData){if(currentNode.data!=null){numNodes++;}}else{numNodes++;}};TernarySearchTree.prototype.sortKeysRecursion=function(storage,currentNode,maxVal){if(currentNode==null){return;}this.sortKeysRecursion(storage,currentNode.relatives[TST_LOKID],maxVal);if((maxVal>0)&&(storage.size()>=maxVal)){return;}if(currentNode.data!=null){storage.push(currentNode.data);}this.sortKeysRecursion(storage,currentNode.relatives[TST_EQKID],maxVal);this.sortKeysRecursion(storage,currentNode.relatives[TST_HIKID],maxVal);
};function TSTMatchBase(){this.defaultNumReturnValues=-1;}TSTMatchBase.prototype.setNumReturnValues=function(num){this.defaultNumReturnValues=(num<0)?-1:num;};TSTMatchBase.prototype.checkNumberOfReturnValues=function(numReturnValues){return((numReturnValues<0)?-1:numReturnValues);};function TSTMatchAlmost(tstTree){this.defaultNumReturnValues=-1;this.matchAlmostResult;this.matchAlmostNumReturnValues;this.matchAlmostKey;this.matchAlmostDiff=4;this.maxMatchAlmostDiff=4;this.tree=tstTree;}TSTMatchAlmost.prototype=new TSTMatchBase;TSTMatchAlmost.prototype.find=function(key,numReturnValues){if(typeof numReturnValues=="undefined"){numReturnValues=this.defaultNumReturnValues;}this.matchAlmostNumReturnValues=this.checkNumberOfReturnValues(numReturnValues);this.matchAlmostResult=[];this.matchAlmostKey=key;this.matchAlmostRecursion(this.tree.getRootNode(),0,this.matchAlmostDiff);return this.matchAlmostResult;};TSTMatchAlmost.prototype.matchAlmostRecursion=function(currentNode,charIndex,d){if((currentNode==null)||(d<0)||(this.matchAlmostNumReturnValues==0)){return;
}var charComp=chcomp(this.matchAlmostKey.charCodeAt(charIndex),currentNode.splitchar);if((d>0)||(charComp<0)){this.matchAlmostRecursion(currentNode.relatives[TST_LOKID],charIndex,d);}var nextD=(charComp==0)?d:d-1;if((this.matchAlmostKey.length<=charIndex+1)&&(currentNode.data!=null)){this.matchAlmostResult.push(currentNode.data);this.matchAlmostNumReturnValues--;}this.matchAlmostRecursion(currentNode.relatives[TST_EQKID],charIndex+1,nextD);if((d>0)||(charComp>0)){this.matchAlmostRecursion(currentNode.relatives[TST_HIKID],charIndex,d);}};function TSTMatchAlmostPrefix(tstTree){this.defaultNumReturnValues=-1;this.matchAlmostResult;this.matchAlmostNumReturnValues;this.matchAlmostKey;this.matchAlmostDiff=2;this.maxMatchAlmostDiff=4;this.tree=tstTree;}TSTMatchAlmostPrefix.prototype=new TSTMatchBase;TSTMatchAlmostPrefix.prototype.find=function(key,numReturnValues){if(typeof numReturnValues=="undefined"){numReturnValues=this.defaultNumReturnValues;}this.matchAlmostNumReturnValues=this.checkNumberOfReturnValues(numReturnValues);
this.matchAlmostResult=[];this.matchAlmostKey=key;this.matchAlmostRecursion(this.tree.getRootNode(),0,this.matchAlmostDiff);return this.matchAlmostResult;};TSTMatchAlmostPrefix.prototype.matchAlmostRecursion=function(currentNode,charIndex,d){if(charIndex>this.matchAlmostKey.length){this.tree.sortKeysRecursion(this.matchAlmostResult,currentNode,this.matchAlmostNumReturnValues);return;}if((currentNode==null)||(d<0)||(this.matchAlmostNumReturnValues==0)){return;}var charComp=chcomp(this.matchAlmostKey.charCodeAt(charIndex),currentNode.splitchar);if((d>0)||(charComp<0)){this.matchAlmostRecursion(currentNode.relatives[TST_LOKID],charIndex,d);}var nextD=(charComp==0)?d:d-1;if((this.matchAlmostKey.length<=charIndex+1)&&(currentNode.data!=null)){this.matchAlmostResult.push(currentNode.data);this.matchAlmostNumReturnValues--;}this.matchAlmostRecursion(currentNode.relatives[TST_EQKID],charIndex+1,nextD);if((d>0)||(charComp>0)){this.matchAlmostRecursion(currentNode.relatives[TST_HIKID],charIndex,d);
}};function TSTMatchPrefix(tstTree){this.tree=tstTree;}TSTMatchPrefix.prototype=new TSTMatchBase;TSTMatchPrefix.prototype.find=function(prefix,numReturnValues){if(typeof numReturnValues=="undefined"){numReturnValues=this.defaultNumReturnValues;}var maxRetVal=this.checkNumberOfReturnValues(numReturnValues);var sortKeysResult=[];var startNode=this.tree.getNode(prefix);if(startNode==null){return sortKeysResult;}if(startNode.data!=null){sortKeysResult.push(startNode.data);}this.tree.sortKeysRecursion(sortKeysResult,startNode.relatives[TST_EQKID],maxRetVal);return sortKeysResult;};function Trie(){this.root=[null,{}];}Trie.prototype.add=function(key,value){var node,ch,curr_node=this.root;for(var i=0,k_len=key.length;i<k_len;i++){ch=key.charAt(i);node=curr_node[1];if(ch in node){curr_node=node[ch];}else{curr_node=node[ch]=[null,{}];}}curr_node[0]=value;};Trie.prototype.find=function(key){var ch,curr_node=this.root;for(var i=0,k_len=key.length;i<k_len;i++){ch=key.charAt(i);if(ch in curr_node[1]){curr_node=curr_node[1][ch];
}else{return;}}return curr_node[0];};Trie.prototype.find_prefix=function(key){var ch,curr_node=this.root;var remainder=key;for(var i=0,k_len=key.length;i<k_len;i++){ch=key.charAt(i);if(ch in curr_node[1]){curr_node=curr_node[1][ch];}else{return[curr_node[0],remainder];}remainder=remainder.slice(1,remainder.length);}return[curr_node[0],remainder];};function _find_prefix_match(trie,key){var ch,curr_node=trie.root;var remainder=key;for(var i=0,k_len=key.length;i<k_len;i++){ch=key.charAt(i);if(ch in curr_node[1]){curr_node=curr_node[1][ch];}else{break;}remainder=remainder.slice(1,remainder.length);}return[curr_node,remainder];}Trie.prototype.find_prefix_matches=function(key){var l=_find_prefix_match(this,key);if(l[1].length>0){return[];}var d,stack=[l[0]],ret=[];while(stack.length>0){d=stack.pop();if(d[0]){ret.unshift(d[0]);}for(var c in d[1]){if(d[1].hasOwnProperty(c)){stack.push(d[1][c]);}}}return ret;};AnalyzerHandler=function(dmList,dimList,hName,lName,limit,dmsel){this.dmList=dmList;this.dimList=dimList;
this.hName=hName;this.lName=lName;if(limit===undefined){this.limit=ddCtrl.LIMIT_RESULT_SEARCHBOX;}else{this.limit=limit;}if(dmsel===undefined){dmsel=null;}else{this.dmsel=dmsel;}this.iReq=0;};AnalyzerHandler.prototype.toJSON=function(){return{dmList:this.dmList,dimList:this.dimList,hName:this.hName,lName:this.lName,limit:this.limit};};AnalyzerHandler.prototype.analyze=function(searchbox){var obj=this;this.iReq++;var curIReq=this.iReq;var searchValue=null;var bAsync=true;if(typeof(searchbox)=="object"){searchValue=searchbox.search.value;bAsync=true;}else{searchValue=searchbox;bAsync=false;}var url=ddCtrl.servletAPIPath;var params="method=getMemberList&attribute="+encodeURIComponent(JSON.stringify(this))+"&text="+encodeURIComponent(searchValue);if(this.dmsel){params+="&sel="+encodeURIComponent(JSON.stringify(this.dmsel));}var xmlRequest=null;if(window.XMLHttpRequest){xmlRequest=new XMLHttpRequest();try{xmlRequest.overrideMimeType("text/ecmascript");}catch(e){}}else{if(window.ActiveXObject){xmlRequest=new ActiveXObject("Microsoft.XMLHTTP");
}}xmlRequest.open("POST",url,bAsync);xmlRequest.setRequestHeader("Content-type","application/x-www-form-urlencoded; charset=UTF-8");if(typeof(searchbox)=="object"){xmlRequest.onreadystatechange=function(){if(xmlRequest.readyState===4){if((xmlRequest.status===0)||(xmlRequest.status>=200&&xmlRequest.status<=206)){var json=xmlRequest.responseText;xmlRequest.onreadystatechange=new Function();xmlRequest=null;if(obj.iReq==curIReq){var resObj;eval("resObj = "+json);searchbox.result=resObj.res;searchbox.sortResult();searchbox.hasMoreResult=resObj.hasMore;searchbox.resultListener(searchbox);}}}};}xmlRequest.send(params);if(typeof(searchbox)!="object"){var res=xmlRequest.responseText;var result=eval(res);return result;}return null;};function SearchComboValName(id,txt,pos,grp){this.id=id;this.txt=txt;this.pos=pos;this.grp=grp;if(typeof(this.grp)!="undefined"){this.key=this.grp+"_"+this.id;}else{this.key=this.id;}}comboListener=new Array();function comboChangeHandler(obj){var execArray=comboListener[obj.id];
doChangeHandler(execArray,obj.id);}function doChangeHandler(execArray,id){if(execArray!=null){var i=0;while(i<execArray.length){execArray[i].onChange(id);++i;}}}RangeCombo=function(parent,id,isDate){this.id=id;this.init=false;this.isDate=isDate;this.format=null;this.HTMLElement=document.createElement("div");this.HTMLElement.setAttribute("id","selector"+id);this.HTMLElement.setAttribute("style","cursor: auto; width: 130px");parent.appendChild(this.HTMLElement);this.parent=parent;};RangeCombo.prototype.getClass=function(){return"RangeCombo";};RangeCombo.prototype.getParent=function(){return this.parent;};RangeCombo.prototype.addChangeListener=function(obj){var array=comboListener[this.id];if(array==null){array=new Array();comboListener[this.id]=array;}array.push(obj);};RangeCombo.prototype.removeChangeListeners=function(){comboListener[this.id]=new Array();};RangeCombo.prototype.callChange=function(){doChangeHandler(comboListener[this.id],this.id);};RangeCombo.prototype.setMultiSelect=function(bMulti){};
RangeCombo.prototype.setCaptions=function(mapCaptions){this.mapCaptions=mapCaptions;};RangeCombo.prototype.getMemberFormated=function(mbr){if(this.mapCaptions&&typeof(this.mapCaptions[mbr])!="undefined"&&this.mapCaptions[mbr]!=null){return this.mapCaptions[mbr];}else{return formatNum(mbr,this.format);}};RangeCombo.prototype.setRange=function(min,max,format,dispatch){this.min=min;this.max=max;if(format){this.format=format;}this.update();if(dispatch){this.callChange();}};RangeCombo.prototype.update=function(){if(this.isDate){this.updateDatePicker();}else{this.updateSlider();}};RangeCombo.prototype.updateSlider=function(){if(!this.init){this.init=true;this.initMin=this.min;this.initMax=this.max;this.sliderId=this.HTMLElement.id+"_slider";var obj=this;setStyle(this.HTMLElement,"cursor: auto; width: 200px; height: 40px");var div=document.createElement("div");setStyle(div,"width: 100%");var minElt=document.createElement("span");this.minId=this.HTMLElement.id+"_min";minElt.id=this.minId;setStyle(minElt,"margin-left: 10px");
minElt.innerHTML=this.getMemberFormated(this.min);div.appendChild(minElt);var maxElt=document.createElement("span");this.maxId=this.HTMLElement.id+"_max";maxElt.id=this.maxId;setStyle(maxElt,"float: right; margin-right: 10px");maxElt.innerHTML=formatNum(this.max,this.format);div.appendChild(maxElt);this.HTMLElement.appendChild(div);var divSlider=document.createElement("div");divSlider.id=this.sliderId;setStyle(divSlider,"margin-left: 10px; margin-right: 10px; margin-top: 5px");this.HTMLElement.appendChild(divSlider);$(function(){$("[id='"+obj.sliderId+"']").slider({range:true,min:obj.min,max:obj.max-1,values:[obj.min,obj.max-1],slide:function(event,ui){document.getElementById(obj.minId).innerHTML=obj.getMemberFormated(ui.values[0]);document.getElementById(obj.maxId).innerHTML=obj.getMemberFormated(ui.values[1]);},change:function(event,ui){if(event.originalEvent){obj.min=ui.values[0];obj.max=ui.values[1]+1;obj.callChange();}}});document.getElementById(obj.minId).innerHTML=obj.getMemberFormated($("[id='"+obj.sliderId+"']").slider("values",0));
document.getElementById(obj.maxId).innerHTML=obj.getMemberFormated($("[id='"+obj.sliderId+"']").slider("values",1));$("[id='"+obj.sliderId+"']").focusin(function(event){if(event.stopPropagation){event.stopPropagation();}});});}else{document.getElementById(this.minId).innerHTML=this.getMemberFormated(this.min);document.getElementById(this.maxId).innerHTML=this.getMemberFormated(this.max-1);$("[id='"+this.sliderId+"']").slider("option","values",[this.min,this.max-1]);}};RangeCombo.prototype.updateDatePicker=function(){if(!this.init){this.initMin=this.min;this.initMax=this.max;var pMin=document.createElement("p");pMin.className="datePickerSpanMin";var minTextElt=document.createElement("input");this.minTextId=this.id+"_minText";minTextElt.id=this.minTextId;minTextElt.type="text";minTextElt.readOnly=true;minTextElt.className="datePickerInput";var minDateElt=document.createElement("input");this.minId=this.id+"_minDate";minDateElt.id=this.minId;minDateElt.type="text";setStyle(minDateElt,"display: none");
pMin.appendChild(minTextElt);pMin.appendChild(minDateElt);this.HTMLElement.appendChild(pMin);var pMax=document.createElement("p");pMax.className="datePickerSpanMin";var maxTextElt=document.createElement("input");this.maxTextId=this.id+"_maxText";maxTextElt.id=this.maxTextId;maxTextElt.type="text";maxTextElt.readOnly=true;maxTextElt.className="datePickerInput";var maxDateElt=document.createElement("input");this.maxId=this.id+"_maxDate";maxDateElt.id=this.maxId;maxDateElt.type="text";setStyle(maxDateElt,"display: none");pMax.appendChild(maxTextElt);pMax.appendChild(maxDateElt);this.HTMLElement.appendChild(pMax);var obj=this;var minDate=new Date(this.min*1000);var maxDate=new Date((this.max-(24*3600))*1000);$("[id='"+this.minTextId+"']").val(this.getMemberFormated(this.min));$(function(){$.datepicker.setDefaults($.datepicker.regional[getLocale()]);$("[id='"+obj.minId+"']").datepicker({changeMonth:true,changeYear:true,showOn:"button",buttonImage:imgFolder+"16-calendar.png",buttonImageOnly:true,defaultDate:minDate,minDate:minDate,maxDate:maxDate,onSelect:function(date,inst){var t=new Date(inst.selectedYear,inst.selectedMonth,inst.selectedDay).getTime()/1000;
obj.min=t;$("[id='"+obj.minTextId+"']").val(obj.getMemberFormated(t));obj.callChange();}});});$("[id='"+this.maxTextId+"']").val(this.getMemberFormated(this.max-(24*3600)));$(function(){$.datepicker.setDefaults($.datepicker.regional[getLocale()]);$("[id='"+obj.maxId+"']").datepicker({changeMonth:true,changeYear:true,showOn:"button",buttonImage:imgFolder+"16-calendar.png",buttonImageOnly:true,defaultDate:maxDate,minDate:minDate,maxDate:maxDate,onSelect:function(date,inst){var t=new Date(inst.selectedYear,inst.selectedMonth,inst.selectedDay).getTime()/1000;obj.max=t+(24*3600);$("[id='"+obj.maxTextId+"']").val(obj.getMemberFormated(t));obj.callChange();}});});this.init=true;}else{$("[id='"+this.minId+"']").datepicker("setDate",new Date(this.min*1000));$("[id='"+this.minTextId+"']").val(this.getMemberFormated(this.min));var maxUI=this.max-(24*3600);$("[id='"+this.maxId+"']").datepicker("setDate",new Date(maxUI*1000));$("[id='"+this.maxTextId+"']").val(this.getMemberFormated(maxUI));}};RangeCombo.prototype.getMin=function(){return this.min;
};RangeCombo.prototype.getMax=function(){return this.max;};RangeCombo.prototype.getSelectedIndex=function(){if(this.min!=this.initMin||this.max!=this.initMax){return 1;}return -1;};RangeCombo.prototype.getSelectedElements=function(){if(this.min!=this.initMin||this.max!=this.initMax){return[this.min+"-"+this.max];}return[];};RangeCombo.prototype.getSelectedFormatedElements=function(){var curMax=this.max;if(this.isDate){curMax-=(24*3600);}else{curMax-=1;}if(this.min!=this.initMin||this.max!=this.initMax){return[Properties[getLocale()]["From"]+" "+this.getMemberFormated(this.min)+" "+Properties[getLocale()]["To"]+" "+this.getMemberFormated(curMax)];}return[];};RangeCombo.prototype.isLoading=function(){return false;};RangeCombo.prototype.unselectElement=function(member){this.min=this.initMin;this.max=this.initMax;if(this.isDate){$("[id='"+this.minId+"']").datepicker("setDate",new Date(this.min*1000));$("[id='"+this.minTextId+"']").val(this.getMemberFormated(this.min));var maxUI=this.max-(24*3600);
$("[id='"+this.maxId+"']").datepicker("setDate",new Date(maxUI*1000));$("[id='"+this.maxTextId+"']").val(this.getMemberFormated(maxUI));}else{document.getElementById(this.minId).innerHTML=this.getMemberFormated(this.min);document.getElementById(this.maxId).innerHTML=this.getMemberFormated(this.max-1);$("[id='"+this.sliderId+"']").slider("option","values",[this.min,this.max-1]);}this.callChange();};RangeCombo.prototype.unselectAllElements=function(dispatch){this.min=this.initMin;this.max=this.initMax;if(this.isDate){$("[id='"+this.minId+"']").datepicker("setDate",new Date(this.min*1000));$("[id='"+this.minTextId+"']").val(this.getMemberFormated(this.min));var maxUI=this.max-(24*3600);$("[id='"+this.maxId+"']").datepicker("setDate",new Date(maxUI*1000));$("[id='"+this.maxTextId+"']").val(this.getMemberFormated(maxUI));}else{document.getElementById(this.minId).innerHTML=this.getMemberFormated(this.min);document.getElementById(this.maxId).innerHTML=this.getMemberFormated(this.max-1);$("[id='"+this.sliderId+"']").slider("option","values",[this.min,this.max-1]);
}if(dispatch){this.callChange();}};RangeCombo.prototype.selectMember=function(id,dispatch){if(id=="All"){this.unselectAllElements(dispatch);}else{alert("select member on range is not supported");}};RangeCombo.prototype.addElement=function(value,formatedVal,selected){};RangeCombo.prototype.removeAllElements=function(){};videoLocale=null;if(typeof(Properties)=="undefined"){if(ddCtrl){if(!ddCtrl.Properties){ddCtrl.Properties={};}Properties=ddCtrl.Properties;}else{Properties={};}}function setVideoLocale(loc){videoLocale=loc;}function getFallBackLocale(loc){if(Properties[loc]===undefined||Properties[loc]===null){return"en";}return loc;}function setLocale(loc){ddCtrl.ddLang=loc;var jsFile="staticwebcontent/charts/template/scripts/js-localization_"+loc+".js";include_js(jsFile,true,null);}function getLocale(){if(videoLocale!==null){return getFallBackLocale(videoLocale);}if(ddCtrl&&ddCtrl.ddLang!==undefined&&ddCtrl.ddLang!==""){return getFallBackLocale(ddCtrl.ddLang);}if(window&&window.ddLang!==undefined&&window.ddLang!==""){return getFallBackLocale(window.ddLang);
}var locale="",index;if(navigator===undefined||navigator===null){return"en";}if(navigator.language){locale=navigator.language;}else{if(navigator.userLanguage){locale=navigator.userLanguage;}}index=locale.lastIndexOf("-");if(index>0){locale=locale.substring(0,index);}return getFallBackLocale(locale);}function getLocMessage(id){var loc=getLocale();var msg=null;if(Properties[loc]&&Properties[loc][id]){msg=Properties[loc][id];}else{if(Properties.en&&Properties.en[id]){msg=Properties.en[id];}else{msg=id;}}if(arguments.length>1){if(typeof(msg)=="array"){var retMsg=[];for(var e=0;e<msg.length;e++){retMsg[e]=msg[e];for(var i=1;i<arguments.length;i++){retMsg[e]=retMsg[e].replace("%"+i,arguments[i]);}}return retMsg;}else{for(var i=1;i<arguments.length;i++){msg=msg.replace("%"+i,arguments[i]);}}}return msg;}
/*!
 * TimeShift.js version 20160603
 * Copyright 2013 Mobile Wellness Solutions MWS Ltd, Sampo Niskanen
 * Released under the MIT license
 * https://github.com/plaa/TimeShift-js
 * DD: added DST offset support
 */
;
var root=this;var OriginalDate=root.Date;var TimeShift;if(typeof exports!=="undefined"){TimeShift=exports;}else{TimeShift=root.TimeShift={};}var currentTime=undefined;var timezoneOffset=new OriginalDate().getTimezoneOffset();var dstInfo=null;function currentDate(){if(currentTime){return new OriginalDate(currentTime);}else{return new OriginalDate();}}function realLocalToUtc(realLocal){var t=realLocal.getTime();var dstOffset=findDST(Math.round(t/1000));return new OriginalDate(t-realLocal.getTimezoneOffset()*60*1000+(timezoneOffset*60*1000-dstOffset*60*1000));}function utcToLocal(utc){var t=utc.getTime();var dstOffset=findDST(Math.round(t/1000));return new OriginalDate(t-(timezoneOffset*60*1000-dstOffset*60*1000));}function localToUtc(local){var t=local.getTime();var dstOffset=findDST(Math.round(t/1000));return new OriginalDate(t+(timezoneOffset*60*1000-dstOffset*60*1000));}function twoDigit(n){if(n<10){return"0"+n;}else{return""+n;}}function timezoneName(d){var zone="GMT";var t=d.getTime();
var dstOffset=findDST(Math.round(t/1000));var offset=Math.abs(timezoneOffset-dstOffset);if(timezoneOffset-dstOffset<0){zone=zone+"+";}else{if(timezoneOffset-dstOffset>0){zone=zone+"-";}else{return zone;}}return zone+twoDigit(Math.floor(offset/60))+twoDigit(offset%60);}TimeShift.getTimezoneOffset=function(){return timezoneOffset;};TimeShift.setTimezoneOffset=function(offset){timezoneOffset=offset;};TimeShift.setDSTInfo=function(dst){dstInfo=dst;};TimeShift.getTime=function(){return currentTime;};TimeShift.setTime=function(time){currentTime=time;};TimeShift.OriginalDate=OriginalDate;TimeShift.Date=function(){var isConstructor=false;if(this instanceof TimeShift.Date&&!this.__previouslyConstructedByTimeShift){isConstructor=true;this.__previouslyConstructedByTimeShift=true;}if(!isConstructor){return(new TimeShift.Date()).toString();}switch(arguments.length){case 0:this.utc=currentDate();break;case 1:this.utc=new OriginalDate(arguments[0]);break;case 2:this.utc=realLocalToUtc(new OriginalDate(arguments[0],arguments[1]));
break;case 3:this.utc=realLocalToUtc(new OriginalDate(arguments[0],arguments[1],arguments[2]));break;case 4:this.utc=realLocalToUtc(new OriginalDate(arguments[0],arguments[1],arguments[2],arguments[3]));break;case 5:this.utc=realLocalToUtc(new OriginalDate(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4]));break;case 6:this.utc=realLocalToUtc(new OriginalDate(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4],arguments[5]));break;default:this.utc=realLocalToUtc(new OriginalDate(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4],arguments[5],arguments[6]));break;}};TimeShift.Date.prototype.getDate=function(){return utcToLocal(this.utc).getUTCDate();};TimeShift.Date.prototype.getDay=function(){return utcToLocal(this.utc).getUTCDay();};TimeShift.Date.prototype.getFullYear=function(){return utcToLocal(this.utc).getUTCFullYear();};TimeShift.Date.prototype.getHours=function(){return utcToLocal(this.utc).getUTCHours();};TimeShift.Date.prototype.getMilliseconds=function(){return utcToLocal(this.utc).getUTCMilliseconds();
};TimeShift.Date.prototype.getMinutes=function(){return utcToLocal(this.utc).getUTCMinutes();};TimeShift.Date.prototype.getMonth=function(){return utcToLocal(this.utc).getUTCMonth();};TimeShift.Date.prototype.getSeconds=function(){return utcToLocal(this.utc).getUTCSeconds();};TimeShift.Date.prototype.getUTCDate=function(){return this.utc.getUTCDate();};TimeShift.Date.prototype.getUTCDay=function(){return this.utc.getUTCDay();};TimeShift.Date.prototype.getUTCFullYear=function(){return this.utc.getUTCFullYear();};TimeShift.Date.prototype.getUTCHours=function(){return this.utc.getUTCHours();};TimeShift.Date.prototype.getUTCMilliseconds=function(){return this.utc.getUTCMilliseconds();};TimeShift.Date.prototype.getUTCMinutes=function(){return this.utc.getUTCMinutes();};TimeShift.Date.prototype.getUTCMonth=function(){return this.utc.getUTCMonth();};TimeShift.Date.prototype.getUTCSeconds=function(){return this.utc.getUTCSeconds();};TimeShift.Date.prototype.setDate=function(){var d=utcToLocal(this.utc);
d.setUTCDate.apply(d,Array.prototype.slice.call(arguments,0));this.utc=localToUtc(d);};TimeShift.Date.prototype.setFullYear=function(){var d=utcToLocal(this.utc);d.setUTCFullYear.apply(d,Array.prototype.slice.call(arguments,0));this.utc=localToUtc(d);};TimeShift.Date.prototype.setHours=function(){var d=utcToLocal(this.utc);d.setUTCHours.apply(d,Array.prototype.slice.call(arguments,0));this.utc=localToUtc(d);};TimeShift.Date.prototype.setMilliseconds=function(){var d=utcToLocal(this.utc);d.setUTCMilliseconds.apply(d,Array.prototype.slice.call(arguments,0));this.utc=localToUtc(d);};TimeShift.Date.prototype.setMinutes=function(){var d=utcToLocal(this.utc);d.setUTCMinutes.apply(d,Array.prototype.slice.call(arguments,0));this.utc=localToUtc(d);};TimeShift.Date.prototype.setMonth=function(){var d=utcToLocal(this.utc);d.setUTCMonth.apply(d,Array.prototype.slice.call(arguments,0));this.utc=localToUtc(d);};TimeShift.Date.prototype.setSeconds=function(){var d=utcToLocal(this.utc);d.setUTCSeconds.apply(d,Array.prototype.slice.call(arguments,0));
this.utc=localToUtc(d);};TimeShift.Date.prototype.setUTCDate=function(){this.utc.setUTCDate.apply(this.utc,Array.prototype.slice.call(arguments,0));};TimeShift.Date.prototype.setUTCFullYear=function(){this.utc.setUTCFullYear.apply(this.utc,Array.prototype.slice.call(arguments,0));};TimeShift.Date.prototype.setUTCHours=function(){this.utc.setUTCHours.apply(this.utc,Array.prototype.slice.call(arguments,0));};TimeShift.Date.prototype.setUTCMilliseconds=function(){this.utc.setUTCMilliseconds.apply(this.utc,Array.prototype.slice.call(arguments,0));};TimeShift.Date.prototype.setUTCMinutes=function(){this.utc.setUTCMinutes.apply(this.utc,Array.prototype.slice.call(arguments,0));};TimeShift.Date.prototype.setUTCMonth=function(){this.utc.setUTCMonth.apply(this.utc,Array.prototype.slice.call(arguments,0));};TimeShift.Date.prototype.setUTCSeconds=function(){this.utc.setUTCSeconds.apply(this.utc,Array.prototype.slice.call(arguments,0));};TimeShift.Date.prototype.getYear=function(){return this.getFullYear()-1900;
};TimeShift.Date.prototype.setYear=function(v){this.setFullYear(v+1900);};TimeShift.Date.prototype.getTime=function(){return this.utc.getTime();};TimeShift.Date.prototype.setTime=function(v){this.utc.setTime(v);};TimeShift.Date.prototype.getTimezoneOffset=function(){var t=this.utc.getTime();var dstOffset=findDST(Math.round(t/1000));return timezoneOffset-dstOffset;};TimeShift.Date.prototype.toDateString=function(){return utcToLocal(this.utc).toDateString();};TimeShift.Date.prototype.toLocaleDateString=function(){return utcToLocal(this.utc).toLocaleDateString();};TimeShift.Date.prototype.toISOString=function(){return this.utc.toISOString();};TimeShift.Date.prototype.toGMTString=function(){return this.utc.toGMTString();};TimeShift.Date.prototype.toUTCString=function(){return this.utc.toUTCString();};TimeShift.Date.prototype.toString=function(){var wkdays=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];var months=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];var d=utcToLocal(this.utc);
return wkdays[d.getUTCDay()]+" "+months[d.getUTCMonth()]+" "+twoDigit(d.getUTCDate())+" "+d.getUTCFullYear()+" "+twoDigit(d.getUTCHours())+":"+twoDigit(d.getUTCMinutes())+":"+twoDigit(d.getUTCSeconds())+" "+timezoneName(this.utc);};TimeShift.Date.prototype.toLocaleString=function(){return this.toString();};TimeShift.Date.prototype.toLocaleTimeString=function(){return this.toString();};TimeShift.Date.prototype.toTimeString=function(){return this.toString();};TimeShift.Date.prototype.toJSON=function(){return this.utc.toJSON();};TimeShift.Date.prototype.valueOf=function(){return this.utc.getTime();};TimeShift.Date.now=function(){return currentDate().getTime();};TimeShift.Date.parse=OriginalDate.parse;TimeShift.Date.UTC=OriginalDate.UTC;TimeShift.Date.prototype.desc=function(){return"utc="+this.utc.toUTCString()+"   local="+utcToLocal(this.utc).toUTCString()+"   offset="+timezoneOffset;};function findDST(ts){if(ts<=0){return 0;}var dstTZInfo=dstInfo;var s=0;var e=dstTZInfo.ts.length-1;var m=dstTZInfo.startM;
while(true){if(ts>=dstTZInfo.ts[m]&&(m+1>=dstTZInfo.ts.length||ts<dstTZInfo.ts[m+1])){return dstTZInfo.dst[m]*60;}if(ts>dstTZInfo.ts[m]){s=m+1;}else{e=m-1;}m=(s+e)>>1;}return 0;}if(typeof(ddCtrl)!="undefined"&&ddCtrl&&ddCtrl.useTimeshift){Date=TimeShift.Date;TimeShift.setTimezoneOffset(ddCtrl.ddTZInfo.offset);TimeShift.setDSTInfo(ddCtrl.ddTZInfo.dstInfo);}if(typeof(ddCtrl)!="undefined"&&ddCtrl&&typeof(ddCtrl.setTimeZoneOffset)=="undefined"){ddCtrl.setTimeZoneOffset=function(tzInfo){this.ddTZInfo=tzInfo;if(this.ddTZInfo){for(var ts in this.ddTZInfo.tester){var dd=(new TimeShift.OriginalDate((ts-0)*1000));if(dd.getHours()!=this.ddTZInfo.tester[ts]){if(this.ddTZInfo.offset!=-1){if((new TimeShift.OriginalDate()).getTimezoneOffset()!=(this.ddTZInfo.offset+this.ddTZInfo.dstOffset)){Date=TimeShift.Date;TimeShift.setTimezoneOffset(this.ddTZInfo.offset);TimeShift.setDSTInfo(this.ddTZInfo.dstInfo);this.useTimeshift=true;}}return;}}}};}function DDDate(){this.date=new Date();}DDDate.parseDDFunctions={count:0};
DDDate.parseDDRegexes=[];DDDate.DDFormatFunctions={count:0};DDDate.prototype.DDFormat=function(format,loc){DDDate.locale=loc;if(DDDate.DDFormatFunctions[format]===undefined||DDDate.DDFormatFunctions[format]===null){DDDate.createNewDDFormat(format);}var func=DDDate.DDFormatFunctions[format];return this[func]();};DDDate.prototype.setTime=function(time){this.date.setTime(time);};DDDate.prototype.getDate=function(){return this.date.getDate();};DDDate.prototype.getDay=function(){return this.date.getDay();};DDDate.prototype.getFullYear=function(){return this.date.getFullYear();};DDDate.prototype.getHours=function(){return this.date.getHours();};DDDate.prototype.getMinutes=function(){return this.date.getMinutes();};DDDate.prototype.getMonth=function(){return this.date.getMonth();};DDDate.prototype.getSeconds=function(){return this.date.getSeconds();};DDDate.prototype.getTime=function(){return this.date.getTime();};DDDate.prototype.getQuarter=function(){return Math.ceil((this.date.getMonth()+1)/3);
};DDDate.prototype.getSemester=function(){return Math.ceil((this.date.getMonth()+1)/6);};DDDate.prototype.getFullWeekYear=function(){var lastSunOfYear,curYear=this.date.getFullYear(),d2812=new Date(curYear,11,28),sundayShift=d2812.getDay();if(sundayShift==0){sundayShift=7;}sundayShift=7-sundayShift;lastSunOfYear=new Date(curYear,11,28+sundayShift);if(this.date.getTime()>lastSunOfYear.getTime()){curYear++;return curYear;}var mondayOfTheFirstWeekOfYear;curYear=this.date.getFullYear();var d11=new Date(curYear,0,1);thursdayShift=d11.getDay();if(thursdayShift>4){thursdayShift=7+(4-thursdayShift);}else{thursdayShift=4-thursdayShift;}mondayOfTheFirstWeekOfYear=new Date(curYear,0,(1+thursdayShift)-3);if(this.date.getTime()<mondayOfTheFirstWeekOfYear.getTime()){curYear--;return curYear;}return curYear;};DDDate.prototype.getWeek=function(){var curYear,firstDayOfYear,mondayShift;curYear=this.getFullWeekYear();firstDayOfYear=new Date(curYear,0,4);mondayShift=firstDayOfYear.getDay();if(mondayShift==0){mondayShift=7;
}mondayShift--;firstDayOfYear=new Date(Date.UTC(curYear,0,4-mondayShift));var utcDate=new Date(Date.UTC(this.date.getFullYear(),this.date.getMonth(),this.date.getDate()));return Math.floor((utcDate.getTime()-firstDayOfYear.getTime())/(86400000*7))+1;};DDDate.createNewDDFormat=function(format){var funcName="format"+DDDate.DDFormatFunctions.count++,code="DDDate.prototype."+funcName+" = function(){return ",special=false,ch="",ignore=false,str="",i,model,j,s;DDDate.DDFormatFunctions[format]=funcName;for(i=0;i<format.length;++i){ch=format.charAt(i);if(ch==='"'||ch==="'"){if(!ignore){ignore=true;}else{ignore=false;str+=ch;code+=str+" + ";str="";continue;}}if(ignore){str+=ch;}if(!ignore){if(!special&&ch==="\\"){special=true;}else{if(special){special=false;code+="'"+String.escape(ch)+"' + ";}else{model=ch;j=i+1;while(ch===format.charAt(j)&&j<format.length){model+=ch;j++;}i+=model.length-1;code+=DDDate.getDDFormatCode(model);}}}}s=code.substring(0,code.length-3)+";}";if(s.indexOf("this.getWeek()")>-1&&s.indexOf("this.getFullYear()")>-1){s=s.replace("this.getFullYear()","this.getFullWeekYear()");
}eval(s);};DDDate.getDDFormatCode=function(model){switch(model.charAt(0)){case"d":return"String.leftPad(this.getDate(), "+model.length+", '0') + ";case"D":return"String.leftPad(Math.floor((this.getTime() - new Date(this.getFullYear(), 0).getTime()) / (1000*60*60*24)), "+model.length+", '0') + ";case"E":if(model.length>3){return"DDDate.DDDayNames[DDDate.locale][this.getDay()] + ";}return"DDDate.DDDayNames[DDDate.locale][this.getDay()].substring(0, 3) + ";case"M":switch(model.length){case 1:return"(this.getMonth()+1) + ";case 2:return"String.leftPad(this.getMonth() + 1, 2, '0') + ";case 3:return"DDDate.DDMonthNamesShort[DDDate.locale][this.getMonth()] + ";default:return"DDDate.DDMonthNames[DDDate.locale][this.getMonth()] + ";}case"y":case"Y":if(model.length<3){return"('' + this.getFullYear()).substring(2, 4) + ";}return"String.leftPad(this.getFullYear(), "+model.length+", '0') + ";case"H":return"String.leftPad(this.getHours(), "+model.length+", '0') + ";case"h":return"String.leftPad((this.getHours() %12) ? this.getHours() % 12 : 12, "+model.length+", '0') + ";
case"m":return"String.leftPad(this.getMinutes(), "+model.length+", '0') + ";case"s":return"String.leftPad(this.getSeconds(), "+model.length+", '0') + ";case"a":return"(this.getHours() < 12 ? 'AM' : 'PM') + ";case"Q":switch(model.length){case 1:return"this.getQuarter() + ";case 2:return"String.leftPad(this.getQuarter(), "+model.length+", '0') + ";case 3:return"DDDate.DDQuarterLiteNames[DDDate.locale][this.getQuarter()-1] + ";case 4:return"DDDate.DDQuarterNames[DDDate.locale][this.getQuarter()-1] + ";}return"";case"S":switch(model.length){case 1:return"this.getSemester() + ";case 2:return"String.leftPad(this.getSemester(), "+model.length+", '0') + ";case 3:return"DDDate.DDSemesterLiteNames[DDDate.locale][this.getSemester()-1] + ";case 4:return"DDDate.DDSemesterNames[DDDate.locale][this.getSemester()-1] + ";}case"w":return"String.leftPad(this.getWeek(), "+model.length+", '0') + ";default:return"'"+String.escape(model)+"' + ";}};String.escape=function(string){return string.replace(/('|\\)/g,"\\$1");
};String.leftPad=function(val,size,ch){var result=String(val);if(ch===null){ch=" ";}while(result.length<size){result=ch+result;}return result;};DDDate.daysInMonth=[31,28,31,30,31,30,31,31,30,31,30,31];DDDate.DDMonthNames={};DDDate.DDMonthNames.en=["January","February","March","April","May","June","July","August","September","October","November","December"];DDDate.DDMonthNames.fr=["janvier","f\u00E9vrier","mars","avril","mai","juin","juillet","ao\u00FBt","septembre","octobre","novembre","d\u00E9cembre"];DDDate.DDMonthNames.de=["Januar","Februar","M\u00E4rz","April","Mai","Juni","Juli","August","September","Oktober","November","Dezember"];DDDate.DDMonthNames.es=["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"];DDDate.DDMonthNames.it=["Gennaio","Febbraio","Marzo","Aprile","Maggio","Giugno","Luglio","Agosto","Settembre","Ottobre","Novembre","Dicembre"];DDDate.DDMonthNames.nl=["Januari","Februari","Maart","April","Mei","Juni","Juli","Augustus","September","Oktober","November","December"];
DDDate.DDMonthNames.pl=["Styczen","Luty","Marzec","Kwiecien","Maj","Czerwiec","Lipiec","Sierpien","Wrzesien","Pazdziernik","Listopad","Grudzien"];DDDate.DDMonthNames.pt=["Janeiro","Fevereiro","Mar�o","Abril","Maio","Junho","Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"];DDDate.DDMonthNamesShort={};DDDate.DDMonthNamesShort.en=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];DDDate.DDMonthNamesShort.fr=["janv.","f\u00E9vr.","mars","avr.","mai","juin","juil.","ao\u00FBt","sept.","oct.","nov.","d\u00E9c."];DDDate.DDMonthNamesShort.de=["Jan","Feb","M\u00E4r","Apr","Mai","Jun","Jul","Aug","Sep","Okt","Nov","Dez"];DDDate.DDMonthNamesShort.es=["ene","feb","mar","abr","may","jun","jul","ago","sep","oct","nov","dic"];DDDate.DDMonthNamesShort.it=["Gen","Feb","Mar","Apr","Mag","Giu","Lug","Ago","Set","Ott","Nov","Dic"];DDDate.DDMonthNamesShort.nl=["jan","feb","mrt","apr","mei","jun","jul","aug","sep","okt","nov","dec"];DDDate.DDMonthNamesShort.pl=["Sty","Lu","Mar","Kw","Maj","Cze","Lip","Sie","Wrz","Pa","Lis","Gru"];
DDDate.DDMonthNamesShort.pt=["Jan","Fev","Mar","Abr","Mai","Jun","Jul","Ago","Set","Out","Nov","Dez"];DDDate.DDDayNames={};DDDate.DDDayNames.en=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];DDDate.DDDayNames.fr=["Dimanche","Lundi","Mardi","Mercredi","Jeudi","Vendredi","Samedi"];DDDate.DDDayNames.de=["Sonntag","Montag","Dienstag","Mittwoch","Donnerstag","Freitag","Samstag"];DDDate.DDDayNames.es=["Domingo","Lunes","Martes","Mi\u00E9rcoles","Jueves","Viernes","S\u00E1bado"];DDDate.DDDayNames.it=["Domenica","Luned\u00EC","Marted\u00EC","Mercoled\u00EC","Gioved\u00EC","Venerd\u00EC","Sabato"];DDDate.DDDayNames.nl=["Zondag","maandag","Dinsdag","Woensdag","Donderdag","Vrijdag","Zaterdag"];DDDate.DDDayNames.pl=["Niedziela","Poniedzialek","Wtorek","Sroda","Czwartek","Piatek","Sobota"];DDDate.DDDayNames.pt=["Domingo","Segunda-feira","Ter�a-feira","Quarta-feira","Quinta-feira","Sexta-feira","S\u00E1bado"];DDDate.DDQuarterNames={};DDDate.DDQuarterNames.en=["1st quarter","2nd quarter","3rd quarter","4th quarter"];
DDDate.DDQuarterNames.fr=["1er trimestre","2\u00e8me trimestre","3\u00e8me trimestre","4\u00e8me trimestre"];DDDate.DDQuarterNames.de=["1. Quartal","2. Quartal","3. Quartal","4. Quartal"];DDDate.DDQuarterNames.es=["1er trimestre","2do trimestre","3er trimestre","4to trimestre"];DDDate.DDQuarterNames.it=["1o trimestre","2o trimestre","3o trimestre","4o trimestre"];DDDate.DDQuarterNames.nl=["1e kwartaal","2e kwartaal","3e kwartaal","4e kwartaal"];DDDate.DDQuarterNames.pl=["I kwarta\u0142","II kwarta\u0142","III kwarta\u0142","IV kwarta\u0142"];DDDate.DDQuarterNames.pt=["1o trimestre","2o trimestre","3o trimestre","4o trimestre"];DDDate.DDQuarterLiteNames={};DDDate.DDQuarterLiteNames.en=["Q1","Q2","Q3","Q4"];DDDate.DDQuarterLiteNames.fr=["T1","T2","T3","T4"];DDDate.DDQuarterLiteNames.de=["Q1","Q2","Q3","Q4"];DDDate.DDQuarterLiteNames.es=["T1","T2","T3","T4"];DDDate.DDQuarterLiteNames.it=["T1","T2","T3","T4"];DDDate.DDQuarterLiteNames.nl=["K1","K2","K3","K4"];DDDate.DDQuarterLiteNames.pl=["K1","K2","K3","K4"];
DDDate.DDQuarterLiteNames.pt=["T1","T2","T3","T4"];DDDate.DDSemesterNames={};DDDate.DDSemesterNames.en=["1st semester","2nd semester","3rd semester","4th semester"];DDDate.DDSemesterNames.fr=["1er semestre","2\u00e8me semestre","3\u00e8me semestre","4\u00e8me semestre"];DDDate.DDSemesterNames.de=["1. H\u00E4lfte","2. H\u00E4lfte","3. H\u00E4lfte","4. H\u00E4lfte"];DDDate.DDSemesterNames.es=["1er semestre","2do semestre","3er semestre","4to semestre"];DDDate.DDSemesterNames.it=["1o semestre","2o semestre","3o semestre","4o semestre"];DDDate.DDSemesterNames.nl=["1e semester","2e semester","3e semester","4e semester"];DDDate.DDSemesterNames.pl=["I semestr","II semestr","III semestr","IV semestr"];DDDate.DDSemesterNames.pt=["1o semestre","2o semestre","3o semestre","4o semestre"];DDDate.DDSemesterLiteNames={};DDDate.DDSemesterLiteNames.en=["S1","S2","S3","S4"];DDDate.DDSemesterLiteNames.fr=["S1","S2","S3","S4"];DDDate.DDSemesterLiteNames.de=["H1","H2","H3","H4"];DDDate.DDSemesterLiteNames.es=["S1","S2","S3","S4"];
DDDate.DDSemesterLiteNames.it=["S1","S2","S3","S4"];DDDate.DDSemesterLiteNames.nl=["S1","S2","S3","S4"];DDDate.DDSemesterLiteNames.pl=["S1","S2","S3","S4"];DDDate.DDSemesterLiteNames.pt=["S1","S2","S3","S4"];DDDate.y2kYear=50;DDDate.monthNumbers={Jan:0,Feb:1,Mar:2,Apr:3,May:4,Jun:5,Jul:6,Aug:7,Sep:8,Oct:9,Nov:10,Dec:11};DDDate.patterns={ISO8601LongPattern:"Y\\-m\\-d\\TH\\:i\\:sO",ISO8601ShortPattern:"Y\\-m\\-d",ShortDatePattern:"n/j/Y",LongDatePattern:"l, F d, Y",FullDateTimePattern:"l, F d, Y g:i:s A",MonthDayPattern:"F d",ShortTimePattern:"g:i A",LongTimePattern:"g:i:s A",SortableDateTimePattern:"Y-m-d\\TH:i:s",UniversalSortableDateTimePattern:"Y-m-d H:i:sO",YearMonthPattern:"F, Y"};var curWidth=0;var curX=0;var curY=0;var mouseButtonPos="up";var curElement=null;var timer=null;function setPos(id,e){if(isIE()){setPosIE(id,e);}else{setPosFF(id,e);}}function setPosIE(id,e){curX=event.clientX;curY=event.clientY;showHideIframe("hidden");mouseButtonPos="down";if(event){var tempWidth=document.getElementById(id).style.width;
var widthArray=tempWidth.split("p");curWidth=parseInt(widthArray[0]);curElement=document.getElementById(id);}}function setPosFF(id,e){curX=e.clientX;curY=e.clientY;showHideIframe("hidden");mouseButtonPos="down";if(e){var tempWidth=document.getElementById(id).style.width;var widthArray=tempWidth.split("p");curWidth=parseInt(widthArray[0]);curElement=document.getElementById(id);}}function getPos(e){if(mouseButtonPos=="down"){if(timer!=null){clearTimeout(timer);}timer=setTimeout("latchResize()",1000);curEvent=((typeof event=="undefined")?e:event);var newX=curEvent.clientX;var pixelMovement=parseInt(newX-curX);var newWidth=parseInt(curWidth+pixelMovement);newWidth=((newWidth<100)?100:newWidth);if(curElement){curElement.style.width=newWidth+"px";}}else{showHideIframe("inherit");}}function getPosition(element){var left=0;var top=0;var e=element;while(e.offsetParent!=undefined&&e.offsetParent!=null){left+=e.offsetLeft+(e.clientLeft!=null?e.clientLeft:0);top+=e.offsetTop+(e.clientTop!=null?e.clientTop:0);
e=e.offsetParent;}return new Array(left,top);}function showHideIframe(showOrHide){var nodes=document.getElementsByTagName("iframe");for(var i=0;i<nodes.length;i++){var pos=getPosition(nodes[i]);if(isIn(nodes[i],pos[0],pos[1])){var chartHandle=ddCtrl.charts[nodes[i].id];if(chartHandle){if(ddCtrl.widgetIsHidden===undefined||!ddCtrl.widgetIsHidden(chartHandle.portletId)){nodes[i].style.visibility=showOrHide;}}else{nodes[i].style.visibility=showOrHide;}}}}function latchResize(){showHideIframe("visible");}function isIn(element,x,y){var endX=element.offsetWidth+x;var endY=element.offsetHeight+y;if((curY>=y&&curY<=endY)){return true;}return false;}DrillObject=function(id,doc,chart,dmSel,axis,dimExplorer,drillPath,sync,drillOnFilter,drillOnSrcDims){if(id==null||typeof id=="undefined"){return;}this.id=id;this.doc=doc;this.chart=chart;this.dmSel=dmSel;this.axis=axis;this.drillPath=drillPath;this.hierarchy=null;this.frameId=doc.frameId;this.breadPath=new BreadPath();if(dimExplorer){this.dimExplorer=new DimExplorer(dimExplorer.dim,dimExplorer.hPos,dimExplorer.lPos,dimExplorer.enabled,dimExplorer.format);
this.dimsExplorer=new Array();if(this.drillPath){this.drillId=drillPath.name;for(var i=0;i<this.drillPath.dimsExplorer.length;i++){var dimEx=this.drillPath.dimsExplorer[i];this.dimsExplorer.push(dimEx);}}else{this.drillId=dimExplorer.dim.hierarchies[dimExplorer.hPos].id;this.hierarchy=dimExplorer.dim.hierarchies[dimExplorer.hPos];var lPos=dimExplorer.lPos;while(lPos!=-3){this.dimsExplorer.push(new DimExplorer(dimExplorer.dim,dimExplorer.hPos,lPos,dimExplorer.enabled,dimExplorer.format));lPos--;}}if(!chart.removeFilterOnDrillUp){this.initFilter=cloneFilter(this.dmSel.getFilterByDimension(this.dimExplorer.dim));}this.initLevel=dimExplorer.lPos;}this.synchronised=sync;this.initMapIndex=this.chart.currentMapIndex;if(ddCtrl.addDimensionFilterListener){ddCtrl.addDimensionFilterListener(this);}if(ddCtrl.addChartModelReadyListener&&!ddCtrl.isMobile()){ddCtrl.addChartModelReadyListener(this);}this.eltByPos=new Array();this.current=0;this.drillOnFilter=drillOnFilter;this.drillOnSrcDims=drillOnSrcDims;
ddCtrl.drillUpdateOnFilter=true;};DrillObject.prototype.unregister=function(){ddCtrl.removeDimensionFilterListener(this);ddCtrl.removeChartModelReadyListener(this);};DrillObject.prototype.onDimensionFilter=function(dimId,hierarchyId,levelId,members,membersFormated){if(ddCtrl.drillUpdateOnFilter){var dim=this.dmSel.dm.getDimensionById(dimId);if(!dim||this.dmSel.dimensionsToExcludeForNavigation[dim.id]){return;}if(this.drillOnFilter&&members.length==1){var breadPath=this.getBreadPathFromFilter(dimId,hierarchyId,levelId,members);if(breadPath){this.drillTo(breadPath,true);}}else{var currentBreadPathElt=this.breadPath.elements[this.current-1];if(currentBreadPathElt){var changed=this.updateBreadPathElt(currentBreadPathElt,dimId,hierarchyId,levelId,members,membersFormated);if(changed){this.current=0;this.redrawBreadCrumb(this.breadPath);}}}}};DrillObject.prototype.getBreadPathFromFilter=function(dimId,hierarchyId,levelId,members){if(this.drillPath){return this.getBreadPathFromFilter_DrillPath(dimId,hierarchyId,levelId,members);
}else{if(this.hierarchy.type==HIERARCHY_DIMENSION&&this.drillOnSrcDims){return this.getBreadPathFromFilter_HierarchyAuto(dimId,hierarchyId,levelId,members);}else{if(this.dimExplorer.dim.id==dimId&&hierarchyId==this.hierarchy.id){return this.getBreadPathFromFilter_Hierarchy(dimId,hierarchyId,levelId,members);}else{return null;}}}};DrillObject.prototype.getBreadPathFromFilter_Hierarchy=function(dimId,hierarchyId,levelId,members){if(members[0]=="All"){if(this.breadPath.elements.length>0){return new BreadPath();}else{return null;}}var dm=this.dmSel.dm;var dim=dm.getDimensionById(dimId);var dmsel=new DataModelSelection();dmsel.attachedDM(dm);var hPos=-1;var lPos=-1;for(var iH=0;iH<dim.hierarchies.length;iH++){if(dim.hierarchies[iH].id==this.hierarchy.id){hPos=iH;break;}}for(var iL=0;iL<this.hierarchy.levels.length;iL++){if(this.hierarchy.levels[iL].id==levelId){lPos=iL;break;}}var iCol=1;var nbLevels=this.hierarchy.levels.length;for(var i=this.initLevel;i>=lPos;i--){dmsel.addBrowse(iCol,dim,hPos,i);
iCol++;}var filter=getFilter(dim,hierarchyId,levelId,members);dmsel.setFilter(filter);var cubRes=null;try{cubRes=dm.getDataFromSelection(dmsel,this);}catch(errObj){if(ddCtrl.checkSession&&(errObj.errorCode==401||errObj.errorCode==403)){ddCtrl.checkSession();}else{alert(errObj.errorMsg);}}if(cubRes!=null&&cubRes.linesCnt>0){var rowSet=cubRes.getRowSet({},false);var rowSetFormated=cubRes.getRowSet({},true);if(rowSet.length==1){var row=rowSet[0];var rowFormated=rowSetFormated[0];var curLvl=this.initLevel;var breadPath=new BreadPath();var mapIndex=this.initMapIndex;for(var i=0;i<row.length;i++){var value=row[i];var valueFormated=rowFormated[i];var hFilter=hPos;var lFilter=curLvl;var hExpl=hPos;var lExpl=curLvl-1;if(lExpl>=-1){filter=getFilter(dim,hFilter,lFilter,[value]);var breadPathElt=new BreadPathElement(value,valueFormated,null,filter,dim.id,hFilter,lFilter,dim.id,hExpl,lExpl);if(typeof(mapIndex)!="undefined"){mapIndex++;breadPathElt.mapIndex=mapIndex;}breadPath.pushElement(breadPathElt);
}curLvl--;}return breadPath;}}return null;};DrillObject.prototype.getBreadPathFromFilter_HierarchyAuto=function(dimId,hierarchyId,levelId,members){var dm=this.dmSel.dm;var dimFilter=dm.getDimensionById(dimId);var dim=this.dimExplorer.dim;var dmsel=new DataModelSelection();dmsel.attachedDM(dm);if(dim.id!=dimFilter.id&&hierarchyId!=null&&levelId!=null&&levelId!="root"){return null;}if(this.drillOnSrcDims&&dim.id==dimFilter.id){return null;}var bFind=false;var hPos=-1;var lPos=-1;for(var iH=0;iH<dim.hierarchies.length;iH++){if(dim.hierarchies[iH].id==this.hierarchy.id){hPos=iH;break;}}if(dim.id==dimFilter.id&&hierarchyId==this.hierarchy.id){for(var iL=0;iL<this.hierarchy.levels.length;iL++){if(this.hierarchy.levels[iL].id==levelId){lPos=iL;bFind=true;break;}}}else{if(ddCtrl.isDimensionFiltered(dim.id,dim.continuous)){lPos=-1;bFind=true;}else{for(var iL=0;iL<this.hierarchy.levels.length;iL++){if(this.hierarchy.levels[iL].id==dimId){bFind=true;}var curDim=dm.getDimensionById(this.hierarchy.levels[iL].id);
if(curDim){var isFiltered=ddCtrl.isDimensionFiltered(curDim.id,curDim.continuous);if(isFiltered&&lPos==-1){lPos=iL;}}}}}if(bFind){if(members.length==1&&members[0]!="All"){var filter=getFilter(dimFilter,hierarchyId,levelId,members);dmsel.setFilter(filter);}for(var i=0;i<this.hierarchy.levels.length;i++){var level=this.hierarchy.levels[i];if(level.id!=dimId){var dimPanel=ddCtrl.getDimPanel(level.id,dim.continuous);var mbrs=ddCtrl.getDimensionFilter(level.id,dim.continuous);if(dimPanel&&mbrs.length==1&&mbrs[0]!="All"){var dimFilter=dm.getDimensionById(level.id);if(dimPanel.getSelectedLevelIndex()==-1){var f=getFilter(dimFilter,-1,-1,mbrs);dmsel.setFilter(f);}}}}if(dmsel.dimsToFilter.length>0){if(dmsel.dimsToFilter.length==(this.hierarchy.levels.length+1)){var breadPath=new BreadPath();var mapIndex=this.initMapIndex;var curLvl=this.hierarchy.levels.length-1;for(var i=this.hierarchy.levels.length-1;i>=-1;i--){var hFilter=hPos;var lFilter=curLvl;var hExpl=hPos;var lExpl=curLvl-1;if(lExpl>=-1){if(curLvl>=0){var level=this.hierarchy.levels[curLvl];
var dimFilter=dm.getDimensionById(level.id);hFilter=-1;lFilter=-1;}else{dimFilter=dim;}var dimPanel=ddCtrl.getDimPanel(dimFilter.id,dimFilter.continuous);var value=dimPanel.getSelectedElements()[0];var valueFormated=dimPanel.getSelectedFormatedElements()[0];var filter=dmsel.filterByDimName[dimFilter.id];var breadPathElt=new BreadPathElement(value,valueFormated,null,filter,dimFilter.id,-1,-1,dim.id,hExpl,lExpl);if(typeof(mapIndex)!="undefined"){mapIndex++;breadPathElt.mapIndex=mapIndex;}breadPath.pushElement(breadPathElt);}curLvl--;lExpl--;}return breadPath;}else{var iCol=1;for(var i=this.initLevel;i>=lPos;i--){dmsel.addBrowse(iCol,dim,hPos,i);iCol++;}var cubRes=null;try{cubRes=dm.getDataFromSelection(dmsel,this);}catch(errObj){if(ddCtrl.checkSession&&(errObj.errorCode==401||errObj.errorCode==403)){ddCtrl.checkSession();}else{alert(errObj.errorMsg);}}if(cubRes!=null&&cubRes.linesCnt>0){var rowSet=cubRes.getRowSet({},false);var rowSetFormated=cubRes.getRowSet({},true);if(rowSet.length==1){var row=rowSet[0];
var rowFormated=rowSetFormated[0];var curLvl=this.initLevel;var breadPath=new BreadPath();var mapIndex=this.initMapIndex;for(var i=0;i<row.length;i++){var value=row[i];var valueFormated=rowFormated[i];var hFilter=hPos;var lFilter=curLvl;var hExpl=hPos;var lExpl=curLvl-1;if(lExpl>=-1){if(curLvl>=0){var level=this.hierarchy.levels[curLvl];var dimFilter=dm.getDimensionById(level.id);hFilter=-1;lFilter=-1;}else{dimFilter=dim;}var filter=dmsel.filterByDimName[dimFilter.id];if(!filter){filter=getFilter(dimFilter,hFilter,lFilter,[value]);}var breadPathElt=new BreadPathElement(value,valueFormated,null,filter,dimFilter.id,hFilter,lFilter,dim.id,hExpl,lExpl);if(typeof(mapIndex)!="undefined"){mapIndex++;breadPathElt.mapIndex=mapIndex;}breadPath.pushElement(breadPathElt);}curLvl--;}return breadPath;}}}}else{return new BreadPath();}}return null;};DrillObject.prototype.getBreadPathFromFilter_DrillPath=function(dimId,hierarchyId,levelId,members){var bFound=false;for(var i=0;i<this.drillPath.dimsExplorer.length;
i++){var dimEx=this.drillPath.dimsExplorer[i];var dim=dimEx.dim;if(dim.id==dimId){bFound=true;break;}}if(!bFound){return null;}var breadPath=new BreadPath();for(var i=0;i<this.drillPath.dimsExplorer.length;i++){var dimEx=this.drillPath.dimsExplorer[i];var dimFilter=dimEx.dim;if(ddCtrl.isDimensionFiltered(dimFilter.id,dimFilter.continuous)){var dimPanel=ddCtrl.getDimPanel(dimFilter.id,dimFilter.continuous);var hlPos=getHierarchyLevelPos(dimFilter,dimPanel.getSelectedHierarchyId(),dimPanel.getSelectedLevelId());var hFilter=hlPos[0];var lFilter=hlPos[1];if((dimEx.hPos==hFilter&&dimEx.lPos==lFilter)||(dimEx.lPos==-1&&lFilter==-1)){var mbrs=dimPanel.getSelectedElements();var mbrsF=dimPanel.getSelectedFormatedElements();var filter=getFilter(dimFilter,hFilter,lFilter,mbrs);var nextDimEx=this.drillPath.dimsExplorer[i+1];if(nextDimEx){var breadPathElt=new BreadPathElement(mbrs[0],mbrsF[0],null,filter,dimFilter.id,hFilter,lFilter,nextDimEx.dim.id,nextDimEx.hPos,nextDimEx.lPos);breadPath.pushElement(breadPathElt);
}}}else{break;}}if(breadPath.elements.length>0){return breadPath;}else{return new BreadPath();}};DrillObject.prototype.onChartModelReady=function(doc,dm,dmsel,chart){if(this.frameId==doc.frameId){this.doc=doc;this.chart=chart;this.dmSel=dmsel;this.current=0;if(this.drillPath){for(var axisId in dmsel.drillPaths){var dPath=dmsel.drillPaths[axisId];if(dPath&&dPath.name==this.drillPath.name){this.drillPath=dPath;break;}}this.drillPath.dPos=0;}var breadPath=this.breadPath;this.createBreadCrumb(true);this.initDrill(breadPath);}};DrillObject.prototype.updateBreadPathElt=function(breadPathElt,dimId,hierarchyId,levelId,members,membersFormated){var dimFilter=this.dmSel.dm.getDimensionById(breadPathElt.dimFilter);var dimExpl=this.dmSel.dm.getDimensionById(breadPathElt.dimExpl);if(dimFilter.id==dimId&&!this.dmSel.dimensionsToExcludeForNavigation[dimFilter]&&this.isSameHierarchyLevel(dimFilter,breadPathElt.hFilter,breadPathElt.lFilter,hierarchyId,levelId)){breadPathElt.member=members[0];breadPathElt.members=members;
breadPathElt.memberFormated=membersFormated[0];breadPathElt.membersFormated=membersFormated;if(members[0]=="All"){breadPathElt.member=null;breadPathElt.members=new Array();breadPathElt.memberFormated=Properties[getLocale()]["All"];breadPathElt.membersFormated=new Array();}if(this.drillPath){if(members&&members.length>1){breadPathElt.memberCaption=dimExpl.name+"...";}else{breadPathElt.memberCaption=dimExpl.name+" ("+breadPathElt.memberFormated+")";}}else{if(members&&members.length>1){if(this.hierarchy.type==HIERARCHY_DIMENSION){breadPathElt.memberCaption=dimFilter.name+"...";}else{var levelName=dimFilter.hierarchies[breadPathElt.hFilter].levels[breadPathElt.lFilter].name;breadPathElt.memberCaption=levelName+"...";}}else{breadPathElt.memberCaption=breadPathElt.memberFormated;}}return true;}return false;};DrillObject.prototype.isSameHierarchyLevel=function(dim,hPos,lPos,hierarchyId,levelId){if(hPos==-1&&hierarchyId==null){return true;}else{if(lPos==-1&&levelId==null){return true;}else{if(dim.hierarchies[hPos]&&dim.hierarchies[hPos].id==hierarchyId&&dim.hierarchies[hPos].levels[lPos]&&dim.hierarchies[hPos].levels[lPos].id==levelId){return true;
}}}return false;};DrillObject.prototype.getDimId=function(){return this.dimExplorer.dim.id;};DrillObject.prototype.getCurrentDimId=function(){if(this.breadPath!=null&&this.breadPath.last()!=null){var curBreadPathElt=this.breadPath.last();return curBreadPathElt.dimExpl;}else{return this.dimExplorer.dim.id;}};DrillObject.prototype.getCurrentHierarchyId=function(){var dimId=null;var hPos=-1;var lPos=-1;if(this.breadPath!=null&&this.breadPath.last()!=null){var curBreadPathElt=this.breadPath.last();dimId=curBreadPathElt.dimExpl;hPos=curBreadPathElt.hExpl;lPos=curBreadPathElt.lExpl;}else{dimId=this.dimExplorer.dim.id;hPos=this.dimExplorer.hPos;lPos=this.dimExplorer.lPos;}var dim=this.dmSel.dm.getDimensionById(dimId);if(dim&&dim.hierarchies[hPos]){return dim.hierarchies[hPos].id;}return null;};DrillObject.prototype.getCurrentLevelId=function(){var dimId=null;var hPos=-1;var lPos=-1;if(this.breadPath!=null&&this.breadPath.last()!=null){var curBreadPathElt=this.breadPath.last();dimId=curBreadPathElt.dimExpl;
hPos=curBreadPathElt.hExpl;lPos=curBreadPathElt.lExpl;}else{dimId=this.dimExplorer.dim.id;hPos=this.dimExplorer.hPos;lPos=this.dimExplorer.lPos;}var dim=this.dmSel.dm.getDimensionById(dimId);if(dim&&dim.hierarchies[hPos]&&dim.hierarchies[hPos].levels[lPos]){return dim.hierarchies[hPos].levels[lPos].id;}return null;};DrillObject.prototype.isSameDrill=function(drillObject){if(this.drillPath){if(this.drillPath.equals(drillObject.drillPath)){return true;}}else{if(this.dimExplorer){if(this.id==drillObject.id&&this.getCurrentDimId()==drillObject.getCurrentDimId()&&this.dimExplorer.hierarchy.id==drillObject.dimExplorer.hierarchy.id&&this.dimExplorer.hierarchy.levels.length==drillObject.dimExplorer.hierarchy.levels.length&&this.initLevel==drillObject.initLevel){return true;}}else{if(this.initMapIndex==drillObject.initMapIndex){return true;}}}return false;};DrillObject.prototype.createBreadCrumb=function(bremove){var obj=this;var id=this.frameId+"_breadcrumb";var elt=document.getElementById(id);
if(elt){var i=0;var nodes=elt.childNodes;elt.style.display="block";var frame=document.getElementById(this.frameId);if(frame&&frame.contentWindow){if(frame.contentWindow.addEventListener){frame.contentWindow.addEventListener("resize",function(){obj.recalcWidth();},true);}else{if(frame.contentWindow.attachEvent){frame.contentWindow.attachEvent("resize",function(){obj.recalcWidth();});}}}if(bremove){while(i<nodes.length){elt.removeChild(nodes[i]);}var divImg=document.createElement("div");divImg.setAttribute("id","resetImg_"+this.frameId);divImg.className="breadcrumbImg";divImg.onclick=function(){ddCtrl.resetChart(obj.frameId,obj.id,obj.synchronised);};elt.appendChild(divImg);}else{var divSep=document.createElement("div");setStyle(divSep,"display: inline");var sepGroup=document.createElement("span");sepGroup.className="breadsep";divSep.appendChild(sepGroup);elt.appendChild(divSep);}var breadGroup=document.createElement("div");breadGroup.id=this.frameId+"_"+this.id;breadGroup.className="breadcrumbTxt";
elt.appendChild(breadGroup);var hierarchyElt=document.createElement("em");hierarchyElt.className="unclickablebreadcrumb";var hierarchyText;if(this.drillPath){hierarchyText=this.drillPath.name;}else{hierarchyText=this.dimExplorer.hierarchy.name;}hierarchyElt.appendChild(document.createTextNode(hierarchyText));breadGroup.appendChild(hierarchyElt);var spanISep=document.createElement("span");spanISep.className="breadspan";spanISep.innerHTML=" ";breadGroup.appendChild(spanISep);var levelElt=document.createElement("em");levelElt.pos=0;var levelText;if(this.drillPath){levelText=this.drillPath.dimsExplorer[0].dim.name;}else{levelText=this.dimExplorer.hierarchy.levels[this.dimExplorer.lPos].name;}levelElt.appendChild(document.createTextNode(levelText));levelElt.member=levelText;levelElt.memberFormated=levelText;this.eltByPos[0]=levelElt;breadGroup.appendChild(levelElt);var frameElt=document.getElementById(this.frameId);var contentElt=document.getElementById(this.frameId.replace("frame","content"));
if(frameElt!=null){if(contentElt==frameElt||contentElt==null){contentElt=frameElt.parentNode;}if(contentElt!=null&&contentElt.style.height!=""){if(contentElt.style.height.indexOf("%")<0){var height=parseInt(contentElt.style.height)-elt.clientHeight;frameElt.style.height=height+"px";frameElt.style.top=elt.clientHeight+"px";if((isIE()&&BrowserDetect.version<9)||isSafari()){frameElt.style.width="99%";setTimeout(function(){docElt.style.width="100%";},0);}}}}}};DrillObject.prototype.addToBreadCrumb=function(dimEx,member,memberFormated,caption,lastDrillUnclickable,filter,mapIndex){this.current++;var obj=this;var id=this.frameId+"_"+this.id;var elt=document.getElementById(id);if(elt){var lastChildIndex=elt.childNodes.length-1;var lastChild=elt.childNodes[lastChildIndex];lastChild.index=lastChildIndex;if(!lastDrillUnclickable){lastChild.onclick=function(){ddCtrl.rewind(obj.frameId,obj.id,this.member,this.pos,obj.synchronised);};lastChild.className="clickablebreadcrumb";}var txt=member;if(memberFormated&&memberFormated!=null){txt=memberFormated;
}var memberElt=document.createElement("em");memberElt.id=id+"_"+member;if(typeof(caption)!="undefined"&&caption!=null){txt=caption;}memberElt.appendChild(document.createTextNode(txt));memberElt.pos=this.current;memberElt.member=member;this.eltByPos[this.current]=memberElt;var spanISep=document.createElement("span");spanISep.className="breadspan";elt.appendChild(spanISep);elt.appendChild(memberElt);if(typeof(filter)=="undefined"||filter==null){filter=cloneFilter(this.dmSel.getFilterByDimension(dimEx.dim));}else{filter=cloneFilter(filter);}var currentMapIndex=-1;if(typeof(mapIndex)!="undefined"){currentMapIndex=mapIndex;}else{currentMapIndex=this.chart.currentMapIndex;}this.breadPath.pushElement(new BreadPathElement(member,memberFormated,caption,filter,filter.dim.id,filter.hierarchy,filter.level,dimEx.dim.id,dimEx.hPos,dimEx.lPos,currentMapIndex));}};DrillObject.prototype.recalcWidth=function(){var elt=document.getElementById(this.frameId+"_"+this.id);if(elt){var divBreadcrumb=document.getElementById(this.frameId+"_breadcrumb");
for(var i=0;i<elt.childNodes.length;i++){elt.childNodes[i].style.display="inherit";if(elt.childNodes[i].innerHTML=="..."){elt.removeChild(elt.childNodes[i]);}}if(elt.offsetWidth>divBreadcrumb.offsetWidth){var i=0;while((elt.offsetWidth+30)>divBreadcrumb.offsetWidth&&i<elt.childNodes.length-1){elt.childNodes[i].style.display="none";i++;}var prevElt=document.createElement("em");prevElt.className="clickablebreadcrumb";prevElt.innerHTML="...";prevElt.setAttribute("title",getLocMessage("DrillUp"));var obj=this;prevElt.onclick=function(){if(obj.current>0){ddCtrl.rewind(obj.frameId,obj.id,obj.eltByPos[obj.current-1].member,obj.current-1,obj.synchronised);}};elt.insertBefore(prevElt,elt.childNodes[i]);}var tooltip=null;if(this.drillPath){tooltip=this.drillPath.name;tooltip+=" > "+this.drillPath.dimsExplorer[0].dim.name;}else{tooltip=this.dimExplorer.hierarchy.name;tooltip+=" > "+this.dimExplorer.hierarchy.levels[this.dimExplorer.lPos].name;}if(this.breadPath&&this.breadPath.elements){for(var i=0;
i<this.breadPath.elements.length;i++){var breadPathElt=this.breadPath.elements[i];var mbr=breadPathElt.member;if(breadPathElt.memberCaption!=null&&breadPathElt.memberCaption.length>0){mbr=breadPathElt.memberCaption;}else{if(breadPathElt.memberFormated!=null&&breadPathElt.memberFormated.length>0){mbr=breadPathElt.memberFormated;}}tooltip+=" > "+mbr;}}divBreadcrumb.setAttribute("title",tooltip);}};DrillObject.prototype.drill=function(member,memberFormated){if(this.drillPath){this.drillDrillPath(member,memberFormated);}else{var dimId=this.dimExplorer.dim.id;var dimEx=this.dmSel.getDimExplorerByDimId(dimId);if(dimEx.dim.continuous){this.drillContinuous(dimEx,member,memberFormated);}else{this.drillDiscrete(dimEx,member,memberFormated);}}};DrillObject.prototype.drillDiscrete=function(dimEx,member,memberFormated){if(typeof(this.chart.currentMapIndex)!="undefined"){this.dmSel.lastDrillMember=member;this.dmSel.lastDrillObject=member;this.chart.currentMapIndex++;}var lvl=dimEx.hierarchy.levels[dimEx.lPos];
var gPos=lvl.getMemberPosById(member);var caption=dimEx.captions[gPos];dimEx.lPos--;dimEx.prepare();this.dmSel.updated=true;var dimFilter=dimEx.dim;var drillSrcDim=false;if(this.drillOnSrcDims&&this.hierarchy.type==HIERARCHY_DIMENSION&&lvl&&this.dmSel.dm.getDimensionById(lvl.id)!=null){dimFilter=this.dmSel.dm.getDimensionById(lvl.id);drillSrcDim=true;}var filter=null;if(!drillSrcDim){filter=new FilterSelection(dimFilter,dimEx.hPos,dimEx.lPos+1,[gPos],[member]);}else{filter=new FilterSelection(dimFilter,-1,-1,getMemberPos(dimFilter,-1,-1,[member]),[member]);}this.addToBreadCrumb(dimEx,member,memberFormated,caption,false,filter);this.recalcWidth();if(this.dmSel.dimensionsToExcludeForNavigation[dimEx.dim.id]){this.dmSel.setFilter(filter);this.doc.refreshDM();}else{var panel=null;var hierarchyId=null;var levelId=null;if(!drillSrcDim){if(dimEx.hierarchy&&dimEx.hierarchy.levels[dimEx.lPos+1]){hierarchyId=dimEx.hierarchy.id;levelId=dimEx.hierarchy.levels[dimEx.lPos+1].id;}panel=ddCtrl.getDimPanel(dimEx.dim.id,dimEx.dim.continuous);
}else{panel=ddCtrl.getDimPanel(dimFilter.id,dimFilter.continuous);}if(panel){panel.selectMembers(hierarchyId,levelId,[member],[memberFormated],true,false);}}if(typeof(this.chart.currentMapIndex)!="undefined"){for(var i=0;i<this.breadPath.elements.length-1;i++){var mapDefParent=this.chart.getMapDefinitionByIndex(this.breadPath.elements[i].mapIndex-1);var nameParent=mapDefParent.name;this.chart.selectedItemInMap["%"+nameParent+"%"]=this.breadPath.elements[i].member;}}};DrillObject.prototype.drillContinuous=function(dimEx,member,memberFormated){var lvl=dimEx.hierarchy.levels[dimEx.lPos];var gPos=lvl.getMemberPosById(member);var caption=dimEx.captions[gPos];var fMin=lvl.fMin;var fMax=lvl.fMax;var explicit=false;if(!fMin){explicit=true;fMin=lvl.groups[gPos].minfval;fMax=lvl.groups[gPos].maxfval;}dimEx.lPos--;dimEx.prepare();this.dmSel.updated=true;var s=member;if(!explicit){s=member-0;}var filter=getFilterContinuous(this.dmSel,dimEx.dim,dimEx.hPos,dimEx.lPos+1,fMin,fMax,s);this.addToBreadCrumb(dimEx,member,memberFormated,caption,false,filter);
this.recalcWidth();if(this.dmSel.dimensionsToExcludeForNavigation[dimEx.dim.id]){this.dmSel.setFilter(filter);this.doc.refreshDM();}else{if(!isNaN(filter.min)&&!isNaN(filter.max)){ddCtrl.setFilterRange(dimEx.dim.id,filter.min,filter.max);}else{var hierarchyId=null;var levelId=null;if(dimEx.hierarchy&&dimEx.hierarchy.levels[dimEx.lPos+1]){hierarchyId=dimEx.hierarchy.id;levelId=dimEx.hierarchy.levels[dimEx.lPos+1].id;}var panel=ddCtrl.getDimPanel(dimEx.dim.id,dimEx.dim.continuous);if(panel){panel.selectMembers(hierarchyId,levelId,[member],[memberFormated],true,false);}var panel=ddCtrl.getDimPanel(dimEx.dim.id,dimEx.dim.continuous);if(panel){panel.selectMembers(hierarchyId,levelId,[member],memberFormated,true,false);}}}};DrillObject.prototype.drillDrillPath=function(member,memberFormated){if(typeof(this.chart.currentMapIndex)!="undefined"){this.dmSel.lastDrillMember=member;this.dmSel.lastDrillObject=member;this.chart.currentMapIndex++;}var dimEx=this.drillPath.dimsExplorer[this.drillPath.dPos];
this.drillPath.dPos++;var newDimEx=this.drillPath.dimsExplorer[this.drillPath.dPos];this.dmSel.updated=true;var filter;if(dimEx.dim.continuous){var fMin;var explicit=false;if(dimEx.lPos>0){var lvl=dimEx.hierarchy.levels[dimEx.lPos];var gPos=lvl.getMemberPosById(member);fMin=lvl.fMin;var fMax=lvl.fMax;if(!fMin){explicit=true;fMin=lvl.groups[gPos].minfval;fMax=lvl.groups[gPos].maxfval;}}var s=member;if(!explicit){s=member-0;}filter=getFilterContinuous(this.dmSel,dimEx.dim,dimEx.hPos,dimEx.lPos,fMin,fMax,s);}else{var gPos=getMemberPos(dimEx.dim,dimEx.hPos,dimEx.lPos,[member]);filter=new FilterSelection(dimEx.dim,dimEx.hPos,dimEx.lPos,gPos,[member]);}var txt=newDimEx.dim.name+" ("+memberFormated+")";this.addToBreadCrumb(newDimEx,member,memberFormated,txt,false,filter);this.recalcWidth();newDimEx.prepare();this.dmSel.replaceDimExplorer(this.axis,newDimEx);if(this.dmSel.dimensionsToExcludeForNavigation[dimEx.dim.id]){this.dmSel.setFilter(filter);this.doc.refreshDM();}else{if(!isNaN(filter.min)&&!isNaN(filter.max)){ddCtrl.setFilterRange(dimEx.dim.id,filter.min,filter.max);
}else{var hierarchyId=null;var levelId=null;if(dimEx.hierarchy&&dimEx.hierarchy.levels[dimEx.lPos]){hierarchyId=dimEx.hierarchy.id;levelId=dimEx.hierarchy.levels[dimEx.lPos].id;}var panel=ddCtrl.getDimPanel(dimEx.dim.id,dimEx.dim.continuous);if(panel){panel.selectMembers(hierarchyId,levelId,[member],[memberFormated],true,false);}}}if(typeof(this.chart.currentMapIndex)!="undefined"){for(var i=0;i<this.breadPath.elements.length-1;i++){var mapDefParent=this.chart.getMapDefinitionByIndex(this.breadPath.elements[i].mapIndex-1);var nameParent=mapDefParent.name;this.chart.selectedItemInMap["%"+nameParent+"%"]=this.breadPath.elements[i].member;}}};DrillObject.prototype.getCurrentDimExplorer=function(){if(this.breadPath!=null&&this.breadPath.last()!=null){return this.getDimExplorer(this.breadPath.last());}else{return this.dimExplorer;}};DrillObject.prototype.getDimExplorer=function(breadPathElt){var dim=this.dmSel.dm.getDimensionById(breadPathElt.dimExpl);var dimEx=new DimExplorer(dim,breadPathElt.hExpl,breadPathElt.lExpl,true);
return dimEx;};DrillObject.prototype.removeZoom=function(chart){if(chart){if(chart.scrollWheel||chart.zoomWheel||chart.scrollWheelV||chart.zoomWheelV){if(chart.subCharts&&chart.subCharts.length>0){for(var i=0;i<chart.subCharts.length;i++){if(ddCtrl&&ddCtrl.infoZoom&&ddCtrl.infoZoom[chart.subCharts[i].flowId+"-"+chart.subCharts[i].id]){ddCtrl.infoZoom[chart.subCharts[i].flowId+"-"+chart.subCharts[i].id]=null;}}}}}};DrillObject.prototype.rewind=function(member,pos){var element=this.eltByPos[pos];this.removeZoom(this.chart);if(typeof(this.chart.currentMapIndex)!="undefined"){this.dmSel.lastDrillObject=null;this.dmSel.lastDrillMember=null;this.chart.currentMapIndex=this.initMapIndex+pos;}this.removeFromBreadCrumb(element,element.parentNode);if(pos>0){var currentBreadElt=this.breadPath.elements[pos-1];var newDimEx=this.getDimExplorer(currentBreadElt);this.dmSel.replaceDimExplorer(this.axis,newDimEx);var filter=currentBreadElt.filter;if(typeof(this.chart.currentMapIndex)!="undefined"){this.dmSel.lastDrillObject=member;
this.dmSel.lastDrillMember=member;}for(var i=pos;i<this.breadPath.elements.length;i++){var breadElt=this.breadPath.elements[i];if(this.dmSel.dimensionsToExcludeForNavigation[breadElt.filter.dim.id]){this.dmSel.removeFilterByDimension(breadElt.filter.dim);}else{var filterOperand=new FilterOperand(breadElt.filter.dim.id,"All",breadElt.hFilter,breadElt.lFilter);ddCtrl.filter(filterOperand);}}if(this.dmSel.dimensionsToExcludeForNavigation[filter.dim.id]){this.dmSel.setFilter(filter);}else{if(!isNaN(filter.min)&&!isNaN(filter.max)){ddCtrl.setFilterRange(filter.dim.id,filter.min,filter.max,filter.hierarchy,filter.level);}else{var filterOperand=new FilterOperand(filter.dim.id,member,filter.hierarchy,filter.level);ddCtrl.filter(filterOperand);}}}else{this.dmSel.replaceDimExplorer(this.axis,this.dimExplorer);for(var i=pos;i<this.breadPath.elements.length;i++){var breadElt=this.breadPath.elements[i];if(this.dmSel.dimensionsToExcludeForNavigation[breadElt.filter.dim.id]){this.dmSel.removeFilterByDimension(breadElt.filter.dim);
}else{var filterOperand=new FilterOperand(breadElt.filter.dim.id,"All",breadElt.hFilter,breadElt.lFilter);ddCtrl.filter(filterOperand);}}if(this.initFilter){this.dmSel.setFilter(this.initFilter);}this.breadPath=new BreadPath();}this.current=pos;if(this.drillPath){this.drillPath.dPos=this.current;}this.breadPath.cut(pos);this.recalcWidth();};DrillObject.prototype.removeFromBreadCrumb=function(memberElt,breadElement){var nodes=breadElement.childNodes;for(var i=nodes.length-1;i>=0;i--){if(memberElt==nodes[i]){break;}else{breadElement.removeChild(nodes[i]);}}breadElement.childNodes[nodes.length-1].className="";};DrillObject.prototype.resetChart=function(doNotUpdate){if(!doNotUpdate){ddCtrl.beginSelection();}if(this.current>0){this.drillTo(null);}if(!doNotUpdate){ddCtrl.commitSelection();}};DrillObject.prototype.getBreadPath=function(){var tmpBreadPath=new BreadPath();for(var i=0;i<this.breadPath.elements.length;i++){var breadPathElt=this.breadPath.elements[i];var dimFilter=this.dmSel.dm.getDimensionById(breadPathElt.dimFilter);
var dimSelPanel=ddCtrl.getDimPanel(dimFilter.id,dimFilter.continuous);var membersFormated=dimSelPanel.getSelectedFormatedElements();var members=dimSelPanel.getSelectedElements();var hierarchy=dimSelPanel.getSelectedHierarchyId();var level=dimSelPanel.getSelectedLevelId();this.updateBreadPathElt(breadPathElt,dimFilter.id,hierarchy,level,members,membersFormated);tmpBreadPath.pushElement(new BreadPathElement(breadPathElt.member,breadPathElt.memberFormated,breadPathElt.memberCaption,breadPathElt.filter,breadPathElt.dimFilter,breadPathElt.hFilter,breadPathElt.lFilter,breadPathElt.dimExpl,breadPathElt.hExpl,breadPathElt.lExpl,breadPathElt.mapIndex));}return tmpBreadPath;};DrillObject.prototype.drillTo=function(breadPath,drillOnFilter){this.removeZoom(this.chart);if(breadPath!=null&&breadPath.last()!=null){var lastElement=breadPath.last();if(typeof(this.chart.currentMapIndex)!="undefined"){var curMapIndex=this.initMapIndex;for(var i=0;i<breadPath.elements.length-1;i++){curMapIndex++;breadPath.elements[i].mapIndex=curMapIndex;
var mapDefParent=this.chart.getMapDefinitionByIndex(breadPath.elements[i].mapIndex-1);var nameParent=mapDefParent.name;if(!this.chart.selectedItemInMap){this.chart.selectedItemInMap={};}this.chart.selectedItemInMap["%"+nameParent+"%"]=breadPath.elements[i].member;}this.dmSel.lastDrillObject=lastElement.member;this.dmSel.lastDrillMember=lastElement.member;this.chart.currentMapIndex=this.initMapIndex+breadPath.elements.length;breadPath.elements[breadPath.elements.length-1].mapIndex=this.chart.currentMapIndex;}this.redrawBreadCrumb(breadPath);}else{if(this.drillPath||(this.drillOnSrcDims&&this.hierarchy.type==HIERARCHY_DIMENSION)){for(var i=0;i<this.breadPath.elements.length;i++){var breadPathElt=this.breadPath.elements[i];var dim=breadPathElt.filter.dim;if(drillOnFilter){var isFiltered=ddCtrl.isDimensionFiltered(dim.id,dim.continuous);if(!isFiltered){this.dmSel.removeFilterByDimension(dim);}}else{if(this.dmSel.dimensionsToExcludeForNavigation[dim.id]){this.dmSel.removeFilterByDimension(dim);
}else{var fO=new FilterOperand(dim.id,"All",breadPathElt.hFilter,breadPathElt.lFilter);ddCtrl.filter(fO);}}}}else{var dim=this.dimExplorer.dim;if(drillOnFilter||this.dmSel.dimensionsToExcludeForNavigation[dim.id]){this.dmSel.removeFilterByDimension(dim);}else{var fO=new FilterOperand(dim.id,"All",this.dimExplorer.hPos,this.dimExplorer.lPos);ddCtrl.filter(fO);}}if(this.initFilter){this.dmSel.setFilter(this.initFilter);}if(typeof(this.chart.currentMapIndex)!="undefined"){this.dmSel.lastDrillObject=null;this.dmSel.lastDrillMember=null;this.chart.currentMapIndex=this.initMapIndex;}var dimEx=this.dimExplorer;this.dmSel.replaceDimExplorer(this.axis,dimEx);this.current=0;if(this.drillPath){this.drillPath.dPos=0;}this.breadPath=new BreadPath();this.redrawBreadCrumb(this.breadPath);}};DrillObject.prototype.redrawBreadCrumb=function(breadPath){var id=this.frameId+"_"+this.id;var elt=document.getElementById(id);if(elt){while(elt.childNodes.length>3){var lastChild=elt.childNodes[elt.childNodes.length-1];
elt.removeChild(lastChild);}var lastChild=elt.childNodes[elt.childNodes.length-1];lastChild.className="";}if(breadPath!=null){this.current=0;this.breadPath=new BreadPath();var dimEx;var i=0;while(i<breadPath.elements.length){var element=breadPath.elements[i];var dim=this.dmSel.dm.getDimensionById(element.dimExpl);dimEx=new DimExplorer(dim,element.hExpl,element.lExpl,true,null);this.addToBreadCrumb(dimEx,element.member,element.memberFormated,element.memberCaption,false,element.filter,element.mapIndex);i++;}this.recalcWidth();if(dimEx!=null){this.dmSel.replaceDimExplorer(this.axis,dimEx);}if(this.drillPath){this.drillPath.dPos=this.current;}}};DrillObject.prototype.initDrill=function(breadPath){this.breadPath=new BreadPath();var i=0;while(i<breadPath.elements.length){var element=breadPath.elements[i];var dim=this.dmSel.dm.getDimensionById(element.dimExpl);var dimEx=new DimExplorer(dim,element.hExpl,element.lExpl,true,null);this.dmSel.replaceDimExplorer(this.axis,dimEx);if(typeof(element.filter)=="undefined"||element.filter==null){var dimFilter=this.dmSel.dm.getDimensionById(element.dimFilter);
var filter=getFilter(dimFilter,element.hFilter,element.lFilter,[element.member]);element.filter=filter;if(this.dmSel.dimensionsToExcludeForNavigation[dim.id]){this.dmSel.setFilter(filter);}}if(typeof(this.chart.currentMapIndex)!="undefined"&&element.mapIndex!=-1){this.chart.currentMapIndex=element.mapIndex;this.dmSel.lastDrillObject=element.member;this.dmSel.lastDrillMember=element.member;this.doc.getMapURL();}if(this.drillPath){this.drillPath.dPos++;}this.addToBreadCrumb(dimEx,element.member,element.memberFormated,element.memberCaption,false,element.filter);i++;}this.recalcWidth();};DrillOnEmptyZone=function(id,doc,chart,dmSel,sync){DrillObject.call(this,id,doc,chart,dmSel,null,null,null,sync);};DrillOnEmptyZone.prototype=new DrillObject();DrillOnEmptyZone.prototype.createBreadCrumb=function(bremove){var obj=this;var id=this.frameId+"_breadcrumb";var elt=document.getElementById(id);if(elt){var i=0;var nodes=elt.childNodes;if(nodes.length==0){elt.style.display="block";if(bremove){while(i<nodes.length){elt.removeChild(nodes[i]);
i++;}var divImg=document.createElement("div");divImg.setAttribute("id","resetImg_"+this.frameId);divImg.className="breadcrumbImg";divImg.onclick=function(){ddCtrl.resetChart(obj.frameId,obj.id,obj.synchronised);};elt.appendChild(divImg);}else{var divSep=document.createElement("div");setStyle(divSep,"display: inline");var sepGroup=document.createElement("span");sepGroup.className="breadsep";divSep.appendChild(sepGroup);elt.appendChild(divSep);}var breadGroup=document.createElement("div");breadGroup.id=this.frameId+"_"+this.id;breadGroup.className="breadcrumbTxt";elt.appendChild(breadGroup);var hierarchyElt=document.createElement("em");hierarchyElt.className="unclickablebreadcrumb";var hierarchyText="Geographic";hierarchyElt.appendChild(document.createTextNode(hierarchyText));breadGroup.appendChild(hierarchyElt);var spanISep=document.createElement("span");spanISep.className="breadspan";spanISep.innerHTML=" ";breadGroup.appendChild(spanISep);var levelElt=document.createElement("em");levelElt.pos=0;
var parentDef=this.chart.getMapDefinitionByIndex(this.initMapIndex);levelText=parentDef.name;levelElt.appendChild(document.createTextNode(levelText));levelElt.member=levelText;levelElt.memberFormated=levelText;levelElt.style.fontWeight="bold";levelElt.style.textDecoration="underline";levelElt.style.cursor="pointer";levelElt.onclick=function(){ddCtrl.rewind(obj.frameId,obj.pos);};this.eltByPos[0]=levelElt;breadGroup.appendChild(levelElt);var docElt=document.getElementById(this.frameId);var contentObj=document.getElementById(this.frameId.replace("frame","content"));if(docElt==null){return;}if(contentObj==docElt||contentObj==null){contentObj=docElt.parentNode;}if(contentObj!=null&&contentObj.style.height!=""){if(contentObj.style.height.indexOf("%")<0){var height=parseInt(contentObj.style.height)-elt.clientHeight;docElt.style.height=height+"px";docElt.style.top=elt.clientHeight+"px";if((isIE()&&BrowserDetect.version<9)||isSafari()){docElt.style.width="99%";setTimeout(function(){docElt.style.width="100%";
},0);}}}}else{this.breadCrumbExist=true;var id=this.frameId+"_breadcrumb";var eltParent=document.getElementById(id);if(eltParent){var nodes=eltParent.childNodes;var lastNodeid=nodes[nodes.length-1].id;var drillIdParent=lastNodeid.substring(this.frameId.length+1,lastNodeid.length);var parentDrillObject=ddCtrl.drillObjectList[this.frameId][drillIdParent];this.parentDrillObject=parentDrillObject;this.current=parentDrillObject.current;this.eltByPos=new Array();for(var i=0;i<parentDrillObject.eltByPos.length;i++){this.eltByPos.push(parentDrillObject.eltByPos[i]);}this.breadPath=new BreadPath();for(var i=0;i<parentDrillObject.breadPath.elements.length;i++){this.breadPath.elements.push(parentDrillObject.breadPath.elements[i]);}this.lastNodeId=lastNodeid;}}}};DrillOnEmptyZone.prototype.drill=function(member,memberFormated){if(typeof(this.chart.currentMapIndex)!="undefined"){this.dmSel.lastDrillMember=member;this.dmSel.lastDrillObject=member;this.chart.currentMapIndex++;}this.dmSel.updated=true;
this.addToBreadCrumb(member,memberFormated,false);this.recalcWidth();if(typeof(this.chart.currentMapIndex)!="undefined"){for(var i=0;i<this.breadPath.elements.length-1;i++){var mapDefParent=this.chart.getMapDefinitionByIndex(this.breadPath.elements[i].mapIndex-1);var nameParent=mapDefParent.name;this.chart.selectedItemInMap["%"+nameParent+"%"]=this.breadPath.elements[i].member;}}this.doc.refreshDM();};DrillOnEmptyZone.prototype.resetChart=function(doNotUpdate){this.rewind(null,0);};DrillOnEmptyZone.prototype.addToBreadCrumb=function(member,memberFormated,lastDrillUnclickable){var id=this.frameId+"_"+this.id;if(this.breadCrumbExist){id=this.lastNodeId;if(this.parentDrillObject.current>this.current){id=this.lastNodeId;this.current=this.parentDrillObject.current;this.eltByPos=new Array();for(var i=0;i<this.parentDrillObject.eltByPos.length;i++){this.eltByPos.push(this.parentDrillObject.eltByPos[i]);}this.breadPath=new BreadPath();for(var i=0;i<this.parentDrillObject.breadPath.elements.length;
i++){this.breadPath.elements.push(this.parentDrillObject.breadPath.elements[i]);}this.lastcurrent=this.parentDrillObject.current;}else{if(this.lastcurrent!=this.parentDrillObject.current){this.current=this.parentDrillObject.current;this.lastcurrent=this.current;}}}this.current++;var obj=this;var elt=document.getElementById(id);if(elt){var lastChildIndex=elt.childNodes.length-1;var lastChild=elt.childNodes[lastChildIndex];lastChild.index=lastChildIndex;if(!lastDrillUnclickable){lastChild.onclick=function(){ddCtrl.rewind(obj.frameId,obj.id,this.member,this.pos,obj.synchronised);};lastChild.className="clickablebreadcrumb";}var txt=member;if(memberFormated&&memberFormated!=null){txt=memberFormated;}var memberElt=document.createElement("em");memberElt.id=id+"_"+member;if(typeof(caption)!="undefined"&&caption!=null){txt=caption;}memberElt.appendChild(document.createTextNode(txt));memberElt.pos=this.current;memberElt.member=member;this.eltByPos[this.current]=memberElt;var spanISep=document.createElement("span");
spanISep.className="breadspan";elt.appendChild(spanISep);elt.appendChild(memberElt);var currentMapIndex=-1;if(typeof(mapIndex)!="undefined"){currentMapIndex=mapIndex;}else{currentMapIndex=this.chart.currentMapIndex;}this.breadPath.pushElement(new BreadPathElement(member,memberFormated,null,null,null,null,null,null,null,null,currentMapIndex));}};DrillOnEmptyZone.prototype.removeFromBreadCrumb=function(memberElt,breadElement){if(breadElement){var nodes=breadElement.childNodes;for(var i=nodes.length-1;i>=0;i--){if(memberElt==nodes[i]){break;}else{breadElement.removeChild(nodes[i]);}}breadElement.childNodes[nodes.length-1].className="";}};DrillOnEmptyZone.prototype.rewind=function(member,pos){var element=this.eltByPos[pos];this.removeZoom(this.chart);if(typeof(this.chart.currentMapIndex)!="undefined"){this.dmSel.lastDrillObject=null;this.dmSel.lastDrillMember=null;this.chart.currentMapIndex=this.initMapIndex+pos;}this.removeFromBreadCrumb(element,element.parentNode);this.recalcWidth();if(pos>0){var currentBreadElt=this.breadPath.elements[pos-1];
if(typeof(this.chart.currentMapIndex)!="undefined"){this.dmSel.lastDrillObject=member;this.dmSel.lastDrillMember=member;}}else{this.breadPath=new BreadPath();}this.current=pos;if(this.drillPath){this.drillPath.dPos=this.current;}this.breadPath.cut(pos);this.dmSel.updated=true;this.doc.refreshDM();this.current=element.pos;};ChangeDimObject=function(id,doc,chart,dmSel,axis,dimExplorer,drillPath,sync){DrillObject.call(this,id,doc,chart,dmSel,axis,dimExplorer,drillPath,sync);};ChangeDimObject.prototype=new DrillObject();ChangeDimObject.prototype.getDimId=function(){var dimEx=this.drillPath.dimsExplorer[0];return dimEx.dim.id;};ChangeDimObject.prototype.getCurrentDimId=function(){var dimEx=this.drillPath.dimsExplorer[this.drillPath.dPos];return dimEx.dim.id;};ChangeDimObject.prototype.getCurrentHierarchyId=function(){var dimEx=this.drillPath.dimsExplorer[this.drillPath.dPos];var dimId=dimEx.dim.id;var dim=this.dmSel.dm.getDimensionById(dimId);if(dim&&dim.hierarchies[dimEx.hPos]){return dim.hierarchies[dimEx.hPos].id;
}return null;};ChangeDimObject.prototype.getCurrentLevelId=function(){var dimEx=this.drillPath.dimsExplorer[this.drillPath.dPos];var dimId=dimEx.dim.id;var dim=this.dmSel.dm.getDimensionById(dimId);if(dim&&dim.hierarchies[dimEx.hPos]&&dim.hierarchies[dimEx.hPos].levels[dimEx.lPos]){return dim.hierarchies[dimEx.hPos].levels[dimEx.lPos].id;}return null;};ChangeDimObject.prototype.createBreadCrumb=function(bremove){var obj=this;var id=this.frameId+"_breadcrumb";var elt=document.getElementById(id);if(elt){var i=0;var nodes=elt.childNodes;elt.style.display="block";if(bremove){while(i<nodes.length){elt.removeChild(nodes[i]);}var divImg=document.createElement("div");divImg.setAttribute("id","resetImg_"+this.frameId);divImg.className="breadcrumbImg";divImg.onclick=function(){ddCtrl.resetChart(obj.frameId,obj.id,obj.synchronised);};elt.appendChild(divImg);}else{var divSep=document.createElement("div");setStyle(divSep,"display: inline");var sepGroup=document.createElement("span");sepGroup.className="breadsep";
divSep.appendChild(sepGroup);elt.appendChild(divSep);}var breadGroup=document.createElement("div");breadGroup.id=this.frameId+"_"+this.id;breadGroup.className="breadcrumbTxt";elt.appendChild(breadGroup);var hierarchyElt=document.createElement("em");hierarchyElt.className="unclickablebreadcrumb";var hierarchyText;if(this.drillPath){hierarchyText=this.drillPath.name;}else{hierarchyText=this.dimExplorer.hierarchy.name;}hierarchyElt.appendChild(document.createTextNode(hierarchyText));breadGroup.appendChild(hierarchyElt);var spanISep=document.createElement("span");spanISep.className="breadspan";spanISep.innerHTML=" ";breadGroup.appendChild(spanISep);var dims=this.drillPath.dimsExplorer;for(var i=0;i<dims.length;i++){var dimEx=dims[i];var levelElt=document.createElement("em");levelElt.pos=i;var dim=this.drillPath.dimsExplorer[i].dim;var levelText=dim.name;if(this.drillPath.dimsExplorer[i].hPos>-1&&this.drillPath.dimsExplorer[i].lPos>-1&&dim.hierarchies.length>0){levelText=dim.hierarchies[this.drillPath.dimsExplorer[i].hPos].levels[this.drillPath.dimsExplorer[i].lPos].name;
}levelElt.appendChild(document.createTextNode(levelText));levelElt.member=levelText;levelElt.memberFormated=levelText;if(i==0){levelElt.className="selectedbreadcrumb";}else{levelElt.className="unselectedbreadcrumb";}levelElt.onclick=function(){ddCtrl.rewind(obj.frameId,obj.id,this.member,this.pos,obj.synchronised);};this.eltByPos[0]=levelElt;breadGroup.appendChild(levelElt);}var docElt=document.getElementById(this.frameId);var contentObj=document.getElementById(this.frameId.replace("frame","content"));if(docElt==null){return;}if(contentObj==docElt||contentObj==null){contentObj=docElt.parentNode;}if(contentObj!=null&&contentObj.style.height!=""){if(contentObj.style.height.indexOf("%")<0){var height=parseInt(contentObj.style.height)-elt.clientHeight;docElt.style.height=height+"px";docElt.style.top=elt.clientHeight+"px";if((isIE()&&BrowserDetect.version<9)||isSafari()){docElt.style.width="99%";setTimeout(function(){docElt.style.width="100%";},0);}}}}};ChangeDimObject.prototype.drill=function(member,memberFormated){var pos=this.drillPath.dPos+1;
if(pos>this.drillPath.dimsExplorer.length-1){pos=0;}this.changeDim(pos,true);};ChangeDimObject.prototype.rewind=function(member,pos){this.changeDim(pos,true);};ChangeDimObject.prototype.changeDim=function(pos,update){this.drillPath.dPos=pos;var newDimEx=this.drillPath.dimsExplorer[this.drillPath.dPos];newDimEx.prepare();this.dmSel.replaceDimExplorer(this.axis,newDimEx);if(update){this.dmSel.updated=true;if(!this.synchronised){this.doc.refreshDM();}}this.addToBreadCrumb(newDimEx);};ChangeDimObject.prototype.initDrill=function(breadPath){var pos=0;if(breadPath.elements.length>0){for(var i=0;i<this.drillPath.dimsExplorer.length;i++){if(this.drillPath.dimsExplorer[i].dim.id==breadPath.elements[0].dimExpl){pos=i;break;}}}this.changeDim(pos,false);};ChangeDimObject.prototype.onDimensionFilter=function(dimId,hierarchyId,levelId,members,membersFormated){};ChangeDimObject.prototype.updateBreadPathElt=function(breadPathElt,dimId,hierarchyId,levelId,members,membersFormated){};ChangeDimObject.prototype.addToBreadCrumb=function(dimEx){this.breadPath.elements[0]=new BreadPathElement(null,null,null,null,null,-1,-1,dimEx.dim.id,dimEx.hPos,dimEx.lPos,-1);
this.selectInBreadCrumb(this.drillPath.dPos);};ChangeDimObject.prototype.selectInBreadCrumb=function(currentSel){var obj=this;var id=this.frameId+"_"+this.id;var elt=document.getElementById(id);if(elt){var childs=elt.getElementsByTagName("em");for(var i=0;i<childs.length;i++){var previousSelectedChild=childs[i];previousSelectedChild.className="unselectedbreadcrumb";}var selectedChild=childs[currentSel+1];selectedChild.className="selectedbreadcrumb";}if(ddCtrl&&ddCtrl.ddHistory){ddCtrl.ddHistory.saveHistoryState(null,null);}};ChangeDimObject.prototype.removeFromBreadCrumb=function(memberElt,breadElement){};ChangeDimObject.prototype.resetChart=function(doNotUpdate){this.rewind(null,0);};ChangeDimObject.prototype.getBreadPath=function(){var tmpBreadPath=new BreadPath();if(this.breadPath&&this.breadPath.elements.length>0){var breadPathElt=this.breadPath.elements[0];tmpBreadPath.pushElement(new BreadPathElement(null,null,null,null,null,-1,-1,breadPathElt.dimExpl,breadPathElt.hExpl,breadPathElt.lExpl,-1));
}return tmpBreadPath;};ChangeDimObject.prototype.drillTo=function(breadPath){this.removeZoom(this.chart);if(!breadPath||breadPath.elements.length==0){this.rewind(null,0);}else{for(var i=0;i<this.drillPath.dimsExplorer.length;i++){if(this.drillPath.dimsExplorer[i].dim.id==breadPath.elements[0].dimExpl){this.rewind(null,i);break;}}}};BreadPathElement=function(sMemberId,sMemberFormated,sMemberCaption,oFilter,dimFilter,hFilter,lFilter,dimExpl,hExpl,lExpl,mapIndex){this.member=sMemberId;this.memberFormated=sMemberFormated;this.memberCaption=sMemberCaption;this.filter=oFilter;this.dimFilter=dimFilter;this.hFilter=hFilter;this.lFilter=lFilter;this.dimExpl=dimExpl;this.hExpl=hExpl;this.lExpl=lExpl;if(typeof(mapIndex)!="undefined"){this.mapIndex=mapIndex;}else{this.mapIndex=-1;}};BreadPath=function(){this.elements=new Array();};BreadPath.prototype.pushElement=function(bpElem){this.elements.push(bpElem);};BreadPath.prototype.get=function(i){if(this.elements.length>0){return this.elements[i];}return null;
};BreadPath.prototype.last=function(){if(this.elements.length>0){return this.elements[this.elements.length-1];}return null;};BreadPath.prototype.first=function(){if(this.elements.length>0){return this.elements[0];}return null;};BreadPath.prototype.cut=function(nToKeep){this.elements=this.elements.slice(0,nToKeep);};BreadPath.prototype.getXML=function(){var xml="";for(var i=0;i<this.elements.length;i++){var breadPathElement=this.elements[i];var memberFormated=breadPathElement.memberFormated;var memberCaption=breadPathElement.memberCaption;if(typeof(memberCaption)=="undefined"){memberCaption=memberFormated;}xml+='<Element member="'+xmlEncode(breadPathElement.member)+'" memberFormated="'+xmlEncode(memberFormated)+'" memberCaption="'+xmlEncode(memberCaption)+'" hFilter="'+breadPathElement.hFilter+'" dimFilter="'+breadPathElement.dimFilter+'" lFilter="'+breadPathElement.lFilter+'" dimExpl="'+breadPathElement.dimExpl+'" hExpl="'+breadPathElement.hExpl+'" lExpl="'+breadPathElement.lExpl+'" mapIndex="'+breadPathElement.mapIndex+'"/>';
}return xml;};Comment=function(user,date,dataModelId,flowId,type,id,userName){this.id=id;this.user=user;this.userName=userName;this.date=date;this.dataModelId=dataModelId,this.flowId=flowId;this.type=type;this.contents=new Object();this.commentSelection=new CommentSelection();};Comment.prototype.toXML=function(){var commentXML="<Comment id='"+this.id+"' user='"+this.user+"' dataModelId='"+this.dataModelId+"' flowId='"+this.flowId+"' date='"+this.date+"' type='"+this.type+"' userName='"+this.userName+"'>";var commentSelectionXML=this.commentSelection.toXML();commentXML+=commentSelectionXML;for(var contentKey in this.contents){var content="<Content lang='"+contentKey+"' text='"+xmlEncode(this.contents[contentKey])+"'></Content>";commentXML+=content;}commentXML+="</Comment>";return commentXML;};function parseCommentContentsXML(contents){var content="{";if(contents.length===0){return{en:"",fr:""};}for(var i=0;i<contents.length;i++){content+=parseCommentContentXML(contents[i]);if(i+1!==contents.length){content+=",";
}}content+="}";return JSON.parse(content);}function parseCommentContentXML(content){return'"'+content.getAttribute("lang")+'":"'+content.getAttribute("text")+'"';}Comment.prototype.castFromJSON=function(){if(typeof(this.cs)!="undefined"){this.commentSelection=this.cs;delete this.cs;}if(typeof(this.id)=="undefined"){this.id="";}if(typeof(this.user)=="undefined"){this.user="";}if(typeof(this.userName)=="undefined"){this.userName="";}if(typeof(this.date)=="undefined"){this.date=0;}if(typeof(this.dataModelId)=="undefined"){this.dataModelId="";}if(typeof(this.flowId)=="undefined"){this.flowId="";}if(typeof(this.type)=="undefined"){this.type="";}if(typeof(this.contents)=="undefined"){this.contents={en:"",fr:""};}if(this.commentSelection){castObject(this.commentSelection,CommentSelection.prototype);this.commentSelection.castFromJSON();}else{this.commentSelection=new CommentSelection();}};CommentSelection=function(){this.filters=new Object();};CommentSelection.prototype.castFromJSON=function(){if(typeof(this.f)!="undefined"){this.filters=this.f;
delete this.f;}if(typeof(this.filters)=="undefined"){this.filters={};}for(var dimId in this.filters){var filter=this.filters[dimId];castObject(filter,CommentSelectionFilter.prototype);filter.dimension=dimId;filter.castFromJSON();}};CommentSelection.prototype.getNbFilters=function(){var nbFilters=0;for(var dimId in this.filters){nbFilters++;}return nbFilters;};CommentSelection.prototype.addFilter=function(filter){this.filters[filter.dimension]=filter;};CommentSelection.prototype.equals=function(commentSelection){if(this.getNbFilters()!=commentSelection.getNbFilters()){return false;}for(var dimId in this.filters){if(commentSelection.filters[dimId]){if(!this.filters[dimId].equals(commentSelection.filters[dimId])){return false;}}else{return false;}}return true;};CommentSelection.prototype.toXML=function(){var xml="<CommentSelection filtermode='1'>";for(var dimId in this.filters){xml+=this.filters[dimId].toXML();}xml+="</CommentSelection>";return xml;};CommentSelectionFilter=function(dimension,hierarchy,level){this.dimension=dimension;
this.dimensionName=dimension;this.hierarchy=hierarchy;this.level=level;this.members=new Array();this.membersFormated=new Array();this.min=null;this.max=null;};CommentSelectionFilter.prototype.castFromJSON=function(){if(typeof(this.d)!="undefined"){this.dimension=this.d;delete this.d;}if(typeof(this.h)!="undefined"){this.hierarchy=this.h;delete this.h;}if(typeof(this.l)!="undefined"){this.level=this.l;delete this.l;}if(typeof(this.m)!="undefined"){this.members=this.m;delete this.m;}if(typeof(this.mf)!="undefined"){this.membersFormated=this.mf;delete this.mf;}if(typeof(this.dimension)=="undefined"){this.dimension="";}if(typeof(this.hierarchy)=="undefined"){this.hierarchy="-1";}if(typeof(this.level)=="undefined"){this.level="-1";}if(typeof(this.members)=="undefined"){this.members=[];}if(typeof(this.membersFormated)=="undefined"){this.membersFormated=[];}if(typeof(this.min)=="undefined"){this.min=0;}if(typeof(this.max)=="undefined"){this.max=0;}};CommentSelectionFilter.prototype.setDimensionName=function(dimName){this.dimensionName=dimName;
};CommentSelectionFilter.prototype.addMember=function(member){this.members.push(member);};CommentSelectionFilter.prototype.addMemberFormated=function(memberFormated){this.membersFormated.push(memberFormated);};CommentSelectionFilter.prototype.isRootLevel=function(){if(this.level=="-1"||this.level==-1||this.level=="root"||this.hierarchy=="-1"||this.hierarchy==-1){return true;}return false;};CommentSelectionFilter.prototype.equals=function(commentSelectionFilter){if(this.dimension!=commentSelectionFilter.dimension){return false;}var bSameLevel=false;if(this.isRootLevel()&&commentSelectionFilter.isRootLevel()){bSameLevel=true;}else{if(this.level==commentSelectionFilter.level&&this.hierarchy==commentSelectionFilter.hierarchy){bSameLevel=true;}}if(bSameLevel&&this.members.length==commentSelectionFilter.members.length){if(this.members.length>0){this.members.sort(sortMembers);commentSelectionFilter.members.sort(sortMembers);for(var i=0;i<this.members.length;i++){if(this.members[i]!=commentSelectionFilter.members[i]){return false;
}}}else{if(this.min!=commentSelectionFilter.min&&this.max!=commentSelectionFilter.max){return false;}}return true;}return false;};function sortMembers(a,b){if(a==b){return 0;}return a>b?1:-1;}function sortCommentsDateDesc(c1,c2){return c2.date-c1.date;}CommentSelectionFilter.prototype.toXML=function(){var xml="<Dimension id='"+xmlEncode(this.dimension)+"' name='"+xmlEncode(this.dimensionName)+"' ";if(this.hierarchy&&this.hierarchy!=="root"&&this.hierarchy!=="null"){xml+="hierarchy='"+this.hierarchy+"' ";}if(this.level&&this.level!=="root"&&this.level!=="null"){xml+="level='"+this.level+"' ";}else{xml+="level='root' ";}if(typeof(this.hpos)!=="undefined"&&typeof(this.lpos)!=="undefined"){xml+="hierarchyPos='"+this.hpos+"' levelPos='"+this.lpos+"' ";}if(this.min!=null&&this.max!=null){xml+="min='"+this.min+"' max='"+this.max+"' >";}else{xml+=">";for(var i=0;i<this.members.length;i++){xml+="<Member>"+xmlEncode(this.members[i])+"</Member>";}for(var i=0;i<this.membersFormated.length;i++){xml+="<MemberFormated>"+xmlEncode(this.membersFormated[i])+"</MemberFormated>";
}}xml+="</Dimension>";return xml;};function parseCommentsXML(commentsXML){var commentsArray=[];var comments=commentsXML.getElementsByTagName("Comment");for(var i=0;i<comments.length;i++){commentsArray.push(parseCommentXML(comments[i]));}return commentsArray;}function parseCommentXML(commentXML){var comment;var commentSelection;var id,user,userName,date,dataModelId,flowId,type;var root=commentXML;id=root.getAttribute("id");user=root.getAttribute("user");userName=root.getAttribute("userName");date=root.getAttribute("date");dataModelId=root.getAttribute("dataModelId");flowId=root.getAttribute("flowId");type=root.getAttribute("type");comment=new Comment(user,date,dataModelId,flowId,type,id,userName);var contents=root.getElementsByTagName("Content");comment.contents=parseCommentContentsXML(contents);if(root.getElementsByTagName("CommentSelection")){commentSelection=parseCommentSelectionXML(root.getElementsByTagName("CommentSelection")[0]);}comment.commentSelection=commentSelection;return comment;
}function parseCommentContentsXML(contents){var content="{";if(contents.length===0){return{en:"",fr:""};}for(var i=0;i<contents.length;i++){content+=parseCommentContentXML(contents[i]);if(i+1!==contents.length){content+=",";}}content+="}";return JSON.parse(content);}function parseCommentContentXML(content){return'"'+content.getAttribute("lang")+'":"'+addSlashes(content.getAttribute("text"))+'"';}function addSlashes(str){return(str+"").replace(/[\\"]/g,"\\$&").replace(/\u0000/g,"\\0");}function parseCommentSelectionXML(selection){var commentSelection=new CommentSelection();var dims=selection.getElementsByTagName("Dimension");for(var i=0;i<dims.length;i++){commentSelection.addFilter(parseCommentSelectionFilterXML(dims[i]));}return commentSelection;}function parseCommentSelectionFilterXML(filter){var d=filter.getAttribute("id");var h=filter.getAttribute("hierarchy");var l=filter.getAttribute("level");var commentSelectionFilter=new CommentSelectionFilter(d,h,l);var mbrs=filter.getElementsByTagName("Member");
for(var j=0;j<mbrs.length;j++){commentSelectionFilter.addMember(mbrs[j].textContent);}return commentSelectionFilter;}if(ddCtrl){ddCtrl.getComments=function(dmId,flowId,dmsel,members,membersFormated){if(ddCtrl.commentsByFlow===undefined){ddCtrl.commentsByFlow=new Object();}if(!ddCtrl.commentsByFlow[flowId]){dmId=null;var method=null;if(ddCtrl.isDashboard){method="getComments";}else{method="getCommentsJSON";}var params="method="+method+"&commentSelection="+(flowId?("&flow="+flowId):"")+(dmId?("&dataModel="+dmId):"");var jsonStr=evalJSON(ddCtrl.servletAPIPath,params);var comments;eval("comments="+jsonStr);if(comments&&typeof(comments.cause)!="undefined"){comments=[];}for(var i=0;i<comments.length;i++){var comment=comments[i];castObject(comment,Comment.prototype);if(flowId){comment.flowId=flowId;}if(dmId){comment.dataModelId=dmId;}comment.castFromJSON();}ddCtrl.commentsByFlow[flowId]=comments;}var commentSelection=ddCtrl.getCommentSelection(dmsel,members,membersFormated);var commentsFlow=ddCtrl.commentsByFlow[flowId];
var comments=[];for(var i=0;i<commentsFlow.length;i++){var comment=commentsFlow[i];if(commentSelection!=null&&comment.commentSelection.equals(commentSelection)){comment.commentSelection=commentSelection;comments.push(comment);}}comments.sort(sortCommentsDateDesc);return comments;};ddCtrl.getLastComments=function(dmId,flowId,dmsel,members,membersFormated){if(ddCtrl.lastCommentsByFlow===undefined){ddCtrl.lastCommentsByFlow=new Object();}if(!ddCtrl.lastCommentsByFlow[flowId]){dmId=null;var params="method=getLastComments&commentSelection="+(flowId?("&flow="+flowId):"")+(dmId?("&dataModel="+dmId):"")+"&fields=2";var jsonStr=evalJSON(ddCtrl.servletAPIPath,params);var comments;eval("comments="+jsonStr);if(comments&&typeof(comments.cause)!="undefined"){comments=[];}for(var i=0;i<comments.length;i++){var comment=comments[i];castObject(comment,Comment.prototype);if(flowId){comment.flowId=flowId;}comment.castFromJSON();}ddCtrl.lastCommentsByFlow[flowId]=comments;}var commentSelection=ddCtrl.getCommentSelection(dmsel,members,membersFormated);
var lastCommentsFlow=ddCtrl.lastCommentsByFlow[flowId];var comments=[];for(var i=0;i<lastCommentsFlow.length;i++){var comment=lastCommentsFlow[i];if(commentSelection!=null&&comment.commentSelection.equals(commentSelection)){comment.commentSelection=commentSelection;comments.push(comment);}}comments.sort(sortCommentsDateDesc);return comments;};ddCtrl.showComments=function(dmId,flowId,commentSelection){if(ddCtrl.showDashboardComments){var commentSelectionXML=commentSelection.toXML();ddCtrl.showDashboardComments(dmId,flowId,commentSelectionXML);}};ddCtrl.getCommentSelection=function(dmsel,members,membersFormated){var commentSelection=new CommentSelection();for(var iAx=1;iAx<dmsel.axis.length;iAx++){var dims=dmsel.axis[iAx];if(dims.length==1){var dimIdx=dmsel.axis[iAx][0];var dimEx=dmsel.dimsToExplore[dimIdx];if(members[iAx-1]){var h="-1";var l="-1";if(dimEx.hPos!=-1&&dimEx.lPos!=-1){h=dimEx.dim.hierarchies[dimEx.hPos].id;l=dimEx.dim.hierarchies[dimEx.hPos].levels[dimEx.lPos].id;}var commentSelectionFilter=new CommentSelectionFilter(dimEx.dim.id,h,l);
commentSelectionFilter.addMember(members[iAx-1]);if(membersFormated&&membersFormated[iAx-1]){commentSelectionFilter.addMemberFormated(membersFormated[iAx-1]);}commentSelection.addFilter(commentSelectionFilter);}}}return commentSelection;};ddCtrl.resetCommentsFlow=function(flowId){if(ddCtrl.commentsByFlow){delete ddCtrl.commentsByFlow[flowId];}if(ddCtrl.lastCommentsByFlow){delete ddCtrl.lastCommentsByFlow[flowId];}};}function DragEditHandler(chart){this.chart=chart;this.dragdropUID=""+Math.random();this.dragDataTransfer={};this.dragging=false;this.dragDataSupported=!isIE()&&!isIE11()&&!isEdge();if(isIE9()){DragEditHandler.addDragSupportIE9(document);}}DragEditHandler._ie9DragListener=function(e){for(var el=e.target;el;el=el.parentNode){if(el.attributes&&el.attributes.draggable){e.preventDefault();e.stopImmediatePropagation();el.dragDrop();return false;}}};DragEditHandler.addDragSupportIE9=function(doc){doc.removeEventListener("selectstart",DragEditHandler._ie9DragListener);doc.addEventListener("selectstart",DragEditHandler._ie9DragListener);
};DragEditHandler.ONLEFT=1;DragEditHandler.ONRIGHT=2;DragEditHandler.ONTOP=4;DragEditHandler.ONBOTTOM=8;DragEditHandler.ONBEFORE=5;DragEditHandler.ONAFTER=10;DragEditHandler.ORIENT_IN=-1;DragEditHandler.ORIENT_LR=0;DragEditHandler.ORIENT_TB=1;DragEditHandler.prototype.addDragTo=function(obj,onDragStart){var self=this;if(isTouchDevice()){}else{obj.setAttribute("draggable",true);obj.setAttribute("ddDraggable",true);obj.ondragstart=function(event){self.dragging=true;onDragStart(event);};obj.ondragend=function(event){self.dragging=false;};}};DragEditHandler.prototype.setLRTB=function(event){var target=findEditable(event.currentTarget?event.currentTarget:event.srcElement);var offX=event.layerX&&!isIE()&&!isIE11()?event.layerX:event.offsetX;var offY=event.layerY&&!isIE()&&!isIE11()?event.layerY:event.offsetY;var width=target.offsetWidth||0;var height=target.offsetHeight||0;event.onLeft=offX<=width/2;event.onRight=!event.onLeft;event.onTop=offY<=height/2;event.onBottom=!event.onTop;if(target.dragOrient==DragEditHandler.ORIENT_TB){event.onBefore=event.onTop;
event.onAfter=event.onBottom;}else{if(target.dragOrient==DragEditHandler.ORIENT_LR){event.onBefore=event.onLeft;event.onAfter=event.onRight;}else{event.onBefore=false;event.onAfter=false;}}};DragEditHandler.prototype.showDragMarker=function(event,obj){if(obj.dragOrient==DragEditHandler.ORIENT_TB){if(event.onTop&&obj.className.indexOf(" dragMarkerTop")<0){obj.className+=" dragMarkerTop";}else{if(event.onBottom&&obj.className.indexOf(" dragMarkerBottom")<0){obj.className+=" dragMarkerBottom";}}}else{if(event.onLeft&&obj.className.indexOf(" dragMarkerLeft")<0){obj.className+=" dragMarkerLeft";}else{if(event.onRight&&obj.className.indexOf(" dragMarkerRight")<0){obj.className+=" dragMarkerRight";}}}};DragEditHandler.prototype.cancelEventBubbling=function(ev){if(ev.stopPropagation){ev.stopPropagation();}ev.cancelBubble=true;};DragEditHandler.prototype.addDropTo=function(obj,onDragOver,onDrop){var self=this;if(typeof(obj.dragOrient)=="undefined"){obj.dragOrient=DragEditHandler.ORIENT_LR;}if(isTouchDevice()){}else{obj.ondrop=function(event){self.setLRTB(event);
onDrop(event);self.cancelEventBubbling(event);};obj.ondragover=function(event){self.setLRTB(event);onDragOver(event);self.showDragMarker(event,obj);self.cancelEventBubbling(event);};obj.ondragenter=function(event){self.showDragMarker(event,obj);self.cancelEventBubbling(event);};obj.ondragleave=function(event){var ind=obj.className.indexOf(" dragMarkerTop");if(ind>=0){obj.className=obj.className.substring(0,ind)+obj.className.substring(ind+" dragMarkerTop".length);}var ind=obj.className.indexOf(" dragMarkerBottom");if(ind>=0){obj.className=obj.className.substring(0,ind)+obj.className.substring(ind+" dragMarkerBottom".length);}var ind=obj.className.indexOf(" dragMarkerLeft");if(ind>=0){obj.className=obj.className.substring(0,ind)+obj.className.substring(ind+" dragMarkerLeft".length);}var ind=obj.className.indexOf(" dragMarkerRight");if(ind>=0){obj.className=obj.className.substring(0,ind)+obj.className.substring(ind+" dragMarkerRight".length);}if(event){self.cancelEventBubbling(event);}};}};
DragEditHandler.prototype.isDragType=function(ev,type){if(ev&&this.dragDataSupported&&ev.dataTransfer&&ev.dataTransfer.types){for(var i=0;i<ev.dataTransfer.types.length;i++){var stype=ev.dataTransfer.types[i];if(stype=="application/"+type||stype==type){return true;}}}else{for(var stype in this.dragDataTransfer){if(stype=="application/"+type||stype==type){return true;}}}return false;};DragEditHandler.prototype.isDragSameWindow=function(ev){return this.isDragType(ev,"dd-dnduid-"+this.dragdropUID);};DragEditHandler.prototype.setDragData=function(ev,key,value){if(this.dragDataSupported&&ev.dataTransfer){ev.dataTransfer.setData(key,value);}this.dragDataTransfer[key]=value;};DragEditHandler.prototype.getDragData=function(ev,key){var d=null;if(this.dragDataSupported&&ev.dataTransfer){d=ev.dataTransfer.getData(key);if(!d){d=ev.dataTransfer.getData("application/"+key);}}if(!d){d=this.dragDataTransfer[key];}if(!d){d=this.dragDataTransfer["application/"+key];}return d;};DragEditHandler.prototype.allowDropObject=function(ev,objType){if(this.isDragType(ev,objType)){ev.preventDefault();
if(this.isDragSameWindow(ev)){if(this.isDragType(ev,"dd-editctx")){this.setDropEffect(ev,"move");return true;}}}return false;};DragEditHandler.prototype.setDropEffect=function(ev,dropEffect){if(ev.dataTransfer){ev.dataTransfer.dropEffect=dropEffect;}};DragEditHandler.prototype.dragObject=function(ev,objType,objId,objType2,objId2){this.dragDataTransfer={};this.setDragData(ev,"text/plain",objId);this.setDragData(ev,"application/"+objType,objId);if(objType2&&objId2){this.setDragData(ev,"application/"+objType2,objId2);}this.setDragData(ev,"application/dd-dnduid-"+this.dragdropUID,this.dragdropUID);if(ev.target.editCtx){this.setDragData(ev,"application/dd-editctx",JSON.stringify(ev.target.editCtx));}};function CustomContextMenu(Arguments){this.Version="2.1";var Base=Arguments.Base?Arguments.Base:document.documentElement;var ItemClassName=Arguments.ItemClassName?Arguments.ItemClassName:"";var Width=Arguments.Width?Arguments.Width:200;var FontColor=Arguments.FontColor?Arguments.FontColor:"black";
var HoverFontColor=Arguments.HoverFontColor?Arguments.HoverFontColor:"white";var HoverBackgroundColor=Arguments.HoverBackgroundColor?Arguments.HoverBackgroundColor:"#2257D5";var HoverBorderColor=Arguments.HoverBorderColor?Arguments.HoverBorderColor:"orange";var ClickEventListener=Arguments.ClickEventListener?Arguments.ClickEventListener:function(){return false;};var Modal=Arguments.Modal?true:false;var ItemHeight=Arguments.ItemHeight?Arguments.ItemHeight:20;var ContextMenuDiv=document.createElement("div");var ContextMenuTable=document.createElement("table");var Index=0;var EventHandlers=new Array();var pdfMenuDiv=document.getElementById(Arguments.Id);if(pdfMenuDiv){pdfMenuDiv.parentNode.removeChild(pdfMenuDiv);}var DelaySubMenu=typeof(Arguments.DelaySubMenu)!="undefined"?Arguments.DelaySubMenu:200;var getWindowRect=function(){var winSize=getWindowSize();var winRect=new Object();winRect.x1=document.body.scrollLeft+document.documentElement.scrollLeft;winRect.y1=document.body.scrollTop+document.documentElement.scrollTop;
winRect.width=winSize.width;winRect.height=winSize.height;var scrollWidth=document.body.clientWidth-document.body.scrollWidth;var scrollHeight=document.body.clientHeight-document.body.scrollHeight;winRect.x2=winRect.x1+winRect.width-(scrollHeight<0?17:0);winRect.y2=winRect.y1+winRect.height-(scrollWidth<0?17:0);return winRect;};if(Modal){var winRect=getWindowRect();var pdfMenuDivParent=document.getElementById(Arguments.Id+"_Back");if(pdfMenuDivParent){pdfMenuDivParent.parentNode.removeChild(pdfMenuDivParent);}pdfMenuDivParent=document.createElement("div");pdfMenuDivParent.id=Arguments.Id+"_Back";pdfMenuDivParent.setAttribute("style","filter:alpha(opacity=40); -moz-opacity:0.4; -khtml-opacity: 0.4; opacity: 0.4;");pdfMenuDivParent.className=Arguments.Id+"_Back";pdfMenuDivParent.style.position="absolute";pdfMenuDivParent.style.backgroundColor="white";if(isIE()){pdfMenuDivParent.style.filter="alpha(opacity=40)";}else{pdfMenuDivParent.style.opacity=0.4;}pdfMenuDivParent.style.visibility="visible";
pdfMenuDivParent.style.top="0px";pdfMenuDivParent.style.left="0px";if(isIE()||Base.clientWidth){maxWidth=Math.max(Base.clientWidth,winRect.x2);pdfMenuDivParent.style.width=maxWidth+"px";}else{pdfMenuDivParent.style.width="100%";}if(isIE()||Base.clientHeight){maxHeight=Math.max(Base.clientHeight,winRect.y2);pdfMenuDivParent.style.height=maxHeight+"px";}else{pdfMenuDivParent.style.height="100%";}Base.appendChild(pdfMenuDivParent);Base=pdfMenuDivParent;}ContextMenuDiv.id=Arguments.Id;ContextMenuDiv.className="contextMenu";ContextMenuDiv.style.position="absolute";ContextMenuDiv.style.verticalAlign="top";ContextMenuDiv.style.visibility="hidden";ContextMenuDiv.style.width=(Width+11)+"px";ContextMenuTable.id=ContextMenuDiv.id+".ContextMenuTable";var width=Width+10;ContextMenuTable.style.width=width+"px";ContextMenuTable.border=0;ContextMenuTable.cellPadding=0;ContextMenuTable.cellSpacing=0;ContextMenuDiv.appendChild(ContextMenuTable);this.AddItem=function(itemText,isDisabled,commandName,mouseOverFunc,index,className){var Tr=null;
if(index){Tr=ContextMenuTable.insertRow(index);Index++;}else{Tr=ContextMenuTable.insertRow(Index++);}Tr.style.cursor="default";var td=Tr.insertCell(0);td.style.width=(Width)+"px";td.style.height=ItemHeight+"px";td.style.verticalAlign="middle";if(isDisabled){td.style.color="gray";}td.innerHTML=itemText?itemText:"&nbsp;";td.itemClassName=(ItemClassName?" "+ItemClassName:"")+(className?" "+className:"");td.className="contextMenuItem"+td.itemClassName;if(!isDisabled){WireUpEventHandler(Tr,"click",function(){ClickEventListener(Tr,{CommandName:commandName,Text:itemText,IsDisabled:isDisabled});});WireUpEventHandler(Tr,"mouseover",function(){MouseOver(Tr,td,commandName,mouseOverFunc);});WireUpEventHandler(Tr,"mouseout",function(){MouseOut(Tr,td);});}};this.AddSeparatorItem=function(){var Tr=ContextMenuTable.insertRow(Index++);Tr.style.cursor="default";var TdRight=Tr.insertCell(0);TdRight.className="contextMenuSeparator";TdRight.style.width=(Width)+"px";};this.Display=function(e){e=e?e:window.event;
var xLeft=0;var yTop=0;var winRect=getWindowRect();if(e){if(e.clientX||e.clientY){xLeft=e.clientX+winRect.x1;yTop=e.clientY+winRect.y1;}else{if(e.pageX||e.pageY){xLeft=e.pageX;yTop=e.pageY;}}var srcDoc=(e.srcElement||e.target).ownerDocument;while(srcDoc!=document&&srcDoc.defaultView.frameElement){var offElt=srcDoc.defaultView.frameElement;while(offElt){if(offElt.offsetLeft){xLeft+=offElt.offsetLeft;}if(offElt.offsetTop){yTop+=offElt.offsetTop;}offElt=offElt.offsetParent;if(offElt){srcDoc=offElt.ownerDocument;}}}}else{xLeft=Math.floor((winRect.width-Width)/2)+winRect.x1;yTop=Math.floor(winRect.height/2)+winRect.y1;}if(xLeft+ContextMenuDiv.offsetWidth>winRect.x2){xLeft=winRect.x2-ContextMenuDiv.offsetWidth;}if(yTop+ContextMenuDiv.offsetHeight>winRect.y2){yTop=winRect.y2-ContextMenuDiv.offsetHeight;}ContextMenuDiv.style.visibility="hidden";ContextMenuDiv.style.left=xLeft+"px";ContextMenuDiv.style.top=yTop+"px";ContextMenuDiv.style.visibility="visible";if(Modal){Base.style.visibility="visible";
}this.visible=true;return false;};this.Hide=function(){ContextMenuDiv.style.visibility="hidden";var subContextMenuDiv=document.getElementById("subContextMenu");if(subContextMenuDiv){subContextMenuDiv.style.visibility;}if(Modal){Base.style.visibility="hidden";}this.visible=false;};this.onClosed=null;this.Dispose=function(){while(EventHandlers.length>0){DetachEventHandler(EventHandlers.pop());}if(ContextMenuDiv&&ContextMenuDiv.parentNode){ContextMenuDiv.parentNode.removeChild(ContextMenuDiv);}var subContextMenuDiv=document.getElementById("subContextMenu");if(subContextMenuDiv&&subContextMenuDiv.parentNode){subContextMenuDiv.parentNode.removeChild(subContextMenuDiv);}ContextMenuDiv=null;if(Modal&&Base&&Base.parentNode){Base.parentNode.removeChild(Base);}this.visible=false;if(this.onClosed){this.onClosed();}};this.GetTotalItems=function(){return ContextMenuTable.getElementsByTagName("tr").length;};var contextSubMenuTimer=null;var MouseOver=function(Tr,td,commandName,mouseOverFunc){td.className="contextMenuItemHover"+td.itemClassName;
if(DelaySubMenu>0){if(contextSubMenuTimer!=null){clearTimeout(contextSubMenuTimer);}contextSubMenuTimer=setTimeout(function(){MouseOver2(Tr,td,commandName,mouseOverFunc);},DelaySubMenu);}else{MouseOver2(Tr,td,commandName,mouseOverFunc);}};var MouseOver2=function(Tr,td,commandName,mouseOverFunc){if(mouseOverFunc&&typeof(mouseOverFunc)=="function"){mouseOverFunc();}var subContextMenuDiv=document.getElementById("subContextMenu");if(Tr.offsetParent.id=="contextMenu.ContextMenuTable"){if(typeof commandName=="string"){var commands=commandName.split("/$/");var cmd=commands[0];var dimName=commands[1];currentSelectedDimension=dimName;if(cmd!="AddDimension"&&subContextMenuDiv){subContextMenuDiv.style.visibility="hidden";return;}}}if(subContextMenuDiv&&subContextMenuDiv!=ContextMenuDiv){var contextMenu=document.getElementById("contextMenu");var xLeft=parseInt(contextMenu.style.left)+215;var yTop=parseInt(contextMenu.style.top);var winRect=getWindowRect();var subWidth=subContextMenuDiv.offsetWidth;
var baseWidth=winRect.x2;if(xLeft+subWidth>baseWidth){if(baseWidth-xLeft>=Math.max(xLeft-215,0)){xLeft-=(xLeft+subWidth-baseWidth);}else{xLeft=Math.max(xLeft-215*2,0);}}subContextMenuDiv.style.visibility="hidden";subContextMenuDiv.style.left=xLeft+"px";var subHeight=subContextMenuDiv.offsetHeight;var baseHeight=winRect.y2;if(Tr.offsetParent.id=="contextMenu.ContextMenuTable"){yTop+=Tr.offsetTop;if(yTop+subHeight>baseHeight){yTop=Math.max(baseHeight-subHeight,0);}subContextMenuDiv.style.top=yTop+"px";}if(mouseOverFunc&&typeof(mouseOverFunc)=="function"){subContextMenuDiv.style.visibility="visible";}}};var MouseOut=function(Tr,td){td.className="contextMenuItem"+td.itemClassName;if(contextSubMenuTimer!=null){clearTimeout(contextSubMenuTimer);}};var WireUpEventHandler=function(Target,Event,Listener){if(Target.addEventListener){Target.addEventListener(Event,Listener,false);}else{if(Target.attachEvent){Target.attachEvent("on"+Event,Listener);}else{Event="on"+Event;Target.Event=Listener;}}var EVENT={Target:Target,Event:Event,Listener:Listener};
EventHandlers.push(EVENT);};var DetachEventHandler=function(EVENT){if(EVENT.Target.removeEventListener){EVENT.Target.removeEventListener(EVENT.Event,EVENT.Listener,false);}else{if(EVENT.Target.detachEvent){EVENT.Target.detachEvent("on"+EVENT.Event,EVENT.Listener);}else{EVENT.Event="on"+EVENT.Event;EVENT.Target.EVENT.Event=null;}}};document.body.appendChild(ContextMenuDiv);WireUpEventHandler(Base,"click",this.Dispose);WireUpEventHandler(ContextMenuDiv,"contextmenu",function(){return false;});}var contextMenu=null;var subContextMenu=null;var OnClickContextMenu=function(Sender,EventArgs){var command=EventArgs.CommandName;if(command){command();if(contextMenu){contextMenu.Dispose();}if(subContextMenu){subContextMenu.Dispose();}}};AxisEditor.prototype.addEditContextMenu=function(elt,_onContextMenu){elt.isEditContextMenu=true;if(this.contextMenuFunc){elt.oncontextmenu=this.contextMenuFunc;}else{elt.oncontextmenu=_onContextMenu;}};function _onEditContextMenu(event){if(!event){event=window.event;
}var target=event.currentTarget?event.currentTarget:event.srcElement;if(target){if(tbReport.editMode&&target.isStyleContextMenu){createStyleContextMenu(event);return false;}else{if(tbReport.editable&&target.isEditContextMenu){tbReport.axisEditor.createEditContextMenu(event);return false;}}}return true;}AxisEditor.prototype.createEditContextMenu=function(event){if(this.isTableMode){this.createEditContextMenu_tables(event);}else{this.createEditContextMenu_charts(event);}};AxisEditor.prototype.createEditContextMenu_tables=function(event){var self=this;if(!event){event=window.event;}var oBase=document.body;var Arguments={Id:"contextMenu",Base:oBase,Modal:true,Width:250,FontColor:null,HoverFontColor:null,HoverBackgroundColor:null,HoverBorderColor:null,ClickEventListener:OnClickContextMenu};contextMenu=new CustomContextMenu(Arguments);var target=findEditable(event.currentTarget?event.currentTarget:event.srcElement);var bShowRemove,bShowReplace,bShowRemoveDim,bShowInsertDimBefore,bShowAddDimToAxis,bShowInsertDimAfter,bShowInsertMeasureBefore,bShowInsertMeasureAfter;
var isDimCol,isMeasureCol,isContDimCol;var axisId=target.editCtx.axisId;var measureIndex=target.editCtx.measureIndex;if(axisId!=this.chart.dmsel.measureAxis){isDimCol=true;isMeasureCol=false;bShowRemove=true;bShowRemoveDim=false;bShowReplace=true;bShowInsertDimBefore=true;bShowAddDimToAxis=true;bShowInsertDimAfter=true;bShowInsertMeasureBefore=false;bShowInsertMeasureAfter=false;if(target.editCtx.allowInsertMeasure){if(target.editCtx.allowInsertMeasure&DragEditHandler.ONAFTER){bShowInsertMeasureAfter=true;}}if(this.chart.dmsel.axis[axisId]){if(this.chart.dmsel.axis[axisId].length>1){bShowRemoveDim=true;}else{var dimEx=this.chart.dmsel.dimsToExplore[this.chart.dmsel.axis[axisId][0]];if(dimEx&&dimEx.dim&&dimEx.dim.continuous){isContDimCol=true;}}}}else{isDimCol=false;isContDimCol=false;isMeasureCol=true;bShowRemove=true;bShowRemoveDim=false;bShowReplace=true;bShowInsertDimBefore=false;bShowAddDimToAxis=false;bShowInsertDimAfter=false;bShowInsertMeasureBefore=true;bShowInsertMeasureAfter=true;
if(target.editCtx.allowInsertDim){if(target.editCtx.allowInsertDim&DragEditHandler.ONBEFORE){bShowInsertDimBefore=true;}}else{axisId=0;}}if(!bShowRemove&&!bShowReplace&&!bShowInsertDimBefore&&!bShowAddDimToAxis&&!bShowInsertDimAfter&&!bShowInsertMeasureBefore&&!bShowInsertMeasureAfter){return;}var sMsg;var sIndent="";if(bShowRemove){if(isDimCol){sMsg=Properties[getLocale()]["Edit.Menu.RemoveAxis"];contextMenu.AddItem(sMsg,false,function(){self.onAxisRemove(axisId);},null,0,"rem_axis");if(bShowRemoveDim){sMsg=Properties[getLocale()]["Edit.Menu.RemoveDim"];contextMenu.AddItem(sMsg,false,null,function(){self.showAddDimSubMenu(event,axisId,-1,REMOVE_MODE);},0,"rem_dim");}}else{if(measureIndex>=0){if(this.chart.dmsel.measuresToKeep[measureIndex].srvFormula&&canEditChartMeasure(this.chart.dmsel.measuresToKeep[measureIndex])){sMsg=Properties[getLocale()]["Edit.Menu.EditFormula"];var icm=0;for(;icm<this.chart.dmsel.chartMeasures.length;icm++){if(this.chart.dmsel.chartMeasures[icm]==this.chart.dmsel.measuresToKeep[measureIndex]){break;
}}if(icm<this.chart.dmsel.chartMeasures.length){contextMenu.AddItem(sMsg,false,function(){self.onFormulaEdit(icm);},null,0,"edit_formula");contextMenu.AddSeparatorItem();}}sMsg=Properties[getLocale()]["Edit.Menu.RemoveMeasure"];contextMenu.AddItem(sMsg,false,function(){self.onMeasureRemove(measureIndex);},null,0,"rem_meas");}}contextMenu.AddSeparatorItem();}if(bShowReplace){if(isDimCol){sMsg=Properties[getLocale()]["Edit.Menu.ReplaceAxis"];contextMenu.AddItem(sMsg,false,null,function(){self.showAddDimSubMenu(event,axisId,-1,ADD_MODE_REPLACE);},0,"repl_axis");}else{sMsg=Properties[getLocale()]["Edit.Menu.ReplaceMeasure"];contextMenu.AddItem(sMsg,false,null,function(){self.showAddMeasureSubMenu(event,axisId,measureIndex,ADD_MODE_REPLACE);},0,"repl_meas");}}if(bShowInsertDimBefore){sMsg=Properties[getLocale()]["Edit.Menu.InsertDimBefore"];contextMenu.AddItem(sMsg,false,null,function(){self.showAddDimSubMenu(event,axisId,-1,ADD_MODE_INSERT_BEFORE);},0,"ins_dim_b");}if(bShowInsertMeasureBefore){sMsg=Properties[getLocale()]["Edit.Menu.InsertMeasureBefore"];
contextMenu.AddItem(sMsg,false,null,function(){self.showAddMeasureSubMenu(event,axisId,measureIndex,ADD_MODE_INSERT_BEFORE);},0,"ins_meas_b");}if(bShowAddDimToAxis){sMsg=Properties[getLocale()]["Edit.Menu.AddDimToAxis"];contextMenu.AddItem(sMsg,false,null,function(){self.showAddDimSubMenu(event,axisId,-1,ADD_MODE_ADDTOAXIS);},0,"add_dim_axis");}if(bShowInsertDimAfter){sMsg=Properties[getLocale()]["Edit.Menu.InsertDimAfter"];contextMenu.AddItem(sMsg,false,null,function(){self.showAddDimSubMenu(event,axisId,-1,ADD_MODE_INSERT_AFTER);},0,"ins_dim_a");}if(bShowInsertMeasureAfter){sMsg=Properties[getLocale()]["Edit.Menu.InsertMeasureAfter"];contextMenu.AddItem(sMsg,false,null,function(){self.showAddMeasureSubMenu(event,axisId,measureIndex,ADD_MODE_INSERT_AFTER);},0,"ins_meas_a");}contextMenu.AddSeparatorItem();if(isDimCol){var overall=this.chart.dmsel.getOverall(axisId);sMsg=Properties[getLocale()]["Edit.Menu.AddOverallTop"];contextMenu.AddItem(sMsg,false,function(){self.onOverallChange(axisId,1);
},null,0,"add_total_s");sMsg=Properties[getLocale()]["Edit.Menu.AddOverallBottom"];contextMenu.AddItem(sMsg,false,function(){self.onOverallChange(axisId,-1);},null,0,"add_total_e");if(overall){sMsg=Properties[getLocale()]["Edit.Menu.ChangeOverallAggregation"];contextMenu.AddItem(sMsg,false,null,function(){self.showChgAggOverallSubMenu(event,axisId);},0,"chg_agg");sMsg=Properties[getLocale()]["Edit.Menu.RemoveOverall"];contextMenu.AddItem(sMsg,false,function(){self.onOverallChange(axisId,0);},null,0,"rem_total");}contextMenu.AddSeparatorItem();sMsg=Properties[getLocale()]["Edit.Menu.AddTop"];contextMenu.AddItem(sMsg,false,null,function(){self.showAddTopBottomSortSubMenu(event,axisId,TBSMODE_TOP);},0,"add_top");sMsg=Properties[getLocale()]["Edit.Menu.AddBottom"];contextMenu.AddItem(sMsg,false,null,function(){self.showAddTopBottomSortSubMenu(event,axisId,TBSMODE_BOTTOM);},0,"add_bottom");sMsg=Properties[getLocale()]["Edit.Menu.AddRange"];contextMenu.AddItem(sMsg,false,null,function(){self.showAddTopBottomSortSubMenu(event,axisId,TBSMODE_RANGE);
},0,"add_range");sMsg=Properties[getLocale()]["Edit.Menu.RemoveTopBottom"];contextMenu.AddItem(sMsg,false,function(){self.onTopBottomChange(axisId,null,TBSMODE_REMOVE);},null,0,"rem_topbottom");contextMenu.AddSeparatorItem();sMsg=Properties[getLocale()]["Edit.Menu.AddSortA"];contextMenu.AddItem(sMsg,false,function(){self.onAxisSortChange(axisId,"",TBSMODE_SORTA);},null,0,"add_sort_a");sMsg=Properties[getLocale()]["Edit.Menu.AddSortD"];contextMenu.AddItem(sMsg,false,function(){self.onAxisSortChange(axisId,"",TBSMODE_SORTD);},null,0,"add_sort_d");sMsg=Properties[getLocale()]["Edit.Menu.AddSortAOnMeasure"];contextMenu.AddItem(sMsg,false,null,function(){self.showAddTopBottomSortSubMenu(event,axisId,TBSMODE_SORTA);},0,"add_sortm_a");sMsg=Properties[getLocale()]["Edit.Menu.AddSortDOnMeasure"];contextMenu.AddItem(sMsg,false,null,function(){self.showAddTopBottomSortSubMenu(event,axisId,TBSMODE_SORTD);},0,"add_sortm_d");sMsg=Properties[getLocale()]["Edit.Menu.RemoveSort"];contextMenu.AddItem(sMsg,false,function(){self.onAxisSortChange(axisId,null,TBSMODE_REMOVE);
},null,0,"rem_sort");if(isContDimCol){contextMenu.AddSeparatorItem();sMsg=Properties[getLocale()]["Edit.Menu.ChangeFormat"];contextMenu.AddItem(sMsg,false,function(){self.onChangeFormat(-1,axisId);},null,0,"chg_format");}}else{sMsg=Properties[getLocale()]["Edit.Menu.ChangeAggregation"];contextMenu.AddItem(sMsg,false,null,function(){self.showChgAggSubMenu(event,measureIndex);},0,"chg_agg");sMsg=Properties[getLocale()]["Edit.Menu.ChangeFormat"];contextMenu.AddItem(sMsg,false,function(){self.onChangeFormat(measureIndex,-1);},null,0,"chg_format");var bHidden=this.chart.dmsel.measuresToKeepHidden[measureIndex];contextMenu.AddItem(Properties[getLocale()][bHidden?"Edit.Menu.ShowMeasure":"Edit.Menu.HideMeasure"],false,function(){self.onChangeVisibility(measureIndex,bHidden);},null,0,"chg_visibility");}contextMenu.Display(event);if(event.stopPropagation){event.stopPropagation();}event.cancelBubble=true;};AxisEditor.prototype.createEditContextMenu_charts=function(event){var self=this;if(!event){event=window.event;
}var oBase=document.body;var Arguments={Id:"contextMenu",Base:oBase,Modal:true,Width:250,FontColor:null,HoverFontColor:null,HoverBackgroundColor:null,HoverBorderColor:null,ClickEventListener:OnClickContextMenu};contextMenu=new CustomContextMenu(Arguments);var target=findEditable(event.currentTarget?event.currentTarget:event.srcElement);var axisId=target.editCtx.axisId;var measureIndex=target.editCtx.measureIndex;var dimIndex=target.editCtx.dimIndex;if(typeof(measureIndex)!="undefined"){if(this.chart.dmsel.measuresToKeep[measureIndex].srvFormula&&canEditChartMeasure(this.chart.dmsel.measuresToKeep[measureIndex])){var icm=0;for(;icm<this.chart.dmsel.chartMeasures.length;icm++){if(this.chart.dmsel.chartMeasures[icm]==this.chart.dmsel.measuresToKeep[measureIndex]){break;}}if(icm<this.chart.dmsel.chartMeasures.length){sMsg=Properties[getLocale()]["Edit.Menu.EditFormula"];contextMenu.AddItem(sMsg,false,function(){self.onFormulaEdit(icm);},null,0,"edit_formula");contextMenu.AddSeparatorItem();
}}var measure=this.chart.dmsel.measuresToKeep[measureIndex];if(measure&&measure.targets){for(var i in measure.targets){contextMenu.AddItem(Properties[getLocale()]["Edit.Menu.ChangeTarget"],false,null,function(){self.showMeasureTargetSubMenu(event,axisId,measureIndex);},0,null);contextMenu.AddSeparatorItem();break;}}contextMenu.AddItem(Properties[getLocale()]["Edit.Menu.RemoveMeasure"],false,function(){self.onMeasureRemove(measureIndex);},null,0,"rem_meas");contextMenu.AddSeparatorItem();contextMenu.AddItem(Properties[getLocale()]["Edit.Menu.ReplaceMeasure"],false,null,function(){self.showAddMeasureSubMenu(event,axisId,measureIndex,ADD_MODE_REPLACE);},0,"repl_meas");contextMenu.AddItem(Properties[getLocale()]["Edit.Menu.InsertMeasureBefore"],false,null,function(){self.showAddMeasureSubMenu(event,axisId,measureIndex,ADD_MODE_INSERT_BEFORE);},0,"ins_meas_b");contextMenu.AddItem(Properties[getLocale()]["Edit.Menu.InsertMeasureAfter"],false,null,function(){self.showAddMeasureSubMenu(event,axisId,measureIndex,ADD_MODE_INSERT_AFTER);
},0,"ins_meas_a");contextMenu.AddItem(Properties[getLocale()]["Edit.Menu.ChangeAggregation"],false,null,function(){self.showChgAggSubMenu(event,measureIndex);},0,"chg_agg");contextMenu.AddItem(Properties[getLocale()]["Edit.Menu.ChangeFormat"],false,function(){self.onChangeFormat(measureIndex,-1);},null,0,"chg_format");var bHidden=this.chart.dmsel.measuresToKeepHidden[measureIndex];contextMenu.AddItem(Properties[getLocale()][bHidden?"Edit.Menu.ShowMeasure":"Edit.Menu.HideMeasure"],false,function(){self.onChangeVisibility(measureIndex,bHidden);},null,0,"chg_visibility");}else{if(typeof(dimIndex)!="undefined"){contextMenu.AddItem(Properties[getLocale()]["Edit.Menu.RemoveDim"],false,function(){self.onDimensionRemove(axisId,dimIndex);},null,0,"rem_dim");contextMenu.AddSeparatorItem();contextMenu.AddItem(Properties[getLocale()]["Edit.Menu.ReplaceDim"],false,null,function(){self.showAddDimSubMenu(event,axisId,dimIndex,ADD_MODE_REPLACE);},0,"repl_axis");contextMenu.AddItem(Properties[getLocale()]["Edit.Menu.InsertDimBefore"],false,null,function(){self.showAddDimSubMenu(event,axisId,dimIndex,ADD_MODE_INSERT_BEFORE);
},0,"ins_dim_b");contextMenu.AddItem(Properties[getLocale()]["Edit.Menu.InsertDimAfter"],false,null,function(){self.showAddDimSubMenu(event,axisId,dimIndex,ADD_MODE_INSERT_AFTER);},0,"ins_dim_a");if(this.chart.dmsel.axis[axisId]&&this.chart.dmsel.axis[axisId].length==1){var dimEx=this.chart.dmsel.dimsToExplore[this.chart.dmsel.axis[axisId][0]];if(dimEx&&dimEx.dim&&dimEx.dim.continuous){contextMenu.AddItem(Properties[getLocale()]["Edit.Menu.ChangeFormat"],false,function(){self.onChangeFormat(-1,axisId);},null,0,"chg_format");}}}else{var acceptMeasure=true;var measureOnly=false;var vizDesc=getVizDescriptor(this.chart);if(vizDesc&&vizDesc.axis&&vizDesc.axis[axisId]){acceptMeasure=vizDesc.axis[axisId].acceptMeasure;measureOnly=vizDesc.axis[axisId].measureOnly;}var isAxisEmpty=!this.chart.dmsel.axis[axisId]||this.chart.dmsel.axis[axisId].length==0;if(!measureOnly){contextMenu.AddItem(Properties[getLocale()]["Edit.Menu.AddDimToAxis"],false,null,function(){self.showAddDimSubMenu(event,axisId,-1,ADD_MODE_ADDTOAXIS);
},0,"add_dim_axis");}if(acceptMeasure){contextMenu.AddItem(Properties[getLocale()]["Edit.Menu.AddMeasureToAxis"],false,null,function(){self.showAddMeasureSubMenu(event,axisId,-1,ADD_MODE_ADDTOAXIS);},0,"add_dim_axis");}if(!measureOnly&&!isAxisEmpty){contextMenu.AddSeparatorItem();var overall=this.chart.dmsel.getOverall(axisId);contextMenu.AddItem(Properties[getLocale()]["Edit.Menu.AddOverallTop"],false,function(){self.onOverallChange(axisId,1);},null,0,"add_total_s");contextMenu.AddItem(Properties[getLocale()]["Edit.Menu.AddOverallBottom"],false,function(){self.onOverallChange(axisId,-1);},null,0,"add_total_e");if(overall){contextMenu.AddItem(Properties[getLocale()]["Edit.Menu.ChangeOverallAggregation"],false,null,function(){self.showChgAggOverallSubMenu(event,axisId);},0,"chg_agg");contextMenu.AddItem(Properties[getLocale()]["Edit.Menu.RemoveOverall"],false,function(){self.onOverallChange(axisId,0);},null,0,"rem_total");}contextMenu.AddSeparatorItem();contextMenu.AddItem(Properties[getLocale()]["Edit.Menu.AddTop"],false,null,function(){self.showAddTopBottomSortSubMenu(event,axisId,TBSMODE_TOP);
},0,"add_top");contextMenu.AddItem(Properties[getLocale()]["Edit.Menu.AddBottom"],false,null,function(){self.showAddTopBottomSortSubMenu(event,axisId,TBSMODE_BOTTOM);},0,"add_bottom");contextMenu.AddItem(Properties[getLocale()]["Edit.Menu.AddRange"],false,null,function(){self.showAddTopBottomSortSubMenu(event,axisId,TBSMODE_RANGE);},0,"add_range");contextMenu.AddItem(Properties[getLocale()]["Edit.Menu.RemoveTopBottom"],false,function(){self.onTopBottomChange(axisId,null,TBSMODE_REMOVE);},null,0,"rem_topbottom");contextMenu.AddSeparatorItem();contextMenu.AddItem(Properties[getLocale()]["Edit.Menu.AddSortA"],false,function(){self.onAxisSortChange(axisId,"",TBSMODE_SORTA);},null,0,"add_sort_a");contextMenu.AddItem(Properties[getLocale()]["Edit.Menu.AddSortD"],false,function(){self.onAxisSortChange(axisId,"",TBSMODE_SORTD);},null,0,"add_sort_d");contextMenu.AddItem(Properties[getLocale()]["Edit.Menu.AddSortAOnMeasure"],false,null,function(){self.showAddTopBottomSortSubMenu(event,axisId,TBSMODE_SORTA);
},0,"add_sortm_a");contextMenu.AddItem(Properties[getLocale()]["Edit.Menu.AddSortDOnMeasure"],false,null,function(){self.showAddTopBottomSortSubMenu(event,axisId,TBSMODE_SORTD);},0,"add_sortm_d");contextMenu.AddItem(Properties[getLocale()]["Edit.Menu.RemoveSort"],false,function(){self.onAxisSortChange(axisId,null,TBSMODE_REMOVE);},null,0,"rem_sort");}if(this.chart.axisLabels&&this.chart.axisLabels[axisId]){contextMenu.AddSeparatorItem();if(this.chart.axisLabels[axisId].changecolor){contextMenu.AddItem(Properties[getLocale()]["Edit.Menu.ColorCyclingDisable"],false,function(){self.onSetColorCycling(axisId,false);},null,0,"set_ccycle");}else{contextMenu.AddItem(Properties[getLocale()]["Edit.Menu.ColorCyclingEnable"],false,function(){self.onSetColorCycling(axisId,true);},null,0,"set_ccycle");}}}}contextMenu.Display(event);if(event.stopPropagation){event.stopPropagation();}event.cancelBubble=true;};function findEditable(target){while(!target.editCtx&&target.parentNode){target=target.parentNode;
}return target;}var ADD_MODE_INSERT_BEFORE=0;var ADD_MODE_INSERT_AFTER=1;var ADD_MODE_REPLACE=2;var ADD_MODE_ADDTOAXIS=3;var REMOVE_MODE=4;AxisEditor.prototype.showAddDimSubMenu=function(event,axisId,dimIndexInAxis,addMode){var self=this;var oBase=document.body;var Arguments={Id:"subContextMenu",Base:oBase,Modal:false,Width:250,FontColor:null,HoverFontColor:null,HoverBackgroundColor:null,HoverBorderColor:null,ClickEventListener:OnClickContextMenu};subContextMenu=new CustomContextMenu(Arguments);var sIndent="";sMsg=Properties[getLocale()]["Edit.Menu.AvailableDimensions"];subContextMenu.AddItem(sMsg,true,null,null,0,"subtitle_class");var dmsel=this.chart.dmsel;if(addMode==REMOVE_MODE){for(var i=0;i<dmsel.axis[axisId].length;i++){var dim=dmsel.dimsToExplore[dmsel.axis[axisId][i]].dim;sMsg=sIndent+dim.name;var f=(function(){var iLoc=i;var axisIdLoc=axisId;return function(){self.onDimensionRemove(axisIdLoc,iLoc);};})();subContextMenu.AddItem(sMsg,false,f,null,0,"dim_class");}}else{for(var i=0;
i<dmsel.dm.dimensions.length;i++){if(!dmsel.dm.dimensions[i].archived){sMsg=sIndent+dmsel.dm.dimensions[i].name;var f=(function(){var dimLoc=dmsel.dm.dimensions[i];var axisIdLoc=axisId;var addModeLoc=addMode;var dimIndexInAxisLoc=dimIndexInAxis;return function(){self.onDimensionAdd(dimLoc,axisIdLoc,dimIndexInAxisLoc,addModeLoc);};})();subContextMenu.AddItem(sMsg,false,f,null,0,"dim_class");}}}subContextMenu.Display(event);};AxisEditor.prototype.onAxisRemove=function(axisId){if(this.removeAxis(this.chart.dmsel,axisId)){this.refreshDM();}};AxisEditor.prototype.onDimensionRemove=function(axisId,dimIndexInAxis){if(this.removeDim(this.chart.dmsel,axisId,dimIndexInAxis)){this.refreshDM();}};AxisEditor.prototype.onDimensionAdd=function(dim,axisId,dimIndexInAxis,addMode){var dmsel=this.chart.dmsel;if(this.isTableMode){if(addMode==ADD_MODE_REPLACE){dmsel.removeAxis(axisId);dmsel.insertNewAxis(axisId,dim,-1,-1,null);if(this.isAutoSortNewDim(axisId)){this.changeAxisSort(dmsel,axisId,"",TBSMODE_SORTA);
}this.refreshDM();}else{if(addMode==ADD_MODE_INSERT_BEFORE){dmsel.insertNewAxis(axisId,dim,-1,-1,null);if(this.isAutoSortNewDim(axisId)){this.changeAxisSort(dmsel,axisId,"",TBSMODE_SORTA);}this.refreshDM();}else{if(addMode==ADD_MODE_INSERT_AFTER){dmsel.insertNewAxis(axisId+1,dim,-1,-1,null);if(this.isAutoSortNewDim(axisId+1)){this.changeAxisSort(dmsel,axisId+1,"",TBSMODE_SORTA);}this.refreshDM();}else{if(addMode==ADD_MODE_ADDTOAXIS){dmsel.addBrowse(axisId,dim,-1,-1,null);this.refreshDM();}}}}}else{if(addMode==ADD_MODE_REPLACE){dmsel.removeBrowse(axisId,dimIndexInAxis,false);dmsel.insertBrowse(axisId,dim,-1,-1,null,dimIndexInAxis);this.refreshDM();}else{if(addMode==ADD_MODE_INSERT_BEFORE){dmsel.insertBrowse(axisId,dim,-1,-1,null,dimIndexInAxis);this.refreshDM();}else{if(addMode==ADD_MODE_INSERT_AFTER){dmsel.insertBrowse(axisId,dim,-1,-1,null,dimIndexInAxis+1);this.refreshDM();}else{if(addMode==ADD_MODE_ADDTOAXIS){dmsel.addBrowse(axisId,dim,-1,-1,null);this.refreshDM();}}}}}};AxisEditor.prototype.isAutoSortNewDim=function(axisId){if(this.chart.autoSortNewDim===false){return false;
}return true;};AxisEditor.prototype.onOverallChange=function(axisId,overAllPos){if(overAllPos==0){this.chart.dmsel.removeOverall(axisId);this.refreshDM();}else{this.chart.dmsel.addOverall(axisId,overAllPos,"",-1);this.refreshDM();}};AxisEditor.prototype.showChgAggOverallSubMenu=function(event,axisId){var self=this;var oBase=document.body;var Arguments={Id:"subContextMenu",Base:oBase,Modal:false,Width:250,FontColor:null,HoverFontColor:null,HoverBackgroundColor:null,HoverBorderColor:null,ClickEventListener:OnClickContextMenu};subContextMenu=new CustomContextMenu(Arguments);var sIndent="";sMsg=Properties[getLocale()]["Edit.Menu.AvailableAggregations"];subContextMenu.AddItem(sMsg,true,null,null,0,"subtitle_class");var dmsel=this.chart.dmsel;var aggs=[-1,0,1,2,3,4,11];for(var ia=0;ia<aggs.length;ia++){var a=aggs[ia];if(a==-1){sMsg=sIndent+Properties[getLocale()]["Edit.Menu.Agg"+a+"_Overall"];}else{sMsg=sIndent+Properties[getLocale()]["Edit.Menu.Agg"+a];}var f=(function(){var axisIdLoc=axisId;
var aggIdLoc=a;return function(){self.onOverallChgAgg(axisIdLoc,aggIdLoc);};})();subContextMenu.AddItem(sMsg,false,f,null,0,"agg"+a+"_class");}subContextMenu.Display(event);};AxisEditor.prototype.onOverallChgAgg=function(axisId,aggId){var overall=this.chart.dmsel.getOverall(axisId);if(overall){overall.agg=aggId;this.refreshDM();}};AxisEditor.prototype.onSetColorCycling=function(axisId,cycleColor){this.chart.axisLabels[axisId].changecolor=cycleColor;this.refreshDM();};var TBSMODE_REMOVE=0;var TBSMODE_BOTTOM=-1;var TBSMODE_TOP=1;var TBSMODE_SORTD=2;var TBSMODE_SORTA=-2;var TBSMODE_RANGE=3;AxisEditor.prototype.showAddTopBottomSortSubMenu=function(event,axisId,mode){var self=this;var oBase=document.body;var Arguments={Id:"subContextMenu",Base:oBase,Modal:false,Width:250,FontColor:null,HoverFontColor:null,HoverBackgroundColor:null,HoverBorderColor:null,ClickEventListener:OnClickContextMenu};subContextMenu=new CustomContextMenu(Arguments);var sIndent="";sMsg=Properties[getLocale()]["Edit.Menu.AvailableMeasures"];
subContextMenu.AddItem(sMsg,true,null,null,0,"subtitle_class");var dmsel=this.chart.dmsel;for(var i=0;i<dmsel.measuresToKeep.length;i++){sMsg=sIndent+dmsel.measuresToKeep[i].name;var f;if(mode==TBSMODE_BOTTOM||mode==TBSMODE_TOP||mode==TBSMODE_RANGE){f=(function(){var axisIdLoc=axisId;var topBottomLoc=mode;var measLoc=dmsel.measuresToKeep[i];return function(){self.onTopBottomChange(axisIdLoc,measLoc,topBottomLoc);};})();}else{if(mode==TBSMODE_SORTD||mode==TBSMODE_SORTA){f=(function(){var axisIdLoc=axisId;var sortOrderLoc=mode;var measLoc=dmsel.measuresToKeep[i];return function(){self.onAxisSortChange(axisIdLoc,measLoc,sortOrderLoc);};})();}}subContextMenu.AddItem(sMsg,false,f,null,0,"meas_class");}subContextMenu.Display(event);};AxisEditor.prototype.changeTopBottom=function(dmsel,axisId,measure,topBottom){var self=this;if(topBottom==TBSMODE_REMOVE){dmsel.removeValueFilterForAxis(axisId);return true;}else{if(measure!=null){if(topBottom==TBSMODE_RANGE){this.promptRange(function(min,max){var mode=topBottom==TBSMODE_TOP?"top":"bottom";
dmsel.removeValueFilterForAxis(axisId);dmsel.addValueFilter(new ValueFilter(axisId,measure.idxCol,"range",[min,max],false,measure.id));self.refreshDM();});}else{promptInt(Properties[getLocale()]["Edit.Menu.NbTopBottom"],"",1,Infinity,1,false,function(str){var x=parseInt(str);if(isNaN(x)){return;}else{var mode=topBottom==TBSMODE_TOP?"top":"bottom";dmsel.removeValueFilterForAxis(axisId);dmsel.addValueFilter(new ValueFilter(axisId,measure.idxCol,mode,x,false,measure.id));self.refreshDM();}});}return false;}else{alert(getLocMessage("Edit.Menu.MeasureNotInView"));}}return false;};AxisEditor.prototype.onTopBottomChange=function(axisId,measure,topBottom){if(this.changeTopBottom(this.chart.dmsel,axisId,measure,topBottom)){this.refreshDM();}};AxisEditor.prototype.changeFormat=function(dmsel,measureIndex,axisId){var self=this;var formatTypes=[getLocMessage("Edit.Menu.formatNumber"),getLocMessage("Edit.Menu.formatDate"),getLocMessage("Edit.Menu.formatIcon"),getLocMessage("Edit.Menu.formatMonth"),getLocMessage("Edit.Menu.formatPercentage"),getLocMessage("Edit.Menu.formatTime"),getLocMessage("Edit.Menu.formatAlerter")];
var formats=getFormats(dmsel);var formatIds=[""];var formatNames=[getLocMessage("Edit.Menu.DefaultDMFormat")];for(var i=0;i<formats.length;i++){var format=formats[i];formatIds.push(format.id);formatNames.push(format.id+" ("+formatTypes[format.type]+")");}if(measureIndex>-1){var curFormat=dmsel.fmtsForMeasure[measureIndex];var curFormatId=(curFormat&&curFormat.id)?curFormat.id:"";promptSelect(getLocMessage("Edit.Menu.ChangeFormat"),curFormatId,formatIds,formatNames,function(str){if(str!=curFormatId){if(str){var fmt=dmsel.dm.formatList[str];if(fmt){dmsel.fmtsForMeasure[measureIndex]=fmt;if(dmsel.measuresToKeep[measureIndex]&&dmsel.measuresToKeep[measureIndex].srvFormula){dmsel.measuresToKeep[measureIndex].format=fmt;}self.refreshDM();}}else{dmsel.fmtsForMeasure[measureIndex]=null;self.refreshDM();}}});return false;}else{if(axisId>-1){var dimEx=dmsel.dimsToExplore[dmsel.axis[axisId][0]];if(dimEx){var curFormatId=(dimEx.format&&dimEx.format.id)?dimEx.format.id:"";promptSelect(getLocMessage("Edit.Menu.ChangeFormat"),curFormatId,formatIds,formatNames,function(str){if(str!=curFormatId){if(str){var fmt=dmsel.dm.formatList[str];
if(fmt){dimEx.format=fmt;self.refreshDM();}}else{dimEx.format=null;self.refreshDM();}}});return false;}}else{alert(getLocMessage("Edit.Menu.MeasureNotInView"));}}return false;};AxisEditor.prototype.onChangeFormat=function(measureIndex,axisId){if(this.changeFormat(this.chart.dmsel,measureIndex,axisId)){this.refreshDM();}};AxisEditor.prototype.changeVisibility=function(dmsel,measureIndex,bShow){if(measureIndex>-1){if(dmsel.measuresToKeepHidden.length>measureIndex){dmsel.measuresToKeepHidden[measureIndex]=!bShow;return true;}}return false;};AxisEditor.prototype.onChangeVisibility=function(measureIndex,bShow){if(this.changeVisibility(this.chart.dmsel,measureIndex,bShow)){this.refreshDM();}};AxisEditor.prototype.changeAxisSort=function(dmsel,axisId,measure,sortOrder){if(sortOrder==TBSMODE_REMOVE){var as=dmsel.getAxisSortByAxisId(axisId);if(as){dmsel.removeAxisSort(as);return true;}}else{if(measure!=null&&measure!==""){var as=dmsel.getAxisSortByAxisId(axisId);if(as){dmsel.removeAxisSort(as);}dmsel.addAxisSort(new AxisSort(axisId,2,sortOrder==TBSMODE_SORTD,measure.idxCol,measure.id,false));
dmsel.sortAxisSorts();return true;}else{if(measure===""){var as=dmsel.getAxisSortByAxisId(axisId);if(as){dmsel.removeAxisSort(as);}var sortType=0;var onCaption=false;if(dmsel.axis[axisId]&&dmsel.axis[axisId].length==1){var dimEx=dmsel.dimsToExplore[dmsel.axis[axisId][0]];if(dimEx){if(dimEx.dim.continuous){sortType=1;}else{sortType=dimEx.dim.order?3:0;}onCaption=dimEx.dim.sortOnCaption;}}dmsel.addAxisSort(new AxisSort(axisId,sortType,sortOrder==TBSMODE_SORTD,-1,null,onCaption));dmsel.sortAxisSorts();return true;}else{alert(getLocMessage("Edit.Menu.MeasureNotInView"));}}}return false;};AxisEditor.prototype.onAxisSortChange=function(axisId,measure,sortOrder){if(this.changeAxisSort(this.chart.dmsel,axisId,measure,sortOrder)){this.refreshDM();}};AxisEditor.prototype.showAddMeasureSubMenu=function(event,axisId,insertPos,addMode){var self=this;var oBase=document.body;var Arguments={Id:"subContextMenu",Base:oBase,Modal:false,Width:250,FontColor:null,HoverFontColor:null,HoverBackgroundColor:null,HoverBorderColor:null,ClickEventListener:OnClickContextMenu};
subContextMenu=new CustomContextMenu(Arguments);var sIndent="";sMsg=Properties[getLocale()]["Edit.Menu.AvailableMeasures"];subContextMenu.AddItem(sMsg,true,null,null,0,"subtitle_class");var dmsel=this.chart.dmsel;var dm=dmsel.dm;for(var i=0;i<dm.measures.length;i++){if(!dm.measures[i].hidden&&!dm.measures[i].archived){sMsg=sIndent+dm.measures[i].name;var f=(function(){var measLoc=dm.measures[i];var axisIdLoc=axisId;var insertPosLoc=insertPos;var addModeLoc=addMode;return function(){self.onMeasureAdd(measLoc,axisIdLoc,insertPosLoc,addModeLoc);};})();subContextMenu.AddItem(sMsg,false,f,null,0,"meas_class");}}subContextMenu.Display(event);};AxisEditor.prototype.showMeasureTargetSubMenu=function(event,axisId,measureIndex){var self=this;var oBase=document.body;var Arguments={Id:"subContextMenu",Base:oBase,Modal:false,Width:250,FontColor:null,HoverFontColor:null,HoverBackgroundColor:null,HoverBorderColor:null,ClickEventListener:OnClickContextMenu};subContextMenu=new CustomContextMenu(Arguments);
var sIndent="";sMsg=Properties[getLocale()]["Edit.Menu.AvailableTargets"];subContextMenu.AddItem(sMsg,true,null,null,0,"subtitle_class");var dmsel=this.chart.dmsel;var dm=dmsel.dm;var measure=dmsel.measuresToKeep[measureIndex];if(measure&&measure.targets){var bHasTargets=false;for(var i in measure.targets){sMsg=sIndent+measure.targets[i].name;var f=(function(){var tgtIdLoc=measure.targets[i].id;var measureIndexLoc=measureIndex;return function(){self.onMeasureChgTarget(measureIndexLoc,tgtIdLoc);};})();var selTgt=(dmsel.targetsForMeasure&&dmsel.targetsForMeasure[measureIndex]&&dmsel.targetsForMeasure[measureIndex]==measure.targets[i].id)?true:false;subContextMenu.AddItem(sMsg,false,f,null,0,"target_class"+(selTgt?" sel":""));bHasTargets=true;}if(bHasTargets){sMsg=sIndent+getLocMessage("Edit.Menu.None");var f=(function(){var tgtIdLoc=null;var measureIndexLoc=measureIndex;return function(){self.onMeasureChgTarget(measureIndexLoc,null);};})();var selNoTgt=(!dmsel.targetsForMeasure||!dmsel.targetsForMeasure[measureIndex])?true:false;
subContextMenu.AddItem(sMsg,false,f,null,0,"target_class"+(selNoTgt?" sel":""));}}subContextMenu.Display(event);};AxisEditor.prototype.onMeasureRemove=function(pos){if(this.removeMeasure(this.chart.dmsel,pos)){this.refreshDM();}};AxisEditor.prototype.onFormulaEdit=function(cmIndex){var dmsel=this.chart.dmsel;if(cmIndex<0||cmIndex>=dmsel.chartMeasures.length){return;}var srcMeas=dmsel.chartMeasures[cmIndex];var srcName=srcMeas.id;var srcFormula=srcMeas.srvFormula;if(!srcFormula){return;}var srcFormat=srcMeas.format.id;var selfae=this;this.promptFormula(function(name,formula,format){var existMeasure=dmsel.findMeasure(name);if(!existMeasure||existMeasure==srcMeas){try{var localMeas2=dmsel.editDerivedCalculation(srcMeas,name,formula,format);if(localMeas2){selfae.updateToolbarChartMeasures();selfae.refreshDM();}}catch(e){localMeas2=dmsel.editDerivedCalculation(srcMeas,srcName,srcFormula,srcMeas.format);selfae.onFormulaEdit(cmIndex);var eMsg=e.toString();if(eMsg.indexOf("stack")>-1||eMsg.indexOf("recursion")>-1||eMsg.indexOf("pile")>-1){alert(getLocMessage("Edit.Menu.FormulaLoopError"));
}else{alert(getLocMessage("Edit.Menu.FormulaError",eMsg));}}}},null,srcName,dmsel.formulaUIzer(srcFormula,srcMeas.srvAssocM),srcFormat);};AxisEditor.prototype.onMeasureAdd=function(measure,axisId,insertPos,addMode){var dmsel=this.chart.dmsel;if(addMode==ADD_MODE_REPLACE){if(dmsel.removeMeasure(insertPos)&&dmsel.insertMeasure(insertPos,measure)){this.refreshDM();}}else{var curIndex=dmsel.indexOfMeasure(measure.id);if(curIndex>-1){if(insertPos>curIndex){insertPos--;}if(!dmsel.removeMeasure(curIndex)){return;}}}var bRefresh=false;if(addMode==ADD_MODE_INSERT_BEFORE){if(dmsel.insertMeasure(insertPos,measure)){bRefresh=true;}}else{if(addMode==ADD_MODE_INSERT_AFTER){if(dmsel.insertMeasure(insertPos+1,measure)){bRefresh=true;}}else{if(addMode==ADD_MODE_ADDTOAXIS){if(axisId!=dmsel.measureAxis){dmsel.measureAxis=axisId;alert(Properties[getLocale()]["Edit.Menu.MeasureAxisChanged"]);}if(dmsel.insertMeasure(dmsel.measuresToKeep.length,measure)){bRefresh=true;}}}}if(bRefresh){var vizDesc=getVizDescriptor(this.chart);
if(vizDesc){var maxMeas=vizDesc.measuresMax;if(maxMeas>-1&&dmsel.measuresToKeep.length>maxMeas){var ind=dmsel.measuresToKeep.length-1;while(!dmsel.measuresToKeep[ind]||dmsel.measuresToKeep[ind].id==measure.id){ind--;}dmsel.removeMeasure(ind);}}this.refreshDM();}};AxisEditor.prototype.showChgAggSubMenu=function(event,measPos){var self=this;var oBase=document.body;var Arguments={Id:"subContextMenu",Base:oBase,Modal:false,Width:250,FontColor:null,HoverFontColor:null,HoverBackgroundColor:null,HoverBorderColor:null,ClickEventListener:OnClickContextMenu};subContextMenu=new CustomContextMenu(Arguments);var sIndent="";sMsg=Properties[getLocale()]["Edit.Menu.AvailableAggregations"];subContextMenu.AddItem(sMsg,true,null,null,0,"subtitle_class");var dmsel=this.chart.dmsel;var aggs=[-1,0,1,2,3,4,11];for(var ia=0;ia<aggs.length;ia++){var a=aggs[ia];var derivedMeas=dmsel.measuresToKeep[measPos].idxCol<0;if((!derivedMeas&&a>-1)||(derivedMeas&&(a==-1||a==AGG_RSM))){sMsg=sIndent+Properties[getLocale()]["Edit.Menu.Agg"+a];
var f=(function(){var measPosLoc=measPos;var aggIdLoc=a;return function(){self.onMeasureChgAgg(measPosLoc,aggIdLoc);};})();subContextMenu.AddItem(sMsg,false,f,null,0,"agg"+a+"_class");}}subContextMenu.Display(event);};AxisEditor.prototype.onMeasureChgAgg=function(pos,aggId){if(this.chart.dmsel.changeAgg(pos,aggId)){this.refreshDM();}};AxisEditor.prototype.onMeasureChgTarget=function(measureIndex,targetId){if(this.chart.dmsel.setMeasureTarget(measureIndex,targetId)){this.refreshDM();}};AxisEditor.prototype.createMeasureDropContextMenu=function(event,measure){var self=this;if(!event){event=window.event;}var oBase=document.body;var Arguments={Id:"contextMenu",Base:oBase,Modal:true,Width:250,FontColor:null,HoverFontColor:null,HoverBackgroundColor:null,HoverBorderColor:null,ClickEventListener:OnClickContextMenu};contextMenu=new CustomContextMenu(Arguments);var target=findEditable(event.currentTarget?event.currentTarget:event.srcElement);var sIndent="";var axisId=target.editCtx.axisId;sMsg=Properties[getLocale()]["Edit.Menu.AddTop"];
contextMenu.AddItem(sMsg,false,function(){self.onTopBottomChange(axisId,measure,TBSMODE_TOP);},null,0,"add_top");sMsg=Properties[getLocale()]["Edit.Menu.AddBottom"];contextMenu.AddItem(sMsg,false,function(){self.onTopBottomChange(axisId,measure,TBSMODE_BOTTOM);},null,0,"add_bottom");sMsg=Properties[getLocale()]["Edit.Menu.AddSortAOnMeasure"];contextMenu.AddItem(sMsg,false,function(){self.onAxisSortChange(axisId,measure,TBSMODE_SORTA);},null,0,"add_sortm_a");sMsg=Properties[getLocale()]["Edit.Menu.AddSortDOnMeasure"];contextMenu.AddItem(sMsg,false,function(){self.onAxisSortChange(axisId,measure,TBSMODE_SORTD);},null,0,"add_sortm_d");contextMenu.Display(event);if(event.stopPropagation){event.stopPropagation();}event.cancelBubble=true;};AxisEditor.prototype.createSelectDimDropContextMenu=function(event,bOnlyContinuous,callback){var self=this;if(!event){event=window.event;}var oBase=document.body;var Arguments={Id:"contextMenu",Base:oBase,Modal:true,Width:250,FontColor:null,HoverFontColor:null,HoverBackgroundColor:null,HoverBorderColor:null,ClickEventListener:OnClickContextMenu};
contextMenu=new CustomContextMenu(Arguments);var target=findEditable(event.currentTarget?event.currentTarget:event.srcElement);var sIndent="";var dm=this.chart.dmsel.dm;for(var iDim=0;iDim<dm.dimensions.length;iDim++){var dim=dm.dimensions[iDim];if(!bOnlyContinuous||dim.continuous){sMsg=dim.name;var f=(function(){var dimIdLoc=dim.id;return function(){callback(dimIdLoc);};})();contextMenu.AddItem(sMsg,false,f,null,0,"dim_class");}}contextMenu.Display(event);if(event.stopPropagation){event.stopPropagation();}event.cancelBubble=true;};function AxisEditorOptions(){this.panelWidth=200;this.expanded={"export":false,views:false,dimensions:true,dimOptions:false,measures:true,measOptions:false};this.styleEdit=false;}function AxisEditor(chart,templateScope){this.chart=chart;this.isTableMode=false;this.templateScope=templateScope;this.dragEditHandler=new DragEditHandler(chart);this.options=new AxisEditorOptions();this.subdivviewsId="subdivviews_"+chart.frameId;this.subdivformulasId="subdivformulas_"+chart.frameId;
if(typeof(this.chart.getExportOptionsOrig)=="undefined"){this.chart.getExportOptionsOrig=this.chart.getExportOptions;if(!this.chart.getExportOptionsOrig){this.chart.getExportOptionsOrig=null;}this.chart.getExportOptions=function(){var str=null;if(this.getExportOptionsOrig){str=this.getExportOptionsOrig();}var options=new ChartOptions(this);str=(str?str:"")+options.toJS();return str?str:null;};}}AxisEditor.prototype.refreshDM=function(){try{if(this.chart.toolTip){this.chart.toolTip.tooltipPrototype=this.buildDefaultTooltip();}if(typeof(this.templateScope.removeZoom)=="function"){this.templateScope.removeZoom(null,null,null);}this.templateScope.refreshDM(this.chart.dmsel.dm,this.chart.dmsel);}catch(e){alert(getLocMessage("Edit.Menu.SelectionError"));}if(this.dropZones){this.updateDropZones();}};AxisEditor.prototype.drawEditToolbarSave=function(divEditToolbar){var isDashboard=ddCtrl.isDashboard?true:false;var isDashboardEditor=(ddCtrl.isDashboard&&ddCtrl.urlParams.mode=="editor")?true:false;
var exportToFlowURL=null;var bShowExportToFlow=false;if(!isDashboard){if(typeof(ddCtrl.exportTemplates)=="undefined"||!ddCtrl.exportTemplates.TOFLOW){return;}else{if(typeof(ddCtrl.exportTemplates)!="undefined"&&ddCtrl.exportTemplates.TOFLOW){exportToFlowURL=ddCtrl.exportTemplates.TOFLOW;bShowExportToFlow=true;}}}else{if(isDashboardEditor){if(this.chart.editMode){return;}if(this.chart.roleId&&(!ddCtrl.userACLs.SaveWalletForGroup)){return;}bShowExportToFlow=true;}}if(bShowExportToFlow){var self=this;var div=this.createDiv(getLocMessage("Edit.Menu.Save"),"editTool bigbutton",null,30);var funcSave=function(fName){if(fName){if(isDashboard){ddCtrl.__exportName=fName;ddCtrl.__overwrite=true;ddCtrl.doExport(self.chart.flowId,"TOFLOW");}else{ddCtrl.__exportName=fName;ddCtrl.__overwrite=true;ddCtrl.saveAs(exportToFlowURL,"TOFLOW");}}};var onclick=function(event){var fName=self.chart.title;confirm(getLocMessage("Edit.Menu.ConfirmFlowOverwrite"),function(){funcSave(fName);});};div.onclick=onclick;divEditToolbar.appendChild(div);
}};AxisEditor.prototype.drawEditToolbarExport=function(divEditToolbar){var isDashboard=ddCtrl.isDashboard?true:false;var isDashboardEditor=(ddCtrl.isDashboard&&ddCtrl.urlParams.mode=="editor")?true:false;var self=this;var exportToFlowURL=null;var bShowExportToFlow=false;if(!isDashboard){if(typeof(ddCtrl.exportTemplates)=="undefined"||(!ddCtrl.exportTemplates.PDF&&!ddCtrl.exportTemplates.PPT&&!ddCtrl.exportTemplates.XLS&&!ddCtrl.exportTemplates.CSV&&!ddCtrl.exportTemplates.TOFLOW)){return;}else{if(typeof(ddCtrl.exportTemplates)!="undefined"&&ddCtrl.exportTemplates.TOFLOW){exportToFlowURL=ddCtrl.exportTemplates.TOFLOW;bShowExportToFlow=true;}}}else{if(this.chart.editMode){return;}if(this.chart.roleId&&(!ddCtrl.userACLs.SaveWalletForGroup)){return;}bShowExportToFlow=true;}var div=this.createDiv(getLocMessage("Edit.Menu.SaveAs"),"editToolTitle2",null,30);divEditToolbar.appendChild(div);var subDiv=document.createElement("div");subDiv.className="editToolSubDiv";if(!this.options.expanded["export"]){subDiv.style.display="none";
}divEditToolbar.appendChild(subDiv);div.style.cursor="pointer";div.onclick=(function(){var subDivLoc=subDiv;return function(event){subDivLoc.style.display=subDivLoc.style.display=="none"?"block":"none";self.options.expanded["export"]=self.options.expanded["export"]?false:true;};})();if(!isDashboard&&ddCtrl.exportTemplates.PDF){var div=this.createDiv(getLocMessage("Edit.Menu.PDF"),"editTool floating",null,30);var onclick;if(this.isTableMode){onclick=function(event){self.promptExportOptions(function(pageFormat){self.chart.pageFormat=pageFormat;ddCtrl.saveAs(ddCtrl.exportTemplates.PDF,"PDF");},self.chart.pageFormat);};}else{onclick=function(event){ddCtrl.saveAs(ddCtrl.exportTemplates.PDF,"PDF");};}div.onclick=onclick;subDiv.appendChild(div);}if(!isDashboard&&ddCtrl.exportTemplates.PPT){var div=this.createDiv(getLocMessage("Edit.Menu.PPT"),"editTool floating",null,30);var onclick=function(event){ddCtrl.saveAs(ddCtrl.exportTemplates.PPT,"PPT");};div.onclick=onclick;subDiv.appendChild(div);}if(!isDashboard&&ddCtrl.exportTemplates.XLS){var div=this.createDiv(getLocMessage("Edit.Menu.XLS"),"editTool floating",null,30);
var onclick=function(event){ddCtrl.saveAs(ddCtrl.exportTemplates.XLS,"XLS");};div.onclick=onclick;subDiv.appendChild(div);}if(!isDashboard&&ddCtrl.exportTemplates.CSV){var div=this.createDiv(getLocMessage("Edit.Menu.CSV"),"editTool floating",null,30);var onclick=function(event){ddCtrl.saveAs(ddCtrl.exportTemplates.CSV,"CSV");};div.onclick=onclick;subDiv.appendChild(div);}if(bShowExportToFlow){var div=this.createDiv(getLocMessage("Edit.Menu.ToNewFlow"),"editTool floating",null,30);var funcSave=function(fName){if(fName){if(isDashboard){ddCtrl.__exportName=fName;ddCtrl.__overwrite=false;ddCtrl.doExport(self.chart.flowId,"TOFLOW");}else{ddCtrl.__exportName=fName;ddCtrl.__overwrite=false;ddCtrl.saveAs(exportToFlowURL,"TOFLOW");}}};var promptFlag={isSet:true};var onclick=function(event){if(promptFlag.isSet){prompt(getLocMessage("Edit.Menu.PromptFlowName"),self.chart.title+" "+getLocMessage("Edit.Menu.CopyOf"),function(fName){if(fName==self.chart.title){confirm(getLocMessage("Edit.Menu.ConfirmNewFlowSameName"),function(){funcSave(fName);
promptFlag.isSet=false;},function(){onclick(event);});}else{funcSave(fName);}});}};div.onclick=onclick;subDiv.appendChild(div);}};function ChartOptions(chart){this.OPTS=["axisLabels","isLine","isLine1","onAltAxis","onAltAxis1","colorTableId"];for(var i=0;i<this.OPTS.length;i++){var optName=this.OPTS[i];if(chart[optName]){this[optName]=chart[optName];}}}ChartOptions.prototype.toJS=function(){var str="";for(var i=0;i<this.OPTS.length;i++){var optName=this.OPTS[i];if(typeof(this[optName])!="undefined"){str=(str?(str+"\n"):"")+"chart."+optName+"="+JSON.stringify(this[optName])+";";}}return str;};ChartOptions.prototype.applyToChart=function(chart){var str="";for(var i=0;i<this.OPTS.length;i++){var optName=this.OPTS[i];if(optName=="isLine"&&!this[optName]){chart[optName]=[];}else{if(optName=="isLine1"&&!this[optName]){chart[optName]=[];}else{if(optName=="onAltAxis"&&!this[optName]){chart[optName]=[];}else{if(optName=="colorTableId"&&chart[optName]!=this[optName]){chart.axisEditor.applyColorPalette(this[optName]);
}else{chart[optName]=this[optName];}}}}}};AxisEditor.prototype.applyColorPalette=function(colorTableId){if(!this.chart.colorIndependant){return false;}ddCtrl.loadColorsRepo();if(ddCtrl.colorsRepo&&ddCtrl.colorsRepo[colorTableId]){var colors=[];for(var i=0;i<ddCtrl.colorsRepo[colorTableId].colors.length;i++){colors.push(ddCtrl.colorsRepo[colorTableId].colors[i].HEX);}this.chart.colors=colors;this.chart.colorTableId=colorTableId;this.chart.colorManager=new ColorManager();return true;}return false;};AxisEditor.prototype.drawEditToolbarViews=function(divEditToolbar){var self=this;var div=this.createDiv(getLocMessage("Edit.Menu.Views"),"editToolTitle2",null,30);divEditToolbar.appendChild(div);var subDiv=document.createElement("div");subDiv.id=this.subdivviewsId;subDiv.className="editToolSubDiv";if(!this.options.expanded.views){subDiv.style.display="none";}divEditToolbar.appendChild(subDiv);div.style.cursor="pointer";div.onclick=(function(){var subDivLoc=subDiv;return function(event){subDivLoc.style.display=subDivLoc.style.display=="none"?"block":"none";
self.options.expanded.views=self.options.expanded.views?false:true;};})();this.updateEditToolbarViews();};AxisEditor.prototype.updateEditToolbarViews=function(){var self=this;var subDiv=document.getElementById(this.subdivviewsId);if(subDiv){if(subDiv.hasChildNodes()){while(subDiv.childNodes.length>=1){subDiv.removeChild(subDiv.firstChild);}}var viewNames=[];var views={};for(var i in this.chart.views){var viewName=i;var view=this.chart.views[i];viewNames.push(viewName);views[viewName]=view;}var serverViews=ddCtrl.ddAPI.getFlowSnapshots(this.chart.flowId);for(var i in serverViews){var serverView=serverViews[i];if(serverView.flowId==this.chart.flowId){var viewName=serverView.name;var view=serverView.value;viewNames.push(viewName);views[viewName]=view;}}viewNames.sort();for(var i=0;i<viewNames.length;i++){var viewName=viewNames[i];var viewDmsel=views[viewName];var div=this.createDiv(viewName,"editTool",null,30);div.onclick=(function(){var viewDmselLoc=views[viewName];return function(event){applyView(viewDmselLoc,self.chart);
};})();var span=this.createSpan(getLocMessage("Edit.Menu.DeleteView"),"editToolIconDel");span.innerHTML="&nbsp;";var self=this;span.onclick=(function(){var viewNameLoc=viewName;return function(event){deleteView(viewNameLoc,self.chart);event.cancelBubble=true;};})();div.appendChild(span);subDiv.appendChild(div);}var div=this.createDiv(getLocMessage("Edit.Menu.ResetView"),"editTool",null,30);var self=this;var onclick=function(event){resetCurrentView(self.chart);};div.onclick=onclick;subDiv.appendChild(div);var div=this.createDiv(getLocMessage("Edit.Menu.SaveView"),"editTool",null,30);var self=this;var onclick=function(event){saveCurrentView(self.chart);};div.onclick=onclick;subDiv.appendChild(div);}};AxisEditor.prototype.drawEditToolbarProperties=function(divEditToolbar){var self=this;var div=this.createDiv(getLocMessage("Edit.Menu.Properties"),"editToolTitle2",null,30);divEditToolbar.appendChild(div);var subDiv=document.createElement("div");subDiv.id=this.subdivviewsId;subDiv.className="editToolSubDiv";
if(!this.options.expanded.properties){subDiv.style.display="none";}divEditToolbar.appendChild(subDiv);div.style.cursor="pointer";div.onclick=(function(){var subDivLoc=subDiv;return function(event){subDivLoc.style.display=subDivLoc.style.display=="none"?"block":"none";self.options.expanded.views=self.options.expanded.properties?false:true;};})();if(!this.tableMode){var div=this.createDiv(getLocMessage("Edit.Menu.ColorPalettes"),"editTool floating",null,30);var onclick=function(event){self.promptColorPalette();};div.onclick=onclick;subDiv.appendChild(div);}};AxisEditor.prototype.promptColorPalette=function(){var self=this;ddCtrl.loadColorsRepo();if(ddCtrl.colorsRepo){var paletteIds=[];var paletteNames=[];for(var i in ddCtrl.colorsRepo){paletteIds.push(ddCtrl.colorsRepo[i].id);paletteNames.push(ddCtrl.colorsRepo[i].name);}var curPaletteId=this.chart.colorTableId;promptSelect(getLocMessage("Edit.Menu.ChangeColorPalette"),curPaletteId,paletteIds,paletteNames,function(str){if(str!=curPaletteId){if(!self.chart.colorIndependant){alert(getLocMessage("Edit.Menu.ChangeColorPaletteWarning"));
return false;}self.applyColorPalette(str);self.refreshDM();}});}};AxisEditor.prototype.drawEditToolbarDimensions=function(divEditToolbar){var vizDesc=getVizDescriptor(this.chart);var acceptDim=false;if(vizDesc&&vizDesc.axis){for(var iz=0;iz<vizDesc.axis.length;iz++){if(!vizDesc.axis[iz].measureOnly){acceptDim=true;break;}}if(!acceptDim){return;}}var self=this;var div=this.createDiv(getLocMessage("Edit.Menu.AvailableDimensions"),"editToolTitle1",null,30);divEditToolbar.appendChild(div);var subDivDims=document.createElement("div");subDivDims.className="editToolSubDiv";var subDivDimsRoot=subDivDims;if(!this.options.expanded.dimensions){subDivDims.style.display="none";}divEditToolbar.appendChild(subDivDims);div.style.cursor="pointer";div.onclick=(function(){var subDivLoc=subDivDims;return function(event){subDivLoc.style.display=subDivLoc.style.display=="none"?"block":"none";self.options.expanded.dimensions=self.options.expanded.dimensions?false:true;};})();var categories=[];var hCategories={};
for(var i=0;i<this.chart.dmsel.dm.dimensions.length;i++){var dim=this.chart.dmsel.dm.dimensions[i];if(dim.archived){continue;}if(dim.category&&!hCategories[dim.category]){categories.push(dim.category);hCategories[dim.category]=true;}}categories.sort().reverse();categories.push("");for(var iCat=0;iCat<categories.length;iCat++){subDivDims=subDivDimsRoot;var category=categories[iCat];if(category){var div=this.createDiv(category,"editToolCategoryTitle",null,30);subDivDims.appendChild(div);var subDiv=document.createElement("div");subDiv.className="editToolSubDiv";if(!this.options.expanded["dim/categ/"+category]){subDiv.style.display="none";}subDivDims.appendChild(subDiv);div.style.cursor="pointer";div.onclick=(function(){var subDivLoc=subDiv;var categNameLoc=category;return function(event){subDivLoc.style.display=subDivLoc.style.display=="none"?"block":"none";self.options.expanded["dim/categ/"+categNameLoc]=self.options.expanded["dim/categ/"+categNameLoc]?false:true;};})();subDivDims=subDiv;
}for(var i=0;i<this.chart.dmsel.dm.dimensions.length;i++){var dim=this.chart.dmsel.dm.dimensions[i];if(dim.archived){continue;}if(!((dim.category&&category&&dim.category==category)||(!dim.category&&!category))){continue;}var hasHierarchies=dim.hierarchies&&dim.hierarchies.length>0;var div=this.createDiv(dim.name+(hasHierarchies?"...":""),"editTool drag editToolIconDim",null,30);div.dragData=dim.id;var ondragstart=function(event){event.dataTransfer.effectAllowed="copyMove";self.dragEditHandler.dragDim(event);};this.dragEditHandler.addDragTo(div,ondragstart);subDivDims.appendChild(div);if(hasHierarchies){var subDivHiers=document.createElement("div");subDivHiers.className="editToolSubDiv";if(!this.options.expanded["dim/"+dim.name]){subDivHiers.style.display="none";}subDivDims.appendChild(subDivHiers);div.style.cursor="pointer";div.onclick=(function(){var subDivLoc=subDivHiers;var divNameLoc=dim.name;return function(event){subDivLoc.style.display=subDivLoc.style.display=="none"?"block":"none";
self.options.expanded["dim/"+divNameLoc]=self.options.expanded["dim/"+divNameLoc]?false:true;};})();for(var j=0;j<dim.hierarchies.length;j++){for(var k=0;k<dim.hierarchies[j].levels.length;k++){var div=this.createDiv(dim.hierarchies[j].name+" / "+dim.hierarchies[j].levels[k].name,"editTool drag editToolIconHierarchy",null,30);div.dragData=dim.id;var ondragstart=(function(){var hierId=dim.hierarchies[j].id;var lvlId=dim.hierarchies[j].levels[k].id;return function(event){self.dragEditHandler.dragDim(event);self.dragEditHandler.setDragData(event,"application/dd-hierarchy",hierId);self.dragEditHandler.setDragData(event,"application/dd-level",lvlId);event.dataTransfer.effectAllowed="copyMove";};})();this.dragEditHandler.addDragTo(div,ondragstart);subDivHiers.appendChild(div);}}}}}subDivDims=subDivDimsRoot;var div=this.createDiv(getLocMessage("Edit.Menu.Options"),"editToolTitle2",null,30);subDivDims.appendChild(div);var subDiv=document.createElement("div");subDiv.className="editToolSubDiv";if(!this.options.expanded.dimOptions){subDiv.style.display="none";
}subDivDims.appendChild(subDiv);div.style.cursor="pointer";div.onclick=(function(){var subDivLoc=subDiv;return function(event){subDivLoc.style.display=subDivLoc.style.display=="none"?"block":"none";self.options.expanded.dimOptions=self.options.expanded.dimOptions?false:true;};})();var div=this.createDiv(getLocMessage("Edit.Menu.OverallBottom"),"editTool drag floating",null,30);var ondragstart=(function(){return function(event){self.dragEditHandler.dragObject(event,"dd-overall",-1);event.dataTransfer.effectAllowed="move";};})();this.dragEditHandler.addDragTo(div,ondragstart);subDiv.appendChild(div);var div=this.createDiv(getLocMessage("Edit.Menu.OverallTop"),"editTool drag floating",null,30);var ondragstart=(function(){return function(event){self.dragEditHandler.dragObject(event,"dd-overall",1);event.dataTransfer.effectAllowed="move";};})();this.dragEditHandler.addDragTo(div,ondragstart);subDiv.appendChild(div);var div=this.createDiv(getLocMessage("Edit.Menu.SortA"),"editTool drag floating editToolIconSortA",null,30);
var ondragstart=(function(){return function(event){self.dragEditHandler.dragObject(event,"dd-sort",TBSMODE_SORTA);event.dataTransfer.effectAllowed="move";};})();this.dragEditHandler.addDragTo(div,ondragstart);subDiv.appendChild(div);var div=this.createDiv(getLocMessage("Edit.Menu.SortD"),"editTool drag floating editToolIconSortD",null,30);var ondragstart=(function(){return function(event){self.dragEditHandler.dragObject(event,"dd-sort",TBSMODE_SORTD);event.dataTransfer.effectAllowed="move";};})();this.dragEditHandler.addDragTo(div,ondragstart);subDiv.appendChild(div);};AxisEditor.prototype.drawEditToolbarMeasures=function(divEditToolbar){var div=this.createDiv(getLocMessage("Edit.Menu.AvailableMeasures"),"editToolTitle1",null,30);divEditToolbar.appendChild(div);var subDivMeasures=document.createElement("div");subDivMeasures.className="editToolSubDiv";var subDivMeasuresRoot=subDivMeasures;if(!this.options.expanded.measures){subDivMeasures.style.display="none";}divEditToolbar.appendChild(subDivMeasures);
div.style.cursor="pointer";var self=this;div.onclick=(function(){var subDivLoc=subDivMeasures;return function(event){subDivLoc.style.display=subDivLoc.style.display=="none"?"block":"none";self.options.expanded.measures=self.options.expanded.measures?false:true;};})();var categories=[];var hCategories={};for(var i=0;i<this.chart.dmsel.dm.measures.length;i++){var measure=this.chart.dmsel.dm.measures[i];if(measure.hidden||measure.archived){continue;}if(measure.category&&!hCategories[measure.category]){categories.push(measure.category);hCategories[measure.category]=true;}}categories.sort().reverse();categories.push("");for(var iCat=0;iCat<categories.length;iCat++){subDivMeasures=subDivMeasuresRoot;var category=categories[iCat];if(category){var div=this.createDiv(category,"editToolCategoryTitle",null,30);subDivMeasures.appendChild(div);var subDiv=document.createElement("div");subDiv.className="editToolSubDiv";if(!this.options.expanded["meas/categ/"+category]){subDiv.style.display="none";}subDivMeasures.appendChild(subDiv);
div.style.cursor="pointer";div.onclick=(function(){var subDivLoc=subDiv;var categNameLoc=category;return function(event){subDivLoc.style.display=subDivLoc.style.display=="none"?"block":"none";self.options.expanded["meas/categ/"+categNameLoc]=self.options.expanded["meas/categ/"+categNameLoc]?false:true;};})();subDivMeasures=subDiv;}for(var i=0;i<this.chart.dmsel.dm.measures.length;i++){var measure=this.chart.dmsel.dm.measures[i];if(measure.hidden||measure.archived){continue;}if(!((measure.category&&category&&measure.category==category)||(!measure.category&&!category))){continue;}var enabled=true;var div=this.createDiv(measure.name,"editTool drag editToolIconMeasure"+(enabled?"":" disabled"),null,30);div.dragData=measure.id;var ondragstart=function(event){event.dataTransfer.effectAllowed="copyMove";self.dragEditHandler.dragMeasure(event);};this.dragEditHandler.addDragTo(div,ondragstart);subDivMeasures.appendChild(div);}}subDivMeasures=subDivMeasuresRoot;var formulasDiv=document.createElement("div");
formulasDiv.id=this.subdivformulasId;subDivMeasures.appendChild(formulasDiv);this.updateToolbarChartMeasures();var div=this.createDiv(getLocMessage("Edit.Menu.Options"),"editToolTitle2",null,30);subDivMeasures.appendChild(div);var subDiv=document.createElement("div");subDiv.className="editToolSubDiv";if(!this.options.expanded.measOptions){subDiv.style.display="none";}subDivMeasures.appendChild(subDiv);div.style.cursor="pointer";div.onclick=(function(){var subDivLoc=subDiv;return function(event){subDivLoc.style.display=subDivLoc.style.display=="none"?"block":"none";self.options.expanded.measOptions=self.options.expanded.measOptions?false:true;};})();var div=this.createDiv(getLocMessage("Edit.Menu.AvailableAggregations"),"editToolTitle3",null,30);subDiv.appendChild(div);var aggs=[-1,0,1,2,3,4,11];for(var ia=0;ia<aggs.length;ia++){var a=aggs[ia];var div=this.createDiv(getLocMessage("Edit.Menu.Agg"+a),"editTool drag floating",null,30);var ondragstart=(function(){var aggIdLoc=a;return function(event){self.dragEditHandler.dragObject(event,"dd-agg",aggIdLoc);
event.dataTransfer.effectAllowed="move";};})();this.dragEditHandler.addDragTo(div,ondragstart);subDiv.appendChild(div);}ddCtrl.loadTransfoRepo();if(ddCtrl.transfoRepo){var div=this.createDiv(getLocMessage("Edit.Menu.AvailableTransformers"),"editToolTitle3",null,30);subDiv.appendChild(div);for(var a in ddCtrl.transfoRepo){var funcName=ddCtrl.transfoRepo[a].displayName||a;var div=this.createDiv(funcName,"editTool drag floating",null,30);if(ddCtrl.transfoRepo[a].description){div.setAttribute("title",ddCtrl.transfoRepo[a].description);}var ondragstart=(function(){var transfoIdLoc=a;return function(event){self.dragEditHandler.dragObject(event,"dd-transfo",transfoIdLoc);event.dataTransfer.effectAllowed="move";};})();this.dragEditHandler.addDragTo(div,ondragstart);subDiv.appendChild(div);}}ddCtrl.loadPredictRepo();if(ddCtrl.predictRepo){var div=this.createDiv(getLocMessage("Edit.Menu.AvailableSmoothing"),"editToolTitle3",null,30);subDiv.appendChild(div);for(var a in ddCtrl.predictRepo){var categ=ddCtrl.predictRepo[a].category;
if(categ=="smoothing"){var funcName=ddCtrl.predictRepo[a].displayName||a;var div=this.createDiv(funcName,"editTool drag floating",null,30);if(ddCtrl.predictRepo[a].description){div.setAttribute("title",ddCtrl.predictRepo[a].description);}var ondragstart=(function(){var transfoIdLoc=a;return function(event){self.dragEditHandler.dragObject(event,"dd-predict",transfoIdLoc);event.dataTransfer.effectAllowed="move";};})();this.dragEditHandler.addDragTo(div,ondragstart);subDiv.appendChild(div);}}var div=this.createDiv(getLocMessage("Edit.Menu.AvailablePredictives"),"editToolTitle3",null,30);subDiv.appendChild(div);for(var a in ddCtrl.predictRepo){var categ=ddCtrl.predictRepo[a].category;if(categ=="predictive"){var funcName=ddCtrl.predictRepo[a].displayName||a;var div=this.createDiv(funcName,"editTool drag floating",null,30);if(ddCtrl.predictRepo[a].description){div.setAttribute("title",ddCtrl.predictRepo[a].description);}var ondragstart=(function(){var transfoIdLoc=a;return function(event){self.dragEditHandler.dragObject(event,"dd-predict",transfoIdLoc);
event.dataTransfer.effectAllowed="move";};})();this.dragEditHandler.addDragTo(div,ondragstart);subDiv.appendChild(div);}}}};AxisEditor.prototype.updateToolbarChartMeasures=function(){var self=this;var subDivMeasures=document.getElementById(this.subdivformulasId);while(subDivMeasures.lastChild){subDivMeasures.removeChild(subDivMeasures.lastChild);}for(var i=0;i<this.chart.dmsel.chartMeasures.length;i++){var measure=this.chart.dmsel.chartMeasures[i];if(measure.hidden||measure.archived){continue;}var enabled=true;var div=this.createDiv(measure.name,"editTool drag editToolIconMeasure editformula"+(enabled?"":" disabled"),null,30);div.dragData=measure.id;var ondragstart=function(event){event.dataTransfer.effectAllowed="copyMove";self.dragEditHandler.dragMeasure(event);};this.dragEditHandler.addDragTo(div,ondragstart);var span=this.createDiv(getLocMessage("Edit.Menu.DeleteFormula"),"editTool editToolIconDel");span.innerHTML="&nbsp;";span.onclick=(function(){var nameLoc=measure.name;var cmIndexLoc=i;
return function(event){confirm(getLocMessage("Edit.Menu.ConfirmDeleteFormula",nameLoc),function(){self.deleteChartMeasure(cmIndexLoc);});};})();subDivMeasures.appendChild(span);if(canEditChartMeasure(measure)){var span=this.createDiv(getLocMessage("Edit.Menu.EditFormula"),"editTool editToolIconEdit");span.innerHTML="&nbsp;";span.onclick=(function(){var cmIndexLoc=i;return function(event){self.onFormulaEdit(cmIndexLoc);};})();subDivMeasures.appendChild(span);}subDivMeasures.appendChild(div);}var div=this.createDiv(getLocMessage("Edit.Menu.NewFormula"),"editTool drag editToolIconMeasure editformula",null,30);div.dragData="DD:NEWFORMULA";var ondragstart=function(event){event.dataTransfer.effectAllowed="copyMove";self.dragEditHandler.dragMeasure(event);};this.dragEditHandler.addDragTo(div,ondragstart);subDivMeasures.appendChild(div);};AxisEditor.prototype.drawEditToolbarCharts=function(divEditToolbar){var self=this;var vizRepo=ddCtrl.loadVizRepo();if(!vizRepo){return;}var div=this.createDiv(getLocMessage("Edit.Menu.AvailableCharts"),"editToolTitle1",null,30);
divEditToolbar.appendChild(div);var subDivCharts=document.createElement("div");subDivCharts.className="editToolSubDiv";if(!this.options.expanded.charts){subDivCharts.style.display="none";}divEditToolbar.appendChild(subDivCharts);div.style.cursor="pointer";div.onclick=(function(){var subDivLoc=subDivCharts;return function(event){subDivLoc.style.display=subDivLoc.style.display=="none"?"block":"none";self.options.expanded.charts=self.options.expanded.charts?false:true;};})();for(var i in vizRepo){var vizDef=vizRepo[i];var enabled=true;var div=this.createDiv(getLocMessage(vizDef.name),"editToolButton off "+(enabled?"":" disabled"),null,30);div.onclick=(function(){var vizDefLoc=vizDef;return function(event){ddCtrl.changeTemplate(self.chart.frameId,vizDefLoc.id,self.chart.dmsel);};})();subDivCharts.appendChild(div);}};AxisEditor.prototype.drawEditToolbar=function(divEditToolbar){var self=this;if(!this.chart.editable){return;}this.dragEditHandler.addDropTo(divEditToolbar,function(event){self.dragEditHandler.allowDropRemove(event);
},function(event){self.dragEditHandler.dropRemove(event);});if(divEditToolbar.inited){if(divEditToolbar.axisEditorOptions){this.options=divEditToolbar.axisEditorOptions;}while(divEditToolbar.lastChild){divEditToolbar.removeChild(divEditToolbar.lastChild);}}else{if(!isTouchDevice()){this.latchHideDZ=new Latcher(function(){if(self.divDropZones){self.divDropZones.className="dropZones slideOut";}},1000);divEditToolbar.onmouseout=function(event){if(!contextMenu||!contextMenu.visible){self.hideDropZones();}else{contextMenu.onClosed=function(){self.hideDropZones();contextMenu.onClosed=null;};}};divEditToolbar.onmouseover=function(event){self.showDropZones();};}}divEditToolbar.inited=true;divEditToolbar.axisEditorOptions=this.options;var helpMsg=this.isTableMode?getLocMessage("Edit.Menu.EditToolbarDescTables"):getLocMessage("Edit.Menu.EditToolbarDescCharts");var div=this.createDiv(helpMsg,"editToolDesc",null,30);div.id="dndHelpMessage";divEditToolbar.appendChild(div);this.drawEditToolbarExport(divEditToolbar);
this.drawEditToolbarViews(divEditToolbar);this.drawEditToolbarProperties(divEditToolbar);if(this.isTableMode){var div=this.createDiv(getLocMessage("Edit.Menu.EditStyle"),"editToolButton "+(this.options.styleEdit?"on":"off"),null,30);self.chart.editMode=this.options.styleEdit?true:false;var onclick=function(event){if(this.className=="editToolButton off"){this.className="editToolButton on";self.chart.editMode=true;self.options.styleEdit=true;}else{this.className="editToolButton off";self.chart.editMode=false;self.options.styleEdit=false;}};div.onclick=onclick;divEditToolbar.appendChild(div);}this.drawEditToolbarDimensions(divEditToolbar);this.drawEditToolbarMeasures(divEditToolbar);if(this.tableMode&&this.chart.turnToChart){this.drawEditToolbarCharts(divEditToolbar);}this.chart.initialView=getViewJSON(this.chart);};AxisEditor.prototype.hideDropZones=function(){if(this.divDropZones){if(this.latchHideDZ){this.latchHideDZ.start();}else{this.divDropZones.className="dropZones slideOut";}}};AxisEditor.prototype.showDropZones=function(){if(this.divDropZones){if(this.latchHideDZ){this.latchHideDZ.cancel();
}this.divDropZones.className="dropZones slideIn";}};AxisEditor.prototype.drawDropZones=function(divDropZones){var self=this;if(!this.chart.editable){return;}this.divDropZones=divDropZones;divDropZones.innerHTML="";this.dropZones=[];divDropZones.dropZones=this.dropZones;divDropZones.className="dropZones";if(!isTouchDevice()){divDropZones.className+=" slideOut";divDropZones.onmouseout=function(event){if(!contextMenu||!contextMenu.visible){self.hideDropZones();}else{contextMenu.onClosed=function(){self.hideDropZones();contextMenu.onClosed=null;};}};divDropZones.onmouseover=function(event){self.showDropZones();};}var vizDesc=getVizDescriptor(this.chart);if(vizDesc&&vizDesc.axis){for(var iz=0;iz<vizDesc.axis.length;iz++){var axisId=vizDesc.axis[iz].id;var axisName=getLocMessage(axisId);var className="dz"+axisId.replace(":","_");this.dropZones.push(new DropZone(this,iz,divDropZones,axisName,className));}}this.updateDropZones();};function getVizDescriptor(chart){var vizRepo=ddCtrl.loadVizRepo();
if(vizRepo){if(chart.type){var vizDesc=vizRepo[chart.type];if(vizDesc){return vizDesc;}else{alert("Viz description not available for chart type "+chart.type+" (vizrepo.js)");}}else{alert("Edition for this chart is not yet implemented");}}return null;}AxisEditor.prototype.updateDropZones=function(){if(!this.chart.editable){return;}for(var iz=0;iz<this.dropZones.length;iz++){this.dropZones[iz].draw();}};function DropZone(axisEditor,axisId,parentDiv,axisName,className){this.axisEditor=axisEditor;this.axisName=axisId;this.axisId=axisId;this.className=className;this.div=axisEditor.createDiv("","dropZone "+className,null,30);this.div.appendChild(axisEditor.createDiv(axisName,"title"));this.div.editCtx={axisId:axisId};parentDiv.appendChild(this.div);axisEditor.dragEditHandler.addDropTo(this.div,function(event){axisEditor.dragEditHandler.allowDropAxis(event)||axisEditor.dragEditHandler.allowDropDim(event)||axisEditor.dragEditHandler.allowDropMeasure(event);},function(event){axisEditor.dragEditHandler.dropAxis(event)||axisEditor.dragEditHandler.dropDim(event)||axisEditor.dragEditHandler.dropMeasure(event);
});this.axisEditor.addEditContextMenu(this.div,function(event){if(!event){event=window.event;}var target=event.currentTarget?event.currentTarget:event.srcElement;if(target){if(axisEditor.chart.editable&&target.isEditContextMenu){axisEditor.createEditContextMenu(event);return false;}}});}DropZone.prototype.draw=function(){var dmsel=this.axisEditor.chart.dmsel;var axisEditor=this.axisEditor;while(this.div.lastChild!=this.div.firstChild){this.div.removeChild(this.div.lastChild);}if(dmsel.axis[this.axisId]){for(var j=0;j<dmsel.axis[this.axisId].length;j++){var dimEx=dmsel.dimsToExplore[dmsel.axis[this.axisId][j]];if(dimEx){var dim=dimEx.dim;var hasHierarchies=false;var divDim=axisEditor.createDiv(dim.name+(hasHierarchies?"...":""),"editTool drag editToolIconDim",null,30);divDim.dragData=dim.id;divDim.editCtx={axisId:this.axisId,dimIndex:j};var ondragstart=(function(){var hierId=dimEx.hPos>=0?dim.hierarchies[dimEx.hPos].id:null;var lvlId=(dimEx.hPos>=0&&dimEx.lPos>=0)?dim.hierarchies[dimEx.hPos].levels[dimEx.lPos].id:null;
return function(event){axisEditor.dragEditHandler.dragDim(event);axisEditor.dragEditHandler.setDragData(event,"application/dd-hierarchy",hierId);axisEditor.dragEditHandler.setDragData(event,"application/dd-level",lvlId);event.dataTransfer.effectAllowed="copyMove";};})();axisEditor.dragEditHandler.addDragTo(divDim,ondragstart);divDim.editCtx.allowInsertDim=DragEditHandler.ONLEFT|DragEditHandler.ONRIGHT;divDim.editCtx.allowInsertMeasure=DragEditHandler.ONLEFT|DragEditHandler.ONRIGHT;axisEditor.dragEditHandler.addDropTo(divDim,function(event){axisEditor.dragEditHandler.allowDropDim(event)||axisEditor.dragEditHandler.allowDropMeasure(event);},function(event){axisEditor.dragEditHandler.dropDim(event)||axisEditor.dragEditHandler.dropMeasure(event);});axisEditor.addEditContextMenu(divDim,function(event){if(!event){event=window.event;}var target=event.currentTarget?event.currentTarget:event.srcElement;if(target){if(axisEditor.chart.editable&&target.isEditContextMenu){axisEditor.createEditContextMenu(event);
return false;}}});this.div.appendChild(divDim);}}}if(dmsel.measureAxis==this.axisId){for(var i=0;i<dmsel.measuresToKeep.length;i++){var measure=dmsel.measuresToKeep[i];if(dmsel.measuresToKeepHidden[i]){var bSkip=false;for(var iMeas2=0;iMeas2<dmsel.measuresToKeep.length;iMeas2++){if(dmsel.targetsForMeasure!=null&&iMeas2<dmsel.targetsForMeasure.length){var targetName=dmsel.targetsForMeasure[iMeas2];if(targetName&&dmsel.measuresToKeep[iMeas2].targets[targetName]&&dmsel.measuresToKeep[iMeas2].targets[targetName].measureTargetName==measure.name){bSkip=true;break;}}}if(bSkip){continue;}}var enabled=!dmsel.measuresToKeepHidden[i];var divMeas=axisEditor.createDiv(measure.name,"editTool drag editToolIconMeasure"+(enabled?"":" disabled"),null,30);divMeas.dragData=measure.id;divMeas.editCtx={axisId:this.axisId,measureIndex:i};var ondragstart=function(event){event.dataTransfer.effectAllowed="copyMove";axisEditor.dragEditHandler.dragMeasure(event);};axisEditor.dragEditHandler.addDragTo(divMeas,ondragstart);
if(i==dmsel.measuresToKeep.length-1){divMeas.editCtx.allowInsertDim=DragEditHandler.ONRIGHT;}divMeas.editCtx.allowInsertMeasure=DragEditHandler.ONLEFT|DragEditHandler.ONRIGHT;axisEditor.dragEditHandler.addDropTo(divMeas,function(event){axisEditor.dragEditHandler.allowDropDim(event)||axisEditor.dragEditHandler.allowDropMeasure(event);},function(event){axisEditor.dragEditHandler.dropDim(event)||axisEditor.dragEditHandler.dropMeasure(event);});axisEditor.addEditContextMenu(divMeas,function(event){if(!event){event=window.event;}var target=event.currentTarget?event.currentTarget:event.srcElement;if(target){if(axisEditor.chart.editable&&target.isEditContextMenu){axisEditor.createEditContextMenu(event);return false;}}});this.div.appendChild(divMeas);}}};function View(dmsel,style,chartOptions){this.dmsel=dmsel;this.style=style;this.chartOptions=chartOptions;}View.prototype.toJSON=function(){return{dmsel:this.dmsel,style:this.style,chartOptions:this.chartOptions};};function viewJSONToView(viewJSON){if(!viewJSON){return null;
}var view;if(typeof(viewJSON)=="string"){eval("view="+viewJSON);}else{view=viewJSON;}if(!view.dmsel){view=new View(view,null,null);}return view;}function applyView(viewJSON,chart){var view=viewJSONToView(viewJSON);if(!view){return;}var dmsel2=view.dmsel;dmsel2=new DataModelSelectionFromJSON(dmsel2,chart.dmsel.dm);if(chart.dmsel.dimensionsToExcludeForDisplay){dmsel2.dimensionsToExcludeForDisplay=chart.dmsel.dimensionsToExcludeForDisplay;}if(chart.dmsel.dimensionsToExcludeForNavigation){dmsel2.dimensionsToExcludeForNavigation=chart.dmsel.dimensionsToExcludeForNavigation;}if(chart.dmsel.pivot>0&&dmsel2.pivot!=chart.dmsel.pivot){dmsel2.remapAxisNewPivot(chart.dmsel.pivot);}chart.dmsel.clear();dmsel2.copyTo(chart.dmsel);if(view.style){chart.tableStyle=new chart.axisEditor.templateScope.TableStyle(view.style);}if(view.chartOptions){(new ChartOptions(view.chartOptions)).applyToChart(chart);}ddCtrl.unregisterDM(chart.axisEditor.templateScope.document.frameId);ddCtrl.charts[chart.dmsel.frameId].callChangeHandler=true;
ddCtrl.registerDM(chart.axisEditor.templateScope.document,chart.dmsel.dm,chart.dmsel,chart);chart.axisEditor.updateToolbarChartMeasures();chart.axisEditor.refreshDM();}function resetCurrentView(chart){confirm(Properties[getLocale()]["Edit.Menu.PromptResetView"],function(){applyView(chart.initialView,chart);});}function getViewJSON(chart){var view=new View(chart.dmsel,chart.tableStyle,new ChartOptions(chart));var viewJSON=JSON.stringify(view);return viewJSON;}function saveCurrentView(chart){prompt(Properties[getLocale()]["Edit.Menu.PromptViewName"],"",function(viewName){if(viewName){var viewJSON=getViewJSON(chart);var inFlow=(chart.views&&chart.views[viewName])?true:false;var retObj;if(inFlow){retObj=ddCtrl.ddAPI.saveFlowParameter(chart.flowId,"views['"+viewName+"']","");if(ddCtrl.ddAPI.isError(retObj)||!retObj){alert(getLocMessage("Edit.Menu.ViewSaveError",retObj?retObj.errorMessage:false));return;}}var retObj=ddCtrl.ddAPI.saveFlowSnapshot(chart.flowId,viewName,viewJSON);if(ddCtrl.ddAPI.isError(retObj)||!retObj){alert(getLocMessage("Edit.Menu.ViewSaveError",retObj?retObj.errorMessage:false));
}else{chart.axisEditor.updateEditToolbarViews();alert(getLocMessage("Edit.Menu.ViewSaved",viewName));}}});}function deleteView(viewName,chart){confirm(getLocMessage("Edit.Menu.PromptDeleteView",viewName),function(){var inFlow=(chart.views&&chart.views[viewName])?true:false;var retObj;if(inFlow){retObj=ddCtrl.ddAPI.saveFlowParameter(chart.flowId,"views['"+viewName+"']","");}else{retObj=ddCtrl.ddAPI.saveFlowSnapshot(chart.flowId,viewName,"");}if(ddCtrl.ddAPI.isError(retObj)||!retObj){alert(getLocMessage("Edit.Menu.ViewDeleteError",retObj?retObj.errorMessage:false));}else{if(inFlow){delete chart.views[viewName];}chart.axisEditor.updateEditToolbarViews();alert(getLocMessage("Edit.Menu.ViewDeleted",viewName));}});}DragEditHandler.prototype.allowDropAxis=function(ev){if(this.chart.axisEditor.isTableMode){return this.allowDropAxis_tables(ev);}else{return this.allowDropAxis_charts(ev);}};DragEditHandler.prototype.allowDropAxis_charts=function(ev){var bAllowed=false;if(!ev.ctrlKey){bAllowed|=this.allowDropObject(ev,"dd-sort");
}return bAllowed;};DragEditHandler.prototype.allowDropAxis_tables=function(ev){var bAllowed=false;var target=findEditable(ev.currentTarget?ev.currentTarget:event.srcElement);var isTargetMeasure=target&&target.editCtx&&target.editCtx.measureIndex>=0;if(isTargetMeasure){if(!ev.ctrlKey&&ev.onBefore){bAllowed|=this.allowDropObject(ev,"dd-axis");}}else{bAllowed|=this.allowDropObject(ev,"dd-axis");if(bAllowed&&ev.ctrlKey){this.setDropEffect(ev,"copy");}}if(!ev.ctrlKey){bAllowed|=this.allowDropObject(ev,"dd-sort");}return bAllowed;};DragEditHandler.prototype.allowDropDim=function(ev){if(this.chart.axisEditor.isTableMode){return this.allowDropDim_tables(ev);}else{return this.allowDropDim_charts(ev);}};DragEditHandler.prototype.allowDropDim_charts=function(ev){var bAllowed=false;var target=findEditable(ev.currentTarget?ev.currentTarget:event.srcElement);var isTargetMeasure=target&&target.editCtx&&target.editCtx.measureIndex>=0;var isAxisAcceptDim=target&&target.editCtx&&typeof(target.editCtx.axisId)!="undefined";
var vizDesc=getVizDescriptor(this.chart);if(vizDesc&&vizDesc.axis&&vizDesc.axis[target.editCtx.axisId]){isAxisAcceptDim&=!vizDesc.axis[target.editCtx.axisId].measureOnly;}if(!isAxisAcceptDim){return false;}if(isTargetMeasure){if(!ev.ctrlKey&&ev.onBefore){bAllowed|=this.allowDropObject(ev,"dd-dim");}}else{bAllowed|=this.allowDropObject(ev,"dd-dim");if(bAllowed&&ev.ctrlKey){this.setDropEffect(ev,"copy");}if(!ev.ctrlKey){bAllowed|=this.allowDropObject(ev,"dd-overall");}}return bAllowed;};DragEditHandler.prototype.allowDropDim_tables=function(ev){var bAllowed=false;var target=findEditable(ev.currentTarget?ev.currentTarget:event.srcElement);var isTargetMeasure=target&&target.editCtx&&target.editCtx.measureIndex>=0;if(isTargetMeasure){if(!ev.ctrlKey&&ev.onBefore){bAllowed|=this.allowDropObject(ev,"dd-dim");}}else{bAllowed|=this.allowDropObject(ev,"dd-dim");if(bAllowed&&ev.ctrlKey){this.setDropEffect(ev,"copy");}if(!ev.ctrlKey){bAllowed|=this.allowDropObject(ev,"dd-overall");}}return bAllowed;
};DragEditHandler.prototype.allowDropMeasure=function(ev){if(this.chart.axisEditor.isTableMode){return this.allowDropMeasure_tables(ev);}else{return this.allowDropMeasure_charts(ev);}};DragEditHandler.prototype.allowDropMeasure_tables=function(ev){var bAllowed=false;var target=findEditable(ev.currentTarget?ev.currentTarget:event.srcElement);var isTargetDimAxis=target&&target.editCtx&&typeof(target.editCtx.axisId)!="undefined"&&typeof(target.editCtx.measureIndex)=="undefined";if(isTargetDimAxis){if((ev.onAfter&&(target.editCtx.allowInsertMeasure&DragEditHandler.ONAFTER))||ev.ctrlKey==true){bAllowed|=this.allowDropObject(ev,"dd-measure");}}else{bAllowed|=this.allowDropObject(ev,"dd-measure");bAllowed|=this.allowDropObject(ev,"dd-agg");bAllowed|=this.allowDropObject(ev,"dd-transfo");bAllowed|=this.allowDropObject(ev,"dd-predict");}return bAllowed;};DragEditHandler.prototype.allowDropMeasure_charts=function(ev){var bAllowed=false;var target=findEditable(ev.currentTarget?ev.currentTarget:event.srcElement);
var isMeasureAxis=target&&target.editCtx&&target.editCtx.axisId==this.chart.dmsel.measureAxis;var isTargetMeasure=target&&target.editCtx&&typeof(target.editCtx.measureIndex)!="undefined";var isAxisAcceptMeasure=target&&target.editCtx&&typeof(target.editCtx.axisId)!="undefined";var vizDesc=getVizDescriptor(this.chart);if(vizDesc&&vizDesc.axis&&vizDesc.axis[target.editCtx.axisId]){isAxisAcceptMeasure&=vizDesc.axis[target.editCtx.axisId].acceptMeasure;}if(!isAxisAcceptMeasure){return false;}if(isTargetMeasure){bAllowed|=this.allowDropObject(ev,"dd-measure");bAllowed|=this.allowDropObject(ev,"dd-agg");bAllowed|=this.allowDropObject(ev,"dd-transfo");bAllowed|=this.allowDropObject(ev,"dd-predict");}else{bAllowed|=this.allowDropObject(ev,"dd-measure");}return bAllowed;};DragEditHandler.prototype.allowDropRemove=function(ev){if(this.isDragSameWindow(ev)){if(this.isDragType(ev,"dd-editctx")){ev.preventDefault();this.setDropEffect(ev,"move");return true;}}return false;};DragEditHandler.prototype.dragAxis=function(ev){this.dragObject(ev,"dd-axis",ev.target.dragData);
};DragEditHandler.prototype.dragAxisOrMeasure=function(ev){this.dragObject(ev,"dd-axis",ev.target.dragData,"dd-measure",ev.target.dragData);};DragEditHandler.prototype.dragDim=function(ev){this.dragObject(ev,"dd-dim",ev.target.dragData);};DragEditHandler.prototype.dragMeasure=function(ev){this.dragObject(ev,"dd-measure",ev.target.dragData);};AxisEditor.prototype.checkMoveAxis=function(dmsel,srcAxId,dstAxId,bCopy){return true;};AxisEditor.prototype.moveAxis=function(dmsel,srcAxId,dstAxId,bCopy){if(this.checkMoveAxis(dmsel,srcAxId,dstAxId,bCopy)){if(dmsel.moveAxis(srcAxId,dstAxId,bCopy)){if(!bCopy){this.moveClickAction(srcAxId,dstAxId);}return true;}return false;}else{alert(getLocMessage("Edit.Menu.CanNotMoveAxis"));}return false;};AxisEditor.prototype.checkRemoveAxis=function(dmsel,axisId){return true;};AxisEditor.prototype.removeAxis=function(dmsel,axisId){if(this.checkRemoveAxis(dmsel,axisId)&&axisId!=dmsel.measureAxis){var axisContent=dmsel.axis[axisId];var dimEx;if(axisContent){dimEx=dmsel.dimsToExplore[axisContent[0]];
}if(dmsel.removeAxis(axisId)){if(dimEx&&this.chart.clickAction&&this.chart.clickAction[axisId]&&(this.chart.clickAction[axisId].action==DRILL||this.chart.clickAction[axisId].action==SYNCHRONIZEDDRILL)){ddCtrl.removeDrillObject(this.chart.frameId,dimEx.dim.id);}this.removeClickAction(axisId);return true;}return false;}else{alert(getLocMessage("Edit.Menu.CanNotRemoveAxis"));}return false;};AxisEditor.prototype.checkRemoveMeasure=function(dmsel,measureIndex,changingAxis){var vizDesc=getVizDescriptor(this.chart);var axisId=dmsel.measureAxis;changingAxis=changingAxis?true:false;if(!changingAxis&&vizDesc&&vizDesc.measuresRequired>0){var cVisibleMeas=0;for(var im=0;im<dmsel.measuresToKeep.length;im++){if(!dmsel.measuresToKeepHidden[im]){cVisibleMeas++;if(cVisibleMeas>1){return true;}}}if(cVisibleMeas-1<vizDesc.measuresRequired){alert(getLocMessage("Edit.Menu.CanNotRemoveMeasure",""+vizDesc.measuresRequired));return false;}}if(vizDesc&&vizDesc.axis&&vizDesc.axis[axisId]){if(!vizDesc.axis[axisId].optional){if(dmsel.axis[axisId]&&dmsel.axis[axisId].length>=1){return true;
}for(var im=0;im<dmsel.measuresToKeep.length;im++){if(!dmsel.measuresToKeepHidden[im]){return true;}}alert(getLocMessage("Edit.Menu.AxisMustNotBeEmpty",getLocMessage(vizDesc.axis[axisId].id)));return false;}}return true;};AxisEditor.prototype.removeMeasure=function(dmsel,measureIndex){if(this.checkRemoveMeasure(dmsel,measureIndex)){return dmsel.removeMeasure(measureIndex);}};AxisEditor.prototype.deleteChartMeasure=function(cmIndex){var dmsel=this.chart.dmsel;if(!dmsel.chartMeasures[cmIndex]){return false;}var depFormulas=[];var measToRemove=dmsel.chartMeasures[cmIndex];for(var im=0;im<dmsel.chartMeasures.length;im++){if(im!=cmIndex){var otherFormula=dmsel.chartMeasures[im];for(var iam=0;iam<otherFormula.srvAssocM.length;iam++){var otherAM=otherFormula.srvAssocM[iam];if(otherAM.measure&&otherAM.measure.id==measToRemove.id&&otherAM.measure.srvFormula){depFormulas.push(otherFormula.id);}}}}if(depFormulas.length>0){alert(getLocMessage("Edit.Menu.CanNotRemoveUsedFormula",measToRemove.id,depFormulas.toString()));
return false;}var bUpdate=false;measureIndex=dmsel.indexOfMeasure(dmsel.chartMeasures[cmIndex].id);if(measureIndex>=0&&dmsel.measuresToKeep[measureIndex]&&dmsel.measuresToKeep[measureIndex].srvFormula){if(!this.checkRemoveMeasure(dmsel,measureIndex)){return false;}if(!dmsel.removeMeasure(measureIndex)){return false;}bUpdate=true;}if(dmsel.deleteChartMeasure(cmIndex)){this.updateToolbarChartMeasures();bUpdate=true;}if(bUpdate){this.refreshDM();}return bUpdate;};AxisEditor.prototype.checkRemoveDim=function(dmsel,axisId,dimIndex){var vizDesc=getVizDescriptor(this.chart);if(vizDesc&&vizDesc.dimensionsRequired>0){var dimCount=dmsel.dimsToExplore?dmsel.dimsToExplore.length:0;if(dimCount-1<vizDesc.dimensionsRequired){alert(getLocMessage("Edit.Menu.CanNotRemoveDimension",""+vizDesc.dimensionsRequired));return false;}}if(vizDesc&&vizDesc.axis&&vizDesc.axis[axisId]){if(!vizDesc.axis[axisId].optional){if(axisId==dmsel.measureAxis){for(var im=0;im<dmsel.measuresToKeep.length;im++){if(!dmsel.measuresToKeepHidden[im]){return true;
}}}if(dmsel.axis[axisId]&&dmsel.axis[axisId].length>1){return true;}alert(getLocMessage("Edit.Menu.AxisMustNotBeEmpty",getLocMessage(vizDesc.axis[axisId].id)));return false;}}return true;};AxisEditor.prototype.removeDim=function(dmsel,axisId,dimIndex){if(this.checkRemoveDim(dmsel,axisId,dimIndex)){return dmsel.removeBrowse(axisId,dimIndex);}};AxisEditor.prototype.moveClickAction=function(srcAxId,dstAxId){if(!this.chart.clickAction){return;}if(this.isTableMode){if(typeof(this.chart.clickAction.length)=="undefined"||this.chart.clickAction.length<=srcAxId){return;}if(this.chart.clickAction.length<=dstAxId){this.chart.clickAction.length=dstAxId+1;}arrayMoveItem(this.chart.clickAction,srcAxId,dstAxId);for(var i=0;i<this.chart.clickAction.length;i++){if(this.chart.clickAction[i]){this.chart.clickAction[i].axis=i;}}}else{}};AxisEditor.prototype.removeClickAction=function(axisId){if(!this.chart.clickAction){return;}if(this.isTableMode){if(this.chart.clickAction.length<=axisId){return;}arrayRemoveItem(this.chart.clickAction,axisId);
for(var i=0;i<this.chart.clickAction.length;i++){if(this.chart.clickAction[i]){this.chart.clickAction[i].axis=i;}}}else{this.chart.clickAction=null;}};AxisEditor.prototype.insertClickAction=function(axisId,action){if(this.isTableMode){if(!this.chart.clickAction){this.chart.clickAction=[];}arrayInsertItem(this.chart.clickAction,axisId,action);for(var i=0;i<this.chart.clickAction.length;i++){if(this.chart.clickAction[i]){this.chart.clickAction[i].axis=i;}}}else{this.chart.clickAction=action;if(action){action.axis=axisId;}}};AxisEditor.prototype.setClickAction=function(axisId,action){if(this.isTableMode){if(!this.chart.clickAction){this.chart.clickAction=[];}this.chart.clickAction[axisId]=action;if(action){action.axis=axisId;}}else{this.chart.clickAction=action;if(action){action.axis=axisId;}}};DragEditHandler.prototype.dropAxis=function(ev){if(this.chart.axisEditor.isTableMode){return this.dropAxis_tables(ev);}else{return this.dropAxis_charts(ev);}};DragEditHandler.prototype.dropAxis_charts=function(ev){ev.preventDefault();
var target=findEditable(ev.currentTarget?ev.currentTarget:event.srcElement);var dmsel=this.chart.dmsel;var dstAxisId=target.editCtx.axisId;if(this.isDragType(ev,"dd-sort")){if(dstAxisId!=undefined){var sortDir=this.getDragData(ev,"dd-sort")-0;this.chart.axisEditor.onAxisSortChange(dstAxisId,"",sortDir);}return true;}return false;};DragEditHandler.prototype.dropAxis_tables=function(ev){ev.preventDefault();var target=findEditable(ev.currentTarget?ev.currentTarget:event.srcElement);var dmsel=this.chart.dmsel;var dstAxisId=target.editCtx.axisId;if(this.isDragType(ev,"dd-axis")){if(dstAxisId==dmsel.measureAxis&&dmsel.pivot==0){dstAxisId=dmsel.getLastAxisId()+1;}else{if(typeof(target.editCtx.axisId)=="undefined"&&typeof(target.editCtx.measureIndex)=="undefined"){dstAxisId=dmsel.getLastAxisId()+1;}}if(this.isDragSameWindow(ev)){var jsonSrcEditCtx=this.getDragData(ev,"dd-editctx");if(jsonSrcEditCtx){srcEditCtx=JSON.parse(jsonSrcEditCtx);if(srcEditCtx){if(ev.onAfter){dstAxisId++;}if(ev.ctrlKey){if(this.chart.axisEditor.moveAxis(dmsel,srcEditCtx.axisId,dstAxisId,true)){this.chart.axisEditor.refreshDM();
}}else{var pivot=dmsel.pivot;if((dstAxisId>=pivot&&srcEditCtx.axisId>=pivot)||(dstAxisId<pivot&&srcEditCtx.axisId<pivot)){if(dstAxisId>srcEditCtx.axisId){dstAxisId--;}}if(this.chart.axisEditor.moveAxis(dmsel,srcEditCtx.axisId,dstAxisId)){this.chart.axisEditor.refreshDM();}}return true;}}}}else{if(this.isDragType(ev,"dd-sort")){if(dstAxisId!=undefined){var sortDir=this.getDragData(ev,"dd-sort")-0;this.chart.axisEditor.onAxisSortChange(dstAxisId,"",sortDir);}return true;}}return false;};DragEditHandler.prototype.dropDim=function(ev){if(this.chart.axisEditor.isTableMode){return this.dropDim_tables(ev);}else{return this.dropDim_charts(ev);}};DragEditHandler.prototype.dropDim_charts=function(ev){ev.preventDefault();var target=findEditable(ev.currentTarget?ev.currentTarget:event.srcElement);var dstAxisId=target.editCtx.axisId;var dmsel=this.chart.dmsel;if(this.isDragType(ev,"dd-dim")){var dimId=this.getDragData(ev,"text/plain");var dim=dmsel.dm.getDimensionById(dimId);if(dim){var hierarchyId=this.getDragData(ev,"dd-hierarchy");
var levelId=this.getDragData(ev,"dd-level");var hier=-1;var lvl=-1;if(hierarchyId&&levelId){var hl=dim.getHierarchyLevelPos(hierarchyId,levelId);hier=hl[0];lvl=hl[1];}var bRefreshDM=false;if(this.isDragSameWindow(ev)){var jsonSrcEditCtx=this.getDragData(ev,"dd-editctx");if(jsonSrcEditCtx){srcEditCtx=JSON.parse(jsonSrcEditCtx);if(srcEditCtx){if(!ev.ctrlKey){bRefreshDM=this.chart.axisEditor.removeDim(dmsel,srcEditCtx.axisId,srcEditCtx.dimIndex);if(!bRefreshDM){return false;}}}}}if(ev.ctrlKey){dmsel.addBrowse(dstAxisId,dim,hier,lvl,null);bRefreshDM=true;}else{if(dmsel.overwriteAxis(dstAxisId,dim,hier,lvl,null)){if(this.chart.axisEditor.isAutoSortNewDim(dstAxisId)){this.chart.axisEditor.changeAxisSort(dmsel,dstAxisId,"",TBSMODE_SORTA);}this.chart.axisEditor.insertClickAction(dstAxisId,undefined);bRefreshDM=true;}}if(bRefreshDM){this.chart.axisEditor.refreshDM();}return true;}}else{if(this.isDragType(ev,"dd-overall")){if(dstAxisId!=undefined){var overAllPos=this.getDragData(ev,"dd-overall")-0;
dmsel.addOverall(dstAxisId,overAllPos,"",-1);this.chart.axisEditor.refreshDM();}return true;}}return false;};DragEditHandler.prototype.dropDim_tables=function(ev){ev.preventDefault();var target=findEditable(ev.currentTarget?ev.currentTarget:event.srcElement);var dstAxisId=target.editCtx.axisId;var dmsel=this.chart.dmsel;if(this.isDragType(ev,"dd-dim")){if(dstAxisId==dmsel.measureAxis&&dmsel.pivot==0){dstAxisId=dmsel.getLastAxisId()+1;}else{if(typeof(target.editCtx.axisId)=="undefined"&&typeof(target.editCtx.measureIndex)=="undefined"){dstAxisId=dmsel.getLastAxisId()+1;}}var dimId=this.getDragData(ev,"text/plain");var dim=dmsel.dm.getDimensionById(dimId);if((dstAxisId!=dmsel.measureAxis||dmsel.pivot!=0)&&dim){var hierarchyId=this.getDragData(ev,"dd-hierarchy");var levelId=this.getDragData(ev,"dd-level");var hier=-1;var lvl=-1;if(hierarchyId&&levelId){var hl=dim.getHierarchyLevelPos(hierarchyId,levelId);hier=hl[0];lvl=hl[1];}if(ev.ctrlKey){dmsel.addBrowse(dstAxisId,dim,hier,lvl,null);this.chart.axisEditor.refreshDM();
}else{if(ev.onAfter){dstAxisId++;}if(dmsel.insertNewAxis(dstAxisId,dim,hier,lvl,null)){if(this.chart.axisEditor.isAutoSortNewDim(dstAxisId)){this.chart.axisEditor.changeAxisSort(dmsel,dstAxisId,"",TBSMODE_SORTA);}this.chart.axisEditor.insertClickAction(dstAxisId,undefined);this.chart.axisEditor.refreshDM();}}return true;}}else{if(this.isDragType(ev,"dd-overall")){if(dstAxisId!=undefined){var overAllPos=this.getDragData(ev,"dd-overall")-0;dmsel.addOverall(dstAxisId,overAllPos,"",-1);this.chart.axisEditor.refreshDM();}return true;}}return false;};DragEditHandler.prototype.dropMeasure=function(ev){if(this.chart.axisEditor.isTableMode){return this.dropMeasure_tables(ev);}else{return this.dropMeasure_charts(ev);}};DragEditHandler.prototype.dropMeasure_charts=function(ev){ev.preventDefault();var target=findEditable(ev.currentTarget?ev.currentTarget:event.srcElement);var dstMeasureIndex=-1;var dmsel=this.chart.dmsel;if(typeof(target.editCtx.measureIndex)!="undefined"){dstMeasureIndex=target.editCtx.measureIndex;
}if(this.isDragType(ev,"dd-measure")){if(typeof(target.editCtx.measureIndex)=="undefined"){dstMeasureIndex=dmsel.measuresToKeep.length;}if(this.isDragSameWindow(ev)){var jsonSrcEditCtx=this.getDragData(ev,"dd-editctx");if(jsonSrcEditCtx){srcEditCtx=JSON.parse(jsonSrcEditCtx);if(srcEditCtx&&srcEditCtx.measureIndex>=0){if(target.editCtx.axisId!=dmsel.measureAxis){if(!this.chart.axisEditor.checkRemoveMeasure(dmsel,srcEditCtx.measureIndex,true)){return false;}dmsel.measureAxis=target.editCtx.axisId;alert(Properties[getLocale()]["Edit.Menu.MeasureAxisChanged"]);}if(ev.onAfter){dstMeasureIndex++;}if(dstMeasureIndex>srcEditCtx.measureIndex){dstMeasureIndex--;}if(dmsel.moveMeasure(srcEditCtx.measureIndex,dstMeasureIndex)){this.chart.axisEditor.refreshDM();}return true;}}}if(target.editCtx.axisId!=dmsel.measureAxis&&!ev.ctrlKey){dmsel.measureAxis=target.editCtx.axisId;alert(Properties[getLocale()]["Edit.Menu.MeasureAxisChanged"]);}var measureId=this.getDragData(ev,"text/plain");if(measureId=="DD:NEWFORMULA"){var selfae=this.chart.axisEditor;
selfae.promptFormula(function(name,formula,format){var existMeasure=dmsel.findMeasure(name);if(!existMeasure){var localMeas2=dmsel.addDerivedCalculation(name,formula,format);if(localMeas2){selfae.updateToolbarChartMeasures();selfae.refreshDM();}}},function(){if(target&&typeof(target.ondragleave)=="function"){target.ondragleave();}});}else{if(ev.ctrlKey){if(target.editCtx.axisId!=dmsel.measureAxis){var curIndex=dmsel.indexOfMeasure(measureId);var measure=dmsel.measuresToKeep[curIndex];this.chart.axisEditor.createMeasureDropContextMenu(ev,measure);return true;}}else{if(ev.onAfter&&dmsel.measuresToKeep.length>dstMeasureIndex){dstMeasureIndex++;}var curIndex=dmsel.indexOfMeasure(measureId);if(curIndex>-1){if(dstMeasureIndex>curIndex){dstMeasureIndex--;}dmsel.removeMeasure(curIndex);}var measure=dmsel.findMeasure(measureId);if(dstMeasureIndex>=0&&measure){this.chart.axisEditor.onMeasureAdd(measure,dmsel.measureAxis,dstMeasureIndex,ADD_MODE_INSERT_BEFORE);}return true;}}}else{if(this.isDragType(ev,"dd-agg")){if(dstMeasureIndex>=0){var aggId=this.getDragData(ev,"dd-agg")-0;
var dstMeas=dmsel.measuresToKeep[dstMeasureIndex];if(dstMeas){var derivedMeas=dstMeas.idxCol<0;if((!derivedMeas&&aggId>-1)||(derivedMeas&&(aggId==-1||aggId==AGG_RSM))){if(dmsel.changeAgg(dstMeasureIndex,aggId)){this.chart.axisEditor.refreshDM();}}else{alert(Properties[getLocale()]["Edit.Menu.AggregationNotSupported"]);}}}return true;}else{if(this.isDragType(ev,"dd-transfo")){if(dstMeasureIndex>=0){var transfoId=this.getDragData(ev,"dd-transfo");var srcMeas=dmsel.measuresToKeep[dstMeasureIndex];if(srcMeas&&ddCtrl.transfoRepo[transfoId]){if(srcMeas.srvFormula){alert(Properties[getLocale()]["Edit.Menu.TransformationNotSupported"]);}else{var dimId=null;var contDimCount=0;for(var iDim=0;iDim<dmsel.dm.dimensions.length;iDim++){if(dmsel.dm.dimensions[iDim].continuous){if(contDimCount==0){dimId=dmsel.dm.dimensions[iDim].id;}contDimCount++;}}if(contDimCount>1){var self=this.chart.axisEditor;this.chart.axisEditor.createSelectDimDropContextMenu(ev,true,function(dimId){self.onAddDerivedTransfoMeasure(srcMeas,dimId,transfoId,dmsel.aggsForMeasure[dstMeasureIndex]);
});}else{if(dimId){this.chart.axisEditor.onAddDerivedTransfoMeasure(srcMeas,dimId,transfoId,dmsel.aggsForMeasure[dstMeasureIndex]);}else{alert(Properties[getLocale()]["Edit.Menu.TransformationNotSupported"]);}}}}}return true;}else{if(this.isDragType(ev,"dd-predict")){if(dstMeasureIndex>=0){var predictId=this.getDragData(ev,"dd-predict");var srcMeas=dmsel.measuresToKeep[dstMeasureIndex];if(srcMeas&&ddCtrl.predictRepo[predictId]){if(srcMeas.srvFormula){alert(Properties[getLocale()]["Edit.Menu.PredictionNotSupported"]);}else{var dimId=null;var contDimCount=0;for(var iDim=0;iDim<dmsel.dm.dimensions.length;iDim++){if(dmsel.dm.dimensions[iDim].continuous){if(contDimCount==0){dimId=dmsel.dm.dimensions[iDim].id;}contDimCount++;}}if(contDimCount>1){var self=this.chart.axisEditor;this.chart.axisEditor.createSelectDimDropContextMenu(ev,true,function(dimId){self.onAddDerivedPredictiveMeasure(srcMeas,dimId,predictId,dmsel.aggsForMeasure[dstMeasureIndex]);});}else{if(dimId){this.chart.axisEditor.onAddDerivedPredictiveMeasure(srcMeas,dimId,predictId,dmsel.aggsForMeasure[dstMeasureIndex]);
}else{alert(Properties[getLocale()]["Edit.Menu.PredictionNotSupported"]);}}}}}return true;}}}}return false;};DragEditHandler.prototype.dropMeasure_tables=function(ev){ev.preventDefault();var target=findEditable(ev.currentTarget?ev.currentTarget:event.srcElement);var dstMeasureIndex=-1;var dmsel=this.chart.dmsel;if(typeof(target.editCtx.measureIndex)!="undefined"){dstMeasureIndex=target.editCtx.measureIndex;}if(this.isDragType(ev,"dd-measure")){if(typeof(target.editCtx.axisId)=="undefined"&&typeof(target.editCtx.measureIndex)=="undefined"){dstMeasureIndex=dmsel.measuresToKeep.length;}if(this.isDragSameWindow(ev)){var jsonSrcEditCtx=this.getDragData(ev,"dd-editctx");if(jsonSrcEditCtx){srcEditCtx=JSON.parse(jsonSrcEditCtx);if(srcEditCtx&&srcEditCtx.measureIndex>=0){if(ev.onAfter){dstMeasureIndex++;}if(dstMeasureIndex>srcEditCtx.measureIndex){dstMeasureIndex--;}if(dmsel.moveMeasure(srcEditCtx.measureIndex,dstMeasureIndex)){this.chart.axisEditor.refreshDM();}return true;}}}var measureId=this.getDragData(ev,"text/plain");
if(measureId=="DD:NEWFORMULA"){var selfae=this.chart.axisEditor;selfae.promptFormula(function(name,formula,format){var existMeasure=dmsel.findMeasure(name);if(!existMeasure){var localMeas2=dmsel.addDerivedCalculation(name,formula,format);if(localMeas2){selfae.updateToolbarChartMeasures();selfae.refreshDM();}}},function(){if(target&&typeof(target.ondragleave)=="function"){target.ondragleave();}});}else{if(ev.ctrlKey){if(typeof(target.editCtx.measureIndex)=="undefined"){var curIndex=dmsel.indexOfMeasure(measureId);var measure=dmsel.measuresToKeep[curIndex];this.chart.axisEditor.createMeasureDropContextMenu(ev,measure);return true;}}else{if(ev.onAfter&&dmsel.measuresToKeep.length>dstMeasureIndex){dstMeasureIndex++;}var curIndex=dmsel.indexOfMeasure(measureId);if(curIndex>-1){if(dstMeasureIndex>curIndex){dstMeasureIndex--;}dmsel.removeMeasure(curIndex);}var measure=dmsel.findMeasure(measureId);if(dstMeasureIndex>=0&&measure){this.chart.axisEditor.onMeasureAdd(measure,dmsel.measureAxis,dstMeasureIndex,ADD_MODE_INSERT_BEFORE);
}return true;}}}else{if(this.isDragType(ev,"dd-agg")){if(dstMeasureIndex>=0){var aggId=this.getDragData(ev,"dd-agg")-0;var dstMeas=dmsel.measuresToKeep[dstMeasureIndex];if(dstMeas){var derivedMeas=dstMeas.idxCol<0;if((!derivedMeas&&aggId>-1)||(derivedMeas&&(aggId==-1||aggId==AGG_RSM))){if(dmsel.changeAgg(dstMeasureIndex,aggId)){this.chart.axisEditor.refreshDM();}}else{alert(Properties[getLocale()]["Edit.Menu.AggregationNotSupported"]);}}}return true;}else{if(this.isDragType(ev,"dd-transfo")){if(dstMeasureIndex>=0){var transfoId=this.getDragData(ev,"dd-transfo");var srcMeas=dmsel.measuresToKeep[dstMeasureIndex];if(srcMeas&&ddCtrl.transfoRepo[transfoId]){if(srcMeas.srvFormula){alert(Properties[getLocale()]["Edit.Menu.TransformationNotSupported"]);}else{var dimId=null;var contDimCount=0;for(var iDim=0;iDim<dmsel.dm.dimensions.length;iDim++){if(dmsel.dm.dimensions[iDim].continuous){if(contDimCount==0){dimId=dmsel.dm.dimensions[iDim].id;}contDimCount++;}}if(contDimCount>1){var self=this.chart.axisEditor;
this.chart.axisEditor.createSelectDimDropContextMenu(ev,true,function(dimId){self.onAddDerivedTransfoMeasure(srcMeas,dimId,transfoId,dmsel.aggsForMeasure[dstMeasureIndex]);});}else{if(dimId){this.chart.axisEditor.onAddDerivedTransfoMeasure(srcMeas,dimId,transfoId,dmsel.aggsForMeasure[dstMeasureIndex]);}else{alert(Properties[getLocale()]["Edit.Menu.TransformationNotSupported"]);}}}}}return true;}else{if(this.isDragType(ev,"dd-predict")){if(dstMeasureIndex>=0){var predictId=this.getDragData(ev,"dd-predict");var srcMeas=dmsel.measuresToKeep[dstMeasureIndex];if(srcMeas&&ddCtrl.predictRepo[predictId]){if(srcMeas.srvFormula){alert(Properties[getLocale()]["Edit.Menu.PredictionNotSupported"]);}else{var dimId=null;var contDimCount=0;for(var iDim=0;iDim<dmsel.dm.dimensions.length;iDim++){if(dmsel.dm.dimensions[iDim].continuous){if(contDimCount==0){dimId=dmsel.dm.dimensions[iDim].id;}contDimCount++;}}if(contDimCount>1){var self=this.chart.axisEditor;this.chart.axisEditor.createSelectDimDropContextMenu(ev,true,function(dimId){self.onAddDerivedPredictiveMeasure(srcMeas,dimId,predictId,dmsel.aggsForMeasure[dstMeasureIndex]);
});}else{if(dimId){this.chart.axisEditor.onAddDerivedPredictiveMeasure(srcMeas,dimId,predictId,dmsel.aggsForMeasure[dstMeasureIndex]);}else{alert(Properties[getLocale()]["Edit.Menu.PredictionNotSupported"]);}}}}}return true;}}}}return false;};AxisEditor.prototype.onAddDerivedTransfoMeasure=function(srcMeas,dimId,transfoId,iAgg){var transfoFuncObj=ddCtrl.transfoRepo[transfoId];if(transfoFuncObj){var dstName=srcMeas.name+" ("+(transfoFuncObj.displayName||transfoFuncObj.id)+")";var transfoFunc=new Function("value",transfoFuncObj["function"]);var selfae=this;prompt(getLocMessage("Edit.Menu.NewFormulaName"),dstName,function(newName){if(!newName){alert(getLocMessage("Edit.Menu.NewFormulaNameRequirements"));}else{if(selfae.chart.dmsel.findMeasure(newName)){alert(getLocMessage("Edit.Menu.FormulaNameAlreadyExists"));}else{var localMeas=selfae.chart.dmsel.addDerivedTransfoMeasure(newName,srcMeas.id,iAgg,dimId,transfoId,transfoFunc);if(localMeas){selfae.updateToolbarChartMeasures();selfae.refreshDM();
}}}});}};AxisEditor.prototype.onAddDerivedPredictiveMeasure=function(srcMeas,dimId,predictId,iAgg){var predictFuncObj=ddCtrl.predictRepo[predictId];if(predictFuncObj){var dstName=srcMeas.name+" ("+(predictFuncObj.displayName||predictFuncObj.id)+")";var selfae=this;prompt(getLocMessage("Edit.Menu.NewFormulaName"),dstName,function(newName){if(!newName){alert(getLocMessage("Edit.Menu.NewFormulaNameRequirements"));}else{if(selfae.chart.dmsel.findMeasure(newName)){alert(getLocMessage("Edit.Menu.FormulaNameAlreadyExists"));}else{var callingCode=predictFuncObj["function"];callingCode=replaceAll(callingCode,"DATE_TOKEN_REPLACE",dimId);callingCode=replaceAll(callingCode,"OUTMEAS_TOKEN_REPLACE",newName);callingCode=replaceAll(callingCode,"ASSOCMEAS_TOKEN_REPLACE",srcMeas.id);var localMeas=selfae.chart.dmsel.addDerivedCalculation(newName,callingCode,srcMeas.format);if(localMeas){selfae.updateToolbarChartMeasures();selfae.refreshDM();}}}});}};DragEditHandler.prototype.dropRemove=function(ev){ev.preventDefault();
var dmsel=this.chart.dmsel;if(this.isDragSameWindow(ev)){var jsonSrcEditCtx=this.getDragData(ev,"dd-editctx");if(jsonSrcEditCtx){srcEditCtx=JSON.parse(jsonSrcEditCtx);if(srcEditCtx){if(this.isDragType(ev,"dd-measure")){if(this.chart.axisEditor.removeMeasure(dmsel,srcEditCtx.measureIndex)){this.chart.axisEditor.refreshDM();}return true;}else{if(this.isDragType(ev,"dd-dim")){if(this.chart.axisEditor.removeDim(dmsel,srcEditCtx.axisId,srcEditCtx.dimIndex)){this.chart.axisEditor.refreshDM();}return true;}else{if(this.isDragType(ev,"dd-axis")){if(this.chart.axisEditor.removeAxis(dmsel,srcEditCtx.axisId)){this.chart.axisEditor.refreshDM();}return true;}}}}}}return false;};AxisEditor.prototype.promptExportOptions=function(funcOnOK,inPageFormat){var dmsel=this.chart.dmsel;var doc=ddCtrl?ddCtrl.document:document;var popupExportOptions=doc.getElementById("popupExportOptions");if(!popupExportOptions){popupExportOptions=(new DOMWrapper(doc.body).add("div","popupExportOptions","popupDivBg",{style:"display:none;"}).add("div",null,"popupDiv").add("form",null,null,{onsubmit:"return false"}).add("div",null,"popupExportOptionsLabel").text(getLocMessage("Edit.Menu.SelectPageFormat")).parent.add("select","popupExportOptionsPageFormatSelect",null).parent.add("div",null,"popupButtons").add("button","popupExportOptionsOK").text(getLocMessage("Ok")).parent.add("button","popupExportOptionsCancel",null,{onclick:"hidePopup(this.parentNode.parentNode.parentNode.parentNode)"}).text(getLocMessage("Cancel")).parent.parent.parent.parent.domElt);
}doc.getElementById("popupExportOptionsOK").onclick=function(){var format=doc.getElementById("popupExportOptionsPageFormatSelect").value;hidePopup(popupExportOptions);if(funcOnOK){funcOnOK(format);}return false;};var selObj=doc.getElementById("popupExportOptionsPageFormatSelect");while(selObj.options.length>0){selObj.removeChild(selObj.options[0]);}var pageFormats=["","21x29.7","29.7x21","21.59x27.94","27.94x21.59"];var pageFormatsNames=getLocMessage("Edit.Menu.PageFormatNames");var selOk=false;var opt0;for(var i=0;i<pageFormats.length;i++){var opt=doc.createElement("option");if(i==0){opt0=opt;}opt.value=pageFormats[i];opt.innerHTML=pageFormatsNames[i];opt.selected=inPageFormat==pageFormats[i];selOk|=opt.selected;selObj.appendChild(opt);}if(!selOk){opt0.selected=true;}showPopup(popupExportOptions);doc.getElementById("popupExportOptionsPageFormatSelect").focus();};AxisEditor.prototype.promptFormula=function(funcOnOK,funcOnCancel,inName,inFormula,inFormat){var dmsel=this.chart.dmsel;var doc=ddCtrl?ddCtrl.document:document;
var popupNewFormula=doc.getElementById("popupFormula");if(!popupNewFormula){popupNewFormula=(new DOMWrapper(doc.body).add("div","popupFormula","popupDivBg",{style:"display:none;"}).add("div",null,"popupDiv").add("form",null,null,{onsubmit:"return false"}).add("input","popupFormulaName",null,{type:"text"}).parent.add("br").parent.add("select","popupFormulaMeasureSelect",null).parent.add("br").parent.add("textarea","popupFormulaFormula").parent.add("br").parent.add("select","popupFormulaFormatSelect").parent.add("div",null,"popupButtons").add("button","popupFormulaOK").text(getLocMessage("Ok")).parent.add("button","popupFormulaCancel").text(getLocMessage("Cancel")).parent.parent.parent.parent.domElt);}doc.getElementById("popupFormulaOK").onclick=function(){var fname=doc.getElementById("popupFormulaName").value;var formula=doc.getElementById("popupFormulaFormula").value;var format=doc.getElementById("popupFormulaFormatSelect").value;format=dmsel.dm.formatList[format];if(!fname||!formula||!format||fname==getLocMessage("Edit.Menu.NewFormulaName")){alert(getLocMessage("Edit.Menu.NewFormulaNameRequirements"));
return false;}if(dmsel.findMeasure(fname)&&inName!=fname){alert(getLocMessage("Edit.Menu.FormulaNameAlreadyExists"));return false;}hidePopup(popupNewFormula);if(funcOnOK){funcOnOK(fname,formula,format);}return false;};doc.getElementById("popupFormulaCancel").onclick=function(){hidePopup(popupNewFormula);if(funcOnCancel){funcOnCancel();}return false;};doc.getElementById("popupFormulaName").value=inName?inName:getLocMessage("Edit.Menu.NewFormulaName");doc.getElementById("popupFormulaFormula").value=inFormula?inFormula:"";var selObj=doc.getElementById("popupFormulaMeasureSelect");selObj.onchange=function(){insertMeasureNameInFormula(this);};while(selObj.options.length>0){selObj.removeChild(selObj.options[0]);}var opt=doc.createElement("option");opt.value="";opt.innerHTML=getLocMessage("Edit.Menu.AvailableMeasures")+"...";selObj.appendChild(opt);var hMeas={};for(var i=0;i<dmsel.dm.measures.length;i++){var meas=dmsel.dm.measures[i];if(!meas.archived){var opt=doc.createElement("option");opt.value=meas.id;
opt.innerHTML=meas.name;selObj.appendChild(opt);hMeas[meas.id]=true;}}for(var i=0;i<dmsel.chartMeasures.length;i++){var meas=dmsel.chartMeasures[i];if(!hMeas[meas.id]&&(!inName||inName!=meas.id)){var opt=doc.createElement("option");opt.value=meas.id;opt.innerHTML=meas.name;selObj.appendChild(opt);}}var selObj=doc.getElementById("popupFormulaFormatSelect");while(selObj.options.length>0){selObj.removeChild(selObj.options[0]);}var formats=getFormats(dmsel);var formatTypes=[getLocMessage("Edit.Menu.formatNumber"),getLocMessage("Edit.Menu.formatDate"),getLocMessage("Edit.Menu.formatIcon"),getLocMessage("Edit.Menu.formatMonth"),getLocMessage("Edit.Menu.formatPercentage"),getLocMessage("Edit.Menu.formatTime"),getLocMessage("Edit.Menu.formatAlerter")];var defaultFormatOpt=null;var foundFormat=false;for(var i=0;i<formats.length;i++){var format=formats[i];var opt=doc.createElement("option");opt.value=format.id;opt.innerHTML=format.id+" ("+formatTypes[format.type]+")";if(inFormat){opt.selected=format.id==inFormat;
}else{opt.selected=format.id=="Number"||format.id=="Nombre";}foundFormat|=opt.selected;if(format.id=="Number"||format.id=="Nombre"){defaultFormatOpt=opt;}selObj.appendChild(opt);}if(!foundFormat&&defaultFormatOpt){defaultFormatOpt.selected=true;}showPopup(popupNewFormula);doc.getElementById("popupFormulaName").focus();};function getFormats(dmsel,typeFilter){dmsel.dm.addFormatRepoToDM();var formats=[];for(var formatId in dmsel.dm.formatList){var format=dmsel.dm.formatList[formatId];if(!typeFilter||typeFilter.indexOf(""+format.type)){formats.push(dmsel.dm.formatList[formatId]);}}formats.sort(function(fa,fb){if(fa.type<fb.type){return -1;}else{if(fa.type>fb.type){return 1;}else{if(fa.id<fb.id){return -1;}else{if(fa.id>fb.id){return 1;}else{return 0;}}}}});return formats;}function insertMeasureNameInFormula(selObj){var doc=ddCtrl?ddCtrl.document:document;if(selObj.selectedIndex>0){var selMeas=selObj.value;selMeas="'"+encodeMeasureName(selMeas)+"'";insertAtCursor(doc.getElementById("popupFormulaFormula"),selMeas);
}selObj.selectedIndex=0;doc.getElementById("popupFormulaFormula").focus();}function insertAtCursor(myField,myValue){var doc=ddCtrl?ddCtrl.document:document;if(doc.selection){myField.focus();sel=doc.selection.createRange();sel.text=myValue;}else{if(myField.selectionStart||myField.selectionStart=="0"){var startPos=myField.selectionStart;var endPos=myField.selectionEnd;myField.value=myField.value.substring(0,startPos)+myValue+myField.value.substring(endPos,myField.value.length);myField.selectionStart=startPos+myValue.length;myField.selectionEnd=startPos+myValue.length;}else{myField.value+=myValue;}}}AxisEditor.prototype.promptRange=function(funcOnOK){var dmsel=this.chart.dmsel;var doc=ddCtrl?ddCtrl.document:document;var popupPromptRange=doc.getElementById("popupPromptRange");if(!popupPromptRange){popupPromptRange=(new DOMWrapper(doc.body).add("div","popupPromptRange","popupDivBg",{style:"display:none;"}).add("div",null,"popupDiv").add("form",null,null,{onsubmit:"return false"}).add("div","popupPromptRangeMinLabel").parent.add("input","popupPromptRangeMinInput",null,{type:"text"}).parent.add("div","popupPromptRangeMaxLabel").parent.add("input","popupPromptRangeMaxInput",null,{type:"text"}).parent.add("div",null,"popupButtons").add("button","popupPromptRangeOK").text(getLocMessage("Ok")).parent.add("button","popupPromptRangeCancel",null,{onclick:"hidePopup(this.parentNode.parentNode.parentNode.parentNode)"}).text(getLocMessage("Cancel")).parent.parent.parent.parent.domElt);
}doc.getElementById("popupPromptRangeOK").onclick=function(){var min=doc.getElementById("popupPromptRangeMinInput").value;var iMin=parseFloat(min);if(isNaN(iMin)&&min.length>0){alert(getLocMessage("Edit.Menu.RangeMinInvalid"));return false;}else{if(min.length==0){iMin=-Math.Infinity;}}var max=doc.getElementById("popupPromptRangeMaxInput").value;var iMax=parseFloat(max);if(isNaN(iMax)&&max.length>0){alert(getLocMessage("Edit.Menu.RangeMaxInvalid"));return false;}else{if(max.length==0){iMax=Math.Infinity;}}hidePopup(popupPromptRange);if(funcOnOK){funcOnOK(iMin,iMax);}return false;};doc.getElementById("popupPromptRangeMinLabel").innerHTML=genHTMLForPopup(getLocMessage("Edit.Menu.PromptRangeMin"));doc.getElementById("popupPromptRangeMaxLabel").innerHTML=genHTMLForPopup(getLocMessage("Edit.Menu.PromptRangeMax"));showPopup(popupPromptRange);doc.getElementById("popupPromptRangeMinInput").focus();};AxisEditor.prototype.createDiv=function(text,divClassName,iWidth,iMaxHeight){var div=document.createElement("div");
var heightStyle="";if(iMaxHeight>=0){heightStyle="max-height:"+iMaxHeight+"px;";}if(typeof(iWidth)!="undefined"&&iWidth!=null){if(iWidth<0){iWidth=0;}if(iWidth==0){setStyle(div,"width:"+iWidth+"px;display:none;"+heightStyle);}else{setStyle(div,"width:"+iWidth+"px;"+heightStyle);}}if(text){div.setAttribute("title",text);}if(!isHTML(text)){text=htmlEncode(text);}div.innerHTML=text;div.className=divClassName;return div;};AxisEditor.prototype.createSpan=function(text,spanClassName,iWidth,iMaxHeight,tableObj){var span=document.createElement("span");var heightStyle="";if(iMaxHeight>=0){heightStyle="max-height:"+iMaxHeight+"px;";}if(typeof(iWidth)!="undefined"&&iWidth!=null){if(iWidth<0){iWidth=0;}if(iWidth==0){setStyle(span,"width:"+iWidth+"px;display:none;"+heightStyle);}else{setStyle(span,"width:"+iWidth+"px;"+heightStyle);}}if(text){span.setAttribute("title",text);}if(!isHTML(text)){text=htmlEncode(text);}span.innerHTML=text;span.className=spanClassName;return span;};AxisEditor.prototype.buildDefaultTooltip=function(){var sToolTip="";
var vizDesc=getVizDescriptor(this.chart);if(!vizDesc||!vizDesc.tooltip){return"";}if(vizDesc.defaultTooltip){return vizDesc.defaultTooltip;}var bDimOnMeasureAxis=false;var dmsel=this.chart.dmsel;for(var axisId=0;axisId<dmsel.axis.length;axisId++){if(!dmsel.axis[axisId]||vizDesc.axis[axisId].skipTooltip){continue;}var axisContent=dmsel.axis[axisId];if(axisContent&&axisContent.length>0&&vizDesc.axis[axisId].id.indexOf("Multiplier")<0){if(axisId==dmsel.measureAxis){sToolTip+="${Member"+axisId+"}: ${Value}";bDimOnMeasureAxis=true;}else{sToolTip+="${Member"+axisId+"}";}}var addTiret=false;if(axisId<dmsel.axis.length-1&&dmsel.axis[axisId+1]&&dmsel.axis[axisId+1].length>0&&vizDesc.axis[axisId+1].id.indexOf("Multiplier")<0){addTiret=true;}if(axisId<dmsel.axis.length-1&&bDimOnMeasureAxis){sToolTip+="\r\n";addTiret=false;}if(axisId==dmsel.axis.length-1&&!bDimOnMeasureAxis){sToolTip+="\r\n";addTiret=false;}if(addTiret){sToolTip+="-";}}if(!bDimOnMeasureAxis){if(vizDesc.measuresMax>1){var cpt=0;for(var iMeasure=0;
iMeasure<dmsel.measuresToKeep.length;iMeasure++){sToolTip+="${Member"+dmsel.measureAxis+"/"+cpt+"}: ${Value"+cpt+"}";if(iMeasure<dmsel.measuresToKeep.length-1){sToolTip+="\r\n";}cpt++;}}else{sToolTip+="${Member"+dmsel.measureAxis+"}: ${Value}";}}return sToolTip;};GlobalFilter=function(id,pageId,bFillNow){this.container=document.getElementById(id);if(this.container){this.pageId=pageId;this.onServer=false;this.datamodels={};this.dimensions={};this.dimsSorted=[];this.filters={};this.createUI();if(bFillNow){this.fillGlobalFilter();for(var dimId in this.dimensions){var dimSelPanel=ddCtrl.dimPanelList[dimId+"true"];if(dimSelPanel){this.onDimensionFilter(dimId,dimSelPanel.getSelectedHierarchyId(),dimSelPanel.getSelectedHierarchyId(),dimSelPanel.getSelectedElements(),dimSelPanel.getSelectedFormatedElements());}dimSelPanel=ddCtrl.dimPanelList[dimId+"false"];if(dimSelPanel){this.onDimensionFilter(dimId,dimSelPanel.getSelectedHierarchyId(),dimSelPanel.getSelectedHierarchyId(),dimSelPanel.getSelectedElements(),dimSelPanel.getSelectedFormatedElements());
}}}ddCtrl.addChartDrawnListener(this);ddCtrl.addCurrentPageLoadListener(this);ddCtrl.addDimensionFilterListener(this);}};GlobalFilter.prototype.createUI=function(){this.container.style.overflow="visible";if(!ddCtrl.isNewDashboard){var curElt=this.container.parentElement;while(curElt!=null&&curElt.className!="x-panel-bwrap"){curElt.style.overflow="visible";curElt=curElt.parentElement;}curElt.style.overflow="visible";}this.searchbox=new SearchComboChosen(this.container,true,ddCtrl.getLocMessage("Search"),false,true,false);this.searchbox.maxDisp=ddCtrl.LIMIT_RESULT_SEARCHBOX;this.searchbox.nbPreviewRes=1000;var obj=this;this.searchbox.addSelectionListener(function(){obj.selectMembers();});this.searchbox.parentObj=this;if(ddCtrl.speechRec&&ddCtrl.speechRec.isAvailable()){var speechImg=document.createElement("div");speechImg.className="speechImg";speechImg.onclick=function(){ddCtrl.speechRec.start(obj.searchbox.search.id,function(eventType){obj.onSpeechRecEvent(eventType);});};this.container.appendChild(speechImg);
}};GlobalFilter.prototype.onSpeechRecEvent=function(eventType){if(eventType=="end"){this.searchbox.show();}};GlobalFilter.prototype.changeOverflow=function(sOverflow){if(ddCtrl.isNewDashboard){var portletElt=document.getElementById(this.container.id.replace("globalfilter_",""));portletElt.style.overflow=sOverflow;var portletContentId=this.container.id.replace("globalfilter_","content_");var portletContentElt=document.getElementById(portletContentId);portletContentElt.style.overflow=sOverflow;portletContentElt.parentElement.style.overflow=sOverflow;var curElt=this.container.parentElement;while(curElt!=null&&curElt.id!=portletContentId){curElt.style.overflow=sOverflow;curElt=curElt.parentElement;}}else{var curElt=this.container.parentElement;while(curElt!=null&&curElt.className!="x-panel-bwrap"){curElt.style.overflow="visible";curElt=curElt.parentElement;}curElt.style.overflow="visible";}};GlobalFilter.prototype.onChartDrawn=function(doc,dm,dmsel,chart){this.addDataModel(dm,dmsel);};GlobalFilter.prototype.currentPageLoaded=function(currentPage){if(currentPage==this.pageId){this.fillGlobalFilter();
}};GlobalFilter.prototype.onDimensionFilter=function(dimId,hierarchyId,levelId,members,membersFormated){if(typeof(this.dimensions[dimId])!="undefined"&&this.dimensions[dimId].length>0&&hierarchyId!="Range"){if(levelId=="root"){levelId=null;}var newSel=[];var sel=this.searchbox.selected;if(sel.length>0){for(var i=0;i<sel.length;i++){var selObj=sel[i];if(selObj.dimId!=dimId){newSel.push(selObj);}}if(members.length>0&&members[0]!="All"){for(var i=0;i<members.length;i++){var selObj=new SearchComboValName(members[i],membersFormated[i],0,this.dimensions[dimId].name);selObj.dimId=dimId;selObj.hierarchyId=hierarchyId;selObj.levelId=levelId;newSel.push(selObj);}}this.searchbox.delSel();this.searchbox.addSelectedList(newSel);}else{if(members.length>0&&members[0]!="All"){for(var i=0;i<members.length;i++){var selObj=new SearchComboValName(members[i],membersFormated[i],0,this.dimensions[dimId].name);selObj.dimId=dimId;selObj.hierarchyId=hierarchyId;selObj.levelId=levelId;this.searchbox.addSelected(selObj);
}}}}};GlobalFilter.prototype.fillGlobalFilter=function(){if(this.dimsSorted.length==0){for(var i=0;i<ddCtrl.dmList.length;i++){this.addDataModel(ddCtrl.dmList[i],ddCtrl.dmSelList[i]);}}for(var i=0;i<this.dimsSorted.length;i++){var dimObj=this.dimsSorted[i];var dimsList=this.dimensions[dimObj.id];this.addDimension(dimsList);}if(this.onServer){var cubeIds=[];for(cubeId in this.datamodels){cubeIds.push(cubeId);}var dimIds=[];for(var i=0;i<this.dimsSorted.length;i++){var dimObj=this.dimsSorted[i];dimIds.push(dimObj.id);}this.searchbox.setAnalyzerHandler(new AnalyzerHandler(cubeIds,dimIds,"ALL","ALL",ddCtrl.LIMIT_RESULT_SEARCHBOX));}};GlobalFilter.prototype.addDataModel=function(dm,dmsel){if(dmsel.pageId==this.pageId&&!this.datamodels[dm.cubeId]){this.datamodels[dm.cubeId]=dm;for(var i=0;i<dm.dimensions.length;i++){var dim=dm.dimensions[i];if(!dim.archived){if(!this.dimensions[dim.id]){this.dimensions[dim.id]=[];this.dimsSorted.push(new DimObject(dim.id,dim.name));}this.dimensions[dim.id].push(dim);
this.onServer|=dim.membersOnServer;}}this.dimsSorted.sort(sortDim);}};GlobalFilter.prototype.addDimension=function(dimsList){var members=[];var mapMembers={};var bSort;var sortFunc;var captionDim=false;var dimName=null;var dimId=null;for(var iDim=0;iDim<dimsList.length;iDim++){var dim=dimsList[iDim];dimName=dim.name;dimId=dim.id;captionDim=dim.captionDim;if(iDim==0){dimId=dim.id;bSort=!dim.order;}if(sortFunc==null){sortFunc=dim.sort;}var dimMembers=dim.members;if(this.onServer&&dim.previewMembers){dimMembers=dim.previewMembers;}for(var iMbr=0;iMbr<dimMembers.length;iMbr++){var member=dimMembers[iMbr];if(typeof(mapMembers[member])=="undefined"){var memberFormated=this.getMemberFormated(dim,null,member);var caption=null;if(captionDim&&dim.captions[i]){caption=dim.captions[i];}var mbrObj=new DimMember(member,memberFormated,caption,dim.id,null,null);members.push(mbrObj);mapMembers[member]=mbrObj;}}}if(bSort&&sortFunc){var mySortFunc=function(obj1,obj2){var mbr1=obj1.id;if(obj1.caption){mbr1=obj1.caption;
}var mbr2=obj2.id;if(obj2.caption){mbr2=obj2.caption;}return sortFunc(mbr1,mbr2);};members.sort(mySortFunc);}for(var i=0;i<members.length;i++){var mbrObj=members[i];var sObj=new SearchComboValName(mbrObj.id,mbrObj.caption!=null?mbrObj.caption:mbrObj.formated,0,dimName);sObj.dimId=dimId;if(i<ddCtrl.LIMIT_RESULT_SEARCHBOX){this.searchbox.add(sObj.txt,sObj);}else{this.searchbox.addToTST(sObj.txt,sObj);}}var mapMembersByHL={};var membersByHL={};for(var iDim=0;iDim<dimsList.length;iDim++){var dim=dimsList[iDim];for(var iH=0;iH<dim.hierarchies.length;iH++){var hierarchy=dim.hierarchies[iH];for(var iL=0;iL<hierarchy.levels.length;iL++){var level=hierarchy.levels[iL];level.prepare(dim);var name=dim.name+" / "+hierarchy.name+" / "+level.name;if(!mapMembersByHL[name]){mapMembersByHL[name]={};membersByHL[name]=[];}var dimGroups=level.groups;if(this.onServer&&level.previewGroups){dimGroups=level.previewGroups;}for(var iG=0;iG<dimGroups.length;iG++){var grpMbr=dimGroups[iG].name;if(typeof(mapMembersByHL[name][grpMbr])=="undefined"){var memberFormated=this.getMemberFormated(dim,level,grpMbr);
var caption=null;if(dimGroups[iG].caption){caption=dimGroups[iG].caption;}var mbrObj=new DimMember(grpMbr,memberFormated,caption,dim.id,hierarchy.id,level.id);membersByHL[name].push(mbrObj);mapMembersByHL[name][grpMbr]=mbrObj;}}}}}for(var hl in membersByHL){var members=membersByHL[hl];if(bSort&&sortFunc){var mySortFunc=function(obj1,obj2){var mbr1=obj1.id;if(obj1.caption){mbr1=obj1.caption;}var mbr2=obj2.id;if(obj2.caption){mbr2=obj2.caption;}return sortFunc(mbr1,mbr2);};members.sort(mySortFunc);}for(var i=0;i<members.length;i++){var mbrObj=members[i];var sObj=new SearchComboValName(mbrObj.id,mbrObj.caption!=null?mbrObj.caption:mbrObj.formated,0,hl);sObj.dimId=mbrObj.dimId;sObj.hierarchyId=mbrObj.hierarchyId;sObj.levelId=mbrObj.levelId;if(i<ddCtrl.LIMIT_RESULT_SEARCHBOX){this.searchbox.add(sObj.txt,sObj);}else{this.searchbox.addToTST(sObj.txt,sObj);}}}};DimObject=function(dimId,dimName){this.id=dimId;this.name=dimName;};function sortDim(a,b){return sortAlphabetic(a.name,b.name);}DimMember=function(id,formated,caption,dimId,hierarchyId,levelId){this.id=id;
this.formated=formated;this.caption=caption;this.dimId=dimId;this.hierarchyId=hierarchyId;this.levelId=levelId;};GlobalFilter.prototype.getMemberFormated=function(dim,level,member){var fMember=member;if(level!=null){if(level.format){fMember=formatNum(member,level.format);}else{var gPos=level.getMemberPosByName(member);if(gPos>=0&&level.groups[gPos]&&typeof(level.groups[gPos].caption)!="undefined"){fMember=level.groups[gPos].caption;}}}else{if(dim.format){fMember=formatNum(member,dim.format);}else{if(dim.captionDim){var mbrPos=dim.getMemberPosById(member);if(dim.captions[mbrPos]){fMember=dim.captions[mbrPos];}}}}return fMember;};GlobalFilter.prototype.selectMembers=function(){this.filters={};var sel=this.searchbox.selected;if(sel.length>0){for(var i=0;i<sel.length;i++){var selObj=sel[i];var filterKey=selObj.dimId;var filterOp=this.filters[filterKey];if(!filterOp||!this.isSameHierarchyLevel(filterOp.h,filterOp.l,selObj.hierarchyId,selObj.levelId)){filterOp=new FilterOperand(selObj.dimId,[selObj.id],selObj.hierarchyId,selObj.levelId,[selObj.txt]);
}else{filterOp.member.push(selObj.id);filterOp.memberFormated.push(selObj.id);}this.filters[filterKey]=filterOp;}ddCtrl.beginSelection();var dimFiltered={};for(key in this.filters){var filterOp=this.filters[key];dimFiltered[filterOp.dimId]=true;ddCtrl.filter(filterOp);}for(dimId in this.dimensions){if(!dimFiltered[dimId]){ddCtrl.filter(new FilterOperand(dimId,"All"));}}ddCtrl.commitSelection();}else{ddCtrl.beginSelection();for(dimId in this.dimensions){ddCtrl.filter(new FilterOperand(dimId,"All"));}ddCtrl.commitSelection();}};GlobalFilter.prototype.isRootLevel=function(hierarchyId,levelId){if(typeof(hierarchyId)=="undefined"||hierarchyId==null||typeof(levelId)=="undefined"||levelId==null||levelId=="root"){return true;}return false;};GlobalFilter.prototype.isSameHierarchyLevel=function(h1,l1,h2,l2){if(this.isRootLevel(h1,l1)&&this.isRootLevel(h2,l2)){return true;}if(h1==h2&&l1==l2){return true;}return false;};DDVarUI=function(id,varName,vizType,hideVarName,pageId){this.container=document.getElementById(id);
this.varName=varName;this.vizType=vizType;this.hideVarName=hideVarName;this.pageId=pageId;if(typeof(__v[varName])!="undefined"){this.ddvar=__v[this.varName];this.displayName=this.ddvar.name;if(this.ddvar.displayName){this.displayName=this.ddvar.displayName;}var i=0;var nodes=this.container.childNodes;while(i<nodes.length){this.container.removeChild(nodes[i]);}this.draw();}};DDVarSlider=function(id,varName,vizType,hideVarName,pageId){DDVarUI.call(this,id,varName,vizType,hideVarName,pageId);};DDVarSlider.prototype=new DDVarUI();DDVarSlider.prototype.draw=function(){var obj=this;this.multiplier=calcMultiplier(this.ddvar.inc);var table=document.createElement("table");table.cellPadding="5";setStyle(table,"width: 100%");var tr=document.createElement("tr");table.appendChild(tr);this.container.appendChild(table);if(!this.hideVarName){var tdName=document.createElement("td");var divName=document.createElement("div");setStyle(divName,"white-space: nowrap;");divName.appendChild(document.createTextNode(this.displayName));
tdName.appendChild(divName);tr.appendChild(tdName);}var tdValue=document.createElement("td");setStyle(tdValue,"width: 100%; padding: 5px");var sliderValue=document.createElement("div");this.sliderId=this.container.id+"_slider";sliderValue.id=this.sliderId;setStyle(sliderValue,"width: 100%");tdValue.appendChild(sliderValue);tr.appendChild(tdValue);createSpinner(obj,tr);createSlider(obj,"horizontal");};DDVarSlider.prototype.update=function(){updateSlider(this);updateSpinner(this);};DDVarSliderVertical=function(id,varName,vizType,hideVarName,pageId){DDVarUI.call(this,id,varName,vizType,hideVarName,pageId);};DDVarSliderVertical.prototype=new DDVarUI();DDVarSliderVertical.prototype.draw=function(){var obj=this;this.multiplier=calcMultiplier(this.ddvar.inc);var table=document.createElement("table");setStyle(table,"width: 100%; height: 100%");this.container.appendChild(table);if(!this.hideVarName){var trName=document.createElement("tr");var tdName=document.createElement("td");var divName=document.createElement("div");
setStyle(divName,"text-align: center;");divName.appendChild(document.createTextNode(this.displayName));tdName.appendChild(divName);trName.appendChild(tdName);table.appendChild(trName);}var trSlider=document.createElement("tr");var tdSlider=document.createElement("td");tdSlider.align="center";setStyle(tdSlider,"width: 100%; height: 100%");var sliderValue=document.createElement("div");setStyle(sliderValue,"height: 100%");this.sliderId=this.container.id+"_slider";sliderValue.id=this.sliderId;tdSlider.appendChild(sliderValue);trSlider.appendChild(tdSlider);table.appendChild(trSlider);createSlider(obj,"vertical");var trSpinner=document.createElement("tr");var tdSpinner=document.createElement("td");setStyle(tdSpinner,"width: 100%");trSpinner.appendChild(tdSpinner);table.appendChild(trSpinner);var tableSpinner=document.createElement("table");tableSpinner.align="center";var trValue=document.createElement("tr");tableSpinner.appendChild(trValue);tdSpinner.appendChild(tableSpinner);createSpinner(obj,trValue);
};DDVarSliderVertical.prototype.update=function(){updateSlider(this);updateSpinner(this);};DDVarTextField=function(id,varName,vizType,hideVarName,pageId){DDVarUI.call(this,id,varName,vizType,hideVarName,pageId);};DDVarTextField.prototype=new DDVarUI();DDVarTextField.prototype.draw=function(){var obj=this;var table=document.createElement("table");table.cellPadding="5";setStyle(table,"width: 100%");var tr=document.createElement("tr");if(!this.hideVarName){var tdName=document.createElement("td");var divName=document.createElement("div");setStyle(divName,"white-space: nowrap;");divName.appendChild(document.createTextNode(this.displayName));tdName.appendChild(divName);tr.appendChild(tdName);}var tdValue=document.createElement("td");setStyle(tdValue,"width: 100%; padding: 5px");this.inputValue=document.createElement("input");setStyle(this.inputValue,"width: 100%");this.inputValue.type="text";this.inputValue.val=this.ddvar.cur;this.inputValue.value=formatNum(this.ddvar.cur,this.ddvar.format);tdValue.appendChild(this.inputValue);
tr.appendChild(tdValue);var tdButton=document.createElement("td");var button=document.createElement("input");button.type="button";button.value="OK";button.onclick=function(){var value=obj.inputValue.value;value=value.replace(",",".");try{value=parseFloat(value);}catch(e){value=Number.NaN;}var bChangeVar=true;if(isNaN(value)){bChangeVar=false;}else{if(obj.ddvar.min!=0&&obj.ddvar.max!=0&&(value>obj.ddvar.max||value<obj.ddvar.min)){bChangeVar=false;}}if(bChangeVar){ddCtrl.changeVariable(obj.varName,value);}};tdButton.appendChild(button);tr.appendChild(tdButton);table.appendChild(tr);this.container.appendChild(table);};DDVarTextField.prototype.update=function(){this.inputValue.val=this.ddvar.cur;this.inputValue.value=formatNum(this.ddvar.cur,this.ddvar.format);};DDVarSpinner=function(id,varName,vizType,hideVarName,pageId){DDVarUI.call(this,id,varName,vizType,hideVarName,pageId);};DDVarSpinner.prototype=new DDVarUI();DDVarSpinner.prototype.draw=function(){var obj=this;var table=document.createElement("table");
table.cellPadding="5";var tr=document.createElement("tr");if(!this.hideVarName){var tdName=document.createElement("td");var divName=document.createElement("div");divName.appendChild(document.createTextNode(this.displayName));tdName.appendChild(divName);tr.appendChild(tdName);}createSpinner(obj,tr);table.appendChild(tr);this.container.appendChild(table);};DDVarSpinner.prototype.update=function(){updateSpinner(this);};DDVarCombo=function(id,varName,vizType,hideVarName,pageId){DDVarUI.call(this,id,varName,vizType,hideVarName,pageId);};DDVarCombo.prototype=new DDVarUI();DDVarCombo.prototype.draw=function(){var obj=this;var table=document.createElement("table");table.cellPadding="5";setStyle(table,"width: 100%");var tr=document.createElement("tr");if(!this.hideVarName){var tdName=document.createElement("td");var divName=document.createElement("div");setStyle(divName,"white-space: nowrap;");divName.appendChild(document.createTextNode(this.displayName));tdName.appendChild(divName);tr.appendChild(tdName);
}var tdValue=document.createElement("td");setStyle(tdValue,"width: 100%; padding: 5px");this.selectValue=document.createElement("select");setStyle(this.selectValue,"width: 100%");if(this.ddvar.values!=null){for(var val in this.ddvar.values){var option=document.createElement("option");option.value=val;option.innerHTML=this.ddvar.values[val];if(val==this.ddvar.cur){option.selected=true;}this.selectValue.appendChild(option);}}else{for(var val=this.ddvar.min;val<=this.ddvar.max;val=val+this.ddvar.inc){var option=document.createElement("option");val=round(val,this.ddvar.inc);option.value=val;option.innerHTML=formatNum(val,this.ddvar.format);if(val==this.ddvar.cur){option.selected=true;}this.selectValue.appendChild(option);}}this.selectValue.onchange=function(){var val=this.options[this.selectedIndex].value;ddCtrl.changeVariable(obj.varName,val);};tdValue.appendChild(this.selectValue);tr.appendChild(tdValue);table.appendChild(tr);this.container.appendChild(table);};DDVarCombo.prototype.update=function(){for(var i=0;
i<this.selectValue.options.length;i++){if(this.selectValue.options[i].value==this.ddvar.cur){this.selectValue.options[i].selected=true;break;}}};DDVarListVertical=function(id,varName,vizType,hideVarName,pageId){DDVarUI.call(this,id,varName,vizType,hideVarName,pageId);};DDVarListVertical.prototype=new DDVarUI();DDVarListVertical.prototype.draw=function(){if(this.ddvar.values!=null){var obj=this;var table=document.createElement("table");setStyle(table,"width: 100%");if(!this.hideVarName){var trName=document.createElement("tr");var tdName=document.createElement("td");setStyle(tdName,"text-align: center");tdName.innerHTML=this.displayName;trName.appendChild(tdName);table.appendChild(trName);}var vals=[];for(var val in this.ddvar.values){vals.push(val-0);}vals.sort(function(a,b){return a-b;});for(var i=0;i<vals.length;i++){var val=vals[i];var tr=document.createElement("tr");var td=document.createElement("td");td.className="tdMemberActive";td.id=this.container.id+"_"+val;setStyle(td,"text-align: center");
td.innerHTML=this.ddvar.values[val];td.val=val;if(val==this.ddvar.cur){td.className="tdMemberSelected";}td.onclick=function(){ddCtrl.changeVariable(obj.varName,this.val);};tr.appendChild(td);table.appendChild(tr);}this.container.appendChild(table);}};DDVarListVertical.prototype.update=function(){for(var val in this.ddvar.values){var id=this.container.id+"_"+val;var elt=document.getElementById(id);if(val==this.ddvar.cur){elt.className="tdMemberSelected";}else{elt.className="tdMemberActive";}}};DDVarListHorizontal=function(id,varName,vizType,hideVarName,pageId){DDVarUI.call(this,id,varName,vizType,hideVarName,pageId);};DDVarListHorizontal.prototype=new DDVarUI();DDVarListHorizontal.prototype.draw=function(){if(this.ddvar.values!=null){var obj=this;var table=document.createElement("table");setStyle(table,"width: 100%");var tr=document.createElement("tr");if(!this.hideVarName){var tdName=document.createElement("td");var divName=document.createElement("div");setStyle(tdName,"width:1%; white-space: nowrap;");
tdName.innerHTML=this.displayName;tr.appendChild(tdName);}var vals=[];for(var val in this.ddvar.values){vals.push(val-0);}vals.sort(function(a,b){return a-b;});for(var i=0;i<vals.length;i++){var val=vals[i];var td=document.createElement("td");td.className="tdMemberActive";td.id=this.container.id+"_"+val;setStyle(td,"text-align: center");td.innerHTML=this.ddvar.values[val];td.val=val;if(val==this.ddvar.cur){td.className="tdMemberSelected";}td.onclick=function(){ddCtrl.changeVariable(obj.varName,this.val);};tr.appendChild(td);}table.appendChild(tr);this.container.appendChild(table);}};DDVarListHorizontal.prototype.update=function(){for(var val in this.ddvar.values){var id=this.container.id+"_"+val;var elt=document.getElementById(id);if(val==this.ddvar.cur){elt.className="tdMemberSelected";}else{elt.className="tdMemberActive";}}};function createSlider(obj,orientation){$(function(){$("[id='"+obj.sliderId+"']").slider({min:obj.ddvar.min*obj.multiplier,max:obj.ddvar.max*obj.multiplier,value:obj.ddvar.cur*obj.multiplier,step:obj.ddvar.inc*obj.multiplier,orientation:orientation,slide:function(event,ui){var val=ui.value;
val=val/obj.multiplier;obj.tdValue.innerHTML=formatNum(val,obj.ddvar.format);},change:function(event,ui){if(event.originalEvent){var val=ui.value;val=val/obj.multiplier;ddCtrl.changeVariable(obj.varName,val);}}});$("[id='"+obj.sliderId+"']").focusin(function(event){if(event.stopPropagation){event.stopPropagation();}});});}function updateSlider(obj){$("[id='"+obj.sliderId+"']").slider("option","value",obj.ddvar.cur*obj.multiplier);}function createSpinner(obj,tr){var tdPrev=document.createElement("td");obj.imgPrev=document.createElement("div");obj.imgPrev.className="variable_prev_img";obj.imgPrev.onclick=function(){var val=obj.ddvar.cur-obj.ddvar.inc;val=round(val,obj.ddvar.inc);ddCtrl.changeVariable(obj.varName,val);};tdPrev.appendChild(obj.imgPrev);tr.appendChild(tdPrev);obj.tdValue=document.createElement("td");setStyle(obj.tdValue,"white-space: nowrap");obj.tdValue.innerHTML=formatNum(obj.ddvar.cur,obj.ddvar.format);tr.appendChild(obj.tdValue);var tdNext=document.createElement("td");obj.imgNext=document.createElement("div");
obj.imgNext.className="variable_next_img";obj.imgNext.onclick=function(){var val=obj.ddvar.cur+obj.ddvar.inc;val=round(val,obj.ddvar.inc);ddCtrl.changeVariable(obj.varName,val);};tdNext.appendChild(obj.imgNext);tr.appendChild(tdNext);}function updateSpinner(obj){obj.tdValue.innerHTML=formatNum(obj.ddvar.cur,obj.ddvar.format);if(obj.ddvar.cur>=obj.ddvar.max){setStyle(obj.imgNext,"visibility: hidden");}else{setStyle(obj.imgNext,"visibility: inherit");}if(obj.ddvar.cur<=obj.ddvar.min){setStyle(obj.imgPrev,"visibility: hidden");}else{setStyle(obj.imgPrev,"visibility: inherit");}}function round(val,inc){var sInc=inc+"";var tInc=sInc.split(".");if(tInc.length==2){var nbDecimals=tInc[1];var n=nbDecimals.length;var s="1";for(var i=0;i<n;i++){s+="0";}var precision=parseInt(s);var iVal=Math.round(val*precision);var dVal=iVal/precision;return dVal;}return val;}function calcMultiplier(inc){var multiplier=1;if(!(inc%1==0)){var sInc=inc+"";var tInc=sInc.split(".");if(tInc.length==2){var nbDecimals=tInc[1];
if(nbDecimals.length>0){multiplier=Math.pow(10,nbDecimals.length);}}}return multiplier;}var ESTIMATED_VALUE=0;var LOWEST_CONF_INT=1;var HIGHEST_CONF_INT=2;function linearRegression(selection,line,phase,dimDateName,outMeasName,x,y,valueType){var algvar="";if(line!=null){algvar=line[selection.measureAxis];}var algoId=outMeasName+algvar;var key=buildKey(line,selection,dimDateName);var measure_value=!valueType||valueType==ESTIMATED_VALUE;var lower_bound=valueType==LOWEST_CONF_INT;var upper_bound=valueType==HIGHEST_CONF_INT;if(phase==0){if(_global[algoId]==undefined){_global[algoId]=Object();_global[algoId].data=Object();_global[algoId].valueTimeSerie=function(x,y){var vts=Object();vts.x=x;vts.y=y;return vts;};_global[algoId].addData=function(vts,key){if(_global[algoId].data[key]==null){_global[algoId].data[key]=Array();}_global[algoId].data[key].push(vts);};}if(y!=null&&!isNaN(y)){_global[algoId].addData(_global[algoId].valueTimeSerie(x,y),key);}return 0;}else{if(_global[algoId].result==null){_global[algoId].result=Object();
_global[algoId].computeMeanSquaredError=function(data,a,b){var SSE=0;for(var i=0;i<data.length;++i){SSE+=(data[i].y-(a*data[i].x+b))*(data[i].y-(a*data[i].x+b));}return(1/(data.length-1))*SSE;};}if(_global[algoId].result[key]!=null){var y_estim=_global[algoId].result[key].intercept+_global[algoId].result[key].slope*x;if(isNaN(y_estim)){return null;}if(lower_bound){return y_estim-1.96*Math.sqrt(_global[algoId].result[key].error);}else{if(upper_bound){return y_estim+1.96*Math.sqrt(_global[algoId].result[key].error);}}return y_estim;}else{_global[algoId].result[key]=Object();var dataReg=_global[algoId].data[key];if(dataReg==null){return null;}var n=0;var sum_x=0;var sum_y=0;var sum_xy=0;var sum_xx=0;var sum_yy=0;var sum=0;if(dataReg.length>1){for(var i=0;i<dataReg.length;++i){sum_x+=dataReg[i].x;sum_y+=dataReg[i].y;sum_xy+=(dataReg[i].x*dataReg[i].y);sum_xx+=(dataReg[i].x*dataReg[i].x);sum_yy+=(dataReg[i].y*dataReg[i].y);n++;}_global[algoId].result[key].slope=(n*sum_xy-sum_x*sum_y)/(n*sum_xx-sum_x*sum_x);
_global[algoId].result[key].intercept=(sum_y-_global[algoId].result[key].slope*sum_x)/n;if(!measure_value){_global[algoId].result[key].error=_global[algoId].computeMeanSquaredError(dataReg,_global[algoId].result[key].slope,_global[algoId].result[key].intercept);}_global[algoId].result[key].y_estim=_global[algoId].result[key].intercept+_global[algoId].result[key].slope*x;}else{_global[algoId].result[key].slope=0;_global[algoId].result[key].intercept=dataReg[0].y;_global[algoId].result[key].error=null;_global[algoId].result[key].y_estim=_global[algoId].result[key].intercept;}if(isNaN(_global[algoId].result[key].y_estim)){return null;}if(lower_bound){return _global[algoId].result[key].y_estim-1.96*Math.sqrt(_global[algoId].result[key].error);}else{if(upper_bound){return _global[algoId].result[key].y_estim+1.96*Math.sqrt(_global[algoId].result[key].error);}}return _global[algoId].result[key].y_estim;}}}function logRegression(selection,line,phase,dimDateName,outMeasName,x,y,valueType){var algvar="";
if(line!=null){algvar=line[selection.measureAxis];}var algoId=outMeasName+algvar;var key=buildKey(line,selection,dimDateName);var measure_value=!valueType||valueType==ESTIMATED_VALUE;var lower_bound=valueType==LOWEST_CONF_INT;var upper_bound=valueType==HIGHEST_CONF_INT;if(phase==0){if(_global[algoId]==undefined){_global[algoId]=Object();_global[algoId].data=Object();_global[algoId].valueTimeSerie=function(x,y){var vts=Object();vts.x=x;vts.y=Math.log(y)/Math.LN10;return vts;};_global[algoId].addData=function(vts,key){if(_global[algoId].data[key]==null){_global[algoId].data[key]=Array();}_global[algoId].data[key].push(vts);};}if(y!=null&&!isNaN(y)){_global[algoId].addData(_global[algoId].valueTimeSerie(x,y),key);}return 0;}else{if(_global[algoId].result==null){_global[algoId].result=Object();_global[algoId].computeMeanSquaredError=function(data,a,b){var SSE=0;for(var i=0;i<data.length;++i){estim=Math.pow(10,b+a*data[i].x);diff=Math.pow(10,data[i].y)-estim;SSE+=diff*diff;}return(1/(data.length-1))*SSE;
};}if(_global[algoId].result[key]!=null){var y_estim=Math.pow(10,_global[algoId].result[key].intercept+_global[algoId].result[key].slope*x);if(isNaN(y_estim)){return null;}if(lower_bound){return y_estim-1.96*Math.sqrt(_global[algoId].result[key].error);}else{if(upper_bound){return y_estim+1.96*Math.sqrt(_global[algoId].result[key].error);}}return y_estim;}else{_global[algoId].result[key]=Object();var dataReg=_global[algoId].data[key];if(dataReg==null){return null;}var n=0;var sum_x=0;var sum_y=0;var sum_xy=0;var sum_xx=0;var sum_yy=0;var sum=0;if(dataReg.length>1){for(var i=0;i<dataReg.length;++i){sum_x+=dataReg[i].x;sum_y+=dataReg[i].y;sum_xy+=(dataReg[i].x*dataReg[i].y);sum_xx+=(dataReg[i].x*dataReg[i].x);sum_yy+=(dataReg[i].y*dataReg[i].y);n++;}_global[algoId].result[key].slope=(n*sum_xy-sum_x*sum_y)/(n*sum_xx-sum_x*sum_x);_global[algoId].result[key].intercept=(sum_y-_global[algoId].result[key].slope*sum_x)/n;if(!measure_value){_global[algoId].result[key].error=_global[algoId].computeMeanSquaredError(dataReg,_global[algoId].result[key].slope,_global[algoId].result[key].intercept);
}_global[algoId].result[key].y_estim=Math.pow(10,_global[algoId].result[key].intercept+_global[algoId].result[key].slope*x);}else{_global[algoId].result[key].slope=0;_global[algoId].result[key].intercept=dataReg[0].y;_global[algoId].result[key].error=null;_global[algoId].result[key].y_estim=_global[algoId].result[key].intercept;}if(isNaN(_global[algoId].result[key].y_estim)){return null;}if(lower_bound){return _global[algoId].result[key].y_estim-1.96*Math.sqrt(_global[algoId].result[key].error);}else{if(upper_bound){return _global[algoId].result[key].y_estim+1.96*Math.sqrt(_global[algoId].result[key].error);}}return _global[algoId].result[key].y_estim;}}}function polynomialRegression(selection,line,phase,dimDateName,outMeasName,x,y,order,valueType){var algvar="";if(line!=null){algvar=line[selection.measureAxis];}var algoId=outMeasName+algvar;var key=buildKey(line,selection,dimDateName);var measure_value=!valueType||valueType==ESTIMATED_VALUE;var lower_bound=valueType==LOWEST_CONF_INT;var upper_bound=valueType==HIGHEST_CONF_INT;
if(phase==0){if(_global[algoId]==undefined){_global[algoId]=Object();_global[algoId].data=Object();_global[algoId].addData=function(x,y,key){if(_global[algoId].data[key]==null){_global[algoId].data[key]=Array();}_global[algoId].data[key].push([x,y]);};}if(y!=null&&!isNaN(y)){_global[algoId].addData(x,y,key);}return 0;}else{if(_global[algoId].result==null){_global[algoId].result=Object();_global[algoId].gaussianElimination=function(a,o){var i=0,j=0,k=0,maxrow=0,tmp=0,n=a.length-1,x=new Array(o);for(i=0;i<n;i++){maxrow=i;for(j=i+1;j<n;j++){if(Math.abs(a[i][j])>Math.abs(a[i][maxrow])){maxrow=j;}}for(k=i;k<n+1;k++){tmp=a[k][i];a[k][i]=a[k][maxrow];a[k][maxrow]=tmp;}for(j=i+1;j<n;j++){for(k=n;k>=i;k--){a[k][j]-=a[k][i]*a[i][j]/a[i][i];}}}for(j=n-1;j>=0;j--){tmp=0;for(k=j+1;k<n;k++){tmp+=a[k][j]*x[k];}x[j]=(a[n][j]-tmp)/a[j][j];}return(x);};_global[algoId].polynomial=function(data,order){if(typeof order=="undefined"){order=2;}var lhs=[],rhs=[],results=[],a=0,b=0,i=0,k=order+1;for(;i<k;i++){for(var l=0,len=data.length;
l<len;l++){if(data[l][1]!=null){a+=Math.pow(data[l][0],i)*data[l][1];}}lhs.push(a),a=0;var c=[];for(var j=0;j<k;j++){for(var l=0,len=data.length;l<len;l++){if(data[l][1]!=null){b+=Math.pow(data[l][0],i+j);}}c.push(b),b=0;}rhs.push(c);}rhs.push(lhs);var equation=_global[algoId].gaussianElimination(rhs,k);for(var i=0,len=data.length;i<len;i++){var answer=0;for(var w=0;w<equation.length;w++){answer+=equation[w]*Math.pow(data[i][0],w);}results.push([data[i][0],answer]);}return equation;};_global[algoId].computeMeanSquaredError=function(data,coefs){var SSE=0;for(var i=0;i<data.length;++i){var val=0;for(var j=0;j<coefs.length;j++){val+=coefs[j]*Math.pow(data[i][0],j);}SSE+=(data[i][1]-val)*(data[i][1]-val);}return(1/(data.length-1))*SSE;};}if(_global[algoId].result[key]!=null){var result=_global[algoId].result[key].coefs[0];for(var i=1;i<_global[algoId].result[key].coefs.length;++i){result+=_global[algoId].result[key].coefs[i]*Math.pow(x,i);}if(isNaN(result)){return null;}if(lower_bound){return result-1.96*Math.sqrt(_global[algoId].result[key].error);
}else{if(upper_bound){return result+1.96*Math.sqrt(_global[algoId].result[key].error);}}return result;}else{_global[algoId].result[key]=Object();var dataReg=_global[algoId].data[key];if(dataReg==null){return null;}if(dataReg.length>1){_global[algoId].result[key].coefs=_global[algoId].polynomial(dataReg,order);if(!measure_value){_global[algoId].result[key].error=_global[algoId].computeMeanSquaredError(dataReg,_global[algoId].result[key].coefs);}}else{_global[algoId].result[key].coefs=[dataReg[0][1]];_global[algoId].result[key].error=null;}var result=_global[algoId].result[key].coefs[0];for(var i=1;i<_global[algoId].result[key].coefs.length;++i){result+=_global[algoId].result[key].coefs[i]*Math.pow(x,i);}if(isNaN(result)){return null;}if(lower_bound){return result-1.96*Math.sqrt(_global[algoId].result[key].error);}else{if(upper_bound){return result+1.96*Math.sqrt(_global[algoId].result[key].error);}}return result;}}}function movingAverage(selection,line,phase,dimDateName,outMeasName,x,y,order,missingValues){var algvar="";
if(line!=null){algvar=line[selection.measureAxis];}var algoId=outMeasName+algvar;var key=buildKey(line,selection,dimDateName);if(phase==0){if(_global[algoId]==undefined){_global[algoId]=Object();_global[algoId].data=Object();_global[algoId].valueTimeSerie=function(x,y){var vts=Object();vts.x=x;vts.y=y;return vts;};_global[algoId].addData=function(x,y,key){if(_global[algoId].data[key]==null){_global[algoId].data[key]=Array();}_global[algoId].data[key].push(_global[algoId].valueTimeSerie(x,y));};}_global[algoId].addData(x,y,key);return 0;}else{if(_global[algoId].result==null){_global[algoId].result=Object();_global[algoId].sortTimeSerie=function(originalData){function compareDates(o1,o2){return o1.x-o2.x;}originalData.sort(compareDates);};_global[algoId].movingAverage=function(data,order){var lastNonMiss=data.length-1;var found=false;while(!found&&lastNonMiss>=0){if(data[lastNonMiss].y==null||isNaN(data[lastNonMiss].y)){lastNonMiss--;}else{found=true;}}for(var j=0;j<lastNonMiss;++j){if(data[j].y==null){if(j==0){var k=1;
while(k<=lastNonMiss&&data[k].y==null){k++;}data[0].y=data[k].y;}else{if(missingValues==1){var k=j;while(k<=lastNonMiss&&data[k].y==null){k++;}data[j].y=(data[j-1].y+((1/(k-j))*data[k].y))/(1+(1/(k-j)));}else{var k=j;while(k<=lastNonMiss&&data[k].y==null){k++;}var slope=(data[k].y-data[j-1].y)/(k-(j-1));var intercept=data[k].y-slope*data[k].x;data[j].y=slope*data[j].x+intercept;}}}}var resMovAvg=Array();if(order>1&&order%2!=0){for(var i=Math.floor(order/2);i<=lastNonMiss-Math.floor(order/2);++i){resMovAvg[i]=0;for(var j=i-Math.floor(order/2);j<=i+Math.floor(order/2);++j){resMovAvg[i]+=data[j].y;}resMovAvg[i]/=order;}}else{if(order>1&&order%2==0){for(var i=Math.floor(order/2);i<=lastNonMiss-Math.floor(order/2);++i){resMovAvg[i]=(data[i-Math.floor(order/2)].y)/2+(data[i+Math.floor(order/2)].y)/2;for(var j=i-Math.floor(order/2)+1;j<=i+Math.floor(order/2)-1;++j){resMovAvg[i]+=data[j].y;}resMovAvg[i]/=order;}}}return resMovAvg;};}if(_global[algoId].result[key]!=null){var indice=_global[algoId].result[key].searchMap[x.toString()];
if(_global[algoId].result[key].ma[indice]!=undefined){return _global[algoId].result[key].ma[indice];}return null;}else{_global[algoId].result[key]=Object();var data=_global[algoId].data[key];if(data==null){return null;}if(data.length>1){_global[algoId].sortTimeSerie(data);_global[algoId].result[key].ma=_global[algoId].movingAverage(data,order);_global[algoId].result[key].searchMap={};for(var i=0;i<data.length;++i){_global[algoId].result[key].searchMap[data[i].x.toString()]=i;}}else{return null;}var indice=_global[algoId].result[key].searchMap[x.toString()];if(_global[algoId].result[key].ma[indice]!=undefined){return _global[algoId].result[key].ma[indice];}return null;}}}function simpleExpSmoothing(selection,line,phase,dimDateName,outMeasName,x,y,nbIter,valueType){var algvar="";if(line!=null){algvar=line[selection.measureAxis];}var algoId=outMeasName+algvar;var key=buildKey(line,selection,dimDateName);var measure_value=!valueType||valueType==ESTIMATED_VALUE;var lower_bound=valueType==LOWEST_CONF_INT;
var upper_bound=valueType==HIGHEST_CONF_INT;if(phase==0){if(_global[algoId]==undefined){_global[algoId]=Object();_global[algoId].data=Object();_global[algoId].valueTimeSerie=function(x,y){var vts=Object();vts.x=x;vts.y=y;return vts;};_global[algoId].addData=function(x,y,key){if(_global[algoId].data[key]==null){_global[algoId].data[key]=Array();}_global[algoId].data[key].push(_global[algoId].valueTimeSerie(x,y));};}_global[algoId].addData(x,y,key);return 0;}else{if(_global[algoId].result==null){_global[algoId].result=Object();_global[algoId].sortTimeSerie=function(originalData){function compareDates(o1,o2){return o1.x-o2.x;}originalData.sort(compareDates);};_global[algoId].simpleExponentialSmoothing=function(data,alpha){var lastNonMiss=data.length-1;while(lastNonMiss!=0&&(data[lastNonMiss].y==null||isNaN(data[lastNonMiss].y))){lastNonMiss--;}simpleExpSmoothingRes=Array();if(data.length<3){for(var i=0;i<data.length;++i){simpleExpSmoothingRes[i]=null;}return simpleExpSmoothingRes;}simpleExpSmoothingRes[0]=null;
simpleExpSmoothingRes[1]=data[0].y;if(data[0].y==null||isNaN(data[0].y)){var i=1;while(data[i].y==null||isNaN(data[i].y)){i++;}simpleExpSmoothingRes[1]=data[i].y;}if(data[1].y==null||isNaN(data[1].y)){if(data[0].y==null||isNaN(data[0].y)){data[1].y=lastComputed;}else{var i=2;while(data[i].y==null||isNaN(data[i].y)){i++;}data[1].y=data[0].y+(data[i].y-data[0].y)/i;}}for(var i=2;i<=lastNonMiss;++i){var err=data[i-1].y-simpleExpSmoothingRes[i-1];simpleExpSmoothingRes[i]=alpha*err+simpleExpSmoothingRes[i-1];if(data[i].y==null){data[i].y=simpleExpSmoothingRes[i];}}var err=data[lastNonMiss].y-simpleExpSmoothingRes[lastNonMiss];simpleExpSmoothingRes[lastNonMiss+1]=alpha*err+simpleExpSmoothingRes[lastNonMiss];for(var i=lastNonMiss+2;i<data.length;++i){simpleExpSmoothingRes[i]=null;}return simpleExpSmoothingRes;};_global[algoId].computeMeanSquaredError=function(data,forecast){var lastNonMiss=data.length-1;while(lastNonMiss!=0&&(data[lastNonMiss].y==null||isNaN(data[lastNonMiss].y))){lastNonMiss--;
}var error=0;for(var i=1;i<=lastNonMiss;++i){error+=Math.pow(data[i].y-forecast[i],2);}return 1/(data.length-1)*error;};_global[algoId].findBestAlpha=function(data,nbIter){var incr=1/nbIter;var bestAlpha=0;var bestError=-1;var alpha=bestAlpha;while(alpha<1){var forecast=_global[algoId].simpleExponentialSmoothing(data,alpha);var error=_global[algoId].computeMeanSquaredError(data,forecast);if(error<bestError||bestError==-1){bestAlpha=alpha;bestError=error;}alpha+=incr;}return bestAlpha;};}if(_global[algoId].result[key]!=null){var indice=_global[algoId].result[key].searchMap[x.toString()];if(_global[algoId].result[key].ma[indice]!=undefined){if(lower_bound){return _global[algoId].result[key].ma[indice]-1.96*Math.sqrt(_global[algoId].result[key].error);}else{if(upper_bound){return _global[algoId].result[key].ma[indice]+1.96*Math.sqrt(_global[algoId].result[key].error);}}return _global[algoId].result[key].ma[indice];}return null;}else{_global[algoId].result[key]=Object();var data=_global[algoId].data[key];
if(data==null){return null;}if(data.length>1){_global[algoId].sortTimeSerie(data);var bestAlpha=_global[algoId].findBestAlpha(data,nbIter);_global[algoId].result[key].ma=_global[algoId].simpleExponentialSmoothing(data,bestAlpha);if(!measure_value){_global[algoId].result[key].error=_global[algoId].computeMeanSquaredError(data,_global[algoId].result[key].ma);}_global[algoId].result[key].searchMap={};for(var i=0;i<data.length;++i){_global[algoId].result[key].searchMap[data[i].x.toString()]=i;}}else{return null;}var indice=_global[algoId].result[key].searchMap[x.toString()];if(_global[algoId].result[key].ma[indice]!=undefined){if(lower_bound){return _global[algoId].result[key].ma[indice]-1.96*Math.sqrt(prev.error);}else{if(upper_bound){return _global[algoId].result[key].ma[indice]+1.96*Math.sqrt(prev.error);}}return _global[algoId].result[key].ma[indice];}return null;}}}function doubleExpSmoothing(selection,line,phase,dimDateName,outMeasName,x,y,nbIter,valueType){var algvar="";if(line!=null){algvar=line[selection.measureAxis];
}var algoId=outMeasName+algvar;var key=buildKey(line,selection,dimDateName);var measure_value=!valueType||valueType==ESTIMATED_VALUE;var lower_bound=valueType==LOWEST_CONF_INT;var upper_bound=valueType==HIGHEST_CONF_INT;if(phase==0){if(_global[algoId]==undefined){_global[algoId]=Object();_global[algoId].data=Object();_global[algoId].valueTimeSerie=function(x,y){var vts=Object();vts.x=x;vts.y=y;return vts;};_global[algoId].addData=function(x,y,key){if(_global[algoId].data[key]==null){_global[algoId].data[key]=Array();}_global[algoId].data[key].push(_global[algoId].valueTimeSerie(x,y));};}_global[algoId].addData(x,y,key);return 0;}else{if(_global[algoId].result==null){_global[algoId].result=Object();_global[algoId].sortTimeSerie=function(originalData){function compareDates(o1,o2){return o1.x-o2.x;}originalData.sort(compareDates);};_global[algoId].simpleExponentialSmoothing=function(data,alpha,order){if(data[0].y!=undefined){var lastNonMiss=data.length-1;while(lastNonMiss!=0&&(data[lastNonMiss].y==null||isNaN(data[lastNonMiss].y))){lastNonMiss--;
}simpleExpSmoothingRes=Array();for(var i=0;i<order;i++){if(data[i].y==null){var j=i;while(data[j]==null){j++;}data[i].y=data[j].y;}simpleExpSmoothingRes[i]=data[i].y;}for(var i=order;i<=lastNonMiss;++i){simpleExpSmoothingRes[i]=alpha*(data[i-1].y-simpleExpSmoothingRes[i-1])+simpleExpSmoothingRes[i-1];if(data[i].y==null){data[i].y=simpleExpSmoothingRes[i];}}}else{var lastNonMiss=data.length-1;while(lastNonMiss!=0&&(data[lastNonMiss]==null||isNaN(data[lastNonMiss]))){lastNonMiss--;}simpleExpSmoothingRes=Array();for(var i=0;i<order;i++){if(data[i]==null){var j=i;while(data[j]==null){j++;}data[i]=data[j];}simpleExpSmoothingRes[i]=data[i];}for(var i=order;i<=lastNonMiss;++i){simpleExpSmoothingRes[i]=alpha*data[i]+(1-alpha)*simpleExpSmoothingRes[i-1];if(data[i]==null){data[i]=simpleExpSmoothingRes[i];}}}return simpleExpSmoothingRes;};_global[algoId].computeA=function(firstSmoothing,secondSmoothing,alpha){var A=Array();for(var i=1;i<firstSmoothing.length;++i){A[i]=(alpha/(1-alpha))*(firstSmoothing[i]-secondSmoothing[i]);
}return A;};_global[algoId].computeB=function(firstSmoothing,secondSmoothing){var B=Array();for(var i=1;i<firstSmoothing.length;++i){B[i]=2*firstSmoothing[i]-secondSmoothing[i];}return B;};_global[algoId].computeForecast=function(data,A,B){forecast=Array();for(var i=2;i<A.length;++i){forecast[i]=A[i-1]+B[i-1];}forecast[A.length]=forecast[A.length-1]+A[A.length-1];for(var i=A.length+1;i<data.length;++i){forecast[i]=null;}return forecast;};_global[algoId].doubleExponentialSmoothing=function(data,alpha){if(data.length<3){var res=Array();for(var i=0;i<res.lenth;++i){res[i]=null;}return res;}var firstSmoothing=_global[algoId].simpleExponentialSmoothing(data,alpha,2);var secondSmoothing=_global[algoId].simpleExponentialSmoothing(firstSmoothing,alpha,1);var A=_global[algoId].computeA(firstSmoothing,secondSmoothing,alpha);var B=_global[algoId].computeB(firstSmoothing,secondSmoothing);return _global[algoId].computeForecast(data,A,B);};_global[algoId].computeMeanSquaredError=function(data,forecast){var lastNonMiss=data.length-1;
while(lastNonMiss!=0&&data[lastNonMiss].y==null){lastNonMiss--;}var error=0;for(var i=2;i<=lastNonMiss;++i){error+=Math.pow(data[i].y-forecast[i],2);}return 1/(data.length-1)*error;};_global[algoId].findBestAlpha=function(data,nbIter){var incr=1/nbIter;var bestAlpha=0.03;var bestError=-1;var alpha=bestAlpha;while(alpha<1){var forecast=_global[algoId].doubleExponentialSmoothing(data,alpha);var error=_global[algoId].computeMeanSquaredError(data,forecast);if(error<bestError||bestError==-1){bestAlpha=alpha;bestError=error;}alpha+=incr;}return bestAlpha;};}if(_global[algoId].result[key]!=null){var indice=_global[algoId].result[key].searchMap[x.toString()];if(_global[algoId].result[key].ma[indice]!=undefined){if(lower_bound){return _global[algoId].result[key].ma[indice]-1.96*Math.sqrt(_global[algoId].result[key].error);}else{if(upper_bound){return _global[algoId].result[key].ma[indice]+1.96*Math.sqrt(_global[algoId].result[key].error);}}return _global[algoId].result[key].ma[indice];}return null;
}else{_global[algoId].result[key]=Object();var data=_global[algoId].data[key];if(data==null){return null;}if(data.length>1){_global[algoId].sortTimeSerie(data);var bestAlpha=_global[algoId].findBestAlpha(data,nbIter);_global[algoId].result[key].ma=_global[algoId].doubleExponentialSmoothing(data,bestAlpha);if(!measure_value){_global[algoId].result[key].error=_global[algoId].computeMeanSquaredError(data,_global[algoId].result[key].ma);}_global[algoId].result[key].searchMap={};for(var i=0;i<data.length;++i){_global[algoId].result[key].searchMap[data[i].x.toString()]=i;}}else{return null;}var indice=_global[algoId].result[key].searchMap[x.toString()];if(isNaN(_global[algoId].result[key].ma[indice])){return null;}if(lower_bound){return _global[algoId].result[key].ma[indice]-1.96*Math.sqrt(_global[algoId].result[key].error);}else{if(upper_bound){return _global[algoId].result[key].ma[indice]+1.96*Math.sqrt(_global[algoId].result[key].error);}}return _global[algoId].result[key].ma[indice];}}}function holtSmoothing(selection,line,phase,dimDateName,outMeasName,x,y,nbIter,valueType){var algvar="";
if(line!=null){algvar=line[selection.measureAxis];}var algoId=outMeasName+algvar;var key=buildKey(line,selection,dimDateName);var measure_value=!valueType||valueType==ESTIMATED_VALUE;var lower_bound=valueType==LOWEST_CONF_INT;var upper_bound=valueType==HIGHEST_CONF_INT;if(phase==0){if(_global[algoId]==undefined){_global[algoId]=Object();_global[algoId].data=Object();_global[algoId].valueTimeSerie=function(x,y){var vts=Object();vts.x=x;vts.y=y;return vts;};_global[algoId].addData=function(x,y,key){if(_global[algoId].data[key]==null){_global[algoId].data[key]=Array();}_global[algoId].data[key].push(_global[algoId].valueTimeSerie(x,y));};}_global[algoId].addData(x,y,key);return 0;}else{if(_global[algoId].result==null){_global[algoId].result=Object();_global[algoId].sortTimeSerie=function(originalData){function compareDates(o1,o2){return o1.x-o2.x;}originalData.sort(compareDates);};_global[algoId].holtSmoothing=function(data,alpha,gamma){if(data.length<3){var forecast=Array();for(var i=0;i<data.length;
++i){forecast[i]=null;}return forecast;}var A=Array();var B=Array();B[0]=data[0].y;A[0]=0;if(data[0].y==null||isNaN(data[0].y)){var i=1;while(data[i].y==null||isNaN(data[i].y)){i++;}B[0]=data[i].y;}var lastNonMiss=data.length-1;while(lastNonMiss!=0&&(data[lastNonMiss].y==null||isNaN(data[lastNonMiss].y))){lastNonMiss--;}for(var i=1;i<=lastNonMiss;++i){if(data[i].y==null||isNaN(data[i].y)){var nextNonMissing=i;while(data[nextNonMissing].y==null||isNaN(data[nextNonMissing].y)){nextNonMissing++;}data[i].y=(data[i-1].y+(1/(nextNonMissing-y))*data[nextNonMissing].y)/(1+(1/(nextNonMissing-y)));}B[i]=alpha*data[i].y+(1-alpha)*(B[i-1]+A[i-1]);A[i]=gamma*(B[i]-B[i-1])+(1-gamma)*A[i-1];}var forecast=Array();for(var i=1;i<=lastNonMiss+1;++i){forecast[i]=A[i-1]+B[i-1];}for(var i=A.length+1;i<data.length;++i){forecast[i]=forecast[i-1]+A[lastNonMiss];}return forecast;};_global[algoId].computeMeanSquaredError=function(data,forecast){var lastNonMiss=data.length-1;while(lastNonMiss!=0&&(data[lastNonMiss].y==null||isNaN(data[lastNonMiss].y))){lastNonMiss--;
}var error=0;for(var i=1;i<=lastNonMiss;++i){error+=Math.pow(data[i].y-forecast[i],2);}return 1/(data.length-1)*error;};_global[algoId].findBestAlphaAndGamma=function(data,nbIter){var incr=1/nbIter;var bestAlpha=0;var bestError=-1;var alpha=bestAlpha;var bestGamma=0;var gamma=bestGamma;while(alpha<1){while(gamma<1){var forecast=_global[algoId].holtSmoothing(data,alpha,gamma);var error=_global[algoId].computeMeanSquaredError(data,forecast);if(error<bestError||bestError==-1){bestGamma=gamma;bestAlpha=alpha;bestError=error;}gamma+=incr;}gamma=0;alpha+=incr;}return{alpha:bestAlpha,gamma:bestGamma};};}if(_global[algoId].result[key]!=null){var indice=_global[algoId].result[key].searchMap[x.toString()];if(_global[algoId].result[key].ma[indice]!=undefined){if(isNaN(_global[algoId].result[key].ma[indice])){return null;}return _global[algoId].result[key].ma[indice];}return null;}else{_global[algoId].result[key]=Object();var data=_global[algoId].data[key];if(data==null){return null;}if(data.length>2){_global[algoId].sortTimeSerie(data);
var bestParameters=_global[algoId].findBestAlphaAndGamma(data,nbIter);_global[algoId].result[key].ma=_global[algoId].holtSmoothing(data,bestParameters.alpha,bestParameters.gamma);if(!measure_value){_global[algoId].result[key].error=_global[algoId].computeMeanSquaredError(data,_global[algoId].result[key].ma);var lastNonMiss=data.length-1;while(lastNonMiss!=0&&(data[lastNonMiss].y==null||isNaN(data[lastNonMiss].y))){lastNonMiss--;}var factor=-1;if(upper_bound){factor=1;}for(var i=2;i<=lastNonMiss+1;++i){_global[algoId].result[key].ma[i]+=factor*1.96*Math.sqrt(_global[algoId].result[key].error);}secondError=0;for(var i=lastNonMiss+2;i<data.length;++i){var to=i-lastNonMiss;secondError+=Math.pow(1+(to-1)*bestParameters.gamma,2);_global[algoId].result[key].ma[i]+=factor*1.96*Math.sqrt(_global[algoId].result[key].error)*Math.sqrt(1+Math.pow(bestParameters.alpha,2)*secondError);}}_global[algoId].result[key].searchMap={};for(var i=0;i<data.length;++i){_global[algoId].result[key].searchMap[data[i].x.toString()]=i;
}}else{_global[algoId].result[key].searchMap={};for(var i=0;i<data.length;++i){_global[algoId].result[key].searchMap[data[i].x.toString()]=i;}_global[algoId].result[key].ma=[];for(var i=0;i<data.length;++i){_global[algoId].result[key].ma[i]=null;}}var indice=_global[algoId].result[key].searchMap[x.toString()];if(_global[algoId].result[key].ma[indice]!=undefined){if(isNaN(_global[algoId].result[key].ma[indice])){return null;}return _global[algoId].result[key].ma[indice];}return null;}}}function holtWintersAdd(selection,line,phase,dimDateName,outMeasName,x,y,nbIter,valueType){var algvar="";if(line!=null){algvar=line[selection.measureAxis];}var algoId=outMeasName+algvar;var key=buildKey(line,selection,dimDateName);var measure_value=!valueType||valueType==ESTIMATED_VALUE;var lower_bound=valueType==LOWEST_CONF_INT;var upper_bound=valueType==HIGHEST_CONF_INT;if(phase==0){if(_global[algoId]==undefined){_global[algoId]=Object();_global[algoId].data=Object();_global[algoId].valueTimeSerie=function(x,y){var vts=Object();
vts.x=x;vts.y=y;return vts;};_global[algoId].addData=function(x,y,key){if(_global[algoId].data[key]==null){_global[algoId].data[key]=Array();}_global[algoId].data[key].push(_global[algoId].valueTimeSerie(x,y));};}_global[algoId].addData(x,y,key);return 0;}else{if(_global[algoId].result==null){_global[algoId].result=Object();_global[algoId].sortTimeSerie=function(originalData){function compareDates(o1,o2){return o1.x-o2.x;}originalData.sort(compareDates);};_global[algoId].wintersSmoothing=function(data,cycleLength,alpha,gamma,delta){var A=Array();var B=Array();var S=Array();var forecasts=Array();var lastNonMiss=data.length-1;while(lastNonMiss!=0&&(data[lastNonMiss].y==null||isNaN(data[lastNonMiss].y))){lastNonMiss--;}var average=0;for(var i=0;i<cycleLength;++i){average+=data[i].y;}average/=cycleLength;B[cycleLength-1]=average;A[cycleLength-1]=0;for(var i=0;i<cycleLength;++i){S[i]=data[i].y-average;}for(var i=cycleLength;i<=lastNonMiss;++i){B[i]=alpha*(data[i].y-S[i-cycleLength])+(1-alpha)*(B[i-1]+A[i-1]);
A[i]=gamma*(B[i]-B[i-1])+A[i-1]*(1-gamma);S[i]=delta*(data[i].y-B[i])+S[i-cycleLength]*(1-delta);}for(var i=cycleLength;i<=lastNonMiss+1;++i){forecasts[i]=B[i-1]+A[i-1]+S[i-cycleLength];}for(var i=lastNonMiss+2;i<data.length;++i){forecasts[i]=B[B.length-1]+(i-(lastNonMiss))*A[A.length-1]+S[i-cycleLength];}return forecasts;};_global[algoId].computeMeanSquaredError=function(data,forecast){var lastNonMiss=data.length-1;while(lastNonMiss!=0&&(data[lastNonMiss].y==null)||isNaN(data[lastNonMiss].y)){lastNonMiss--;}var firstNonMiss=0;while(firstNonMiss<lastNonMiss&&forecast[firstNonMiss]==null){firstNonMiss++;}var error=0;for(var i=firstNonMiss;i<=lastNonMiss;++i){error+=Math.pow(data[i].y-forecast[i],2);}return 1/(data.length-1)*error;};_global[algoId].findBestParameters=function(data,nbIter,cycleLength){var incr=1/nbIter;var bestAlpha=0;var bestError=-1;var alpha=bestAlpha;var bestGamma=0;var gamma=bestGamma;var bestDelta=0;var delta=bestDelta;var bestParameters=Object();while(alpha<0.999){while(gamma<0.999){while(delta<0.999){var forecast=_global[algoId].wintersSmoothing(data,cycleLength,alpha,gamma,delta);
var error=_global[algoId].computeMeanSquaredError(data,forecast);if(error<bestError||bestError==-1){bestGamma=gamma;bestAlpha=alpha;bestDelta=delta;bestError=error;}delta+=incr;}delta=0;gamma+=incr;}gamma=0;alpha+=incr;}return{alpha:bestAlpha,gamma:bestGamma,delta:bestDelta};};_global[algoId].fillMissingValues=function(data){if(data.length<4){return false;}var lastNonMissing=data.length-1;while(lastNonMissing>=0&&(data[lastNonMissing].y==null)||isNaN(data[lastNonMissing].y)){lastNonMissing--;}if(data[0].y==null){var nextNonMissing=1;while(data[nextNonMissing].y==null&&nextNonMissing<=lastNonMissing){nextNonMissing++;}if(nextNonMissing==lastNonMissing){return false;}data[0].y=data[nextNonMissing];}for(var i=1;i<=lastNonMissing;++i){if(data[i].y==null){var nextNonMissing=i+1;while(nextNonMissing<=lastNonMissing&&(data[nextNonMissing].y==null||isNaN(data[nextNonMissing].y))){nextNonMissing++;}data[i].y=(data[i-1].y+(1/(nextNonMissing-i))*data[nextNonMissing].y)/(1+(1/(nextNonMissing-i)));}}return true;
};_global[algoId].autoCorrelation=function(data){var lastNonMiss=data.length-1;while(lastNonMiss!=0&&data[lastNonMiss].y==null){lastNonMiss--;}var autoCorrelationResult=Array();for(var shift=1;shift<lastNonMiss/2;++shift){serie1=data.slice(0,lastNonMiss-shift);serie2=data.slice(shift,lastNonMiss);var n=serie1.length;var sum_x=0;var sum_y=0;var sum_xy=0;var sum_xx=0;var sum_yy=0;var sum=0;for(var i=0;i<serie1.length;i++){sum_x+=serie1[i].y;sum_y+=serie2[i].y;sum_xy+=(serie1[i].y*serie2[i].y);sum_xx+=(serie1[i].y*serie1[i].y);sum_yy+=(serie2[i].y*serie2[i].y);}var correlation=Math.pow((n*sum_xy-sum_x*sum_y)/Math.sqrt((n*sum_xx-sum_x*sum_x)*(n*sum_yy-sum_y*sum_y)),2);autoCorrelationResult.push({shift:shift,correlation:correlation});}return autoCorrelationResult;};_global[algoId].getBestAutoCorrelation=function(autoCorrelationsArray){autoCorr7=null;autoCorr12=null;if(autoCorrelationsArray.length>(7-2)){autoCorr7=autoCorrelationsArray[5]["correlation"];}if(autoCorrelationsArray.length>(12-2)){autoCorr12=autoCorrelationsArray[10]["correlation"];
}maxCorr=Math.max(autoCorr7,autoCorr12);if(maxCorr==autoCorr7){shift=7;corr=autoCorr7;}else{shift=12;corr=autoCorr12;}function compareAutoCorr(o1,o2){return o1.correlation-o2.correlation;}autoCorrelationsArray.sort(compareAutoCorr);if(corr>=0.75*autoCorrelationsArray[0].correlation){return{shift:shift,correlation:corr};}return autoCorrelationsArray[autoCorrelationsArray.length-1];};}if(_global[algoId].result[key]!=null){if(!_global[algoId].result[key].possible){return null;}var indice=_global[algoId].result[key].searchMap[x.toString()];if(_global[algoId].result[key].ma[indice]!=undefined){if(isNaN(_global[algoId].result[key].ma[indice])){return null;}if(lower_bound){return _global[algoId].result[key].ma[indice]-1.96*Math.sqrt(_global[algoId].result[key].error);}else{if(upper_bound){return _global[algoId].result[key].ma[indice]+1.96*Math.sqrt(_global[algoId].result[key].error);}}return _global[algoId].result[key].ma[indice];}return null;}else{_global[algoId].result[key]=Object();var data=_global[algoId].data[key];
if(data==null){return null;}if(data.length>1){_global[algoId].result[key].searchArray=_global[algoId].sortTimeSerie(data);var algoPossible=_global[algoId].fillMissingValues(data);if(!algoPossible){_global[algoId].result[key].possible=false;return null;}_global[algoId].result[key].possible=true;var autoCorrelationResult=_global[algoId].autoCorrelation(data);var bestCorrelation=_global[algoId].getBestAutoCorrelation(autoCorrelationResult);var bestParameters=_global[algoId].findBestParameters(data,nbIter,bestCorrelation.shift);_global[algoId].result[key].ma=_global[algoId].wintersSmoothing(data,bestCorrelation.shift,bestParameters.alpha,bestParameters.gamma,bestParameters.delta);if(!measure_value){_global[algoId].result[key].error=_global[algoId].computeMeanSquaredError(data,_global[algoId].result[key].ma);}_global[algoId].result[key].searchMap={};for(var i=0;i<data.length;++i){_global[algoId].result[key].searchMap[data[i].x.toString()]=i;}}else{return null;}var indice=_global[algoId].result[key].searchMap[x.toString()];
if(_global[algoId].result[key].ma[indice]!=undefined){if(isNaN(_global[algoId].result[key].ma[indice])){return null;}if(lower_bound){return _global[algoId].result[key].ma[indice]-1.96*Math.sqrt(_global[algoId].result[key].error);}else{if(upper_bound){return _global[algoId].result[key].ma[indice]+1.96*Math.sqrt(_global[algoId].result[key].error);}}return _global[algoId].result[key].ma[indice];}return null;}}}function holtWintersMult(selection,line,phase,dimDateName,outMeasName,x,y,nbIter,valueType){var algvar="";if(line!=null){algvar=line[selection.measureAxis];}var algoId=outMeasName+algvar;var key=buildKey(line,selection,dimDateName);var measure_value=!valueType||valueType==ESTIMATED_VALUE;var lower_bound=valueType==LOWEST_CONF_INT;var upper_bound=valueType==HIGHEST_CONF_INT;if(phase==0){if(_global[algoId]==undefined){_global[algoId]=Object();_global[algoId].data=Object();_global[algoId].valueTimeSerie=function(x,y){var vts=Object();vts.x=x;vts.y=y;return vts;};_global[algoId].addData=function(x,y,key){if(_global[algoId].data[key]==null){_global[algoId].data[key]=Array();
}_global[algoId].data[key].push(_global[algoId].valueTimeSerie(x,y));};}_global[algoId].addData(x,y,key);return 0;}else{if(_global[algoId].result==null){_global[algoId].result=Object();_global[algoId].sortTimeSerie=function(originalData){function compareDates(o1,o2){return o1.x-o2.x;}originalData.sort(compareDates);};_global[algoId].wintersSmoothing=function(data,cycleLength,alpha,gamma,delta){var A=Array();var B=Array();var S=Array();var forecasts=Array();var lastNonMiss=data.length-1;while(lastNonMiss!=0&&(data[lastNonMiss].y==null||isNaN(data[lastNonMiss].y))){lastNonMiss--;}var average=0;for(var i=0;i<cycleLength;++i){average+=data[i].y;}average/=cycleLength;B[cycleLength-1]=average;A[cycleLength-1]=0;for(var i=0;i<cycleLength;++i){S[i]=data[i].y/average;}for(var i=cycleLength;i<=lastNonMiss;++i){B[i]=alpha*(data[i].y/S[i-cycleLength])+(1-alpha)*(B[i-1]+A[i-1]);A[i]=gamma*(B[i]-B[i-1])+A[i-1]*(1-gamma);S[i]=delta*(data[i].y/B[i])+S[i-cycleLength]*(1-delta);}for(var i=cycleLength;i<=lastNonMiss+1;
++i){forecasts[i]=(B[i-1]+A[i-1])*S[i-cycleLength];}for(var i=lastNonMiss+2;i<data.length;++i){forecasts[i]=(B[B.length-1]+((i-(lastNonMiss))*A[A.length-1]))*S[i-cycleLength];}return forecasts;};_global[algoId].computeMeanSquaredError=function(data,forecast){var lastNonMiss=data.length-1;while(lastNonMiss!=0&&(data[lastNonMiss].y==null||isNaN(data[lastNonMiss].y))){lastNonMiss--;}var firstNonMiss=0;while(firstNonMiss<lastNonMiss&&forecast[firstNonMiss]==null){firstNonMiss++;}var error=0;for(var i=firstNonMiss;i<=lastNonMiss;++i){error+=Math.pow(data[i].y-forecast[i],2);}return 1/(data.length-1)*error;};_global[algoId].findBestParameters=function(data,nbIter,cycleLength){var incr=1/nbIter;var bestAlpha=0;var bestError=-1;var alpha=bestAlpha;var bestGamma=0;var gamma=bestGamma;var bestDelta=0;var delta=bestDelta;var bestParameters=Object();while(alpha<0.999){while(gamma<0.999){while(delta<0.999){var forecast=_global[algoId].wintersSmoothing(data,cycleLength,alpha,gamma,delta);var error=_global[algoId].computeMeanSquaredError(data,forecast);
if(error<bestError||bestError==-1){bestGamma=gamma;bestAlpha=alpha;bestDelta=delta;bestError=error;}delta+=incr;}delta=0;gamma+=incr;}gamma=0;alpha+=incr;}return{alpha:bestAlpha,gamma:bestGamma,delta:bestDelta};};_global[algoId].fillMissingValues=function(data){if(data.length<4){return false;}var lastNonMissing=data.length-1;while(lastNonMissing>=0&&(data[lastNonMissing].y==null||isNaN(data[lastNonMissing].y))){lastNonMissing--;}if(data[0].y==null){var nextNonMissing=1;while((data[nextNonMissing].y||isNaN(data[nextNonMissing].y))==null&&nextNonMissing<=lastNonMissing){nextNonMissing++;}if(nextNonMissing==lastNonMissing){return false;}data[0].y=data[nextNonMissing];}for(var i=1;i<=lastNonMissing;++i){if(data[i].y==null){var nextNonMissing=i+1;while(nextNonMissing<=lastNonMissing&&(data[nextNonMissing].y==null||isNaN(data[nextNonMissing].y))){nextNonMissing++;}data[i].y=(data[i-1].y+(1/(nextNonMissing-i))*data[nextNonMissing].y)/(1+(1/(nextNonMissing-i)));}}return true;};_global[algoId].autoCorrelation=function(data){var lastNonMiss=data.length-1;
while(lastNonMiss!=0&&data[lastNonMiss].y==null){lastNonMiss--;}var autoCorrelationResult=Array();for(var shift=1;shift<lastNonMiss/2;++shift){serie1=data.slice(0,lastNonMiss-shift);serie2=data.slice(shift,lastNonMiss);var n=serie1.length;var sum_x=0;var sum_y=0;var sum_xy=0;var sum_xx=0;var sum_yy=0;var sum=0;for(var i=0;i<serie1.length;i++){sum_x+=serie1[i].y;sum_y+=serie2[i].y;sum_xy+=(serie1[i].y*serie2[i].y);sum_xx+=(serie1[i].y*serie1[i].y);sum_yy+=(serie2[i].y*serie2[i].y);}var correlation=Math.pow((n*sum_xy-sum_x*sum_y)/Math.sqrt((n*sum_xx-sum_x*sum_x)*(n*sum_yy-sum_y*sum_y)),2);autoCorrelationResult.push({shift:shift,correlation:correlation});}return autoCorrelationResult;};_global[algoId].getBestAutoCorrelation=function(autoCorrelationsArray){autoCorr7=null;autoCorr12=null;if(autoCorrelationsArray.length>(7-2)){autoCorr7=autoCorrelationsArray[5]["correlation"];}if(autoCorrelationsArray.length>(12-2)){autoCorr12=autoCorrelationsArray[10]["correlation"];}maxCorr=Math.max(autoCorr7,autoCorr12);
if(maxCorr==autoCorr7){shift=7;corr=autoCorr7;}else{shift=12;corr=autoCorr12;}function compareAutoCorr(o1,o2){return o1.correlation-o2.correlation;}autoCorrelationsArray.sort(compareAutoCorr);if(corr>=0.75*autoCorrelationsArray[0].correlation){return{shift:shift,correlation:corr};}return autoCorrelationsArray[autoCorrelationsArray.length-1];};}if(_global[algoId].result[key]!=null){if(!_global[algoId].result[key].possible){return null;}var indice=_global[algoId].result[key].searchMap[x.toString()];if(_global[algoId].result[key].ma[indice]!=undefined){if(isNaN(_global[algoId].result[key].ma[indice])){return null;}if(lower_bound){return _global[algoId].result[key].ma[indice]-1.96*Math.sqrt(_global[algoId].result[key].error);}else{if(upper_bound){return _global[algoId].result[key].ma[indice]+1.96*Math.sqrt(_global[algoId].result[key].error);}}return _global[algoId].result[key].ma[indice];}return null;}else{_global[algoId].result[key]=Object();var data=_global[algoId].data[key];if(data==null){return null;
}if(data.length>1){_global[algoId].result[key].searchArray=_global[algoId].sortTimeSerie(data);var algoPossible=_global[algoId].fillMissingValues(data);if(!algoPossible){_global[algoId].result[key].possible=false;return null;}_global[algoId].result[key].possible=true;var autoCorrelationResult=_global[algoId].autoCorrelation(data);var bestCorrelation=_global[algoId].getBestAutoCorrelation(autoCorrelationResult);var bestParameters=_global[algoId].findBestParameters(data,nbIter,bestCorrelation.shift);_global[algoId].result[key].ma=_global[algoId].wintersSmoothing(data,bestCorrelation.shift,bestParameters.alpha,bestParameters.gamma,bestParameters.delta);if(!measure_value){_global[algoId].result[key].error=_global[algoId].computeMeanSquaredError(data,_global[algoId].result[key].ma);}_global[algoId].result[key].searchMap={};for(var i=0;i<data.length;++i){_global[algoId].result[key].searchMap[data[i].x.toString()]=i;}}else{return null;}var indice=_global[algoId].result[key].searchMap[x.toString()];
if(_global[algoId].result[key].ma[indice]!=undefined){if(isNaN(_global[algoId].result[key].ma[indice])){return null;}if(lower_bound){return _global[algoId].result[key].ma[indice]-1.96*Math.sqrt(_global[algoId].result[key].error);}else{if(upper_bound){return _global[algoId].result[key].ma[indice]+1.96*Math.sqrt(_global[algoId].result[key].error);}}return _global[algoId].result[key].ma[indice];}return null;}}}function fourierForecast(selection,line,phase,dimDateName,outMeasName,x,y,nbIter,valueType){var algvar="";if(line!=null){algvar=line[selection.measureAxis];}var algoId=outMeasName+algvar;var key=buildKey(line,selection,dimDateName);var measure_value=!valueType||valueType==ESTIMATED_VALUE;var lower_bound=valueType==LOWEST_CONF_INT;var upper_bound=valueType==HIGHEST_CONF_INT;if(phase==0){if(_global[algoId]==undefined){_global[algoId]=Object();_global[algoId].data=Object();_global[algoId].valueTimeSerie=function(x,y){var vts=Object();vts.x=x;vts.y=y;return vts;};_global[algoId].addData=function(x,y,key){if(_global[algoId].data[key]==null){_global[algoId].data[key]=Array();
}_global[algoId].data[key].push(_global[algoId].valueTimeSerie(x,y));};}_global[algoId].addData(x,y,key);return 0;}else{if(_global[algoId].result==null){_global[algoId].result=Object();_global[algoId].FFT=Object();_global[algoId].sortTimeSerie=function(originalData){function compareDates(o1,o2){return o1.x-o2.x;}originalData.sort(compareDates);};void function(namespace){function butterfly2(output,outputOffset,outputStride,fStride,state,m){var t=state.twiddle;for(var i=0;i<m;i++){var s0_r=output[2*((outputOffset)+(outputStride)*(i))],s0_i=output[2*((outputOffset)+(outputStride)*(i))+1];var s1_r=output[2*((outputOffset)+(outputStride)*(i+m))],s1_i=output[2*((outputOffset)+(outputStride)*(i+m))+1];var t1_r=t[2*((0)+(fStride)*(i))],t1_i=t[2*((0)+(fStride)*(i))+1];var v1_r=s1_r*t1_r-s1_i*t1_i,v1_i=s1_r*t1_i+s1_i*t1_r;var r0_r=s0_r+v1_r,r0_i=s0_i+v1_i;var r1_r=s0_r-v1_r,r1_i=s0_i-v1_i;output[2*((outputOffset)+(outputStride)*(i))]=r0_r,output[2*((outputOffset)+(outputStride)*(i))+1]=r0_i;output[2*((outputOffset)+(outputStride)*(i+m))]=r1_r,output[2*((outputOffset)+(outputStride)*(i+m))+1]=r1_i;
}}function butterfly3(output,outputOffset,outputStride,fStride,state,m){var t=state.twiddle;var m1=m,m2=2*m;var fStride1=fStride,fStride2=2*fStride;var e=t[2*((0)+(fStride)*(m))+1];for(var i=0;i<m;i++){var s0_r=output[2*((outputOffset)+(outputStride)*(i))],s0_i=output[2*((outputOffset)+(outputStride)*(i))+1];var s1_r=output[2*((outputOffset)+(outputStride)*(i+m1))],s1_i=output[2*((outputOffset)+(outputStride)*(i+m1))+1];var t1_r=t[2*((0)+(fStride1)*(i))],t1_i=t[2*((0)+(fStride1)*(i))+1];var v1_r=s1_r*t1_r-s1_i*t1_i,v1_i=s1_r*t1_i+s1_i*t1_r;var s2_r=output[2*((outputOffset)+(outputStride)*(i+m2))],s2_i=output[2*((outputOffset)+(outputStride)*(i+m2))+1];var t2_r=t[2*((0)+(fStride2)*(i))],t2_i=t[2*((0)+(fStride2)*(i))+1];var v2_r=s2_r*t2_r-s2_i*t2_i,v2_i=s2_r*t2_i+s2_i*t2_r;var i0_r=v1_r+v2_r,i0_i=v1_i+v2_i;var r0_r=s0_r+i0_r,r0_i=s0_i+i0_i;output[2*((outputOffset)+(outputStride)*(i))]=r0_r,output[2*((outputOffset)+(outputStride)*(i))+1]=r0_i;var i1_r=s0_r-i0_r*0.5;var i1_i=s0_i-i0_i*0.5;var i2_r=(v1_r-v2_r)*e;
var i2_i=(v1_i-v2_i)*e;var r1_r=i1_r-i2_i;var r1_i=i1_i+i2_r;output[2*((outputOffset)+(outputStride)*(i+m1))]=r1_r,output[2*((outputOffset)+(outputStride)*(i+m1))+1]=r1_i;var r2_r=i1_r+i2_i;var r2_i=i1_i-i2_r;output[2*((outputOffset)+(outputStride)*(i+m2))]=r2_r,output[2*((outputOffset)+(outputStride)*(i+m2))+1]=r2_i;}}function butterfly4(output,outputOffset,outputStride,fStride,state,m){var t=state.twiddle;var m1=m,m2=2*m,m3=3*m;var fStride1=fStride,fStride2=2*fStride,fStride3=3*fStride;for(var i=0;i<m;i++){var s0_r=output[2*((outputOffset)+(outputStride)*(i))],s0_i=output[2*((outputOffset)+(outputStride)*(i))+1];var s1_r=output[2*((outputOffset)+(outputStride)*(i+m1))],s1_i=output[2*((outputOffset)+(outputStride)*(i+m1))+1];var t1_r=t[2*((0)+(fStride1)*(i))],t1_i=t[2*((0)+(fStride1)*(i))+1];var v1_r=s1_r*t1_r-s1_i*t1_i,v1_i=s1_r*t1_i+s1_i*t1_r;var s2_r=output[2*((outputOffset)+(outputStride)*(i+m2))],s2_i=output[2*((outputOffset)+(outputStride)*(i+m2))+1];var t2_r=t[2*((0)+(fStride2)*(i))],t2_i=t[2*((0)+(fStride2)*(i))+1];
var v2_r=s2_r*t2_r-s2_i*t2_i,v2_i=s2_r*t2_i+s2_i*t2_r;var s3_r=output[2*((outputOffset)+(outputStride)*(i+m3))],s3_i=output[2*((outputOffset)+(outputStride)*(i+m3))+1];var t3_r=t[2*((0)+(fStride3)*(i))],t3_i=t[2*((0)+(fStride3)*(i))+1];var v3_r=s3_r*t3_r-s3_i*t3_i,v3_i=s3_r*t3_i+s3_i*t3_r;var i0_r=s0_r+v2_r,i0_i=s0_i+v2_i;var i1_r=s0_r-v2_r,i1_i=s0_i-v2_i;var i2_r=v1_r+v3_r,i2_i=v1_i+v3_i;var i3_r=v1_r-v3_r,i3_i=v1_i-v3_i;var r0_r=i0_r+i2_r,r0_i=i0_i+i2_i;if(state.inverse){var r1_r=i1_r-i3_i;var r1_i=i1_i+i3_r;}else{var r1_r=i1_r+i3_i;var r1_i=i1_i-i3_r;}var r2_r=i0_r-i2_r,r2_i=i0_i-i2_i;if(state.inverse){var r3_r=i1_r+i3_i;var r3_i=i1_i-i3_r;}else{var r3_r=i1_r-i3_i;var r3_i=i1_i+i3_r;}output[2*((outputOffset)+(outputStride)*(i))]=r0_r,output[2*((outputOffset)+(outputStride)*(i))+1]=r0_i;output[2*((outputOffset)+(outputStride)*(i+m1))]=r1_r,output[2*((outputOffset)+(outputStride)*(i+m1))+1]=r1_i;output[2*((outputOffset)+(outputStride)*(i+m2))]=r2_r,output[2*((outputOffset)+(outputStride)*(i+m2))+1]=r2_i;
output[2*((outputOffset)+(outputStride)*(i+m3))]=r3_r,output[2*((outputOffset)+(outputStride)*(i+m3))+1]=r3_i;}}function butterfly(output,outputOffset,outputStride,fStride,state,m,p){var t=state.twiddle,n=state.n,scratch=new Array(2*p);for(var u=0;u<m;u++){for(var q1=0,k=u;q1<p;q1++,k+=m){var x0_r=output[2*((outputOffset)+(outputStride)*(k))],x0_i=output[2*((outputOffset)+(outputStride)*(k))+1];scratch[2*(q1)]=x0_r,scratch[2*(q1)+1]=x0_i;}for(var q1=0,k=u;q1<p;q1++,k+=m){var tOffset=0;var x0_r=scratch[2*(0)],x0_i=scratch[2*(0)+1];output[2*((outputOffset)+(outputStride)*(k))]=x0_r,output[2*((outputOffset)+(outputStride)*(k))+1]=x0_i;for(var q=1;q<p;q++){tOffset=(tOffset+fStride*k)%n;var s0_r=output[2*((outputOffset)+(outputStride)*(k))],s0_i=output[2*((outputOffset)+(outputStride)*(k))+1];var s1_r=scratch[2*(q)],s1_i=scratch[2*(q)+1];var t1_r=t[2*(tOffset)],t1_i=t[2*(tOffset)+1];var v1_r=s1_r*t1_r-s1_i*t1_i,v1_i=s1_r*t1_i+s1_i*t1_r;var r0_r=s0_r+v1_r,r0_i=s0_i+v1_i;output[2*((outputOffset)+(outputStride)*(k))]=r0_r,output[2*((outputOffset)+(outputStride)*(k))+1]=r0_i;
}}}}function work(output,outputOffset,outputStride,f,fOffset,fStride,inputStride,factors,state){var p=factors.shift();var m=factors.shift();if(m==1){for(var i=0;i<p*m;i++){var x0_r=f[2*((fOffset)+(fStride*inputStride)*(i))],x0_i=f[2*((fOffset)+(fStride*inputStride)*(i))+1];output[2*((outputOffset)+(outputStride)*(i))]=x0_r,output[2*((outputOffset)+(outputStride)*(i))+1]=x0_i;}}else{for(var i=0;i<p;i++){work(output,outputOffset+outputStride*i*m,outputStride,f,fOffset+i*fStride*inputStride,fStride*p,inputStride,factors.slice(),state);}}switch(p){case 2:butterfly2(output,outputOffset,outputStride,fStride,state,m);break;case 3:butterfly3(output,outputOffset,outputStride,fStride,state,m);break;case 4:butterfly4(output,outputOffset,outputStride,fStride,state,m);break;default:butterfly(output,outputOffset,outputStride,fStride,state,m,p);break;}}var complex=function(n,inverse){if(arguments.length<2){throw new RangeError("You didn't pass enough arguments, passed `"+arguments.length+"'");}var n=~~n,inverse=!!inverse;
if(n<1){throw new RangeError("n is outside range, should be positive integer, was `"+n+"'");}var state={n:n,inverse:inverse,factors:[],twiddle:new Array(2*n),scratch:new Array(2*n)};var t=state.twiddle,theta=2*Math.PI/n;for(var i=0;i<n;i++){if(inverse){var phase=theta*i;}else{var phase=-theta*i;}t[2*(i)]=Math.cos(phase);t[2*(i)+1]=Math.sin(phase);}var p=4,v=Math.floor(Math.sqrt(n));while(n>1){while(n%p){switch(p){case 4:p=2;break;case 2:p=3;break;default:p+=2;break;}if(p>v){p=n;}}n/=p;state.factors.push(p);state.factors.push(n);}this.state=state;};complex.prototype.simple=function(output,input,t){this.process(output,0,1,input,0,1,t);};complex.prototype.process=function(output,outputOffset,outputStride,input,inputOffset,inputStride,t){var outputStride=~~outputStride,inputStride=~~inputStride;var type=t=="real"?t:"complex";if(outputStride<1){throw new RangeError("outputStride is outside range, should be positive integer, was `"+outputStride+"'");}if(inputStride<1){throw new RangeError("inputStride is outside range, should be positive integer, was `"+inputStride+"'");
}if(type=="real"){for(var i=0;i<this.state.n;i++){var x0_r=input[inputOffset+inputStride*i];var x0_i=0;this.state.scratch[2*(i)]=x0_r,this.state.scratch[2*(i)+1]=x0_i;}work(output,outputOffset,outputStride,this.state.scratch,0,1,1,this.state.factors.slice(),this.state);}else{if(input==output){work(this.state.scratch,0,1,input,inputOffset,1,inputStride,this.state.factors.slice(),this.state);for(var i=0;i<this.state.n;i++){var x0_r=this.state.scratch[2*(i)],x0_i=this.state.scratch[2*(i)+1];output[2*((outputOffset)+(outputStride)*(i))]=x0_r,output[2*((outputOffset)+(outputStride)*(i))+1]=x0_i;}}else{work(output,outputOffset,outputStride,input,inputOffset,1,inputStride,this.state.factors.slice(),this.state);}}};namespace.complex=complex;}(_global[algoId].FFT);_global[algoId].fillMissingValues=function(data){var lastNonMissing=data.length-1;while(lastNonMissing>=0&&(data[lastNonMissing].y==null)||isNaN(data[lastNonMissing].y)){lastNonMissing--;}if(data[0].y==null){var nextNonMissing=1;while(data[nextNonMissing].y==null&&nextNonMissing<=lastNonMissing){nextNonMissing++;
}if(nextNonMissing==lastNonMissing){return false;}data[0].y=data[nextNonMissing];}for(var i=1;i<=lastNonMissing;++i){if(data[i].y==null){var nextNonMissing=i+1;while(nextNonMissing<=lastNonMissing&&(data[nextNonMissing].y==null||isNaN(data[nextNonMissing].y))){nextNonMissing++;}data[i].y=(data[i-1].y+(1/(nextNonMissing-i))*data[nextNonMissing].y)/(1+(1/(nextNonMissing-i)));}}};_global[algoId].linearDetrendData=function(data,nb){var n=0;var sum_x=0;var sum_y=0;var sum_xy=0;var sum_xx=0;var sum_yy=0;var sum=0;for(var i=0;i<nb;++i){sum_x+=data[i].x;sum_y+=data[i].y;sum_xy+=(data[i].x*data[i].y);sum_xx+=(data[i].x*data[i].x);sum_yy+=(data[i].y*data[i].y);n++;}var slope=(n*sum_xy-sum_x*sum_y)/(n*sum_xx-sum_x*sum_x);var intercept=(sum_y-slope*sum_x)/n;var detrendedData=[];for(var i=0;i<nb;i++){detrendedData[i]=data[i].y-slope*data[i].x;}return{data:detrendedData,intercept:intercept,slope:slope};};_global[algoId].testRealToComplex=function(data,n){var o1=new Array(2*n);var fft=new _global[algoId].FFT.complex(n,false);
var res=[];res=fft.simple(o1,data,"real");return o1;};_global[algoId].fillIndexes=function(n){var arr=Array();for(var i=0;i<n;i++){arr[i]=i;}return arr;};_global[algoId].zeros=function(n){var arr=Array();for(var i=0;i<n;++i){arr[i]=0;}return arr;};_global[algoId].fftfreq=function(n){var results=[];var val=1/n;var N=Math.floor((n-1)/2)+1;for(var i=0;i<N;i++){results[i]=i;}for(var i=N;i<n;i++){var nbSteps=i-Math.floor(n/2);results[i]=-(N-nbSteps);}for(var i=0;i<results.length;++i){results[i]*=val;}return results;};_global[algoId].sortPairs=function(indexes,freqs){tmpArr=Array();for(var i=0;i<data.length;i++){tmpArr[i]={index:indexes[i],freq:freqs[i]};}function compare(o1,o2){if(o1.freq==undefined){return 1;}if(o2.freq==undefined){return -1;}return(Math.abs(o1.freq)-Math.abs(o2.freq));}tmpArr.sort(compare);var results=Array();for(var i=0;i<tmpArr.length;++i){results[i]=tmpArr[i].index;}return results;};_global[algoId].computeMeanSquaredError=function(data,forecast){var lastNonMiss=data.length-1;
while(lastNonMiss!=0&&(data[lastNonMiss].y==null||isNaN(data[lastNonMiss].y))){lastNonMiss--;}var error=0;for(var i=1;i<=lastNonMiss;++i){error+=Math.pow(data[i].y-forecast[i],2);}return 1/(data.length-1)*error;};_global[algoId].fourierForecast=function(data){var lastNonMiss=data.length-1;while(lastNonMiss!=0&&(data[lastNonMiss].y==null||isNaN(data[lastNonMiss].y))){lastNonMiss--;}var n=lastNonMiss+1;_global[algoId].fillMissingValues(data);var detrendedObj=_global[algoId].linearDetrendData(data,n);var detrendedData=detrendedObj.data;var slope=detrendedObj.slope;var n_harm=35;x_freqdomTmp=_global[algoId].testRealToComplex(detrendedData,n);var x_freqdom=Array();var cpt=0;for(var i=0;i<x_freqdomTmp.length;i+=2){x_freqdom[cpt]={real:x_freqdomTmp[i],imaginary:x_freqdomTmp[i+1]};cpt++;}var norms=Array();for(var i=0;i<x_freqdom.length;++i){norms[i]=Math.sqrt(x_freqdom[i].real*x_freqdom[i].real+x_freqdom[i].imaginary*x_freqdom[i].imaginary);}norms.sort(function(a,b){return b-a;});var freqs=_global[algoId].fftfreq(n);
var indexes=_global[algoId].fillIndexes(n);var indexesSorted=_global[algoId].sortPairs(indexes,freqs);var horizonForecast=data.length-1-lastNonMiss;var t=_global[algoId].fillIndexes(data.length);var restored_sig=_global[algoId].zeros(t.length);if(n_harm>=0.4*lastNonMiss){n_harm=Math.floor(lastNonMiss/3.5)+1;}for(var i=0;i<(1+n_harm*2);++i){var ind=indexesSorted[i];if(ind==undefined){break;}var ampliTmp={real:Math.abs(x_freqdom[ind].real)/n,imaginary:Math.abs(x_freqdom[ind].imaginary)/n};var ampli=Math.sqrt(ampliTmp.real*ampliTmp.real+ampliTmp.imaginary*ampliTmp.imaginary);var phase=Math.atan2(x_freqdom[ind].imaginary,x_freqdom[ind].real);var factor=2*Math.PI*freqs[ind];for(var j=0;j<t.length;++j){restored_sig[j]+=ampli*Math.cos(factor*t[j]+phase);}}extrapolation=Array();for(var i=0;i<data.length;++i){extrapolation[i]=restored_sig[i]+slope*data[i].x;}return extrapolation;};}if(_global[algoId].result[key]!=null){var indice=_global[algoId].result[key].searchMap[x.toString()];if(_global[algoId].result[key].ma[indice]!=undefined){if(isNaN(_global[algoId].result[key].ma[indice])){return null;
}return _global[algoId].result[key].ma[indice];}return null;}else{_global[algoId].result[key]=Object();var data=_global[algoId].data[key];if(data==null){return null;}if(data.length>2){_global[algoId].sortTimeSerie(data);_global[algoId].result[key].ma=_global[algoId].fourierForecast(data);_global[algoId].result[key].searchMap={};for(var i=0;i<data.length;++i){_global[algoId].result[key].searchMap[data[i].x.toString()]=i;}if(!measure_value){_global[algoId].result[key].error=_global[algoId].computeMeanSquaredError(data,_global[algoId].result[key].ma);var factor=-1;if(upper_bound){factor=1;}for(var i=0;i<data.length;++i){_global[algoId].result[key].ma[i]+=factor*1.96*Math.sqrt(_global[algoId].result[key].error);}}}else{_global[algoId].result[key].searchMap={};for(var i=0;i<data.length;++i){_global[algoId].result[key].searchMap[data[i].x.toString()]=i;}_global[algoId].result[key].ma=[];for(var i=0;i<data.length;++i){_global[algoId].result[key].ma[i]=null;}}var indice=_global[algoId].result[key].searchMap[x.toString()];
if(_global[algoId].result[key].ma[indice]!=undefined){if(isNaN(_global[algoId].result[key].ma[indice])){return null;}return _global[algoId].result[key].ma[indice];}return null;}}}